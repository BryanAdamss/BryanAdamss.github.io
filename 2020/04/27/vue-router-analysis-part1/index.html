<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="vue,vue-router,Ê∫êÁ†ÅËß£Êûê," />








  <link rel="shortcut icon" type="image/x-icon" href="/Avatar.png?v=5.1.0" />






<meta name="description" content="vue-router Ê∫êÁ†ÅËß£Êûê | 1.3w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé vue-routerÊòØÊØè‰∏™vueÂºÄÂèëËÄÖÈÉΩ‰ºöÊé•Ëß¶Âà∞ÁöÑ‰∏Ä‰∏™Êèí‰ª∂ Êú¨ÁùÄËøΩÊú¨Ê∫ØÊ∫êÁöÑÁêÜÂøµÔºåÊàëÂºÄÂêØ‰∫Üvue-routerÊ∫êÁ†ÅÂàÜÊûê‰πãË∑Ø üòÇ Â§©Â§©Âä†Áè≠ÔºåÊâÄ‰ª•ÂâçÂâçÂêéÂêéËä±‰∫ÜÂ•ΩÂá†‰∏™ÊúàÊó∂Èó¥ Êó∂Èó¥ÊãñÁöÑÂæàÈïøÔºåÊâÄ‰ª•ÂèØËÉΩÂ≠òÂú®ÊÄùË∑Ø‰∏çËøûË¥ØÁöÑÊÉÖÂÜµÔºåËøòÊúõËßÅË∞Ö ü§£ Áî±‰∫éÊéòÈáëÂ≠óÊï∞ÈôêÂà∂ÔºåÊâÄ‰ª•ÂàÜ‰∏∫‰∏ä‰∏≠‰∏ã‰∏âÁØáÊù•‰ªãÁªç ‰∏äÁØáÂç≥Êú¨ÁØáÔºå‰∏ªË¶Å‰ªãÁªç‰∫ÜÂâçÁ´ØË∑Ø">
<meta name="keywords" content="vue,vue-router,Ê∫êÁ†ÅËß£Êûê">
<meta property="og:type" content="article">
<meta property="og:title" content="vue-router-analysis-part1">
<meta property="og:url" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/index.html">
<meta property="og:site_name" content="BryanAdamssÁöÑÂçöÂÆ¢">
<meta property="og:description" content="vue-router Ê∫êÁ†ÅËß£Êûê | 1.3w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé vue-routerÊòØÊØè‰∏™vueÂºÄÂèëËÄÖÈÉΩ‰ºöÊé•Ëß¶Âà∞ÁöÑ‰∏Ä‰∏™Êèí‰ª∂ Êú¨ÁùÄËøΩÊú¨Ê∫ØÊ∫êÁöÑÁêÜÂøµÔºåÊàëÂºÄÂêØ‰∫Üvue-routerÊ∫êÁ†ÅÂàÜÊûê‰πãË∑Ø üòÇ Â§©Â§©Âä†Áè≠ÔºåÊâÄ‰ª•ÂâçÂâçÂêéÂêéËä±‰∫ÜÂ•ΩÂá†‰∏™ÊúàÊó∂Èó¥ Êó∂Èó¥ÊãñÁöÑÂæàÈïøÔºåÊâÄ‰ª•ÂèØËÉΩÂ≠òÂú®ÊÄùË∑Ø‰∏çËøûË¥ØÁöÑÊÉÖÂÜµÔºåËøòÊúõËßÅË∞Ö ü§£ Áî±‰∫éÊéòÈáëÂ≠óÊï∞ÈôêÂà∂ÔºåÊâÄ‰ª•ÂàÜ‰∏∫‰∏ä‰∏≠‰∏ã‰∏âÁØáÊù•‰ªãÁªç ‰∏äÁØáÂç≥Êú¨ÁØáÔºå‰∏ªË¶Å‰ªãÁªç‰∫ÜÂâçÁ´ØË∑Ø">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/sequence.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-config.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-component.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/directory.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/examples.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/src.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/declarations.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/root-instance.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/install.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-mode.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/create-matcher.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-map-obj.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/create-route-map-sequence.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/path-to-regex-demo.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/nested-route.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/alias-route.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/add-route-record.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-mode-class.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/h5history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/hash-history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/abstract-history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/vue-router-instance.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/init.png">
<meta property="og:updated_time" content="2020-12-06T04:24:32.735Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vue-router-analysis-part1">
<meta name="twitter:description" content="vue-router Ê∫êÁ†ÅËß£Êûê | 1.3w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé vue-routerÊòØÊØè‰∏™vueÂºÄÂèëËÄÖÈÉΩ‰ºöÊé•Ëß¶Âà∞ÁöÑ‰∏Ä‰∏™Êèí‰ª∂ Êú¨ÁùÄËøΩÊú¨Ê∫ØÊ∫êÁöÑÁêÜÂøµÔºåÊàëÂºÄÂêØ‰∫Üvue-routerÊ∫êÁ†ÅÂàÜÊûê‰πãË∑Ø üòÇ Â§©Â§©Âä†Áè≠ÔºåÊâÄ‰ª•ÂâçÂâçÂêéÂêéËä±‰∫ÜÂ•ΩÂá†‰∏™ÊúàÊó∂Èó¥ Êó∂Èó¥ÊãñÁöÑÂæàÈïøÔºåÊâÄ‰ª•ÂèØËÉΩÂ≠òÂú®ÊÄùË∑Ø‰∏çËøûË¥ØÁöÑÊÉÖÂÜµÔºåËøòÊúõËßÅË∞Ö ü§£ Áî±‰∫éÊéòÈáëÂ≠óÊï∞ÈôêÂà∂ÔºåÊâÄ‰ª•ÂàÜ‰∏∫‰∏ä‰∏≠‰∏ã‰∏âÁØáÊù•‰ªãÁªç ‰∏äÁØáÂç≥Êú¨ÁØáÔºå‰∏ªË¶Å‰ªãÁªç‰∫ÜÂâçÁ´ØË∑Ø">
<meta name="twitter:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/sequence.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Âçö‰∏ª'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/04/27/vue-router-analysis-part1/"/>





  <title> vue-router-analysis-part1 | BryanAdamssÁöÑÂçöÂÆ¢ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BryanAdamssÁöÑÂçöÂÆ¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">‰∏Ä‰∏™‰º™ÂâçÁ´Ø</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            È¶ñÈ°µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            ÂàÜÁ±ª
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            ÂΩíÊ°£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Ê†áÁ≠æ
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            ÊêúÁ¥¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="ÊêúÁ¥¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/27/vue-router-analysis-part1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BryanAdamss">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/Avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BryanAdamssÁöÑÂçöÂÆ¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                vue-router-analysis-part1
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂèëË°®‰∫é</span>
              
              <time title="ÂàõÂª∫‰∫é" itemprop="dateCreated datePublished" datetime="2020-04-27T22:48:40+08:00">
                2020-04-27 22:48:40
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂàÜÁ±ª‰∫é</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FrontEnd/" itemprop="url" rel="index">
                    <span itemprop="name">ÂâçÁ´Ø</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="vue-router-Ê∫êÁ†ÅËß£Êûê-1-3w-Â≠ó-Â§öÂõæÈ¢ÑË≠¶-„Äê‰∏ä„Äë"><a href="#vue-router-Ê∫êÁ†ÅËß£Êûê-1-3w-Â≠ó-Â§öÂõæÈ¢ÑË≠¶-„Äê‰∏ä„Äë" class="headerlink" title="vue-router Ê∫êÁ†ÅËß£Êûê | 1.3w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë"></a>vue-router Ê∫êÁ†ÅËß£Êûê | 1.3w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë</h1><ul>
<li>ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé</li>
<li><code>vue-router</code>ÊòØÊØè‰∏™<code>vueÂºÄÂèëËÄÖ</code>ÈÉΩ‰ºöÊé•Ëß¶Âà∞ÁöÑ‰∏Ä‰∏™Êèí‰ª∂</li>
<li>Êú¨ÁùÄËøΩÊú¨Ê∫ØÊ∫êÁöÑÁêÜÂøµÔºåÊàëÂºÄÂêØ‰∫Ü<code>vue-router</code>Ê∫êÁ†ÅÂàÜÊûê‰πãË∑Ø üòÇ</li>
<li>Â§©Â§©Âä†Áè≠ÔºåÊâÄ‰ª•ÂâçÂâçÂêéÂêéËä±‰∫ÜÂ•ΩÂá†‰∏™ÊúàÊó∂Èó¥</li>
<li>Êó∂Èó¥ÊãñÁöÑÂæàÈïøÔºåÊâÄ‰ª•ÂèØËÉΩÂ≠òÂú®ÊÄùË∑Ø‰∏çËøûË¥ØÁöÑÊÉÖÂÜµÔºåËøòÊúõËßÅË∞Ö ü§£</li>
<li>Áî±‰∫éÊéòÈáëÂ≠óÊï∞ÈôêÂà∂ÔºåÊâÄ‰ª•ÂàÜ‰∏∫‰∏ä‰∏≠‰∏ã‰∏âÁØáÊù•‰ªãÁªç</li>
<li>‰∏äÁØáÂç≥Êú¨ÁØáÔºå‰∏ªË¶Å‰ªãÁªç‰∫ÜÂâçÁ´ØË∑ØÁî±ÁöÑËÆæËÆ°ÊÄùË∑ØÂèäÂÆûÁé∞Âü∫Êú¨ÂéüÂàô„ÄÅ<code>vue-router</code>ÁöÑÁõ∏ÂÖ≥ÊúØËØ≠„ÄÅÁõÆÂΩïÁªìÊûÑ„ÄÅÂÆâË£Ö„ÄÅÂÆû‰æãÂåñ„ÄÅÂàùÂßãÂåñÁõ∏ÂÖ≥ÂÆûÁé∞</li>
<li>‰∏≠ÁØá‰ªãÁªç‰∫ÜÂÖ∂Ê†∏ÂøÉÁâπÊÄßË∑ØÁî±ÂåπÈÖç„ÄÅÂØºËà™ÂÆàÂç´Ëß¶ÂèëÁöÑÊú∫Âà∂</li>
<li>‰∏ãÁØá‰∏∫Êî∂Â∞æÁØáÔºå‰ªãÁªç‰∫Ü‰∏Ä‰∫õÈùûÊ†∏ÂøÉÁâπÊÄßÔºåÂ¶ÇÊªöÂä®Â§ÑÁêÜ„ÄÅ<code>view,link</code>ÁªÑ‰ª∂ÁöÑÂÆûÁé∞</li>
<li>Á¨¨‰∏ÄÊ¨°ÂÅöÊ∫êÁ†ÅËß£ÊûêÔºåËÇØÂÆöÊúâÂæàÂ§öÈîôËØØÊàñÁêÜËß£‰∏çÂà∞‰ΩçÁöÑÂú∞ÊñπÔºåÊ¨¢ËøéÊåáÊ≠£ ü§û</li>
<li>È°πÁõÆÂú∞ÂùÄ<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis</code></li>
<li>Â¶ÇÊûúËßâÂæóÂØπ‰Ω†ÊúâÂ∏ÆÂä©ÔºåËÆ∞ÂæóÁªôÊàë‰∏Ä‰∏™<code>star</code>‚ú®</li>
</ul>
</li>
<li>uml ÂõæÊ∫êÊñá‰ª∂<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis/blob/dev/vue-router.EAP</code></li>
</ul>
</li>
<li>ÂÖ≥ËÅîÊñáÁ´†ÈìæÊé•<ul>
<li><a href="https://juejin.cn/post/6880529850159874062" target="_blank" rel="noopener">vue-router Ê∫êÁ†ÅËß£Êûê | 1.3w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë</a></li>
<li><a href="https://juejin.cn/post/6901047675227996167" target="_blank" rel="noopener">vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë</a></li>
<li><a href="https://juejin.cn/post/6902992939115855880" target="_blank" rel="noopener">vue-router Ê∫êÁ†ÅËß£Êûê | 6k Â≠ó - „Äê‰∏ã„Äë</a></li>
</ul>
</li>
</ul>
<h2 id="ËÆæËÆ°ÊÄùË∑Ø"><a href="#ËÆæËÆ°ÊÄùË∑Ø" class="headerlink" title="ËÆæËÆ°ÊÄùË∑Ø"></a>ËÆæËÆ°ÊÄùË∑Ø</h2><ul>
<li>Âú®Ëß£Êûê<code>vue-router</code>Ëøô‰∏™Ë∑ØÁî±Â∫ìÂâçÔºåÊàë‰ª¨Ë¶Å‰∫ÜËß£‰ªÄ‰πàÊòØË∑ØÁî±Ôºå‰ªÄ‰πàÊòØÂâçÁ´ØË∑ØÁî±ÔºüÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±ÁöÑÂ∏∏ËßÑÂ•óË∑ØÊòØ‰ªÄ‰πàÔºü</li>
</ul>
<h3 id="‰ªÄ‰πàÊòØÂâçÁ´ØË∑ØÁî±"><a href="#‰ªÄ‰πàÊòØÂâçÁ´ØË∑ØÁî±" class="headerlink" title="‰ªÄ‰πàÊòØÂâçÁ´ØË∑ØÁî±"></a>‰ªÄ‰πàÊòØÂâçÁ´ØË∑ØÁî±</h3><ul>
<li>ÂÖ≥‰∫éË∑ØÁî±ÁöÑÂÆö‰πâÔºåÁª¥Âü∫ÊòØËøôÊ†∑ÂÆö‰πâÁöÑÔºõ<code>Ë∑ØÁî±ÔºàroutingÔºâÂ∞±ÊòØÈÄöËøá‰∫íËÅîÁöÑÁΩëÁªúÊää‰ø°ÊÅØ‰ªéÊ∫êÂú∞ÂùÄ‰º†ËæìÂà∞ÁõÆÁöÑÂú∞ÂùÄÁöÑÊ¥ªÂä®„ÄÇË∑ØÁî±ÂèëÁîüÂú®OSIÁΩëÁªúÂèÇËÄÉÊ®°Âûã‰∏≠ÁöÑÁ¨¨‰∏âÂ±ÇÂç≥ÁΩëÁªúÂ±Ç„ÄÇË∑ØÁî±ÂºïÂØºÂàÜÁªÑËΩ¨ÈÄÅÔºåÁªèËøá‰∏Ä‰∫õ‰∏≠Èó¥ÁöÑËäÇÁÇπÂêéÔºåÂà∞ÂÆÉ‰ª¨ÊúÄÂêéÁöÑÁõÆÁöÑÂú∞„ÄÇ‰ΩúÊàêÁ°¨‰ª∂ÁöÑËØùÔºåÂàôÁß∞‰∏∫Ë∑ØÁî±Âô®„ÄÇË∑ØÁî±ÈÄöÂ∏∏Ê†πÊçÆË∑ØÁî±Ë°®‚Äî‚Äî‰∏Ä‰∏™Â≠òÂÇ®Âà∞ÂêÑ‰∏™ÁõÆÁöÑÂú∞ÁöÑÊúÄ‰Ω≥Ë∑ØÂæÑÁöÑË°®‚Äî‚ÄîÊù•ÂºïÂØºÂàÜÁªÑËΩ¨ÈÄÅ</code></li>
<li>‰∏äÈù¢ÁöÑÂÆö‰πâÂèØËÉΩÂæàÂÆòÊñπÔºå‰ΩÜÊòØÊàë‰ª¨ÂèØ‰ª•ÊäΩÂá∫‰∏Ä‰∫õÈáçÁÇπ<ul>
<li>Ë∑ØÁî±ÊòØ‰∏ÄÁßçÊ¥ªÂä®ÔºåË¥üË¥£Â∞Ü‰ø°ÊÅØ‰ªéÊ∫êÂú∞ÂùÄ‰º†ËæìÂà∞ÁõÆÁöÑÂú∞ÂùÄÔºõ</li>
<li>Ë¶ÅÂÆåÊàêËøôÊ†∑‰∏Ä‰∏™Ê¥ªÂä®ÈúÄË¶Å‰∏Ä‰∏™ÂæàÈáçË¶ÅÁöÑ‰∏úË•ø<strong>Ë∑ØÁî±Ë°®</strong>-Ê∫êÂú∞ÂùÄÂíåÁõÆÊ†áÂú∞ÂùÄÁöÑÊò†Â∞ÑË°®</li>
</ul>
</li>
<li><code>Âú®webÂêéÂè∞ÂºÄÂèë‰∏≠Ôºå‚Äúroute‚ÄùÊòØÊåáÊ†πÊçÆurlÂàÜÈÖçÂà∞ÂØπÂ∫îÁöÑÂ§ÑÁêÜÁ®ãÂ∫è„ÄÇ</code>ÔºõÂºïÁî®Ëá™<code>https://www.zhihu.com/question/46767015</code>@Ë¥∫Â∏à‰øä<ul>
<li>Áî®Êà∑ËæìÂÖ•‰∏Ä‰∏™ urlÔºåÊµèËßàÂô®‰º†ÈÄíÁªôÊúçÂä°Á´ØÔºåÊúçÂä°Á´ØÂåπÈÖçÊò†Â∞ÑË°®ÔºåÊâæÂà∞ÂØπÂ∫îÁöÑÂ§ÑÁêÜÁ®ãÂ∫èÔºåËøîÂõûÂØπÂ∫îÁöÑËµÑÊ∫ê(È°µÈù¢ or ÂÖ∂ÂÆÉ)Ôºõ</li>
</ul>
</li>
<li>ÂØπ‰∫éÂâçÁ´ØÊù•ËØ¥ÔºåË∑ØÁî±Ê¶ÇÂøµÁöÑÂá∫Áé∞ÊòØ‰º¥ÈöèÁùÄ<code>spa</code>Âá∫Áé∞ÁöÑÔºõÂú®<code>spa</code>Âá∫Áé∞‰πãÂâçÔºåÈ°µÈù¢ÁöÑË∑≥ËΩ¨(ÂØºËà™)ÈÉΩÊòØÈÄöËøáÊúçÂä°Á´ØÊéßÂà∂ÁöÑÔºåÂπ∂‰∏îË∑≥ËΩ¨Â≠òÂú®‰∏Ä‰∏™ÊòéÊòæÁôΩÂ±èË∑≥ËΩ¨ËøáÁ®ãÔºõ<code>spa</code>Âá∫Áé∞ÂêéÔºå‰∏∫‰∫ÜÊõ¥Â•ΩÁöÑ‰ΩìÈ™åÔºåÂ∞±Ê≤°ÊúâÂÜçËÆ©ÊúçÂä°Á´ØÊéßÂà∂Ë∑≥ËΩ¨‰∫ÜÔºå‰∫éÊòØÂâçÁ´ØË∑ØÁî±Âá∫Áé∞‰∫ÜÔºåÂâçÁ´ØÂèØ‰ª•Ëá™Áî±ÊéßÂà∂ÁªÑ‰ª∂ÁöÑÊ∏≤ÊüìÔºåÊù•Ê®°ÊãüÈ°µÈù¢Ë∑≥ËΩ¨</li>
<li>Â∞èÁªì<ul>
<li>ÊúçÂä°Á´ØË∑ØÁî±Ê†πÊçÆ<code>url</code>ÂàÜÈÖçÂØπÂ∫îÂ§ÑÁêÜÁ®ãÂ∫èÔºåËøîÂõûÈ°µÈù¢„ÄÅÊé•Âè£ËøîÂõû</li>
<li>ÂâçÁ´ØË∑ØÁî±ÊòØÈÄöËøá<code>js</code>Ê†πÊçÆ<code>url</code>ËøîÂõûÂØπÂØπÂ∫îÁªÑ‰ª∂</li>
</ul>
</li>
</ul>
<h3 id="Â¶Ç‰ΩïÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±"><a href="#Â¶Ç‰ΩïÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±" class="headerlink" title="Â¶Ç‰ΩïÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±"></a>Â¶Ç‰ΩïÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±</h3><ul>
<li>Áúã‰∫Ü‰∏äÈù¢ÁöÑÂÆö‰πâÔºåË¶ÅÂÆûÁé∞Ë∑ØÁî±ÔºåÈúÄË¶Å‰∏Ä‰∏™ÂæàÈáçË¶ÅÁöÑ‰∏úË•ø-Ë∑ØÁî±Êò†Â∞ÑË°®Ôºõ<ul>
<li>ÊúçÂä°Á´ØÂÅöË∑ØÁî±È°µÈù¢Ë∑≥ËΩ¨Êó∂ÔºåÊò†Â∞ÑË°®ÁöÑÂèçÊò†ÁöÑÊòØ<code>url</code>Âíå<code>È°µÈù¢</code>ÁöÑÂÖ≥Á≥ª</li>
<li>Áé∞Âú®ÂâçÁ´ØÂü∫Êú¨Ëµ∞Ê®°ÂùóÂåñ‰∫ÜÔºåÊâÄ‰ª•ÂâçÁ´ØÁöÑË∑ØÁî±Êò†Â∞ÑË°®ÂèçÊò†ÁöÑÊòØ<code>url</code>Âíå<code>ÁªÑ‰ª∂</code>ÁöÑÂÖ≥Á≥ª</li>
</ul>
</li>
<li>Â∞±ÂÉè‰∏ãÈù¢ÁöÑ‰º™‰ª£Á†Å‰∏ÄÊ†∑</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ‰ΩøÁî®es6 map</span></span><br><span class="line"><span class="keyword">const</span> routeMap = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">'/'</span>, È¶ñÈ°µÁªÑ‰ª∂],</span><br><span class="line">  [<span class="string">'/bar'</span>, BarÁªÑ‰ª∂],</span><br><span class="line">  [<span class="string">'/bar/foo'</span>, FooÁªÑ‰ª∂],</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ‰Ω†‰πüÂèØ‰ª•Áî®ÂØπË±°Â≠óÈù¢Èáè</span></span><br><span class="line"><span class="keyword">const</span> routeMap = &#123;</span><br><span class="line">  <span class="string">'/'</span>: È¶ñÈ°µÁªÑ‰ª∂,</span><br><span class="line">  <span class="string">'/bar'</span>: BarÁªÑ‰ª∂,</span><br><span class="line">  <span class="string">'/bar/foo'</span>: FooÁªÑ‰ª∂,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Êúâ‰∫ÜÊò†Â∞ÑË°®ÔºåÊàë‰ª¨Â∞±Áü•ÈÅì<code>url</code>ÂíåÁªÑ‰ª∂ÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÔºõ</li>
<li>‰ΩÜÊòØÔºåÊò†Â∞ÑË°®Áª¥Êä§ÁöÑÂè™ÊòØ‰∏Ä‰∏™ÂÖ≥Á≥ªÔºåÂπ∂‰∏çËÉΩÂ∏ÆÊàë‰ª¨ÂÆåÊàêÔºåËÆøÈóÆ<code>/bar</code>ÔºåËøîÂõû<code>BarÁªÑ‰ª∂</code>ËøôÊ†∑‰∏Ä‰∏™ÊµÅÁ®ãÔºåÊâÄ‰ª•Êàë‰ª¨ËøòÈúÄË¶Å‰∏Ä‰∏™ÂåπÈÖçÂô®ÔºåÊù•Â∏ÆÊàë‰ª¨ÂÆåÊàê‰ªé<code>url</code>Âà∞<code>ÁªÑ‰ª∂</code>ÁöÑÂåπÈÖçÂ∑•‰ΩúÔºõ</li>
<li>ÊòØ‰∏çÊòØÊúâ‰∫Ü<code>Ë∑ØÁî±Êò†Â∞ÑË°®</code>Âíå<code>ÂåπÈÖçÂô®</code>Â∞±ÂèØ‰ª•ÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±‰∫ÜÂë¢Ôºü</li>
<li>Êàë‰ª¨ÁöÑ<code>spa</code>ÊòØËøêË°åÂú®ÊµèËßàÂô®ÁéØÂ¢É‰∏≠ÁöÑÔºåÊµèËßàÂô®ÊòØÊúâ<code>ÂâçËøõ„ÄÅËøîÂõû</code>ÂäüËÉΩÁöÑÔºåÈúÄË¶ÅÊàë‰ª¨ËÆ∞ÂΩïËÆøÈóÆËøáÁöÑ<code>url</code>Ôºõ<ul>
<li>Êàë‰ª¨Áü•ÈÅìÔºåË¶ÅÂÆûÁé∞ËøôÁßçÁ±ª‰ºº<code>Êí§ÈîÄ„ÄÅÊÅ¢Â§ç</code>ÁöÑÂäüËÉΩÔºåËÇØÂÆöÈúÄË¶Å‰ΩøÁî®Âà∞‰∏ÄÁßçÊï∞ÊçÆÁªìÊûÑ-<code>Ê†à(stack)</code>ÔºõÊØèËÆøÈóÆ‰∏Ä‰∏™<code>url</code>ÔºåÂ∞Ü<code>url</code>Ôºå<code>push</code>Âà∞Ê†à‰∏≠ÔºåËøîÂõûÊó∂ÔºåÊâßË°å<code>pop</code>Âç≥ÂèØÊãøÂà∞‰∏ä‰∏ÄÊ¨°ËÆøÈóÆÁöÑ<code>url</code></li>
<li>Â•ΩÂú®ÊµèËßàÂô®Âπ≥Âè∞ÔºåÂ∑≤ÁªèÁªôÊàë‰ª¨Êèê‰æõ‰∫ÜËøôÊ†∑ÁöÑÊ†àÔºåÊó†ÈúÄÊàë‰ª¨Ëá™Â∑±ÂÆûÁé∞ÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂéªË∞ÉÁî®ÂÆÉÁöÑÊé•Âè£<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noopener">window.history</a>ÂÆûÁé∞ÂäüËÉΩÂç≥ÂèØ</li>
</ul>
</li>
<li>Áîª‰∫Ü‰∏™ÂõæÔºåÊèèËø∞‰∫Ü‰∏ã‰∏âËÄÖÂçè‰ΩúÂÖ≥Á≥ª<ul>
<li>sequence.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/sequence.png" alt="sequence.png"></li>
</ul>
</li>
</ul>
</li>
<li>ÂΩìÊàë‰ª¨ËÆøÈóÆÊüê‰∏™ url Êó∂ÔºåÂ¶Ç<code>/foo</code>ÔºåÂåπÈÖçÂô®‰ºöÊãøÁùÄ<code>/foo</code>ÂéªË∑ØÁî±Êò†Â∞ÑË°®‰∏≠ÂéªÊü•ÊâæÂØπÂ∫îÁöÑÁªÑ‰ª∂ÔºåÂπ∂Â∞ÜÁªÑ‰ª∂ËøîÂõûÊ∏≤ÊüìÔºåÂêåÊó∂Â∞ÜËÆøÈóÆËÆ∞ÂΩïÊé®ÂÖ•ÂéÜÂè≤Ê†à‰∏≠</li>
<li>ÂΩìÊàë‰ª¨ÈÄöËøáÂâçËøõ/ÂêéÈÄÄÂéªËÆøÈóÆÊüê‰∏™<code>url</code>Êó∂Ôºå‰ºöÂÖà‰ªéÂéÜÂè≤Ê†à‰∏≠ÊâæÂà∞ÂØπÂ∫î<code>url</code>ÔºåÁÑ∂ÂêéÂåπÈÖçÂô®Êãø<code>url</code>ÂéªÊâæÁªÑ‰ª∂ÔºåÂπ∂ËøîÂõûÊ∏≤ÊüìÔºõÂè™‰∏çËøáÔºåËøôÊòØÈÄöËøáÂâçËøõ/ÂêéÈÄÄÂÆûÁé∞ËÆøÈóÆÁöÑÔºåÊâÄ‰ª•‰∏çÈúÄË¶ÅÂÜçÊé®ÂÖ•ÂéÜÂè≤Ê†à‰∫Ü</li>
</ul>
<h3 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h3><ul>
<li>Ë¶ÅÂÆûÁé∞‰∏Ä‰∏™ÂâçÁ´ØË∑ØÁî±ÔºåÈúÄË¶Å‰∏â‰∏™ÈÉ®ÂàÜ<ul>
<li>Ë∑ØÁî±Êò†Â∞ÑË°®<ul>
<li>‰∏Ä‰∏™ËÉΩË°®Ëææ<code>url</code>Âíå<code>ÁªÑ‰ª∂</code>ÂÖ≥Á≥ªÁöÑÊò†Â∞ÑË°®ÔºåÂèØ‰ª•‰ΩøÁî®<code>Map</code>„ÄÅ<code>ÂØπË±°Â≠óÈù¢Èáè</code>Êù•ÂÆûÁé∞</li>
</ul>
</li>
<li>ÂåπÈÖçÂô®<ul>
<li>Ë¥üË¥£Âú®ËÆøÈóÆ<code>url</code>Êó∂ÔºåËøõË°åÂåπÈÖçÔºåÊâæÂá∫ÂØπÂ∫îÁöÑ<code>ÁªÑ‰ª∂</code></li>
</ul>
</li>
<li>ÂéÜÂè≤ËÆ∞ÂΩïÊ†à<ul>
<li>ÊµèËßàÂô®Âπ≥Âè∞ÔºåÂ∑≤ÁªèÂéüÁîüÊîØÊåÅÔºåÊó†ÈúÄÂÆûÁé∞ÔºåÁõ¥Êé•Ë∞ÉÁî®Êé•Âè£</li>
</ul>
</li>
</ul>
</li>
<li>Áé∞Âú®‰∏çÁî®Á∫†Áªì‰ªñ‰ª¨ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Ôºå‰Ω†Âè™ÈúÄË¶ÅÁü•ÈÅìÊúâËøô‰∏â‰∏™‰∏úË•øÔºåÂπ∂‰∏î‰ªñ‰ª¨Â§ßÊ¶ÇÊòØÂ¶Ç‰ΩïÂçè‰ΩúÁöÑÂ∞±ÂèØ‰ª•‰∫ÜÔºõ</li>
<li>ÂêéÈù¢Êàë‰ª¨Â∞Ü‰∏ÄËµ∑ÁúãÁúã<code>vue-router</code>Â¶Ç‰ΩïÂà©Áî®‰ªñ‰ª¨ÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±ÁöÑ</li>
</ul>
<h2 id="ÊúØËØ≠"><a href="#ÊúØËØ≠" class="headerlink" title="ÊúØËØ≠"></a>ÊúØËØ≠</h2><ul>
<li>Âú®ÂàÜÊûê<code>vue-router</code>Ê∫êÁ†ÅÂâçÔºåÊàë‰ª¨ÂÖà‰∫ÜËß£‰∏ã<code>vue-router</code>‰∏≠Â∏∏Âá∫Áé∞ÁöÑ‰∏Ä‰∫õÊ¶ÇÂøµÊúØËØ≠ÔºåÂ¶ÇÊûúÁêÜËß£Ëµ∑Êù•ÂêÉÂäõÔºåÂèØ‰ª•ÂÖàË∑≥ËøáÔºåÂêéÈù¢ÈÅáÂà∞ÔºåÂÜçÂõûÊù•ÁúãÔºõ</li>
</ul>
<h3 id="Ë∑ØÁî±ËßÑÂàô„ÄÅÈÖçÁΩÆÂØπË±°-RouteConfig"><a href="#Ë∑ØÁî±ËßÑÂàô„ÄÅÈÖçÁΩÆÂØπË±°-RouteConfig" class="headerlink" title="Ë∑ØÁî±ËßÑÂàô„ÄÅÈÖçÁΩÆÂØπË±°(RouteConfig)"></a>Ë∑ØÁî±ËßÑÂàô„ÄÅÈÖçÁΩÆÂØπË±°(<code>RouteConfig</code>)</h3><ul>
<li>Ë∑ØÁî±ÁöÑÈÖçÁΩÆÈ°πÔºåÁî®Êù•ÊèèËø∞Ë∑ØÁî±</li>
<li>‰∏ãÂõæÁ∫¢Ê°ÜÈáåÈù¢Ê†áÂá∫Êù•ÁöÑÈÉΩÊòØË∑ØÁî±ÈÖçÁΩÆÂØπË±°</li>
<li>route-config.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-config.png" alt="route-config.png"></li>
</ul>
</li>
<li>Âõ†‰∏∫<code>vue-router</code>ÊòØÊîØÊåÅ<code>ÂµåÂ•óË∑ØÁî±</code>ÁöÑÔºåÊâÄ‰ª•ÈÖçÁΩÆÂØπË±°‰πüÊòØÂèØ‰ª•Áõ∏‰∫íÂµåÂ•óÁöÑ</li>
<li>ÂÆåÊï¥ÁöÑÂΩ¢Áä∂Â¶Ç‰∏ã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> RouteConfig = &#123;</span><br><span class="line">  path: <span class="built_in">string</span>,</span><br><span class="line">  component?: Component,<span class="comment">// Ë∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line">  name?: <span class="built_in">string</span>, <span class="comment">// ÂëΩÂêçË∑ØÁî±</span></span><br><span class="line">  components?: &#123; [name: <span class="built_in">string</span>]: Component &#125;, <span class="comment">// ÂëΩÂêçËßÜÂõæÁªÑ‰ª∂</span></span><br><span class="line">  redirect?: <span class="built_in">string</span> | Location | <span class="built_in">Function</span>,</span><br><span class="line">  props?: <span class="built_in">boolean</span> | <span class="built_in">Object</span> | <span class="built_in">Function</span>,</span><br><span class="line">  alias?: <span class="built_in">string</span> | <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;,</span><br><span class="line">  children?: <span class="built_in">Array</span>&lt;RouteConfig&gt;, <span class="comment">// ÂµåÂ•óË∑ØÁî±</span></span><br><span class="line">  beforeEnter?: <span class="function">(<span class="params">to: Route, <span class="keyword">from</span>: Route, next: <span class="built_in">Function</span></span>) =&gt;</span> <span class="built_in">void</span>,</span><br><span class="line">  meta?: <span class="built_in">any</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.6.0+</span></span><br><span class="line">  caseSensitive?: <span class="built_in">boolean</span>, <span class="comment">// ÂåπÈÖçËßÑÂàôÊòØÂê¶Â§ßÂ∞èÂÜôÊïèÊÑüÔºü(ÈªòËÆ§ÂÄºÔºöfalse)</span></span><br><span class="line">  pathToRegexpOptions?: <span class="built_in">Object</span> <span class="comment">// ÁºñËØëÊ≠£ÂàôÁöÑÈÄâÈ°π</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Ë∑ØÁî±ËÆ∞ÂΩï-RouteRecord"><a href="#Ë∑ØÁî±ËÆ∞ÂΩï-RouteRecord" class="headerlink" title="Ë∑ØÁî±ËÆ∞ÂΩï(RouteRecord)"></a>Ë∑ØÁî±ËÆ∞ÂΩï(<code>RouteRecord</code>)</h3><ul>
<li>ÊØè‰∏ÄÊù°Ë∑ØÁî±ËßÑÂàôÈÉΩ‰ºöÁîüÊàê‰∏ÄÊù°Ë∑ØÁî±ËÆ∞ÂΩïÔºõÂµåÂ•ó„ÄÅÂà´ÂêçË∑ØÁî±‰πüÈÉΩ‰ºöÁîüÊàê‰∏ÄÊù°Ë∑ØÁî±ËÆ∞ÂΩïÔºõÊòØË∑ØÁî±Êò†Â∞ÑË°®ÁöÑÁªÑÊàêÈÉ®ÂàÜ</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> record: RouteRecord = &#123;</span><br><span class="line">  path: normalizedPath,</span><br><span class="line">  regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), <span class="comment">//¬†Âà©Áî®path-to-regexpÂåÖÁîüÊàêÁî®Êù•ÂåπÈÖçpathÁöÑÂ¢ûÂº∫Ê≠£ÂàôÂØπË±°ÔºåÂèØ‰ª•Áî®Êù•ÂåπÈÖçÂä®ÊÄÅË∑ØÁî±</span></span><br><span class="line">  components: route.components || &#123; <span class="keyword">default</span>: route.component &#125;, <span class="comment">//¬†‰øùÂ≠òË∑ØÁî±ÁªÑ‰ª∂ÔºåÊîØÊåÅÂëΩÂêçËßÜÂõæhttps://router.vuejs.org/zh/guide/essentials/named-views.html#ÂëΩÂêçËßÜÂõæ</span></span><br><span class="line">  instances: &#123;&#125;, <span class="comment">//¬†‰øùÂ≠òÊØè‰∏™ÂëΩÂêçrouter-viewÈúÄË¶ÅÊ∏≤ÊüìÁöÑË∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line">  name,</span><br><span class="line">  parent,</span><br><span class="line">  matchAs,</span><br><span class="line">  redirect: route.redirect, <span class="comment">//¬†ÈáçÂÆöÂêëÁöÑË∑ØÁî±ÈÖçÁΩÆÂØπË±°</span></span><br><span class="line">  beforeEnter: route.beforeEnter, <span class="comment">//¬†Ë∑ØÁî±Áã¨‰∫´ÁöÑÂÆàÂç´</span></span><br><span class="line">  meta: route.meta || &#123;&#125;, <span class="comment">//¬†ÂÖÉ‰ø°ÊÅØ</span></span><br><span class="line">  <span class="comment">//¬†Âä®ÊÄÅË∑ØÁî±‰º†ÂèÇÔºõhttps://router.vuejs.org/zh/guide/essentials/passing-props.html#Ë∑ØÁî±ÁªÑ‰ª∂‰º†ÂèÇ</span></span><br><span class="line">  props:</span><br><span class="line">    route.props == <span class="literal">null</span></span><br><span class="line">      ? &#123;&#125;</span><br><span class="line">      : route.components <span class="comment">//¬†ÂëΩÂêçËßÜÂõæÁöÑ‰º†ÂèÇËßÑÂàôÈúÄË¶Å‰ΩøÁî®route.propsÊåáÂÆöÁöÑËßÑÂàô</span></span><br><span class="line">      ? route.props</span><br><span class="line">      : &#123; <span class="keyword">default</span>: route.props &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Ë∑ØÁî±ÂØπË±°-Route"><a href="#Ë∑ØÁî±ÂØπË±°-Route" class="headerlink" title="Ë∑ØÁî±ÂØπË±°(Route)"></a>Ë∑ØÁî±ÂØπË±°(<code>Route</code>)</h3><ul>
<li><code>Route</code>Ë°®Á§∫ÂΩìÂâçÊøÄÊ¥ªÁöÑË∑ØÁî±ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåÂåÖÂê´‰∫ÜÂΩìÂâç <code>URL</code> Ëß£ÊûêÂæóÂà∞ÁöÑ‰ø°ÊÅØÔºåËøòÊúâ <code>URL</code> ÂåπÈÖçÂà∞ÁöÑË∑ØÁî±ËÆ∞ÂΩï<strong>‰ª¨</strong> (<code>route records</code>)„ÄÇ<ul>
<li><code>https://router.vuejs.org/zh/api/#Ë∑ØÁî±ÂØπË±°</code></li>
</ul>
</li>
<li>Ê≥®ÊÑèÔºåËøôËØ¥Êòé‰∏Ä‰∏™<code>Route</code>ÂèØ‰ª•ÂÖ≥ËÅîÂ§ö‰∏™<code>RouteRecord</code></li>
<li>ÈÄöËøá<code>this.$route</code>ËÆøÈóÆÂà∞ÁöÑÂ∞±ÊòØ<code>Route</code>ÂØπË±°</li>
<li>route.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route.png" alt="route.png"></li>
</ul>
</li>
<li>Ë∑ØÁî±ÂØπË±°ÊòØ‰∏çÂèØÂèò (<code>immutable</code>) ÁöÑÔºåÊØèÊ¨°ÊàêÂäüÁöÑÂØºËà™ÂêéÈÉΩ‰ºö‰∫ßÁîü‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±°</li>
</ul>
<h3 id="‰ΩçÁΩÆ-Location"><a href="#‰ΩçÁΩÆ-Location" class="headerlink" title="‰ΩçÁΩÆ(Location)"></a>‰ΩçÁΩÆ(<code>Location</code>)</h3><ul>
<li>ÂÆÉÂπ∂‰∏çÊòØ<code>window.location</code>ÁöÑÂºïÁî®Ôºå<code>vue-router</code>Âú®ÂÜÖÈÉ®ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™<code>Location</code>ÔºåÊòØ‰∏Ä‰∏™Áî®Êù•ÊèèËø∞ÁõÆÊ†á‰ΩçÁΩÆÁöÑÂØπË±°Ôºõ</li>
<li><code>$router.push/replace</code>„ÄÅ<code>router-linkÁöÑto</code>Êé•Êî∂ÁöÑÂ∞±ÊòØ<code>LocationÂØπË±°</code><ul>
<li><code>https://router.vuejs.org/zh/api/#to</code></li>
</ul>
</li>
<li><code>vue-router</code>ÂÜÖÈÉ®ÂèØ‰ª•Â∞Ü‰∏Ä‰∏™<code>url string</code>ËΩ¨Êç¢Êàê<code>LocationÂØπË±°</code>ÔºåÊâÄ‰ª•Á°ÆÂàáÁöÑËØ¥<code>$router.push/replace</code>„ÄÅ<code>router-linkÁöÑto</code>Êé•Êî∂ÁöÑÈÉΩÊòØ‰∏Ä‰∏™<code>RawLocationÂØπË±°</code></li>
<li><code>RawLocationÂØπË±°</code>ÊòØ<code>String</code>Âíå<code>Location</code>ÁöÑËÅîÂêàÁ±ªÂûã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RawLocation = <span class="built_in">string</span> | Location</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Location &#123;</span><br><span class="line">  name?: <span class="built_in">string</span></span><br><span class="line">  path?: <span class="built_in">string</span></span><br><span class="line">  hash?: <span class="built_in">string</span></span><br><span class="line">  query?: Dictionary&lt;<span class="built_in">string</span> | (<span class="built_in">string</span> | <span class="literal">null</span>)[] | <span class="literal">null</span> | <span class="literal">undefined</span>&gt;</span><br><span class="line">  params?: Dictionary&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  append?: <span class="built_in">boolean</span></span><br><span class="line">  replace?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Ë∑ØÁî±ÁªÑ‰ª∂-RouteComponent"><a href="#Ë∑ØÁî±ÁªÑ‰ª∂-RouteComponent" class="headerlink" title="Ë∑ØÁî±ÁªÑ‰ª∂(RouteComponent)"></a>Ë∑ØÁî±ÁªÑ‰ª∂(<code>RouteComponent</code>)</h3><ul>
<li>ÂΩìË∑ØÁî±ÊàêÂäüÂåπÈÖçÊó∂ÔºåÂ∞±ÈúÄË¶ÅÂú®<code>router-view</code>Ê∏≤Êüì‰∏Ä‰∏™ÁªÑ‰ª∂ÔºåËøô‰∏™ÈúÄË¶ÅË¢´Ê∏≤ÊüìÁöÑÁªÑ‰ª∂Â∞±ÊòØ<code>Ë∑ØÁî±ÁªÑ‰ª∂</code></li>
<li><code>RouteConfig</code>‰∏≠<code>component„ÄÅcomponents</code>‰∏≠ÂÆö‰πâÁöÑ<code>vueÁªÑ‰ª∂</code>Â∞±ÊòØË∑ØÁî±ÁªÑ‰ª∂</li>
<li>Ë∑ØÁî±ÁªÑ‰ª∂ÁöÑÁâπÊÆäÊÄß<ul>
<li>Êã•Êúâ<strong>Âè™Âú®Ë∑ØÁî±ÁªÑ‰ª∂‰∏≠ÁîüÊïà</strong>ÁöÑÂÆàÂç´(<code>beforeRouteEnter „ÄÅbeforeRouteUpdate„ÄÅbeforeRouteLeave</code>)</li>
<li>‰Ω†ÊòØÂê¶Ë∑üÊàë‰∏ÄÊ†∑ÔºåÊõæÁªèÂú®ÁªÑ‰ª∂‰∏≠Ë∞ÉÁî®<code>beforeRouteEnter</code>ÂèëÁé∞Ê≤°ÊúâÁîüÊïàÔºåÈÇ£ÊòØÂõ†‰∏∫Ëøô‰∏™ÂÆàÂç´Âè™ËÉΩÂú®<code>Ë∑ØÁî±ÁªÑ‰ª∂</code>‰∏≠Ë¢´Ë∞ÉÁî®ÔºåÂú®ÊâÄÊúâÈùûË∑ØÁî±ÁªÑ‰ª∂‰∏≠ÈÉΩ‰∏ç‰ºöË¢´Ë∞ÉÁî®ÔºåÂåÖÊã¨Ë∑ØÁî±ÁªÑ‰ª∂ÁöÑÂêé‰ª£ÁªÑ‰ª∂Ôºõ‰Ω†Â¶ÇÊûúÊÉ≥Âú®Ë∑ØÁî±ÁªÑ‰ª∂‰∏≠ÂÆûÁé∞<code>beforeRouteEnter</code>Á±ª‰ººÂÆàÂç´ÁõëÂê¨ÊïàÊûúÔºåÂèØ‰ª•ÈÄöËøá<code>watch $route</code>Êù•ÊâãÂä®Âà§Êñ≠</li>
</ul>
</li>
<li>Á∫¢Ê°ÜÊ†áËÆ∞Âá∫Êù•ÁöÑÊòØ<code>Ë∑ØÁî±ÁªÑ‰ª∂</code></li>
<li>route-component.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-component.png" alt="route-component.png"></li>
</ul>
</li>
<li>ÁúãÂÆå‰∏äÈù¢ÁöÑÊúØËØ≠Ôºå‰Ω†ÂèØËÉΩËøòÊòØ‰∫ëÈáåÈõæÈáåÁöÑÔºåÊ≤°‰∫ãÔºåÂêéÈù¢‰ºöËØ¶Ëß£ÔºåÁé∞Âú®‰Ω†Âè™ÈúÄË¶ÅÊúâ‰∏™Â§ßÊ¶Ç‰∫ÜËß£Âç≥ÂèØ;</li>
</ul>
<h2 id="ÁéØÂ¢É"><a href="#ÁéØÂ¢É" class="headerlink" title="ÁéØÂ¢É"></a>ÁéØÂ¢É</h2><ul>
<li><code>vue-router</code>ÁâàÊú¨:<code>v3.1.6</code></li>
<li><code>node</code>ÁâàÊú¨:<code>v8.17.0</code></li>
<li>ÂàÜÊûê‰ªìÂ∫ìÂú∞ÂùÄ:<code>https://github.com/BryanAdamss/vue-router-for-analysis</code><ul>
<li>ÂàíÈáçÁÇπ<ul>
<li>Ê≥®ÊÑèÊü•Áúã<code>commitËÆ∞ÂΩï</code>Ôºå<code>commit</code>ËÆ∞ÂΩï‰∫ÜÊàëÊï¥‰∏™ÂàÜÊûêÁöÑÊµÅÁ®ã</li>
<li>Â¶ÇÊûú‰Ω†ËßâÂæóËøòÂèØ‰ª•Ôºå‰∏çË¶ÅÂøòËÆ∞<code>star</code>„ÄÅ<code>fork</code>ü§û</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ÁõÆÂΩïÁªìÊûÑ"><a href="#ÁõÆÂΩïÁªìÊûÑ" class="headerlink" title="ÁõÆÂΩïÁªìÊûÑ"></a>ÁõÆÂΩïÁªìÊûÑ</h2><ul>
<li>È¶ñÂÖàÊàë‰ª¨Â∞Ü<code>vue-router</code>‰ªìÂ∫ì<code>clone</code>‰∏ãÊù•ÔºåÁúã‰∏ãÁõÆÂΩïÁªìÊûÑÂ§ßÊ¶ÇÊòØ‰ªÄ‰πàÊ†∑ÁöÑ</li>
<li><code>git clone git@github.com:BryanAdamss/vue-router-for-analysis.git</code></li>
</ul>
<h3 id="ÁõÆÂΩï"><a href="#ÁõÆÂΩï" class="headerlink" title="ÁõÆÂΩï"></a>ÁõÆÂΩï</h3><ul>
<li>ÂèØ‰ª•ÁúãÂà∞‰ºöÊúâÂ¶Ç‰∏ãÁõÆÂΩï</li>
<li>directory.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/directory.png" alt="directory.png"></li>
</ul>
</li>
<li>Âà´ÁúãÁõÆÂΩïÂ§ö‰πàÂ§öÔºåÂÖ∂ÂÆûÊàëÂ∑≤ÁªèÁªô‰Ω†Âàí‰∫ÜÈáçÁÇπ</li>
<li>Êàë‰ª¨ÂÖ∂ÂÆûÂè™ÈúÄË¶ÅÂÖ≥Ê≥®‰∏ãÈù¢Âá†‰∏™ÁõÆÂΩïÊàñÊñá‰ª∂</li>
<li><code>examples</code><ul>
<li>ËøôÈáåÈù¢Â≠òÊîæ‰∫ÜÂÆòÊñπÁ≤æÂøÉÂáÜÂ§áÁöÑÊ°à‰æã</li>
<li>‰∏ç‰ªÖÂëäËØâ‰Ω†<code>vue-router</code>ÊúâÂì™‰∫õÂü∫Á°ÄÁâπÊÄßÔºåËøò‰ºöÂëäËØâ‰Ω†ÊÄé‰πàÂ∫îÂØπ‰∏Ä‰∫õÂ§çÊùÇÂú∫ÊôØÔºå‰æãÂ¶ÇÊùÉÈôêÊéßÂà∂„ÄÅÂä®ÊÄÅÊ∑ªÂä†Ë∑ØÁî±Á≠âÔºõÊÄª‰πãÔºåÂÄºÂæó‰Ω†Âéª‰∏ÄÊé¢Á©∂Á´üÔºõ</li>
<li>examples.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/examples.png" alt="examples.png"></li>
</ul>
</li>
<li>Âè¶Â§ñÔºåÊàë‰ª¨Âú®ÂàÜÊûêÊ∫êÁ†ÅÁöÑÊó∂ÂÄôÔºåËøòÂèØ‰ª•Âà©Áî®Ëøô‰∫õ‰æãÂ≠êËøõË°åË∞ÉËØï<ul>
<li>Âú®Ê∫êÁ†Å‰Ω†ÊÉ≥Ë∞ÉËØïÂ§ÑÊ∑ªÂä†<code>debuggerÊñ≠ÁÇπÊ†áËØÜ</code>ÔºåÁÑ∂ÂêéÂêØÂä®‰æãÂ≠ê<code>npm run dev</code>ÔºåÊâìÂºÄ<code>localhost:8080</code>Âç≥ÂèØ</li>
</ul>
</li>
</ul>
</li>
<li><code>src</code>ÁõÆÂΩï<ul>
<li>ËøôÊòØ<code>vue-router</code>Ê∫êÁ†ÅÂ≠òÊîæÁöÑÁõÆÂΩïÔºåÊòØÊàë‰ª¨ÈúÄË¶ÅÈáçÁÇπÂÖ≥Ê≥®ÁöÑÂú∞Êñπ</li>
<li>src.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/src.png" alt="src.png"></li>
</ul>
</li>
<li>Êç°Âá†‰∏™ÈáçË¶ÅÁõÆÂΩïÂÖàËØ¥‰∏ã<ul>
<li><code>components</code>ÁõÆÂΩïÊòØÂ≠òÊîæÂÜÖÁΩÆÁªÑ‰ª∂<code>router-link</code>„ÄÅ<code>router-view</code>ÁöÑ</li>
<li><code>history</code>ÊòØÂ≠òÊîæÊ†∏ÂøÉ<code>historyÁ±ª</code>ÁöÑÂú∞Êñπ</li>
<li><code>util</code>‰∏≠Â≠òÊîæÁöÑÊòØ‰∏Ä‰∫õËæÖÂä©ÂáΩÊï∞</li>
<li><code>index.js</code>ÊòØ<code>vue-router</code>ÁöÑÂÖ•Âè£Êñá‰ª∂Ôºå‰πüÊòØ<code>vue-router</code>Á±ªÂÆö‰πâÁöÑÂú∞Êñπ</li>
<li><code>install.js</code>ÊòØÂÆâË£ÖÈÄªËæëÊâÄÂú®Êñá‰ª∂</li>
</ul>
</li>
</ul>
</li>
<li><code>flow/declarations.js</code><ul>
<li>ÂÆÉÊòØ<code>vue-router</code>ÁöÑ flow Á±ªÂûãÂ£∞ÊòéÊñá‰ª∂ÔºåÈÄöËøáÂÆÉÊàë‰ª¨ËÉΩÁü•ÈÅì<code>vue-router</code>‰∏≠Âá†‰∏™Ê†∏ÂøÉÁ±ª(ÂØπË±°)ÊòØÈïø‰ªÄ‰πàÊ†∑ÁöÑ</li>
<li>ÂÆÉÈáåÈù¢ÔºåÂ§ßÊ¶ÇÈïøËøôÊ†∑</li>
<li>declarations.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/declarations.png" alt="declarations.png"></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Âü∫Á°Ä‰æãÂ≠ê"><a href="#Âü∫Á°Ä‰æãÂ≠ê" class="headerlink" title="Âü∫Á°Ä‰æãÂ≠ê"></a>Âü∫Á°Ä‰æãÂ≠ê</h2><ul>
<li>Êàë‰ª¨‰ªéÊúÄÂü∫Á°ÄÁöÑ‰æãÂ≠êÂºÄÂßãÁúã</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="comment">//¬†1.¬†Use¬†plugin.</span></span><br><span class="line"><span class="comment">// ÂÆâË£ÖÊèí‰ª∂</span></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†2.¬†Define¬†route¬†components</span></span><br><span class="line"><span class="comment">// ÂÆö‰πâË∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line"><span class="keyword">const</span> Home = &#123; <span class="attr">template</span>: <span class="string">'&lt;div&gt;home&lt;/div&gt;'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> Foo = &#123; <span class="attr">template</span>: <span class="string">'&lt;div&gt;foo&lt;/div&gt;'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> Bar = &#123; <span class="attr">template</span>: <span class="string">'&lt;div&gt;bar&lt;/div&gt;'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†3.¬†Create¬†the¬†router</span></span><br><span class="line"><span class="comment">// ÂÆû‰æãÂåñvue-router</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  routes: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">component</span>: Home &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/foo'</span>, <span class="attr">component</span>: Foo &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/bar'</span>, <span class="attr">component</span>: Bar &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†4.¬†Create¬†and¬†mount¬†root¬†instance.</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router, <span class="comment">// Ê≥®ÂÖ•routerÂÆû‰æã</span></span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">¬†¬†¬†¬†&lt;div¬†id="app"&gt;</span></span><br><span class="line"><span class="string">¬†¬†¬†¬†¬†¬†&lt;h1&gt;Basic&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">¬†¬†¬†¬†¬†¬†&lt;ul&gt;</span></span><br><span class="line"><span class="string">¬†¬†¬†¬†¬†¬†¬†¬†&lt;li&gt;&lt;router-link¬†to="/"&gt;/&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">¬†¬†¬†¬†¬†¬†¬†¬†&lt;li&gt;&lt;router-link¬†to="/foo"&gt;/foo&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">¬†¬†¬†¬†¬†¬†¬†¬†&lt;li&gt;&lt;router-link¬†to="/bar"&gt;/bar&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">       &lt;/ul&gt;</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">¬†¬†¬†¬†¬†¬†&lt;router-view¬†class="view"&gt;&lt;/router-view&gt;</span></span><br><span class="line"><span class="string">¬†¬†¬†¬†&lt;/div&gt;</span></span><br><span class="line"><span class="string">¬†¬†`</span>,</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÔºåÈ¶ñÂÖà‰ΩøÁî®<code>vue</code>ÁöÑÊèí‰ª∂ËØ≠Ê≥ïÂÆâË£Ö‰∫Ü<code>vue-router</code>Ôºõ ÁÑ∂ÂêéÊàë‰ª¨ÂÜçÂÆû‰æãÂåñ<code>VueRouter</code>Ôºõ ÊúÄÂêéÊàë‰ª¨Â∞Ü<code>VueRouter</code>ÁöÑÂÆû‰æãÊ≥®ÂÖ•Âà∞<code>Vue</code></li>
<li>ËøôÂÖ∂ÂÆûÂ∞±Ê∂âÂèäÂà∞‰∏â‰∏™Ê†∏ÂøÉÊµÅÁ®ãÔºöÂÆâË£Ö„ÄÅÂÆû‰æãÂåñ„ÄÅÂàùÂßãÂåñ</li>
<li>Êàë‰ª¨ÂÖà‰ªéËøô‰∏â‰∏™ÊµÅÁ®ãËÆ≤Ëµ∑</li>
</ul>
<h2 id="ÂÆâË£ÖÊµÅÁ®ã"><a href="#ÂÆâË£ÖÊµÅÁ®ã" class="headerlink" title="ÂÆâË£ÖÊµÅÁ®ã"></a>ÂÆâË£ÖÊµÅÁ®ã</h2><ul>
<li>Êàë‰ª¨Áü•ÈÅìÔºåÂè™Ë¶ÅÊòØ<code>vue plugin</code>ÔºåËÇØÂÆöÈÉΩ‰ºöÊúâ‰∏Ä‰∏™<code>install</code>ÊñπÊ≥ï;<ul>
<li><a href="https://cn.vuejs.org/v2/guide/plugins.html#ÂºÄÂèëÊèí‰ª∂" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/plugins.html#ÂºÄÂèëÊèí‰ª∂</a></li>
</ul>
</li>
<li>‰∏äÈù¢‰πüÊèêÂà∞<code>vue-router</code>ÁöÑÂÖ•Âè£Êñá‰ª∂Âú®<code>src/index.js</code>‰∏≠ÔºåÈÇ£Êàë‰ª¨Âéª<code>index.js</code>‰∏≠ÊâæÊâæ<code>install</code>ÊñπÊ≥ï</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*¬†@flow¬†*/</span></span><br><span class="line"><span class="keyword">import</span>¬†&#123;¬†install¬†&#125;¬†<span class="keyword">from</span>¬†<span class="string">'./install'</span>¬†<span class="comment">//¬†ÂØºÂÖ•ÂÆâË£ÖÊñπÊ≥ï</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†VueRouterÁ±ª</span></span><br><span class="line"><span class="keyword">export</span>¬†<span class="keyword">default</span>¬†<span class="keyword">class</span>¬†VueRouter¬†&#123;</span><br><span class="line">¬†¬†...¬†</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">VueRouter.install¬†=¬†install¬†<span class="comment">//¬†ÊåÇËΩΩÂÆâË£ÖÊñπÊ≥ïÔºåVue.useÊó∂ÔºåËá™Âä®Ë∞ÉÁî®installÊñπÊ≥ï</span></span><br><span class="line">VueRouter.version¬†=¬†<span class="string">'__VERSION__'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊµèËßàÂô®ÁéØÂ¢ÉÔºåËá™Âä®ÂÆâË£ÖVueRouter</span></span><br><span class="line"><span class="keyword">if</span>¬†(inBrowser¬†&amp;&amp;¬†<span class="built_in">window</span>.Vue)¬†&#123;</span><br><span class="line">¬†¬†<span class="built_in">window</span>.Vue.use(VueRouter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÔºåÂºÄÂ§¥ÂØºÂÖ•‰∫Ü<code>install</code>ÊñπÊ≥ïÔºåÂπ∂Â∞ÜÂÖ∂ÂÅö‰∏∫ÈùôÊÄÅÊñπÊ≥ïÁõ¥Êé•ÊåÇËΩΩÂà∞<code>VueRouter</code>‰∏äÔºåËøôÊ†∑ÔºåÂú®<code>Vue.use(VueRouter)</code>Êó∂Ôºå<code>install</code>ÊñπÊ≥ïÂ∞±‰ºöË¢´Ë∞ÉÁî®Ôºõ</li>
<li>ÂèØ‰ª•ÁúãÂà∞ÔºåÂ¶ÇÊûúÂú®ÊµèËßàÂô®ÁéØÂ¢ÉÔºåÂπ∂‰∏îÈÄöËøá<code>scriptÊ†áÁ≠æ</code>ÁöÑÂΩ¢ÂºèÂºïÂÖ•<code>Vue</code>Êó∂(‰ºöÂú®<code>window</code>‰∏äÊåÇËΩΩ<code>Vue</code>ÂÖ®Â±ÄÂèòÈáè)Ôºå‰ºöÂ∞ùËØïËá™Âä®‰ΩøÁî®<code>VueRouter</code></li>
<li>Êàë‰ª¨Êé•‰∏ãÊù•ÁúãÁúã<code>install.js</code>‰∏≠ÊòØ‰ªÄ‰πà</li>
</ul>
<h3 id="install-js"><a href="#install-js" class="headerlink" title="install.js"></a>install.js</h3><ul>
<li><code>install</code>ÊñπÊ≥ïÂπ∂‰∏çÈïø</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> View <span class="keyword">from</span> <span class="string">'./components/view'</span></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'./components/link'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> _Vue <span class="comment">//¬†Áî®Êù•ÈÅøÂÖçÂ∞ÜVueÂÅö‰∏∫‰æùËµñÊâìÂåÖËøõÊù•</span></span><br><span class="line"><span class="comment">//¬†installÊñπÊ≥ï</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (install.installed &amp;&amp; _Vue === Vue) <span class="keyword">return</span> <span class="comment">//¬†ÈÅøÂÖçÈáçÂ§çÂÆâË£Ö</span></span><br><span class="line">  install.installed = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  _Vue = Vue <span class="comment">//¬†‰øùÁïôVueÂºïÁî®</span></span><br><span class="line">  <span class="keyword">const</span> isDef = <span class="function">(<span class="params">v</span>) =&gt;</span> v !== <span class="literal">undefined</span> <span class="comment">//¬†‰∏∫router-viewÁªÑ‰ª∂ÂÖ≥ËÅîË∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> registerInstance = <span class="function">(<span class="params">vm, callVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = vm.$options._parentVnode <span class="comment">//¬†Ë∞ÉÁî®vm.$options._parentVnode.data.registerRouteInstanceÊñπÊ≥ï //¬†ËÄåËøô‰∏™ÊñπÊ≥ïÂè™Âú®router-viewÁªÑ‰ª∂‰∏≠Â≠òÂú®Ôºårouter-viewÁªÑ‰ª∂ÂÆö‰πâÂú®(../components/view.js¬†@71Ë°å) //¬†ÊâÄ‰ª•ÔºåÂ¶ÇÊûúvmÁöÑÁà∂ËäÇÁÇπ‰∏∫router-viewÔºåÂàô‰∏∫router-viewÂÖ≥ËÅîÂΩìÂâçvmÔºåÂç≥Â∞ÜÂΩìÂâçvmÂÅö‰∏∫router-viewÁöÑË∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      isDef(i) &amp;&amp;</span><br><span class="line">      isDef((i = i.data)) &amp;&amp;</span><br><span class="line">      isDef((i = i.registerRouteInstance))</span><br><span class="line">    ) &#123;</span><br><span class="line">      i(vm, callVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//¬†Ê≥®ÂÜåÂÖ®Â±ÄÊ∑∑ÂÖ•</span></span><br><span class="line"></span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="comment">//¬†this¬†===¬†new¬†Vue(&#123;router:router&#125;)¬†===¬†VueÊ†πÂÆû‰æã</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//¬†Âà§Êñ≠ÊòØÂê¶‰ΩøÁî®‰∫Üvue-routerÊèí‰ª∂</span></span><br><span class="line">      <span class="keyword">if</span> (isDef(<span class="keyword">this</span>.$options.router)) &#123;</span><br><span class="line">        <span class="comment">//¬†Âú®VueÊ†πÂÆû‰æã‰∏ä‰øùÂ≠ò‰∏Ä‰∫õ‰ø°ÊÅØ</span></span><br><span class="line">        <span class="keyword">this</span>._routerRoot = <span class="keyword">this</span> <span class="comment">//¬†‰øùÂ≠òÊåÇËΩΩVueRouterÁöÑVueÂÆû‰æãÔºåÊ≠§Â§Ñ‰∏∫Ê†πÂÆû‰æã</span></span><br><span class="line">        <span class="keyword">this</span>._router = <span class="keyword">this</span>.$options.router <span class="comment">//¬†‰øùÂ≠òVueRouterÂÆû‰æãÔºåthis.$options.router‰ªÖÂ≠òÂú®‰∫éVueÊ†πÂÆû‰æã‰∏äÔºåÂÖ∂ÂÆÉVueÁªÑ‰ª∂‰∏çÂåÖÂê´Ê≠§Â±ûÊÄßÔºåÊâÄ‰ª•‰∏ãÈù¢ÁöÑÂàùÂßãÂåñÔºåÂè™‰ºöÊâßË°å‰∏ÄÊ¨° //¬†beforeCreate¬†hookË¢´Ëß¶ÂèëÊó∂ÔºåË∞ÉÁî®</span></span><br><span class="line">        <span class="keyword">this</span>._router.init(<span class="keyword">this</span>) <span class="comment">//¬†ÂàùÂßãÂåñVueRouterÂÆû‰æãÔºåÂπ∂‰º†ÂÖ•VueÊ†πÂÆû‰æã //¬†ÂìçÂ∫îÂºèÂÆö‰πâ_routeÂ±ûÊÄßÔºå‰øùËØÅ_routeÂèëÁîüÂèòÂåñÊó∂ÔºåÁªÑ‰ª∂(router-view)‰ºöÈáçÊñ∞Ê∏≤Êüì</span></span><br><span class="line">        Vue.util.defineReactive(<span class="keyword">this</span>, <span class="string">'_route'</span>, <span class="keyword">this</span>._router.history.current)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//¬†ÂõûÊ∫ØÊü•Êâæ_routerRoot</span></span><br><span class="line">        <span class="keyword">this</span>._routerRoot = (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._routerRoot) || <span class="keyword">this</span></span><br><span class="line">      &#125; <span class="comment">//¬†‰∏∫router-viewÁªÑ‰ª∂ÂÖ≥ËÅîË∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line"></span><br><span class="line">      registerInstance(<span class="keyword">this</span>, <span class="keyword">this</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    destroyed() &#123;</span><br><span class="line">      <span class="comment">//¬†destroyed¬†hookËß¶ÂèëÊó∂ÔºåÂèñÊ∂àrouter-viewÂíåË∑ØÁî±ÁªÑ‰ª∂ÁöÑÂÖ≥ËÅî</span></span><br><span class="line">      registerInstance(<span class="keyword">this</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;) <span class="comment">//¬†Âú®ÂéüÂûã‰∏äÊ≥®ÂÖ•$router„ÄÅ$routeÂ±ûÊÄßÔºåÊñπ‰æøÂø´Êç∑ËÆøÈóÆ</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(Vue.prototype, <span class="string">'$router'</span>, &#123;</span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._routerRoot._router</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(Vue.prototype, <span class="string">'$route'</span>, &#123;</span><br><span class="line">    <span class="comment">//¬†ÊØè‰∏™ÁªÑ‰ª∂ËÆøÈóÆÂà∞ÁöÑ$routeÔºåÂÖ∂ÂÆûÊúÄÂêéËÆøÈóÆÁöÑÈÉΩÊòØVueÊ†πÂÆû‰æãÁöÑ_route</span></span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._routerRoot._route</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;) <span class="comment">//¬†Ê≥®ÂÜårouter-view„ÄÅrouter-linkÂÖ®Â±ÄÁªÑ‰ª∂</span></span><br><span class="line"></span><br><span class="line">  Vue.component(<span class="string">'RouterView'</span>, View)</span><br><span class="line">  Vue.component(<span class="string">'RouterLink'</span>, Link)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> strats = Vue.config.optionMergeStrategies <span class="comment">//¬†use¬†the¬†same¬†hook¬†merging¬†strategy¬†for¬†route¬†hooks</span></span><br><span class="line">  strats.beforeRouteEnter = strats.beforeRouteLeave = strats.beforeRouteUpdate =</span><br><span class="line">    strats.created</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞Ôºå<code>install</code>ÊñπÊ≥ïÂπ≤‰∫Ü‰∏ãÈù¢Âá†‰ª∂‰∫ã</li>
</ul>
<h4 id="ÈÅøÂÖçÈáçÂ§çÂÆâË£Ö"><a href="#ÈÅøÂÖçÈáçÂ§çÂÆâË£Ö" class="headerlink" title="ÈÅøÂÖçÈáçÂ§çÂÆâË£Ö"></a>ÈÅøÂÖçÈáçÂ§çÂÆâË£Ö</h4><ul>
<li>ÈÄöËøáÊ∑ªÂä†<code>installed</code>Ê†áËØÜÊù•Âà§Êñ≠ÊòØÂê¶ÈáçÂ§çÂÆâË£Ö</li>
</ul>
<h4 id="‰øùÁïôVueÂºïÁî®ÔºåÈÅøÂÖçÂ∞ÜVueÂÅö‰∏∫‰æùËµñÊâìÂåÖ"><a href="#‰øùÁïôVueÂºïÁî®ÔºåÈÅøÂÖçÂ∞ÜVueÂÅö‰∏∫‰æùËµñÊâìÂåÖ" class="headerlink" title="‰øùÁïôVueÂºïÁî®ÔºåÈÅøÂÖçÂ∞ÜVueÂÅö‰∏∫‰æùËµñÊâìÂåÖ"></a>‰øùÁïô<code>Vue</code>ÂºïÁî®ÔºåÈÅøÂÖçÂ∞Ü<code>Vue</code>ÂÅö‰∏∫‰æùËµñÊâìÂåÖ</h4><ul>
<li><code>install</code>ÊñπÊ≥ïË¢´Ë∞ÉÁî®Êó∂Ôºå‰ºöÂ∞Ü<code>Vue</code>ÂÅö‰∏∫ÂèÇÊï∞‰º†ÂÖ•Ôºå<code>Vue</code>‰ºöË¢´ËµãÂÄºÁªô‰∫ãÂÖàÂÆö‰πâÂ•ΩÁöÑ<code>_Vue</code>ÂèòÈáè</li>
<li>Âú®ÂÖ∂ÂÆÉÊ®°Âùó‰∏≠ÔºåÂèØ‰ª•ÂØºÂÖ•Ëøô‰∏™<code>_Vue</code>ÔºåËøôÊ†∑Êó¢ËÉΩËÆøÈóÆÂà∞<code>Vue</code>ÔºåÂèàÈÅøÂÖç‰∫ÜÂ∞Ü<code>Vue</code>ÂÅö‰∏∫‰æùËµñÊâìÂåÖ</li>
<li>ËøôÊòØ‰∏Ä‰∏™Êèí‰ª∂ÂºÄÂèëÂÆûÁî®Â∞èÊäÄÂ∑ß</li>
</ul>
<h4 id="Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÊ∑∑ÂÖ•"><a href="#Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÊ∑∑ÂÖ•" class="headerlink" title="Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÊ∑∑ÂÖ•"></a>Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÊ∑∑ÂÖ•</h4><ul>
<li>Ëøô‰∏™Ê∑∑ÂÖ•Â∞ÜÂΩ±ÂìçÊ≥®ÂÜå‰πãÂêéÊâÄÊúâÂàõÂª∫ÁöÑÊØè‰∏™ <code>Vue</code> ÂÆû‰æãÔºå‰πüÂ∞±ÊòØÂêéÈù¢ÊØè‰∏™<code>Vue</code>ÂÆû‰æãÈÉΩ‰ºöÊâßË°åÊ∑∑ÂÖ•‰∏≠ÁöÑ‰ª£Á†Å</li>
<li>Êàë‰ª¨Áúã‰∏ãÊ∑∑ÂÖ•‰∏≠ÁöÑ‰ª£Á†Å</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//¬†Ê≥®ÂÜåÂÖ®Â±ÄÊ∑∑ÂÖ•</span></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    <span class="comment">//¬†this¬†===¬†new¬†Vue(&#123;router:router&#125;)¬†===¬†VueÊ†πÂÆû‰æã</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//¬†Âà§Êñ≠ÊòØÂê¶‰ΩøÁî®‰∫Üvue-routerÊèí‰ª∂</span></span><br><span class="line">    <span class="keyword">if</span> (isDef(<span class="keyword">this</span>.$options.router)) &#123;</span><br><span class="line">      <span class="comment">//¬†Âú®VueÊ†πÂÆû‰æã‰∏ä‰øùÂ≠ò‰∏Ä‰∫õ‰ø°ÊÅØ</span></span><br><span class="line">      <span class="keyword">this</span>._routerRoot = <span class="keyword">this</span> <span class="comment">//¬†‰øùÂ≠òÊåÇËΩΩVueRouterÁöÑVueÂÆû‰æãÔºåÊ≠§Â§Ñ‰∏∫Ê†πÂÆû‰æã</span></span><br><span class="line">      <span class="keyword">this</span>._router = <span class="keyword">this</span>.$options.router <span class="comment">//¬†‰øùÂ≠òVueRouterÂÆû‰æãÔºåthis.$options.router‰ªÖÂ≠òÂú®‰∫éVueÊ†πÂÆû‰æã‰∏äÔºåÂÖ∂ÂÆÉVueÁªÑ‰ª∂‰∏çÂåÖÂê´Ê≠§Â±ûÊÄßÔºåÊâÄ‰ª•‰∏ãÈù¢ÁöÑÂàùÂßãÂåñÔºåÂè™‰ºöÊâßË°å‰∏ÄÊ¨° //¬†beforeCreate¬†hookË¢´Ëß¶ÂèëÊó∂ÔºåË∞ÉÁî®</span></span><br><span class="line">      <span class="keyword">this</span>._router.init(<span class="keyword">this</span>) <span class="comment">//¬†ÂàùÂßãÂåñVueRouterÂÆû‰æãÔºåÂπ∂‰º†ÂÖ•VueÊ†πÂÆû‰æã //¬†ÂìçÂ∫îÂºèÂÆö‰πâ_routeÂ±ûÊÄßÔºå‰øùËØÅ_routeÂèëÁîüÂèòÂåñÊó∂ÔºåÁªÑ‰ª∂(router-view)‰ºöÈáçÊñ∞Ê∏≤Êüì</span></span><br><span class="line">      Vue.util.defineReactive(<span class="keyword">this</span>, <span class="string">'_route'</span>, <span class="keyword">this</span>._router.history.current)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//¬†ÂõûÊ∫ØÊü•Êâæ_routerRoot</span></span><br><span class="line">      <span class="keyword">this</span>._routerRoot = (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._routerRoot) || <span class="keyword">this</span></span><br><span class="line">    &#125; <span class="comment">//¬†‰∏∫router-viewÁªÑ‰ª∂ÂÖ≥ËÅîË∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line"></span><br><span class="line">    registerInstance(<span class="keyword">this</span>, <span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  destroyed() &#123;</span><br><span class="line">    <span class="comment">//¬†destroyed¬†hookËß¶ÂèëÊó∂ÔºåÂèñÊ∂àrouter-viewÂíåË∑ØÁî±ÁªÑ‰ª∂ÁöÑÂÖ≥ËÅî</span></span><br><span class="line">    registerInstance(<span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂÆÉÊ≥®ÂÜå‰∫Ü‰∏§‰∏™ÁîüÂëΩÂë®ÊúüÈí©Â≠ê<code>beforeCreate</code>Âíå<code>destroyed</code>Ôºõ</li>
<li>Ê≥®ÊÑè<ul>
<li>Âú®Ëøô‰∏§‰∏™Èí©Â≠ê‰∏≠Ôºå<code>this</code>ÊòØÊåáÂêëÂΩìÊó∂Ê≠£Âú®Ë∞ÉÁî®Èí©Â≠êÁöÑ<code>vueÂÆû‰æã</code>Ôºõ</li>
<li><strong>Ëøô‰∏§‰∏™Èí©Â≠ê‰∏≠ÁöÑÈÄªËæëÔºåÂú®ÂÆâË£ÖÊµÅÁ®ã‰∏≠ÊòØ‰∏ç‰ºöË¢´ÊâßË°åÁöÑÔºåÂè™ÊúâÂú®ÁªÑ‰ª∂ÂÆû‰æãÂåñÊó∂ÊâßË°åÂà∞Èí©Â≠êÊó∂Êâç‰ºöË¢´Ë∞ÉÁî®</strong></li>
</ul>
</li>
<li>Êàë‰ª¨ÂÖàÁúã<code>beforeCreate</code>Èí©Â≠ê</li>
<li>ÂÆÉÂÖàÂà§Êñ≠‰∫Ü<code>this.$options.router</code>ÊòØÂê¶Â≠òÂú®ÔºåÊàë‰ª¨Âú®<code>new Vue({router})</code>Êó∂Ôºå<code>router</code>Â∑≤ÁªèË¢´‰øùÂ≠òÂà∞Âà∞<code>VueÊ†πÂÆû‰æã</code>ÁöÑ<code>$options</code>‰∏äÔºåËÄåÂÖ∂ÂÆÉ<code>VueÂÆû‰æã</code>ÁöÑ<code>$options</code>‰∏äÊòØÊ≤°Êúâ<code>router</code>ÁöÑ<ul>
<li>ÊâÄ‰ª•<code>if</code>‰∏≠ÁöÑËØ≠Âè•Âè™Âú®<code>this === new Vue({router})</code>Êó∂ÔºåÊâç‰ºöË¢´ÊâßË°åÔºåÁî±‰∫é<code>VueÊ†πÂÆû‰æã</code>Âè™Êúâ‰∏Ä‰∏™ÔºåÊâÄ‰ª•Ëøô‰∏™ÈÄªËæëÂè™‰ºöË¢´ÊâßË°å‰∏ÄÊ¨°</li>
<li>Êàë‰ª¨ÂèØ‰ª•Âú®<code>if</code>‰∏≠ÊâìÂç∞<code>this</code>Âπ∂ÁªìÂêàË∞ÉËØïÂ∑•ÂÖ∑ÁúãÁúã</li>
<li>root-instance.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/root-instance.png" alt="root-instance.png"></li>
</ul>
</li>
<li>ÁöÑÁ°ÆÔºå<code>if</code>‰∏≠ÁöÑÈÄªËæëÂè™ÊâßË°å‰∫Ü‰∏ÄÊ¨°ÔºåÂπ∂‰∏î<code>this</code>Â∞±ÊòØÊåáÂêë<code>VueÊ†πÂÆû‰æã</code></li>
</ul>
</li>
<li>Êàë‰ª¨Áúã‰∏ã<code>if</code>‰∏≠ÂÖ∑‰ΩìÂπ≤‰∫Ü‰ªÄ‰πà<ul>
<li>Âú®Ê†πÂÆû‰æã‰∏ä‰øùÂ≠ò‰∫Ü<code>_routerRoot</code>ÔºåÁî®Êù•Ê†áËØÜ<code>router</code>ÊåÇËΩΩÁöÑ<code>VueÂÆû‰æã</code></li>
<li>Âú®Ê†πÂÆû‰æã‰∏ä‰øùÂ≠ò‰∫Ü<code>VueRouter</code>ÂÆû‰æã(<code>router</code>)</li>
<li>ÂØπ<code>router</code>ËøõË°å‰∫ÜÂàùÂßãÂåñ(<code>init</code>)<ul>
<li><code>router</code>ÂàùÂßãÂåñÈÄªËæëÊàë‰ª¨ÂêéÈù¢ÁªÜÁúã</li>
</ul>
</li>
<li>Âú®Ê†πÂÆû‰æã‰∏äÔºåÂìçÂ∫îÂºèÂÆö‰πâ‰∫Ü<code>_route</code>Â±ûÊÄß<ul>
<li>‰øùËØÅ<code>_route</code>ÂèòÂåñÊó∂Ôºå<code>router-view</code>‰ºöÈáçÊñ∞Ê∏≤ÊüìÔºåËøô‰∏™Êàë‰ª¨ÂêéÈù¢Âú®<code>router-view</code>ÁªÑ‰ª∂‰∏≠‰ºöÁªÜËÆ≤</li>
</ul>
</li>
</ul>
</li>
<li>Êàë‰ª¨ÂÜçÁúã‰∏ã<code>else</code>‰∏≠ÂÖ∑‰ΩìÂπ≤‰∫ÜÂï•<ul>
<li>‰∏ªË¶ÅÊòØ‰∏∫ÊØè‰∏™ÁªÑ‰ª∂ÂÆö‰πâ<code>_routerRoot</code>ÔºåÈááÁî®ÁöÑÊòØÈÄêÂ±ÇÂêë‰∏äÁöÑÂõûÊ∫ØÊü•ÊâæÊñπÂºè</li>
</ul>
</li>
<li>Êàë‰ª¨ÁúãÂà∞ËøòÊúâ‰∏™<code>registerInstance</code>ÊñπÊ≥ïÔºåÂÆÉÂú®<code>beforeCreate</code>„ÄÅ<code>destroyed</code>ÈÉΩÊúâË¢´Ë∞ÉÁî®ÔºåÂè™ÊòØÂèÇÊï∞‰∏™Êï∞‰∏ç‰∏ÄÊ†∑<ul>
<li>Âú®<code>beforeCreate</code>‰∏≠‰º†ÂÖ•‰∫Ü‰∏§‰∏™ÂèÇÊï∞Ôºå‰∏îÈÉΩÊòØ<code>this</code>Âç≥ÂΩìÂâç<code>vueÂÆû‰æã</code>ÔºåËÄåÂú®<code>destroyed</code>‰∏≠Âè™‰º†ÂÖ•‰∫Ü‰∏Ä‰∏™<code>vueÂÆû‰æã</code></li>
<li>Êàë‰ª¨Âú®ËÆ≤<code>router-view</code>Êó∂‰ºöÁªÜËÆ≤Ôºå‰Ω†Âè™ÈúÄË¶ÅÁü•ÈÅìÂÆÉÊòØÁî®Êù•‰∏∫<code>router-view</code>ÁªÑ‰ª∂ÂÖ≥ËÅîÊàñËß£Áªë<code>Ë∑ØÁî±ÁªÑ‰ª∂</code>Áî®ÁöÑÂç≥ÂèØ</li>
<li>‰º†ÂÖ•‰∏§‰∏™ÂèÇÊï∞Âç≥ÂÖ≥ËÅîÔºå‰º†ÂÖ•‰∏Ä‰∏™ÂèÇÊï∞Âç≥Ëß£Áªë</li>
</ul>
</li>
</ul>
<h4 id="Ê∑ªÂä†ÂÆû‰æãÂ±ûÊÄß„ÄÅÊñπÊ≥ï"><a href="#Ê∑ªÂä†ÂÆû‰æãÂ±ûÊÄß„ÄÅÊñπÊ≥ï" class="headerlink" title="Ê∑ªÂä†ÂÆû‰æãÂ±ûÊÄß„ÄÅÊñπÊ≥ï"></a>Ê∑ªÂä†ÂÆû‰æãÂ±ûÊÄß„ÄÅÊñπÊ≥ï</h4><ul>
<li>Âú®<code>Vue</code>ÂéüÂûã‰∏äÊ≥®ÂÖ•<code>$router„ÄÅ$route</code>Â±ûÊÄßÔºåÊñπ‰æøÂú®<code>vueÂÆû‰æã</code>‰∏≠ÈÄöËøá<code>this.$router</code>„ÄÅ<code>this.$route</code>Âø´Êç∑ËÆøÈóÆ</li>
</ul>
<h4 id="Ê≥®ÂÜå-router-view„ÄÅrouter-link-ÂÖ®Â±ÄÁªÑ‰ª∂"><a href="#Ê≥®ÂÜå-router-view„ÄÅrouter-link-ÂÖ®Â±ÄÁªÑ‰ª∂" class="headerlink" title="Ê≥®ÂÜå router-view„ÄÅrouter-link ÂÖ®Â±ÄÁªÑ‰ª∂"></a>Ê≥®ÂÜå router-view„ÄÅrouter-link ÂÖ®Â±ÄÁªÑ‰ª∂</h4><ul>
<li>ÈÄöËøá<code>Vue.component</code>ËØ≠Ê≥ïÊ≥®ÂÜå‰∫Ü<code>router-view</code>Âíå<code>router-link</code>‰∏§‰∏™ÂÖ®Â±ÄÁªÑ‰ª∂</li>
</ul>
<h4 id="ËÆæÁΩÆË∑ØÁî±ÁªÑ‰ª∂ÂÆàÂç´ÁöÑÂêàÂπ∂Á≠ñÁï•"><a href="#ËÆæÁΩÆË∑ØÁî±ÁªÑ‰ª∂ÂÆàÂç´ÁöÑÂêàÂπ∂Á≠ñÁï•" class="headerlink" title="ËÆæÁΩÆË∑ØÁî±ÁªÑ‰ª∂ÂÆàÂç´ÁöÑÂêàÂπ∂Á≠ñÁï•"></a>ËÆæÁΩÆË∑ØÁî±ÁªÑ‰ª∂ÂÆàÂç´ÁöÑÂêàÂπ∂Á≠ñÁï•</h4><ul>
<li>ËÆæÁΩÆË∑ØÁî±ÁªÑ‰ª∂ÁöÑ<code>beforeRouteEnter</code>„ÄÅ<code>beforeRouteLeave</code>„ÄÅ<code>beforeRouteUpdate</code>ÂÆàÂç´ÁöÑÂêàÂπ∂Á≠ñÁï•</li>
</ul>
<h4 id="ÊÄªÁªì-1"><a href="#ÊÄªÁªì-1" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h4><ul>
<li>Êàë‰ª¨Áî®‰∏ÄÂº†ÂõæÔºåÊÄªÁªì‰∏Ä‰∏ãÂÆâË£ÖÊµÅÁ®ã</li>
<li>install.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/install.png" alt="install.png"></li>
</ul>
</li>
</ul>
<h2 id="ÂÆû‰æãÂåñÊµÅÁ®ã"><a href="#ÂÆû‰æãÂåñÊµÅÁ®ã" class="headerlink" title="ÂÆû‰æãÂåñÊµÅÁ®ã"></a>ÂÆû‰æãÂåñÊµÅÁ®ã</h2><ul>
<li>ÁúãÂÆåÂÆâË£ÖÊµÅÁ®ãÔºåÊàë‰ª¨Á¥ßÊé•ÁùÄÊù•Áúã‰∏ã<code>VueRouter</code>ÁöÑÂÆû‰æãÂåñËøáÁ®ã</li>
<li>Ëøô‰∏ÄËäÇÔºåÈáçÁÇπÂÖ≥Ê≥®ÂÆû‰æãÂåñËøáÁ®ãÔºåÊâÄ‰ª•Êàë‰ª¨Âè™Áúã<code>constructor</code>‰∏≠ÁöÑÊ†∏ÂøÉÈÄªËæë</li>
</ul>
<h3 id="VueRouter-ÁöÑÊûÑÈÄ†ÂáΩÊï∞"><a href="#VueRouter-ÁöÑÊûÑÈÄ†ÂáΩÊï∞" class="headerlink" title="VueRouter ÁöÑÊûÑÈÄ†ÂáΩÊï∞"></a>VueRouter ÁöÑÊûÑÈÄ†ÂáΩÊï∞</h3><ul>
<li>Êàë‰ª¨ÊâìÂºÄ<code>src/index.js</code>Áúã‰∏ã<code>VueRouter</code>ÊûÑÈÄ†ÂáΩÊï∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> VueRouter &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">options: RouterOptions = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.app = <span class="literal">null</span> <span class="comment">// ‰øùÂ≠òÊåÇËΩΩÂÆû‰æã</span></span><br><span class="line">    <span class="keyword">this</span>.apps = [] <span class="comment">// VueRouterÊîØÊåÅÂ§öÂÆû‰æã</span></span><br><span class="line">    <span class="keyword">this</span>.options = options</span><br><span class="line">    <span class="keyword">this</span>.beforeHooks = [] <span class="comment">// Êé•Êî∂ beforeEach hook</span></span><br><span class="line">    <span class="keyword">this</span>.resolveHooks = [] <span class="comment">// Êé•Êî∂ beforeResolve hook</span></span><br><span class="line">    <span class="keyword">this</span>.afterHooks = [] <span class="comment">// Êé•Êî∂ afterEach hook</span></span><br><span class="line">    <span class="keyword">this</span>.matcher = createMatcher(options.routes || [], <span class="keyword">this</span>) <span class="comment">//¬†ÂàõÂª∫Ë∑ØÁî±matcherÂØπË±°Ôºå‰º†ÂÖ•routesË∑ØÁî±ÈÖçÁΩÆÂàóË°®ÂèäVueRouterÂÆû‰æã</span></span><br><span class="line">    <span class="keyword">let</span> mode = options.mode || <span class="string">'hash'</span></span><br><span class="line">    <span class="keyword">this</span>.fallback =</span><br><span class="line">      mode === <span class="string">'history'</span> &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== <span class="literal">false</span> <span class="comment">// ÊòØÂê¶ÂõûÈÄÄ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.fallback) &#123;</span><br><span class="line">      mode = <span class="string">'hash'</span></span><br><span class="line">    &#125; <span class="comment">//¬†ÈùûÊµèËßàÂô®ÁéØÂ¢ÉÔºåÂº∫Âà∂‰ΩøÁî®abstractÊ®°Âºè</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!inBrowser) &#123;</span><br><span class="line">      mode = <span class="string">'abstract'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.mode = mode <span class="comment">//¬†Ê†πÊçÆ‰∏çÂêåmodeÔºåÂÆû‰æãÂåñ‰∏çÂêåhistoryÂÆû‰æã</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'history'</span>:</span><br><span class="line">        <span class="keyword">this</span>.history = <span class="keyword">new</span> HTML5History(<span class="keyword">this</span>, options.base)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'hash'</span>:</span><br><span class="line">        <span class="keyword">this</span>.history = <span class="keyword">new</span> HashHistory(<span class="keyword">this</span>, options.base, <span class="keyword">this</span>.fallback)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'abstract'</span>:</span><br><span class="line">        <span class="keyword">this</span>.history = <span class="keyword">new</span> AbstractHistory(<span class="keyword">this</span>, options.base)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          assert(<span class="literal">false</span>, <span class="string">`invalid¬†mode:¬†<span class="subst">$&#123;mode&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊûÑÈÄ†ÂáΩÊï∞‰∏ªË¶ÅÂπ≤‰∫Ü‰∏ãÈù¢Âá†‰ª∂‰∫ã</li>
</ul>
<h4 id="Êé•Êî∂-RouterOptions"><a href="#Êé•Êî∂-RouterOptions" class="headerlink" title="Êé•Êî∂ RouterOptions"></a>Êé•Êî∂ RouterOptions</h4><ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÔºåÊûÑÈÄ†ÂáΩÊï∞Êé•Êî∂‰∏Ä‰∏™<code>optionsÈÄâÈ°πÂØπË±°</code>ÔºåÂÆÉÁöÑÁ±ªÂûãÊòØ<code>RouterOptions</code>ÔºåÊàë‰ª¨Êù•Áúã‰∏ã<code>RouterOptions</code></li>
<li>ÊâìÂºÄ<code>flow/declarations.js</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flow/declarations.js</span></span><br><span class="line"></span><br><span class="line">declare type RouterOptions = &#123;</span><br><span class="line">  routes?: <span class="built_in">Array</span>&lt;RouteConfig&gt;, <span class="comment">// Ë∑ØÁî±ÈÖçÁΩÆËßÑÂàôÂàóË°®</span></span><br><span class="line">  mode?: string, <span class="comment">// Ë∑ØÁî±Ê®°Âºè</span></span><br><span class="line">  fallback?: boolean, <span class="comment">// ÊòØÂê¶ÂêØÁî®ÂõûÈÄÄ</span></span><br><span class="line">  base?: string, <span class="comment">// baseÂú∞ÂùÄ</span></span><br><span class="line">  linkActiveClass?: string, <span class="comment">// router-linkÊøÄÊ¥ªÊó∂Á±ªÂêç</span></span><br><span class="line">  linkExactActiveClass?: string, <span class="comment">// router-linkÁ≤æÂáÜÊøÄÊ¥ªÊó∂Á±ªÂêç</span></span><br><span class="line">  parseQuery?: <span class="function">(<span class="params">query: string</span>) =&gt;</span> <span class="built_in">Object</span>, <span class="comment">// Ëá™ÂÆö‰πâËß£ÊûêqsÁöÑÊñπÊ≥ï</span></span><br><span class="line">  stringifyQuery?: <span class="function">(<span class="params">query: <span class="built_in">Object</span></span>) =&gt;</span> string, <span class="comment">// Ëá™ÂÆö‰πâÂ∫èÂàóÂåñqsÁöÑÊñπÊ≥ï</span></span><br><span class="line">  scrollBehavior?: (</span><br><span class="line">    <span class="comment">// ÊéßÂà∂ÊªöÂä®Ë°å‰∏∫</span></span><br><span class="line">    to: Route,</span><br><span class="line">    <span class="keyword">from</span>: Route,</span><br><span class="line">    savedPosition: ?Position</span><br><span class="line">  ) =&gt; PositionResult | <span class="built_in">Promise</span>&lt;PositionResult&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>RouterOptions</code>ÂÆö‰πâ‰∫Ü<code>VueRouter</code>ÊâÄËÉΩÊé•Êî∂ÁöÑÊâÄÊúâÈÄâÈ°πÔºõ<ul>
<li><a href="https://router.vuejs.org/zh/api/#router-ÊûÑÂª∫ÈÄâÈ°π" target="_blank" rel="noopener">https://router.vuejs.org/zh/api/#router-ÊûÑÂª∫ÈÄâÈ°π</a></li>
</ul>
</li>
<li>Êàë‰ª¨ÈáçÁÇπÂÖ≥Ê≥®‰∏Ä‰∏ã‰∏ãÈù¢ÁöÑÂá†‰∏™ÈÄâÈ°πÂÄº<ul>
<li><code>routes</code>ÊòØË∑ØÁî±ÈÖçÁΩÆËßÑÂàôÂàóË°®ÔºåËøô‰∏™‰∏ªË¶ÅÁî®Êù•ÂêéÁª≠ÁîüÊàêË∑ØÁî±Êò†Â∞ÑË°®ÁöÑÔºõ<ul>
<li>ÂÆÉÊòØ‰∏Ä‰∏™Êï∞ÁªÑÔºåÊØè‰∏ÄÈ°πÈÉΩÊòØ‰∏Ä‰∏™Ë∑ØÁî±ÈÖçÁΩÆËßÑÂàô(<code>RouteConfig</code>)ÔºåÂÖ≥‰∫é<code>RouteConfig</code>ÔºåÂèØ‰ª•ÂõûÁúãÊúØËØ≠ÈÇ£‰∏ÄËäÇÔºõ</li>
</ul>
</li>
<li><code>mode</code>„ÄÅ<code>fallback</code>ÊòØË∑üË∑ØÁî±Ê®°ÂºèÁõ∏ÂÖ≥ÁöÑ<ul>
<li>ÂêéÈù¢‰ºöËØ¶ÁªÜËÆ≤<code>VueRouter</code>ÁöÑË∑ØÁî±Ê®°Âºè</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Â±ûÊÄßËµãÂàùÂÄº"><a href="#Â±ûÊÄßËµãÂàùÂÄº" class="headerlink" title="Â±ûÊÄßËµãÂàùÂÄº"></a>Â±ûÊÄßËµãÂàùÂÄº</h4><ul>
<li>ÂØπ‰∏Ä‰∫õÂ±ûÊÄßËµã‰∫à‰∫ÜÂàùÂÄºÔºå‰æãÂ¶ÇÔºåÂØπÊé•Êî∂<code>ÂÖ®Â±ÄÂØºËà™ÂÆàÂç´(beforeEach„ÄÅbeforeResolve„ÄÅafterEach)</code>ÁöÑÊï∞ÁªÑÂÅö‰∫ÜÂàùÂßãÂåñ</li>
</ul>
<h4 id="ÂàõÂª∫-matcher"><a href="#ÂàõÂª∫-matcher" class="headerlink" title="ÂàõÂª∫ matcher"></a>ÂàõÂª∫ matcher</h4><ul>
<li>ÈÄöËøá<code>createMatcher</code>ÁîüÊàê‰∫Ü<code>matcher</code></li>
<li>Ëøô‰∏™<code>matcherÂØπË±°</code>Â∞±ÊòØÊúÄÂàùËÅäÁöÑÂåπÈÖçÂô®ÔºåË¥üË¥£ url ÂåπÈÖçÔºåÂÆÉÊé•Êî∂‰∫Ü<code>routes</code>Âíå<code>routerÂÆû‰æã</code>Ôºõ<code>createMatcher</code>ÈáåÈù¢‰∏çÂÖâÂàõÂª∫‰∫Ü<code>matcher</code>ÔºåËøòÂàõÂª∫‰∫Ü<code>Ë∑ØÁî±Êò†Â∞ÑË°®RouteMap</code>ÔºåÊàë‰ª¨ÂêéÈù¢ÁªÜÁúã</li>
</ul>
<h4 id="Á°ÆÂÆöË∑ØÁî±Ê®°Âºè"><a href="#Á°ÆÂÆöË∑ØÁî±Ê®°Âºè" class="headerlink" title="Á°ÆÂÆöË∑ØÁî±Ê®°Âºè"></a>Á°ÆÂÆöË∑ØÁî±Ê®°Âºè</h4><ul>
<li>‰∏âÁßçË∑ØÁî±Ê®°ÂºèÊàë‰ª¨ÂêéÈù¢ÁªÜËÆ≤</li>
<li>Áé∞Âú®Âè™ÈúÄË¶ÅÁü•ÈÅì<code>VueRouter</code>ÊòØÂ¶Ç‰ΩïÁ°ÆÂÆöË∑ØÁî±Ê®°ÂºèÁöÑ</li>
<li><code>VueRouter</code>‰ºöÊ†πÊçÆ<code>options.mode</code>„ÄÅ<code>options.fallback</code>„ÄÅ<code>supportsPushState</code>„ÄÅ<code>inBrowser</code>Êù•Á°ÆÂÆöÊúÄÁªàÁöÑË∑ØÁî±Ê®°Âºè</li>
<li>ÂÖàÁ°ÆÂÆö<code>fallback</code>Ôºå<code>fallback</code>Âè™ÊúâÂú®Áî®Êà∑ËÆæÁΩÆ‰∫Ü<code>mode:history</code>Âπ∂‰∏îÂΩìÂâçÁéØÂ¢É‰∏çÊîØÊåÅ<code>pushState</code>‰∏îÁî®Êà∑‰∏ªÂä®Â£∞Êòé‰∫ÜÈúÄË¶ÅÂõûÈÄÄÔºåÊ≠§Êó∂<code>fallback</code>Êâç‰∏∫<code>true</code></li>
<li>ÂΩì<code>fallback‰∏∫true</code>Êó∂‰ºö‰ΩøÁî®<code>hash</code>Ê®°ÂºèÔºõ</li>
<li>Â¶ÇÊûúÊúÄÂêéÂèëÁé∞Â§Ñ‰∫éÈùûÊµèËßàÂô®ÁéØÂ¢ÉÔºåÂàô‰ºöÂº∫Âà∂‰ΩøÁî®<code>abstract</code>Ê®°Âºè</li>
<li>route-mode.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-mode.png" alt="route-mode.png"></li>
</ul>
</li>
<li><code>inBrowser</code>Âíå<code>supportsPushState</code>ÁöÑÂÆûÁé∞ÈÉΩÂæàÁÆÄÂçï</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/dom.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> inBrowser = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> <span class="comment">// Áõ¥Êé•Âà§Êñ≠windowÊòØÂê¶Â≠òÂú®ÔºåÊù•Á°ÆÂÆöÊòØÂê¶Âú®ÊµèËßàÂô®ÁéØÂ¢É‰∏≠</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/util/push-state.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> supportsPushState =</span><br><span class="line">  inBrowser &amp;&amp; <span class="comment">// ÊµèËßàÂô®ÁéØÂ¢É</span></span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ua = <span class="built_in">window</span>.navigator.userAgent</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (ua.indexOf(<span class="string">'Android¬†2.'</span>) !== <span class="number">-1</span> || ua.indexOf(<span class="string">'Android¬†4.0'</span>) !== <span class="number">-1</span>) &amp;&amp;</span><br><span class="line">      ua.indexOf(<span class="string">'Mobile¬†Safari'</span>) !== <span class="number">-1</span> &amp;&amp;</span><br><span class="line">      ua.indexOf(<span class="string">'Chrome'</span>) === <span class="number">-1</span> &amp;&amp;</span><br><span class="line">      ua.indexOf(<span class="string">'Windows¬†Phone'</span>) === <span class="number">-1</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// ÁâπÊÆäÊµèËßàÂô®Áõ¥Êé•‰∏çÊîØÊåÅ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.history &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.history.pushState === <span class="string">'function'</span> <span class="comment">// Âà§Êñ≠ÊòØÂê¶ÊîØÊåÅpushState</span></span><br><span class="line">  &#125;)()</span><br></pre></td></tr></table></figure>
<h4 id="Ê†πÊçÆË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêåÁöÑ-History-ÂÆû‰æã"><a href="#Ê†πÊçÆË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêåÁöÑ-History-ÂÆû‰æã" class="headerlink" title="Ê†πÊçÆË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêåÁöÑ History ÂÆû‰æã"></a>Ê†πÊçÆË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêåÁöÑ History ÂÆû‰æã</h4><ul>
<li>Ê†πÊçÆ‰∏ä‰∏ÄÊ≠•ÁöÑË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêåÁöÑ<code>HistoryÂÆû‰æã</code>ÔºåÂÖ≥‰∫éË∑ØÁî±Ê®°Âºè„ÄÅ<code>HistoryÂÆû‰æã</code>ÂêéÈù¢ÂÜçËÆ≤</li>
</ul>
<h4 id="Â∞èÁªì"><a href="#Â∞èÁªì" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h4><ul>
<li><code>VueRouter</code>ÁöÑÊûÑÈÄ†ÂáΩÊï∞‰∏ªË¶ÅÂπ≤‰∫Ü‰∏ãÈù¢Âá†‰ª∂‰∫ã<ul>
<li>Êé•Êî∂‰∏Ä‰∏™<code>RouterOptions</code></li>
<li>ÁÑ∂ÂêéÂØπ‰∏Ä‰∫õÂ±ûÊÄßËµã‰∫ÜÂàùÂÄº</li>
<li>ÁîüÊàê‰∫Ü<code>matcher</code>ÂåπÈÖçÂô®</li>
<li>Á°ÆÂÆöË∑ØÁî±Ê®°Âºè</li>
<li>Ê†πÊçÆ‰∏çÂêåË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêå<code>HistoryÂÆû‰æã</code></li>
</ul>
</li>
</ul>
<h3 id="ÂàõÂª∫ÂåπÈÖçÂô®"><a href="#ÂàõÂª∫ÂåπÈÖçÂô®" class="headerlink" title="ÂàõÂª∫ÂåπÈÖçÂô®"></a>ÂàõÂª∫ÂåπÈÖçÂô®</h3><ul>
<li>Êàë‰ª¨Êù•ÁªÜÁúã‰∏Ä‰∏ã<code>createMatcher</code>ÈáåÈù¢ÁöÑÂÆûÁé∞</li>
<li><code>createMatcher</code>ÁöÑÂÆûÁé∞Âú®<code>src/create-matcher.js</code>‰∏≠</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// src/create-matcher.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// MatcherÁ±ªÂûã</span></span><br><span class="line"><span class="keyword">export</span>¬†<span class="keyword">type</span>¬†Matcher¬†=¬†&#123;</span><br><span class="line">¬†¬†match:¬†<span class="function">(<span class="params">raw:¬†RawLocation,¬†current?:¬†Route,¬†redirectedFrom?:¬†Location</span>)¬†=&gt;</span>¬†Route; <span class="comment">// ÂåπÈÖçÊñπÊ≥ï</span></span><br><span class="line">¬†¬†addRoutes:¬†<span class="function">(<span class="params">routes:¬†<span class="built_in">Array</span>&lt;RouteConfig&gt;</span>)¬†=&gt;</span>¬†<span class="built_in">void</span>; <span class="comment">// Ê∑ªÂä†RouteÊñπÊ≥ï</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MatcherÂ∑•ÂéÇÂáΩÊï∞</span></span><br><span class="line"><span class="keyword">export</span>¬†<span class="function"><span class="keyword">function</span>¬†<span class="title">createMatcher</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†routes:¬†<span class="built_in">Array</span>&lt;RouteConfig&gt;,¬†<span class="comment">//¬†Ë∑ØÁî±ÈÖçÁΩÆÂàóË°®</span></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†router:¬†VueRouter¬†<span class="comment">//¬†VueRouterÂÆû‰æã</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>):¬†<span class="title">Matcher</span>¬†</span>&#123;</span><br><span class="line">¬†¬†<span class="keyword">const</span>¬†&#123;¬†pathList,¬†pathMap,¬†nameMap¬†&#125;¬†=¬†createRouteMap(routes)¬†<span class="comment">//¬†ÂàõÂª∫Ë∑ØÁî±Êò†Â∞ÑË°®</span></span><br><span class="line">¬†¬†<span class="comment">//¬†Ê∑ªÂä†Ë∑ØÁî±</span></span><br><span class="line">¬†¬†<span class="function"><span class="keyword">function</span>¬†<span class="title">addRoutes</span>¬†(<span class="params">routes</span>)¬†</span>&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Áî±‰∫é‰º†ÂÖ•pathList,¬†pathMap,¬†nameMap‰∫ÜÔºåÊâÄ‰ª•createRouteMapÊñπÊ≥ï‰ºöÊâßË°åÊ∑ªÂä†ÈÄªËæë</span></span><br><span class="line">¬†¬†¬†¬†createRouteMap(routes,¬†pathList,¬†pathMap,¬†nameMap)</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">¬†¬†<span class="comment">//¬†‰º†ÂÖ•location,ËøîÂõûÂåπÈÖçÁöÑRouteÂØπË±°</span></span><br><span class="line">¬†¬†<span class="function"><span class="keyword">function</span>¬†<span class="title">match</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†¬†¬†raw:¬†RawLocation,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†¬†¬†currentRoute?:¬†Route,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†¬†¬†redirectedFrom?:¬†Location</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†</span>):¬†<span class="title">Route</span>¬†</span>&#123;</span><br><span class="line">¬†¬†¬†¬†...</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">¬†¬†</span><br><span class="line">¬†¬†<span class="comment">//¬†ËøîÂõûMatcherÂØπË±°ÔºåÊö¥Èú≤match„ÄÅaddRoutesÊñπÊ≥ï</span></span><br><span class="line">¬†¬†<span class="keyword">return</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†match,</span><br><span class="line">¬†¬†¬†¬†addRoutes</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞Ôºå<code>createMatcher</code>ÊñπÊ≥ïÊé•Êî∂‰∏Ä‰∏™Ë∑ØÁî±ÈÖçÁΩÆËßÑÂàôÂàóË°®Âíå<code>routerÂÆû‰æã</code>ÔºåËøîÂõû‰∏Ä‰∏™<code>Matcher</code>ÂØπË±°</li>
<li><code>Matcher</code>ÂØπË±°ÂåÖÂê´‰∏Ä‰∏™Áî®‰∫éÂåπÈÖçÁöÑ<code>match</code>ÊñπÊ≥ïÂíå‰∏Ä‰∏™Âä®ÊÄÅÊ∑ªÂä†Ë∑ØÁî±ÁöÑ<code>addRoutes</code>ÊñπÊ≥ïÔºõ<ul>
<li>ËÄåËøô‰∏§‰∏™ÊñπÊ≥ïÈÉΩÂ£∞ÊòéÂú®<code>createMatcher</code>ÂÜÖÈÉ®ÔºåÁî±‰∫éÈó≠ÂåÖÁâπÊÄßÔºåÂÆÉËÉΩËÆøÈóÆÂà∞<code>createMatcher</code>‰ΩúÁî®ÂüüÁöÑÊâÄÊúâÂèòÈáè</li>
</ul>
</li>
</ul>
<h4 id="Â∞èÁªì-1"><a href="#Â∞èÁªì-1" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h4><ul>
<li>Êàë‰ª¨ÊÄªÁªì‰∏ã<code>createMatcher</code>ÁöÑÈÄªËæë</li>
<li>create-matcher.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/create-matcher.png" alt="create-matcher.png"></li>
</ul>
</li>
<li>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞<code>createMatcher</code>Âíå<code>addRoutes</code>ÊñπÊ≥ï‰∏≠ÈÉΩË∞ÉÁî®‰∫Ü<code>createRouteMap</code>ÊñπÊ≥ïÔºå‰∫åËÄÖÂè™ÊòØ‰º†ÈÄíÁöÑÂèÇÊï∞‰∏çÂêåÔºå‰ªéÊñπÊ≥ïÂêçÁúãÔºåËøô‰∏™ÊñπÊ≥ïËÇØÂÆöÂíå<code>Ë∑ØÁî±Ë°®RouteMap</code>ÊúâÂÖ≥</li>
<li>Êàë‰ª¨Êé•‰∏ãÊù•ÁúãÁúã<code>createRouteMap</code>ÁöÑÂÆûÁé∞</li>
</ul>
<h3 id="createRouteMap"><a href="#createRouteMap" class="headerlink" title="createRouteMap"></a>createRouteMap</h3><ul>
<li><code>createRouteMap</code>ÊñπÊ≥ï‰Ωç‰∫é<code>src/create-route-map.js</code>‰∏≠</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//¬†ÂàõÂª∫Ë∑ØÁî±Êò†Â∞Ñmap„ÄÅÊ∑ªÂä†Ë∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createRouteMap</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  routes: <span class="built_in">Array</span>&lt;RouteConfig&gt;, <span class="comment">//¬†Ë∑ØÁî±ÈÖçÁΩÆÂàóË°®</span></span></span></span><br><span class="line"><span class="function"><span class="params">  oldPathList?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;, <span class="comment">//¬†ÊóßpathList</span></span></span></span><br><span class="line"><span class="function"><span class="params">  oldPathMap?: Dictionary&lt;RouteRecord&gt;, <span class="comment">//¬†ÊóßpathMap</span></span></span></span><br><span class="line"><span class="function"><span class="params">  oldNameMap?: Dictionary&lt;RouteRecord&gt; <span class="comment">//¬†ÊóßnameMap</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): </span>&#123;</span><br><span class="line">  pathList: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  pathMap: Dictionary&lt;RouteRecord&gt;</span><br><span class="line">  nameMap: Dictionary&lt;RouteRecord&gt;</span><br><span class="line">&#125; &#123;</span><br><span class="line">  <span class="comment">//¬†Ëã•ÊóßÁöÑË∑ØÁî±Áõ∏ÂÖ≥Êò†Â∞ÑÂàóË°®ÂèämapÂ≠òÂú®ÔºåÂàô‰ΩøÁî®ÊóßÁöÑÂàùÂßãÂåñÔºàÂÄüÊ≠§ÂÆûÁé∞Ê∑ªÂä†Ë∑ØÁî±ÂäüËÉΩÔºâ</span></span><br><span class="line">  <span class="comment">//¬†the¬†path¬†list¬†is¬†used¬†to¬†control¬†path¬†matching¬†priority</span></span><br><span class="line">  <span class="keyword">const</span> pathList: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt; = oldPathList || [] <span class="comment">//¬†$flow-disable-line</span></span><br><span class="line">  <span class="keyword">const</span> pathMap: Dictionary&lt;RouteRecord&gt; = oldPathMap || <span class="built_in">Object</span>.create(<span class="literal">null</span>) <span class="comment">//¬†$flow-disable-line</span></span><br><span class="line">  <span class="keyword">const</span> nameMap: Dictionary&lt;RouteRecord&gt; = oldNameMap || <span class="built_in">Object</span>.create(<span class="literal">null</span>) <span class="comment">//¬†ÈÅçÂéÜË∑ØÁî±ÈÖçÁΩÆÂØπË±°ÔºåÁîüÊàê/Ê∑ªÂä†Ë∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"></span><br><span class="line">  routes.forEach(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">    addRouteRecord(pathList, pathMap, nameMap, route)</span><br><span class="line">  &#125;) <span class="comment">//¬†ensure¬†wildcard¬†routes¬†are¬†always¬†at¬†the¬†end //¬†Á°Æ‰øùpath:*Ê∞∏ËøúÂú®Âú®ÊúÄÂêé</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = pathList.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pathList[i] === <span class="string">'*'</span>) &#123;</span><br><span class="line">      pathList.push(pathList.splice(i, <span class="number">1</span>)[<span class="number">0</span>])</span><br><span class="line">      l--</span><br><span class="line">      i--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//¬†ÂºÄÂèëÁéØÂ¢ÉÔºåÊèêÁ§∫ÈùûÂµåÂ•óË∑ØÁî±ÁöÑpathÂøÖÈ°ª‰ª•/ÊàñËÄÖ*ÂºÄÂ§¥</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">    <span class="comment">//¬†warn¬†if¬†routes¬†do¬†not¬†include¬†leading¬†slashes</span></span><br><span class="line">    <span class="keyword">const</span> found = pathList <span class="comment">//¬†check¬†for¬†missing¬†leading¬†slash</span></span><br><span class="line">      .filter(</span><br><span class="line">        (path) =&gt; path &amp;&amp; path.charAt(<span class="number">0</span>) !== <span class="string">'*'</span> &amp;&amp; path.charAt(<span class="number">0</span>) !== <span class="string">'/'</span></span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">if</span> (found.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> pathNames = found.map(<span class="function">(<span class="params">path</span>) =&gt;</span> <span class="string">`-¬†<span class="subst">$&#123;path&#125;</span>`</span>).join(<span class="string">'\n'</span>)</span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`Non-nested¬†routes¬†must¬†include¬†a¬†leading¬†slash¬†character.¬†Fix¬†the¬†following¬†routes:¬†\n<span class="subst">$&#123;pathNames&#125;</span>`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pathList,</span><br><span class="line">    pathMap,</span><br><span class="line">    nameMap,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞<code>createRouteMap</code>ËøîÂõû‰∏Ä‰∏™ÂØπË±°ÔºåÂÆÉÂåÖÂê´<code>pathList</code>„ÄÅ<code>pathMap</code>Âíå<code>nameMap</code></li>
<li><code>pathList</code>‰∏≠Â≠òÂÇ®‰∫Ü<code>routes</code>‰∏≠ÁöÑÊâÄÊúâ<code>path</code></li>
<li><code>pathMap</code>Áª¥Êä§ÁöÑÊòØ<code>path</code>Âíå<code>Ë∑ØÁî±ËÆ∞ÂΩïRouteRecord</code>ÁöÑÊò†Â∞Ñ</li>
<li><code>nameMap</code>Áª¥Êä§ÁöÑÊòØ<code>name</code>Âíå<code>Ë∑ØÁî±ËÆ∞ÂΩïRouteRecord</code>ÁöÑÊò†Â∞Ñ<ul>
<li>Âõ†‰∏∫<code>VueRouter</code>ÊîØÊåÅÂëΩÂêçË∑ØÁî±</li>
</ul>
</li>
<li>Âêé‰∏§ËÄÖÔºåÈÉΩÊòØ‰∏∫‰∫ÜÂø´ÈÄüÊâæÂà∞ÂØπÂ∫îÁöÑ<code>Ë∑ØÁî±ËÆ∞ÂΩï</code></li>
<li>ÂèØ‰ª•Áúã‰∏ã‰ΩøÁî®‰∏ãÈù¢ÁöÑ<code>routes</code>Ë∞ÉÁî®<code>createRouteMap</code>‰ºöËøîÂõû‰ªÄ‰πà</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">component</span>: Home &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/foo'</span>,</span><br><span class="line">    component: Foo,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'child'</span>,</span><br><span class="line">        component: FooChild,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/bar/:dynamic'</span>, <span class="attr">component</span>: Bar &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>route-map-obj.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-map-obj.png" alt="route-map-obj.png"></li>
</ul>
</li>
<li>Áî±‰∫éÊ≤°ÊúâÂëΩÂêçË∑ØÁî±ÔºåÊâÄ‰ª•<code>nameMap</code>‰∏∫Á©∫</li>
<li><code>pathList</code>Â≠òÂÇ®‰∫ÜÊâÄÊúâ<code>path</code>ÔºåÊúâ‰∏™‰∏∫Á©∫ÔºåÂÖ∂ÂÆûÊòØ<code>/</code>ÔºåÂú®<code>normalizePath</code>Êó∂Ë¢´Âà†Èô§‰∫Ü</li>
<li><code>pathMap</code>ËÆ∞ÂΩï‰∫ÜÊØè‰∏™<code>path</code>Âíå<code>ÂØπÂ∫îRouteRecord</code>ÁöÑÊò†Â∞ÑÂÖ≥Á≥ª</li>
</ul>
<h4 id="Â∞èÁªì-2"><a href="#Â∞èÁªì-2" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h4><ul>
<li><code>VueRouter</code>ÁöÑË∑ØÁî±Êò†Â∞ÑË°®Áî±‰∏âÈÉ®ÂàÜÁªÑÊàê:<code>pathList</code>„ÄÅ<code>pathMap</code>„ÄÅ<code>nameMap</code>ÔºõÂêé‰∏§ËÄÖÊòØÁî®Êù•Âø´ÈÄüÊü•ÊâæÁöÑ</li>
<li><code>createRouteMap</code>ÁöÑÈÄªËæë<ul>
<li>ÂÖàÂà§Êñ≠Ë∑ØÁî±Áõ∏ÂÖ≥Êò†Â∞ÑË°®ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÔºåËã•Â≠òÂú®Âàô‰ΩøÁî®ÔºåÂê¶ÂàôÊñ∞Âª∫Ôºõ<ul>
<li>ËøôÂ∞±ÂÆûÁé∞‰∫Ü<code>createRouteMap</code>ÂàõÂª∫/Êñ∞Â¢ûÁöÑÂèåÈáçÂäüËÉΩ</li>
</ul>
</li>
<li>ÁÑ∂ÂêéÈÅçÂéÜ<code>routes</code>Ôºå‰æùÊ¨°‰∏∫ÊØè‰∏™<code>route</code>Ë∞ÉÁî®<code>addRouteRecord</code>ÁîüÊàê‰∏Ä‰∏™<code>RouteRecord</code>Âπ∂Êõ¥Êñ∞<code>pathList</code>„ÄÅ<code>pathMap</code>Âíå<code>nameMap</code></li>
<li>Áî±‰∫é<code>pathList</code>Âú®ÂêéÁª≠ÈÄªËæë‰ºöÁî®Êù•ÈÅçÂéÜÂåπÈÖçÔºå‰∏∫‰∫ÜÊÄßËÉΩÔºåÊâÄ‰ª•ÈúÄË¶ÅÂ∞Ü<code>path:*</code>ÊîæÁΩÆÂà∞<code>pathList</code>ÁöÑÊúÄÂêé</li>
<li>ÊúÄÂêéÊ£ÄÊü•ÈùûÂµåÂ•óË∑ØÁî±ÁöÑ<code>path</code>ÊòØÂê¶ÊòØ‰ª•<code>/</code>ÊàñËÄÖ<code>*</code>ÂºÄÂ§¥</li>
</ul>
</li>
<li>Áî®ÂõæÊÄªÁªìÂ¶Ç‰∏ã</li>
<li>create-route-map-sequence.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/create-route-map-sequence.png" alt="create-route-map-sequence.png"></li>
</ul>
</li>
<li>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨ÁúãÁúãË∑ØÁî±ËÆ∞ÂΩïÊòØÂ¶Ç‰ΩïÁîüÊàêÁöÑ</li>
</ul>
<h3 id="addRouteRecord"><a href="#addRouteRecord" class="headerlink" title="addRouteRecord"></a>addRouteRecord</h3><ul>
<li>Ëøô‰∏™ÊñπÊ≥ï‰∏ªË¶ÅÊòØÂàõÂª∫Ë∑ØÁî±ËÆ∞ÂΩïÂπ∂Êõ¥Êñ∞Ë∑ØÁî±Êò†Â∞ÑË°®</li>
<li>‰Ωç‰∫é<code>src/create-route-map.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-route-map.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ê∑ªÂä†Ë∑ØÁî±ËÆ∞ÂΩïÔºåÊõ¥Êñ∞pathList„ÄÅpathMap„ÄÅnameMap</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addRouteRecord</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  pathList: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pathMap: Dictionary&lt;RouteRecord&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  nameMap: Dictionary&lt;RouteRecord&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  route: RouteConfig,</span></span></span><br><span class="line"><span class="function"><span class="params">  parent?: RouteRecord, <span class="comment">//¬†Áà∂Ë∑ØÁî±Êó∂ËÆ∞ÂΩï</span></span></span></span><br><span class="line"><span class="function"><span class="params">  matchAs?: <span class="built_in">string</span> <span class="comment">//¬†Â§ÑÁêÜÂà´ÂêçË∑ØÁî±Êó∂‰ΩøÁî®</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; path, name &#125; = route</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="comment">//¬†route.path‰∏çËÉΩ‰∏∫Á©∫</span></span><br><span class="line">    assert(path != <span class="literal">null</span>, <span class="string">`"path"¬†is¬†required¬†in¬†a¬†route¬†configuration.`</span>) <span class="comment">//¬†route.component‰∏çËÉΩ‰∏∫string</span></span><br><span class="line"></span><br><span class="line">    assert(</span><br><span class="line">      <span class="keyword">typeof</span> route.component !== <span class="string">'string'</span>,</span><br><span class="line">      <span class="string">`route¬†config¬†"component"¬†for¬†path:¬†<span class="subst">$&#123;String(</span></span></span><br><span class="line"><span class="string"><span class="subst">        path || name</span></span></span><br><span class="line"><span class="string"><span class="subst">      )&#125;</span>¬†cannot¬†be¬†a¬†`</span> + <span class="string">`string¬†id.¬†Use¬†an¬†actual¬†component¬†instead.`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> pathToRegexpOptions: PathToRegexpOptions =</span><br><span class="line">    route.pathToRegexpOptions || &#123;&#125; <span class="comment">//¬†ÁîüÊàêÊ†ºÂºèÂåñÂêéÁöÑpath(Â≠êË∑ØÁî±‰ºöÊãºÊé•‰∏äÁà∂Ë∑ØÁî±ÁöÑpath)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> normalizedPath = normalizePath(path, parent, pathToRegexpOptions.strict)</span><br><span class="line">  <span class="comment">//¬†ÂåπÈÖçËßÑÂàôÊòØÂê¶Â§ßÂ∞èÂÜôÊïèÊÑüÔºü(ÈªòËÆ§ÂÄºÔºöfalse)</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> route.caseSensitive === <span class="string">'boolean'</span>) &#123;</span><br><span class="line">    pathToRegexpOptions.sensitive = route.caseSensitive</span><br><span class="line">  &#125; <span class="comment">//¬†ÁîüÊàê‰∏ÄÊù°Ë∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> record: RouteRecord = &#123;</span><br><span class="line">    path: normalizedPath,</span><br><span class="line">    regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), <span class="comment">//¬†Âà©Áî®path-to-regexpÂåÖÁîüÊàêÁî®Êù•ÂåπÈÖçpathÁöÑÂ¢ûÂº∫Ê≠£ÂàôÂØπË±°ÔºåÂèØ‰ª•Áî®Êù•ÂåπÈÖçÂä®ÊÄÅË∑ØÁî±</span></span><br><span class="line">    components: route.components || &#123; <span class="keyword">default</span>: route.component &#125;, <span class="comment">//¬†‰øùÂ≠òË∑ØÁî±ÁªÑ‰ª∂ÔºåÊîØÊåÅÂëΩÂêçËßÜÂõæhttps://router.vuejs.org/zh/guide/essentials/named-views.html#ÂëΩÂêçËßÜÂõæ</span></span><br><span class="line">    instances: &#123;&#125;, <span class="comment">//¬†‰øùÂ≠òrouter-viewÂÆû‰æã</span></span><br><span class="line">    name,</span><br><span class="line">    parent,</span><br><span class="line">    matchAs,</span><br><span class="line">    redirect: route.redirect, <span class="comment">//¬†ÈáçÂÆöÂêëÁöÑË∑ØÁî±ÈÖçÁΩÆÂØπË±°</span></span><br><span class="line">    beforeEnter: route.beforeEnter, <span class="comment">//¬†Ë∑ØÁî±Áã¨‰∫´ÁöÑÂÆàÂç´</span></span><br><span class="line">    meta: route.meta || &#123;&#125;, <span class="comment">//¬†ÂÖÉ‰ø°ÊÅØ</span></span><br><span class="line">    <span class="comment">//¬†Âä®ÊÄÅË∑ØÁî±‰º†ÂèÇÔºõhttps://router.vuejs.org/zh/guide/essentials/passing-props.html#Ë∑ØÁî±ÁªÑ‰ª∂‰º†ÂèÇ</span></span><br><span class="line">    props:</span><br><span class="line">      route.props == <span class="literal">null</span></span><br><span class="line">        ? &#123;&#125;</span><br><span class="line">        : route.components <span class="comment">//¬†ÂëΩÂêçËßÜÂõæÁöÑ‰º†ÂèÇËßÑÂàôÈúÄË¶Å‰ΩøÁî®route.propsÊåáÂÆöÁöÑËßÑÂàô</span></span><br><span class="line">        ? route.props</span><br><span class="line">        : &#123; <span class="keyword">default</span>: route.props &#125;,</span><br><span class="line">  &#125; <span class="comment">//¬†Â§ÑÁêÜÊúâÂ≠êË∑ØÁî±ÊÉÖÂÜµ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (route.children) &#123;</span><br><span class="line">    <span class="comment">//¬†Warn¬†if¬†route¬†is¬†named,¬†does¬†not¬†redirect¬†and¬†has¬†a¬†default¬†child¬†route.</span></span><br><span class="line">    <span class="comment">//¬†If¬†users¬†navigate¬†to¬†this¬†route¬†by¬†name,¬†the¬†default¬†child¬†will</span></span><br><span class="line">    <span class="comment">//¬†not¬†be¬†rendered¬†(GH¬†Issue¬†#629)</span></span><br><span class="line">    <span class="comment">//¬†https://github.com/vuejs/vue-router/issues/629</span></span><br><span class="line">    <span class="comment">//¬†ÂëΩÂêçË∑ØÁî±¬†&amp;&amp;¬†Êú™‰ΩøÁî®ÈáçÂÆöÂêë¬†&amp;&amp;¬†Â≠êË∑ØÁî±ÈÖçÁΩÆÂØπË±°path‰∏∫''Êàñ/Êó∂Ôºå‰ΩøÁî®Áà∂Ë∑ØÁî±ÁöÑnameË∑≥ËΩ¨Êó∂ÔºåÂ≠êË∑ØÁî±Â∞Ü‰∏ç‰ºöË¢´Ê∏≤Êüì</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        route.name &amp;&amp;</span><br><span class="line">        !route.redirect &amp;&amp;</span><br><span class="line">        route.children.some(<span class="function">(<span class="params">child</span>) =&gt;</span> /^\/?$/.test(child.path))</span><br><span class="line">      ) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="literal">false</span>,</span><br><span class="line">          <span class="string">`Named¬†Route¬†'<span class="subst">$&#123;route.name&#125;</span>'¬†has¬†a¬†default¬†child¬†route.¬†`</span> +</span><br><span class="line">            <span class="string">`When¬†navigating¬†to¬†this¬†named¬†route¬†(:to="&#123;name:¬†'<span class="subst">$&#123;route.name&#125;</span>'"),¬†`</span> +</span><br><span class="line">            <span class="string">`the¬†default¬†child¬†route¬†will¬†not¬†be¬†rendered.¬†Remove¬†the¬†name¬†from¬†`</span> +</span><br><span class="line">            <span class="string">`this¬†route¬†and¬†use¬†the¬†name¬†of¬†the¬†default¬†child¬†route¬†for¬†named¬†`</span> +</span><br><span class="line">            <span class="string">`links¬†instead.`</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">//¬†ÈÅçÂéÜÁîüÊàêÂ≠êË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"></span><br><span class="line">    route.children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> childMatchAs = matchAs <span class="comment">//¬†matchAsËã•ÊúâÂÄºÔºå‰ª£Ë°®ÂΩìÂâçË∑ØÁî±ÊòØÂà´ÂêçË∑ØÁî±ÔºåÂàôÈúÄË¶ÅÂçïÁã¨ÁîüÊàêÂà´ÂêçË∑ØÁî±ÁöÑÂ≠êË∑ØÁî±ÔºåË∑ØÂæÑÂâçÁºÄÈúÄ‰ΩøÁî®matchAs</span></span><br><span class="line">        ? cleanPath(<span class="string">`<span class="subst">$&#123;matchAs&#125;</span>/<span class="subst">$&#123;child.path&#125;</span>`</span>)</span><br><span class="line">        : <span class="literal">undefined</span></span><br><span class="line">      addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="comment">//¬†Ëã•pathMap‰∏≠‰∏çÂ≠òÂú®ÂΩìÂâçË∑ØÂæÑÔºåÂàôÊõ¥Êñ∞pathListÂíåpathMap</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!pathMap[record.path]) &#123;</span><br><span class="line">    pathList.push(record.path)</span><br><span class="line">    pathMap[record.path] = record</span><br><span class="line">  &#125; <span class="comment">//¬†Â§ÑÁêÜÂà´ÂêçÔºõhttps://router.vuejs.org/zh/guide/essentials/redirect-and-alias.html#%E5%88%AB%E5%90%8D</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (route.alias !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> aliases = <span class="built_in">Array</span>.isArray(route.alias) ? route.alias : [route.alias] <span class="comment">//¬†aliasÊîØÊåÅstringÔºåÂíåArray&lt;String&gt;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; aliases.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">const</span> alias = aliases[i]</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; alias === path) &#123;</span><br><span class="line">        <span class="comment">//¬†aliasÁöÑÂÄºÂíåpathÈáçÂ§çÔºåÈúÄË¶ÅÁªôÊèêÁ§∫</span></span><br><span class="line">        warn(</span><br><span class="line">          <span class="literal">false</span>,</span><br><span class="line">          <span class="string">`Found¬†an¬†alias¬†with¬†the¬†same¬†value¬†as¬†the¬†path:¬†"<span class="subst">$&#123;path&#125;</span>".¬†You¬†have¬†to¬†remove¬†that¬†alias.¬†It¬†will¬†be¬†ignored¬†in¬†development.`</span></span><br><span class="line">        ) <span class="comment">//¬†skip¬†in¬†dev¬†to¬†make¬†it¬†work</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125; <span class="comment">//¬†ÁîüÊàêÂà´ÂêçË∑ØÁî±ÈÖçÁΩÆÂØπË±°</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> aliasRoute = &#123;</span><br><span class="line">        path: alias,</span><br><span class="line">        children: route.children,</span><br><span class="line">      &#125; <span class="comment">//¬†Ê∑ªÂä†Âà´ÂêçË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"></span><br><span class="line">      addRouteRecord(</span><br><span class="line">        pathList,</span><br><span class="line">        pathMap,</span><br><span class="line">        nameMap,</span><br><span class="line">        aliasRoute, <span class="comment">//¬†Âà´ÂêçË∑ØÁî±</span></span><br><span class="line">        parent, <span class="comment">//¬†ÂΩìÂâçË∑ØÁî±ÁöÑÁà∂Ë∑ØÁî±ÔºåÂõ†‰∏∫ÊòØÁªôÂΩìÂâçË∑ØÁî±Âèñ‰∫Ü‰∏™Âà´ÂêçÔºåÊâÄ‰ª•‰∫åËÄÖÂÖ∂ÂÆûÊòØÊúâÂêå‰∏™Áà∂Ë∑ØÁî±ÁöÑ</span></span><br><span class="line">        record.path || <span class="string">'/'</span> <span class="comment">//¬†matchAsÔºåÁî®Êù•ÁîüÊàêÂà´ÂêçË∑ØÁî±ÁöÑÂ≠êË∑ØÁî±Ôºõ</span></span><br><span class="line">      ) <span class="comment">//¬†!¬†ÊÄªÁªìÔºöÂΩìÂâçË∑ØÁî±ËÆæÁΩÆ‰∫ÜaliasÂêéÔºå‰ºöÂçïÁã¨‰∏∫ÂΩìÂâçË∑ØÁî±ÂèäÂÖ∂ÊâÄÊúâÂ≠êË∑ØÁî±ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩïÔºå‰∏îÂ≠êË∑ØÁî±ÁöÑpathÂâçÁºÄ‰∏∫matchAs(Âç≥Âà´ÂêçË∑ØÁî±ÁöÑpath)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//¬†Â§ÑÁêÜÂëΩÂêçË∑ØÁî±</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (name) &#123;</span><br><span class="line">    <span class="comment">//¬†Êõ¥Êñ∞nameMap</span></span><br><span class="line">    <span class="keyword">if</span> (!nameMap[name]) &#123;</span><br><span class="line">      nameMap[name] = record</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !matchAs) &#123;</span><br><span class="line">      <span class="comment">//¬†Ë∑ØÁî±ÈáçÂêçË≠¶Âëä</span></span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`Duplicate¬†named¬†routes¬†definition:¬†`</span> +</span><br><span class="line">          <span class="string">`&#123;¬†name:¬†"<span class="subst">$&#123;name&#125;</span>",¬†path:¬†"<span class="subst">$&#123;record.path&#125;</span>"¬†&#125;`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Áúã‰∏ãÈÄªËæë<ul>
<li>Ê£ÄÊü•‰∫ÜË∑ØÁî±ËßÑÂàô‰∏≠ÁöÑ<code>path</code>Âíå<code>component</code></li>
<li>ÁîüÊàê<code>path-to-regexp</code>ÁöÑÈÄâÈ°π<code>pathToRegexpOptions</code></li>
<li>Ê†ºÂºèÂåñ<code>path</code>ÔºåÂ¶ÇÊûúÊòØÂµåÂ•óË∑ØÁî±ÔºåÂàô‰ºöËøΩÂä†‰∏äÁà∂Ë∑ØÁî±ÁöÑ<code>path</code></li>
<li>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï</li>
<li>Â§ÑÁêÜÂµåÂ•óË∑ØÁî±ÔºåÈÄíÂΩíÁîüÊàêÂ≠êË∑ØÁî±ËÆ∞ÂΩï</li>
<li>Êõ¥Êñ∞<code>pathList</code>„ÄÅ<code>pathMap</code></li>
<li>Â§ÑÁêÜÂà´ÂêçË∑ØÁî±ÔºåÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï</li>
<li>Â§ÑÁêÜÂëΩÂêçË∑ØÁî±ÔºåÊõ¥Êñ∞<code>nameMap</code></li>
</ul>
</li>
<li>Êàë‰ª¨Êù•Áúã‰∏ãÂá†‰∏™Ê†∏ÂøÉÈÄªËæë</li>
</ul>
<h4 id="ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï"><a href="#ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï" class="headerlink" title="ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï"></a>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï</h4><ul>
<li>Ë∑ØÁî±ËÆ∞ÂΩïËÆ∞ÂΩï‰∫ÜË∑ØÁî±ÁöÑÊ†∏ÂøÉ‰ø°ÊÅØ</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> record: RouteRecord = &#123;</span><br><span class="line">  path: normalizedPath, <span class="comment">// ËßÑËåÉÂåñÂêéÁöÑË∑ØÂæÑ</span></span><br><span class="line">  regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), <span class="comment">//¬†Âà©Áî®path-to-regexpÂåÖÁîüÊàêÁî®Êù•ÂåπÈÖçpathÁöÑÂ¢ûÂº∫Ê≠£ÂàôÂØπË±°ÔºåÂèØ‰ª•Áî®Êù•ÂåπÈÖçÂä®ÊÄÅË∑ØÁî±</span></span><br><span class="line">  components: route.components || &#123; <span class="keyword">default</span>: route.component &#125;, <span class="comment">//¬†‰øùÂ≠òË∑ØÁî±ÁªÑ‰ª∂ÔºåÊîØÊåÅÂëΩÂêçËßÜÂõæhttps://router.vuejs.org/zh/guide/essentials/named-views.html#ÂëΩÂêçËßÜÂõæ</span></span><br><span class="line">  instances: &#123;&#125;, <span class="comment">//¬†‰øùÂ≠òrouter-viewÂÆû‰æã</span></span><br><span class="line">  name,</span><br><span class="line">  parent, <span class="comment">// Áà∂Ë∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line">  matchAs, <span class="comment">// Âà´ÂêçË∑ØÁî±ÈúÄË¶Å‰ΩøÁî®</span></span><br><span class="line">  redirect: route.redirect, <span class="comment">//¬†ÈáçÂÆöÂêëÁöÑË∑ØÁî±ÈÖçÁΩÆÂØπË±°</span></span><br><span class="line">  beforeEnter: route.beforeEnter, <span class="comment">//¬†Ë∑ØÁî±Áã¨‰∫´ÁöÑÂÆàÂç´</span></span><br><span class="line">  meta: route.meta || &#123;&#125;, <span class="comment">//¬†ÂÖÉ‰ø°ÊÅØ</span></span><br><span class="line">  <span class="comment">//¬†Âä®ÊÄÅË∑ØÁî±‰º†ÂèÇÔºõhttps://router.vuejs.org/zh/guide/essentials/passing-props.html#Ë∑ØÁî±ÁªÑ‰ª∂‰º†ÂèÇ</span></span><br><span class="line">  props:</span><br><span class="line">    route.props == <span class="literal">null</span></span><br><span class="line">      ? &#123;&#125;</span><br><span class="line">      : route.components <span class="comment">//¬†ÂëΩÂêçËßÜÂõæÁöÑ‰º†ÂèÇËßÑÂàôÈúÄË¶Å‰ΩøÁî®route.propsÊåáÂÆöÁöÑËßÑÂàô</span></span><br><span class="line">      ? route.props</span><br><span class="line">      : &#123; <span class="keyword">default</span>: route.props &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Ë∑ØÁî±ËÆ∞ÂΩïÊúâ‰∏™<code>regex</code>Â≠óÊÆµÔºåÂÆÉÊòØ‰∏Ä‰∏™Â¢ûÂº∫ÁöÑÊ≠£ÂàôË°®ËææÂºèÔºåÂÆÉÊòØÂÆûÁé∞Âä®ÊÄÅË∑ØÁî±ÂåπÈÖçÁöÑÂÖ≥ÈîÆ</li>
<li><code>regex</code>ÊòØÈÄöËøá<code>compileRouteRegex</code>ÊñπÊ≥ïËøîÂõûÁöÑÔºåÂÆÉÈáåÈù¢Ë∞ÉÁî®‰∫Ü<code>path-to-regexp</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>¬†Regexp¬†<span class="keyword">from</span>¬†<span class="string">'path-to-regexp'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†‰ΩøÁî®path-to-regexpÂåÖÔºåÁîüÊàêrouteÂØπÂ∫îÁöÑÊ≠£ÂàôÔºåÂèØ‰ª•Áî®Êù•ÁîüÊàêÂä®ÊÄÅË∑ØÁî±ÈúÄË¶ÅÁöÑÊ≠£ÂàôË°®ËææÂºè</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>¬†<span class="title">compileRouteRegex</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†path:¬†<span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†pathToRegexpOptions:¬†PathToRegexpOptions</span></span></span><br><span class="line"><span class="function"><span class="params"></span>):¬†<span class="title">RouteRegExp</span>¬†</span>&#123;</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="keyword">const</span>¬†regex¬†=¬†Regexp(path,¬†[],¬†pathToRegexpOptions)</span><br><span class="line">¬†¬†<span class="keyword">if</span>¬†(process.env.NODE_ENV¬†!==¬†<span class="string">'production'</span>)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†keys:¬†<span class="built_in">any</span>¬†=¬†<span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">¬†¬†¬†¬†regex.keys.forEach(<span class="function"><span class="params">key</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†ÈáçÂ§çkeyÊµ∏ËÜè</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†warn(</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†!keys[key.name],</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">`Duplicate¬†param¬†keys¬†in¬†route¬†with¬†path:¬†"<span class="subst">$&#123;path&#125;</span>"`</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†)</span><br><span class="line">¬†¬†¬†¬†¬†¬†keys[key.name]¬†=¬†<span class="literal">true</span></span><br><span class="line">¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">¬†¬†<span class="keyword">return</span>¬†regex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Êàë‰ª¨Áúã‰∏ã<code>path-to-regexp</code>ÊòØÂ¶Ç‰Ωï‰ΩøÁî®ÁöÑ</li>
<li>ÂÆòÁΩëÊòØ:<a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="noopener">https://www.npmjs.com/package/path-to-regexp</a></li>
<li>Regexp Êé•Êî∂‰∏â‰∏™ÂèÇÊï∞<code>pathÔºåkeysÔºåoptions</code>Ôºõ<code>path</code>‰∏∫ÈúÄË¶ÅËΩ¨Êç¢‰∏∫Ê≠£ÂàôÁöÑË∑ØÂæÑÔºå<code>keys</code>ÔºåÊòØÁî®Êù•Êé•Êî∂Âú®<code>path</code>‰∏≠ÊâæÂà∞ÁöÑ<code>key</code>ÔºåÂèØ‰ª•‰º†ÂÖ•Ôºå‰πüÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ËøîÂõûÂÄº‰∏äÁöÑ<code>keys</code>Â±ûÊÄßÔºå<code>options</code>‰∏∫ÈÄâÈ°π</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pathToRegexp = <span class="built_in">require</span>(<span class="string">'path-to-regexp'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> regexp = pathToRegexp(<span class="string">'/foo/:bar'</span>) <span class="comment">// regexp¬†=¬†/^\/foo\/([^\/]+?)\/?$/i</span></span><br><span class="line"><span class="comment">// :barË¢´Â§ÑÁêÜÊàêÊ≠£ÂàôÁöÑ‰∏Ä‰∏™ÁªÑ‰∫ÜÔºåÂΩìÊ≠£ÂàôË¢´ÊâßË°åÊó∂ÔºåÂ∞±ÂèØ‰ª•ÈÄöËøáÁªÑÂèñÂà∞barÂØπÂ∫îÁöÑÂÄº</span></span><br><span class="line"><span class="built_in">console</span>.log(regexp.keys) <span class="comment">// keys¬†=¬†[&#123;¬†name:¬†'bar',¬†prefix:¬†'/',¬†suffix:¬†'',¬†pattern:¬†'[^\\/#\\?]+?',¬†modifier:¬†''¬†&#125;]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ÈÄöËøá‰∏ãÈù¢ÁöÑ‰æãÂ≠êÔºåÂ∞±ÂèØ‰ª•Áü•ÈÅìÂä®ÊÄÅË∑ØÁî±Ëé∑ÂèñÂèÇÊï∞ÂÄºÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pathToRegexp = <span class="built_in">require</span>(<span class="string">'path-to-regexp'</span>)</span><br><span class="line"><span class="keyword">const</span> regexp = pathToRegexp(<span class="string">'/foo/:bar'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(regexp.keys) <span class="comment">// ËÆ∞ÂΩï‰∫Ükey‰ø°ÊÅØ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> m = <span class="string">'/foo/test'</span>.match(regexp) <span class="comment">// Ê≠£ÂàôÁöÑÁªÑËÆ∞ÂΩï‰∫Üvalue‰ø°ÊÅØ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'key:'</span>, regexp.keys[<span class="number">0</span>].name, <span class="string">',value:'</span>, m[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<ul>
<li>path-to-regex-demo.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/path-to-regex-demo.png" alt="path-to-regex-demo.png"></li>
</ul>
</li>
</ul>
<h4 id="ÁîüÊàêÂµåÂ•óË∑ØÁî±ËÆ∞ÂΩï"><a href="#ÁîüÊàêÂµåÂ•óË∑ØÁî±ËÆ∞ÂΩï" class="headerlink" title="ÁîüÊàêÂµåÂ•óË∑ØÁî±ËÆ∞ÂΩï"></a>ÁîüÊàêÂµåÂ•óË∑ØÁî±ËÆ∞ÂΩï</h4><ul>
<li>Êàë‰ª¨Áü•ÈÅì<code>vue-router</code>ÊòØÊîØÊåÅÂµåÂ•óË∑ØÁî±ÁöÑÔºåÊàë‰ª¨Êù•ÁúãÁúãÊòØÂ¶Ç‰ΩïÁîüÊàêÂµåÂ•óË∑ØÁî±ËÆ∞ÂΩïÁöÑ</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-route-map</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Â§ÑÁêÜÊúâÂ≠êË∑ØÁî±ÊÉÖÂÜµ</span></span><br><span class="line"><span class="keyword">if</span> (route.children) &#123;</span><br><span class="line">  <span class="comment">//¬†Warn¬†if¬†route¬†is¬†named,¬†does¬†not¬†redirect¬†and¬†has¬†a¬†default¬†child¬†route.</span></span><br><span class="line">  <span class="comment">//¬†If¬†users¬†navigate¬†to¬†this¬†route¬†by¬†name,¬†the¬†default¬†child¬†will</span></span><br><span class="line">  <span class="comment">//¬†not¬†be¬†rendered¬†(GH¬†Issue¬†#629)</span></span><br><span class="line">  <span class="comment">//¬†https://github.com/vuejs/vue-router/issues/629</span></span><br><span class="line">  <span class="comment">//¬†ÂëΩÂêçË∑ØÁî±¬†&amp;&amp;¬†Êú™‰ΩøÁî®ÈáçÂÆöÂêë¬†&amp;&amp;¬†Â≠êË∑ØÁî±ÈÖçÁΩÆÂØπË±°path‰∏∫''Êàñ/Êó∂Ôºå‰ΩøÁî®Áà∂Ë∑ØÁî±ÁöÑnameË∑≥ËΩ¨Êó∂ÔºåÂ≠êË∑ØÁî±Â∞Ü‰∏ç‰ºöË¢´Ê∏≤Êüì</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      route.name &amp;&amp;</span><br><span class="line">      !route.redirect &amp;&amp;</span><br><span class="line">      route.children.some(<span class="function">(<span class="params">child</span>) =&gt;</span> /^\/?$/.test(child.path))</span><br><span class="line">    ) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`Named¬†Route¬†'<span class="subst">$&#123;route.name&#125;</span>'¬†has¬†a¬†default¬†child¬†route.¬†`</span> +</span><br><span class="line">          <span class="string">`When¬†navigating¬†to¬†this¬†named¬†route¬†(:to="&#123;name:¬†'<span class="subst">$&#123;route.name&#125;</span>'"),¬†`</span> +</span><br><span class="line">          <span class="string">`the¬†default¬†child¬†route¬†will¬†not¬†be¬†rendered.¬†Remove¬†the¬†name¬†from¬†`</span> +</span><br><span class="line">          <span class="string">`this¬†route¬†and¬†use¬†the¬†name¬†of¬†the¬†default¬†child¬†route¬†for¬†named¬†`</span> +</span><br><span class="line">          <span class="string">`links¬†instead.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//¬†ÈÅçÂéÜÁîüÊàêÂ≠êË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line">  route.children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> childMatchAs = matchAs <span class="comment">//¬†matchAsËã•ÊúâÂÄºÔºå‰ª£Ë°®ÂΩìÂâçË∑ØÁî±ÊòØÂà´ÂêçË∑ØÁî±ÔºåÂàôÈúÄË¶ÅÂçïÁã¨ÁîüÊàêÂà´ÂêçË∑ØÁî±ÁöÑÂ≠êË∑ØÁî±ÔºåË∑ØÂæÑÂâçÁºÄÈúÄ‰ΩøÁî®matchAs</span></span><br><span class="line">      ? cleanPath(<span class="string">`<span class="subst">$&#123;matchAs&#125;</span>/<span class="subst">$&#123;child.path&#125;</span>`</span>)</span><br><span class="line">      : <span class="literal">undefined</span></span><br><span class="line">    addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>È¶ñÂÖàÈíàÂØπ<code>#629</code>ÈóÆÈ¢òÂÅöÂá∫‰∫ÜË≠¶ÂëäÊèêÁ§∫<ul>
<li><code>#629</code>ÈóÆÈ¢ò‰∏ªË¶ÅÊòØ ÂΩì‰∏Ä‰∏™Ë∑ØÁî±ÊòØ <code>ÂëΩÂêçË∑ØÁî± &amp;&amp; Êú™‰ΩøÁî®ÈáçÂÆöÂêë &amp;&amp; Â≠êË∑ØÁî±ÈÖçÁΩÆÂØπË±°path‰∏∫&#39;&#39;Êàñ/</code>Êó∂Ôºå‰ΩøÁî®Áà∂Ë∑ØÁî±ÁöÑ<code>name</code>Ë∑≥ËΩ¨Êó∂ÔºåÂ≠êË∑ØÁî±Â∞Ü‰∏ç‰ºöË¢´Ê∏≤Êüì</li>
</ul>
</li>
<li>ÁÑ∂ÂêéÈÅçÂéÜÂ≠êË∑ØÁî±ËßÑÂàôÂàóË°®ÔºåÁîüÊàêÂ≠êË∑ØÁî±ËÆ∞ÂΩï<ul>
<li>ËøôÈáåÈù¢ËøòÂ§ÑÁêÜ‰∫ÜÂà´ÂêçË∑ØÁî±ÁöÑÂ≠êË∑ØÁî±ÊÉÖÂÜµ<ul>
<li>ÈÅçÂéÜÊó∂Â¶ÇÊûúÂèëÁé∞Áà∂Ë∑ØÁî±Ë¢´Ê†áËÆ∞‰∏∫Âà´ÂêçË∑ØÁî±ÔºåÂàôÂ≠êË∑ØÁî±ÁöÑ<code>path</code>ÂâçÈù¢ÈúÄË¶ÅÂä†‰∏äÁà∂Ë∑ØÁî±ÁöÑ<code>path</code>ÔºåÁÑ∂ÂêéÂÜçÁîüÊàêËÆ∞ÂΩï</li>
</ul>
</li>
</ul>
</li>
<li>Êàë‰ª¨ÂèØ‰ª•Áúã‰∏ã‰∏ãÈù¢ÁöÑÂµåÂ•óË∑ØÁî±ÔºåÁîüÊàêÁöÑË∑ØÁî±Êò†Â∞ÑË°®Èïø‰ªÄ‰πàÊ†∑</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/parent'</span>,</span><br><span class="line">    component: Parent,</span><br><span class="line">    children: [&#123; <span class="attr">path</span>: <span class="string">'foo'</span>, <span class="attr">component</span>: Foo &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>nested-route.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/nested-route.png" alt="nested-route.png"></li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞ÔºåÂ≠êË∑ØÁî±ÁöÑ<code>path</code>‰ºöÂâçËøΩÂä†‰∏äÁà∂Ë∑ØÁî±ÁöÑ<code>path</code></li>
</ul>
<h4 id="ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï"><a href="#ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï" class="headerlink" title="ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï"></a>ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï</h4><ul>
<li><code>VueRouter</code>ÊîØÊåÅÁªôË∑ØÁî±ËÆæÁΩÆÂà´ÂêçÔºõ<code>/a</code>  ÁöÑÂà´ÂêçÊòØ  <code>/b</code>ÔºåÊÑèÂë≥ÁùÄÔºåÂΩìÁî®Êà∑ËÆøÈóÆ  <code>/b</code>  Êó∂Ôºå<code>URL</code> ‰ºö‰øùÊåÅ‰∏∫  <code>/b</code>Ôºå‰ΩÜÊòØË∑ØÁî±ÂåπÈÖçÂàô‰∏∫  <code>/a</code>ÔºåÂ∞±ÂÉèÁî®Êà∑ËÆøÈóÆ  <code>/a</code>  ‰∏ÄÊ†∑</li>
<li>Êàë‰ª¨Êù•ÁúãÁúãÊ§íÂ¶Ç‰ΩïÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩïÁöÑ</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-route-map.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (route.alias !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> aliases = <span class="built_in">Array</span>.isArray(route.alias) ? route.alias : [route.alias] <span class="comment">//¬†aliasÊîØÊåÅstringÔºåÂíåArray&lt;String&gt;</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; aliases.length; ++i) &#123;</span><br><span class="line">    <span class="keyword">const</span> alias = aliases[i]</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; alias === path) &#123;</span><br><span class="line">      <span class="comment">//¬†aliasÁöÑÂÄºÂíåpathÈáçÂ§çÔºåÈúÄË¶ÅÁªôÊèêÁ§∫</span></span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`Found¬†an¬†alias¬†with¬†the¬†same¬†value¬†as¬†the¬†path:¬†"<span class="subst">$&#123;path&#125;</span>".¬†You¬†have¬†to¬†remove¬†that¬†alias.¬†It¬†will¬†be¬†ignored¬†in¬†development.`</span></span><br><span class="line">      ) <span class="comment">//¬†skip¬†in¬†dev¬†to¬†make¬†it¬†work</span></span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125; <span class="comment">//¬†ÁîüÊàêÂà´ÂêçË∑ØÁî±ÈÖçÁΩÆÂØπË±°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aliasRoute = &#123;</span><br><span class="line">      path: alias,</span><br><span class="line">      children: route.children,</span><br><span class="line">    &#125; <span class="comment">//¬†Ê∑ªÂä†Âà´ÂêçË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"></span><br><span class="line">    addRouteRecord(</span><br><span class="line">      pathList,</span><br><span class="line">      pathMap,</span><br><span class="line">      nameMap,</span><br><span class="line">      aliasRoute, <span class="comment">//¬†Âà´ÂêçË∑ØÁî±</span></span><br><span class="line">      parent, <span class="comment">//¬†ÂΩìÂâçË∑ØÁî±ÁöÑÁà∂Ë∑ØÁî±ÔºåÂõ†‰∏∫ÊòØÁªôÂΩìÂâçË∑ØÁî±Âèñ‰∫Ü‰∏™Âà´ÂêçÔºåÊâÄ‰ª•‰∫åËÄÖÂÖ∂ÂÆûÊòØÊúâÂêå‰∏™Áà∂Ë∑ØÁî±ÁöÑ</span></span><br><span class="line">      record.path || <span class="string">'/'</span> <span class="comment">//¬†matchAsÔºåÁî®Êù•ÁîüÊàêÂà´ÂêçË∑ØÁî±ÁöÑÂ≠êË∑ØÁî±Ôºõ</span></span><br><span class="line">    ) <span class="comment">//¬†!¬†ÊÄªÁªìÔºöÂΩìÂâçË∑ØÁî±ËÆæÁΩÆ‰∫ÜaliasÂêéÔºå‰ºöÂçïÁã¨‰∏∫ÂΩìÂâçË∑ØÁî±ÂèäÂÖ∂ÊâÄÊúâÂ≠êË∑ØÁî±ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩïÔºå‰∏îÂ≠êË∑ØÁî±ÁöÑpathÂâçÁºÄ‰∏∫matchAs(Âç≥Âà´ÂêçË∑ØÁî±ÁöÑpath)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Âà´ÂêçÊòØÊîØÊåÅÂçïÂà´ÂêçÂíåÂ§öÂà´ÂêçÁöÑÔºåÂç≥<code>route.alias</code>ÊîØÊåÅ‰º†ÂÖ•<code>/foo</code>Êàñ<code>[&#39;/foo&#39;,&#39;/bar&#39;]</code>ÔºåÊâÄ‰ª•ÂÖàÂØπËøô‰∏§ÁßçÊÉÖÂÜµÂÅö‰∫ÜÂΩí‰∏ÄÂ§ÑÁêÜÔºåÁªü‰∏ÄÂ§ÑÁêÜÊàêÊï∞ÁªÑ</li>
<li>ÁÑ∂ÂêéÈÅçÂéÜËøô‰∏™Êï∞ÁªÑÔºåÂÖàÊ£ÄÊü•Âà´ÂêçÂíå<code>path</code>ÊòØÂê¶ÈáçÂ§çÔºåÁÑ∂ÂêéÂçïÁã¨‰∏∫Âà´ÂêçË∑ØÁî±ÁîüÊàê‰∏Ä‰ªΩÈÖçÁΩÆ‰º†ÂÖ•ÔºåÊúÄÂêéË∞ÉÁî®<code>addRouteRecord</code>ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï<ul>
<li>Ê≥®ÊÑèÊ≠§Â§ÑËøòÈÄöËøá<code>matchAs</code>Â§ÑÁêÜ‰∫ÜÂà´ÂêçË∑ØÁî±ÁîüÊàêÂ≠êË∑ØÁî±ÁöÑÂú∫ÊôØÔºå‰∏ªË¶ÅÈÄöËøáËÆæÁΩÆ<code>matchAs</code>‰∏∫<code>record.path || &#39;/&#39;</code>ÔºåÁÑ∂ÂêéÂú®ÁîüÊàêÂ≠êË∑ØÁî±ËÆ∞ÂΩïÊó∂Ôºå‰ºöÊ†πÊçÆ<code>matchAs</code>ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩïÁöÑÂ≠êËÆ∞ÂΩïÔºåÂÖ∑‰ΩìÂèØÁúã‰∏äÈù¢ÁöÑ<code>ÂµåÂ•óË∑ØÁî±Á´†ËäÇ</code></li>
</ul>
</li>
<li>Êàë‰ª¨ÁúãÁúãÔºåÂà´ÂêçË∑ØÁî±ÁîüÊàêÁöÑÁöÑË∑ØÁî±Êò†Â∞ÑË°®Èïø‰ªÄ‰πàÊ†∑</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/root'</span>, <span class="attr">component</span>: Root, <span class="attr">alias</span>: <span class="string">'/root-alias'</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/home'</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">    children: [</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'bar'</span>, <span class="attr">component</span>: Bar, <span class="attr">alias</span>: <span class="string">'bar-alias'</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'baz'</span>, <span class="attr">component</span>: Baz, <span class="attr">alias</span>: [<span class="string">'/baz'</span>, <span class="string">'baz-alias'</span>] &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>alias-route.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/alias-route.png" alt="alias-route.png"></li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞‰∏∫Âà´ÂêçË∑ØÁî±ÂíåÂà´ÂêçË∑ØÁî±ÁöÑÂ≠êË∑ØÁî±ÈÉΩÂçïÁã¨ÁîüÊàê‰∫Ü‰∏ÄÊù°Ë∑ØÁî±ËÆ∞ÂΩï</li>
</ul>
<h4 id="Â∞èÁªì-3"><a href="#Â∞èÁªì-3" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h4><ul>
<li>Ë∑ØÁî±ËÆ∞ÂΩïÊòØ<code>Ë∑ØÁî±Êò†Â∞ÑË°®</code>ÁöÑÈáçË¶ÅÁªÑÊàêÈÉ®ÂàÜ<ul>
<li>Ë∑ØÁî±ËÆ∞ÂΩï‰∏≠ÁöÑ<code>regex</code>ÊòØÂ§ÑÁêÜÂä®ÊÄÅË∑ØÁî±‰º†ÂèÇÁöÑÂÖ≥ÈîÆÂ≠óÊÆµÔºå‰∏ªË¶ÅÊòØÂÄüÂä©<code>path-to-regexp</code>ÂÆûÁé∞ÁöÑ</li>
</ul>
</li>
<li>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï‰∏ªË¶ÅËÄÉËôë‰∫Ü‰∏ãÈù¢Âá†ÁßçË∑ØÁî±ËÆ∞ÂΩïÁöÑÁîüÊàê<ul>
<li>ÂµåÂ•óË∑ØÁî±<ul>
<li>Â≠êË∑ØÁî±ÂçïÁã¨ÁîüÊàê‰∏ÄÊù°Ë∑ØÁî±ËÆ∞ÂΩï</li>
</ul>
</li>
<li>Âà´ÂêçË∑ØÁî±ÂèäÂà´ÂêçË∑ØÁî±Â≠êË∑ØÁî±<ul>
<li>Âà´ÂêçË∑ØÁî±ÂèäÂÖ∂Â≠êË∑ØÁî±ÂàÜÂà´‰ºöÁîüÊàê‰∏ÄÊù°Ë∑ØÁî±ËÆ∞ÂΩï</li>
</ul>
</li>
<li>ÂëΩÂêçË∑ØÁî±</li>
</ul>
</li>
<li>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩïÁöÑÊï¥‰∏™ÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫</li>
<li>add-route-record.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/add-route-record.png" alt="add-route-record.png"></li>
</ul>
</li>
<li>Ëá≥Ê≠§Êàë‰ª¨Â∑≤ÁªèÂàÜÊûêÂÆå‰∫Ü<code>VueRouter</code>ÂÆû‰æãÂåñ‰∏≠ÂàõÂª∫ÂåπÈÖçÂô®(ÁîüÊàêË∑ØÁî±Êò†Â∞ÑË°®)Áõ∏ÂÖ≥ÈÄªËæë</li>
<li>‰∏ãÈù¢Êàë‰ª¨Â∞ÜÁúãÁúãÊ†πÊçÆË∑ØÁî±Ê®°ÂºèÁîüÊàê<code>HistoryÂÆû‰æã</code>ÁöÑÁõ∏ÂÖ≥ÈÄªËæë</li>
</ul>
<h3 id="Ë∑ØÁî±Ê®°Âºè"><a href="#Ë∑ØÁî±Ê®°Âºè" class="headerlink" title="Ë∑ØÁî±Ê®°Âºè"></a>Ë∑ØÁî±Ê®°Âºè</h3><ul>
<li>ÂâçÁ´ØË∑ØÁî±‰∏Ä‰∏™ÂæàÈáçË¶ÅÁöÑÁâπÊÄßÊòØË¶ÅÂÆûÁé∞Êó†Âà∑Êñ∞ÂàáÊç¢È°µÈù¢<ul>
<li>Âç≥ url ÊîπÂèòÔºåÈ°µÈù¢‰∏çÂà∑Êñ∞ÂÆûÁé∞È°µÈù¢ÁöÑË∑≥ËΩ¨</li>
</ul>
</li>
<li>Ë¶ÅÂÆûÁé∞Ëøô‰∏ÄÁÇπÔºåÊúâ‰∏§ÁßçÊñπÊ°à</li>
<li>‰∏ÄÁßç<code>hash+hashChange</code>ÔºåÂè¶‰∏ÄÁßçÂà©Áî®<code>History API</code>ÁöÑ<code>pushState+popState</code></li>
<li>ÂâçËÄÖ‰∏ªË¶ÅÂà©Áî®<code>hash</code>ÊîπÂèòÊó∂È°µÈù¢‰∏ç‰ºöÂà∑Êñ∞Âπ∂‰ºöËß¶Âèë<code>hashChange</code>Ëøô‰∏™ÁâπÊÄßÊù•ÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±</li>
<li>ÂêéËÄÖÂÖÖÂàÜÂà©Áî®‰∫Ü<code>HTML5 History API</code>ÁöÑ<code>pushState</code>ÊñπÊ≥ïÂíå<code>popState</code>‰∫ã‰ª∂Êù•ÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±</li>
<li>‰∫åËÄÖÊØîËæÉ</li>
<li>ÂâçËÄÖ<ul>
<li>ÂÖºÂÆπÊÄßÂ•ΩÔºå<code>hashChange</code>ÊîØÊåÅÂà∞ IE8</li>
<li><code>url</code>‰∏≠‰ºöÊê∫Â∏¶<code>/#/</code>Ôºå‰∏çÁæéËßÇ</li>
<li>‰∏çÈúÄË¶ÅÊúçÂä°Á´ØÊîπÈÄ†</li>
</ul>
</li>
<li>ÂêéËÄÖ<ul>
<li>ÂÖºÂÆπÂà∞ IE10</li>
<li><code>url</code>Ë∑üÊ≠£Â∏∏<code>url</code>‰∏ÄÊ†∑</li>
<li>Áî±‰∫éÂÖ∂<code>url</code>Ë∑üÊ≠£Â∏∏<code>url</code>‰∏ÄÊ†∑ÔºåÊâÄ‰ª•Âú®Âà∑Êñ∞Êó∂Ôºå‰ºö‰ª•Ê≠§<code>url</code>‰∏∫ÈìæÊé•ËØ∑Ê±ÇÊúçÂä°Á´ØÈ°µÈù¢ÔºåËÄåÊúçÂä°Á´ØÊòØÊ≤°ÊúâËøô‰∏™È°µÈù¢ÁöÑÔºå‰ºö 404ÔºåÂõ†Ê≠§ÈúÄË¶ÅÊúçÂä°Á´ØÈÖçÂêàÂ∞ÜÊâÄÊúâËØ∑Ê±ÇÈáçÂÆöÂêëÂà∞È¶ñÈ°µÔºåÂ∞ÜÊï¥‰∏™Ë∑ØÁî±ÁöÑÊéßÂà∂‰∫§ÁªôÂâçÁ´ØË∑ØÁî±</li>
</ul>
</li>
<li><code>VueRouter</code>ÊîØÊåÅ‰∏âÁßçË∑ØÁî±Ê®°ÂºèÔºåÂàÜÂà´‰∏∫<code>hash</code>„ÄÅ<code>history</code>„ÄÅ<code>abstract</code></li>
<li><code>hash</code>Ê®°ÂºèÂ∞±ÊòØÁ¨¨‰∏ÄÁßçÊñπÊ°àÁöÑÂÆûÁé∞</li>
<li><code>history</code>Ê®°ÂºèÊòØÁ¨¨‰∫åÁßçÊñπÊ°àÁöÑÂÆûÁé∞</li>
<li><code>abstract</code>Ê®°ÂºèÊòØÁî®Âú®ÈùûÊµèËßàÂô®ÁéØÂ¢ÉÁöÑÔºå‰∏ªË¶ÅÁî®‰∫é<code>SSR</code></li>
</ul>
<h4 id="Ê†∏ÂøÉÁ±ª"><a href="#Ê†∏ÂøÉÁ±ª" class="headerlink" title="Ê†∏ÂøÉÁ±ª"></a>Ê†∏ÂøÉÁ±ª</h4><ul>
<li><code>VueRouter</code>ÁöÑ‰∏âÁßçË∑ØÁî±Ê®°ÂºèÔºå‰∏ªË¶ÅÁî±‰∏ãÈù¢ÁöÑ‰∏â‰∏™Ê†∏ÂøÉÁ±ªÂÆûÁé∞</li>
<li><code>History</code><ul>
<li>Âü∫Á°ÄÁ±ª</li>
<li>‰Ωç‰∫é<code>src/history/base.js</code></li>
</ul>
</li>
<li><code>HTML5History</code><ul>
<li>Áî®‰∫éÊîØÊåÅ<code>pushState</code>ÁöÑÊµèËßàÂô®</li>
<li><code>src/history/html5.js</code></li>
</ul>
</li>
<li><code>HashHistory</code><ul>
<li>Áî®‰∫é‰∏çÊîØÊåÅ<code>pushState</code>ÁöÑÊµèËßàÂô®</li>
<li><code>src/history/hash.js</code></li>
</ul>
</li>
<li><code>AbstractHistory</code><ul>
<li>Áî®‰∫éÈùûÊµèËßàÂô®ÁéØÂ¢É(ÊúçÂä°Á´ØÊ∏≤Êüì)</li>
<li><code>src/history/abstract.js</code></li>
</ul>
</li>
<li>ÈÄöËøá‰∏ãÈù¢ËøôÂº†ÂõæÔºåÂèØ‰ª•‰∫ÜËß£Âà∞‰ªñ‰ª¨‰πãÈó¥ÁöÑÂÖ≥Á≥ª</li>
<li>route-mode-class.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-mode-class.png" alt="route-mode-class.png"></li>
</ul>
</li>
<li><code>HTML5History</code>„ÄÅ<code>HashHistory</code>„ÄÅ<code>AbstractHistory</code>‰∏âËÄÖÈÉΩÊòØÁªßÊâø‰∫éÂü∫Á°ÄÁ±ª<code>History</code>Ôºõ</li>
<li>‰∏âËÄÖ‰∏çÂÖâËÉΩËÆøÈóÆ<code>HistoryÁ±ª</code>ÁöÑÊâÄÊúâÂ±ûÊÄßÂíåÊñπÊ≥ïÔºå‰ªñ‰ª¨ËøòÈÉΩÂÆûÁé∞‰∫ÜÂü∫Á°ÄÁ±ª‰∏≠Â£∞ÊòéÁöÑÈúÄË¶ÅÂ≠êÁ±ªÂÆûÁé∞ÁöÑ 5 ‰∏™Êé•Âè£(<code>go„ÄÅpush„ÄÅreplace„ÄÅensureURL„ÄÅgetCurrentLocation</code>)</li>
<li>Áî±‰∫é<code>HashHistory</code>ÁõëÂê¨<code>hashChange</code>ÁöÑÁâπÊÆäÊÄßÔºåÊâÄ‰ª•‰ºöÂçïÁã¨Â§ö‰∏Ä‰∏™<code>setupListeners</code>ÊñπÊ≥ï</li>
<li><code>AbstractHistory</code>Áî±‰∫éÈúÄË¶ÅÂú®ÈùûÊµèËßàÂô®ÁéØÂ¢É‰ΩøÁî®ÔºåÊ≤°ÊúâÂéÜÂè≤ËÆ∞ÂΩïÊ†àÔºåÊâÄ‰ª•Âè™ËÉΩÈÄöËøá<code>index„ÄÅstack</code>Êù•Ê®°Êãü</li>
<li>ÂâçÈù¢Êàë‰ª¨ÂàÜÊûê<code>VueRouter</code>ÂÆû‰æãÂåñËøáÁ®ãÊó∂ÔºåÁü•ÈÅì<code>VueRouter</code>‰ºöÂú®Á°ÆÂÆöÂÆåË∑ØÁî±Ê®°ÂºèÂêéÔºå‰ºöÂÆû‰æãÂåñ‰∏çÂêåÁöÑ<code>HistoryÂÆû‰æã</code></li>
<li>ÈÇ£Êàë‰ª¨Êù•ÁúãÁúã‰∏çÂêå<code>History</code>ÁöÑÂÆû‰æãÂåñËøáÁ®ã</li>
</ul>
<h4 id="History-Á±ª"><a href="#History-Á±ª" class="headerlink" title="History Á±ª"></a>History Á±ª</h4><ul>
<li>ÂÆÉÊòØÁà∂Á±ª(Âü∫Á±ª)ÔºåÂÖ∂ÂÆÉÁ±ªÈÉΩÊòØÁªßÊâøÂÆÉÁöÑ</li>
<li>‰ª£Á†Å‰Ωç‰∫é<code>src/history/base.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"><span class="comment">//¬†Áà∂Á±ª</span></span><br><span class="line"><span class="keyword">export</span>¬†<span class="keyword">class</span>¬†History¬†&#123;</span><br><span class="line">¬†¬†router:¬†Router</span><br><span class="line">¬†¬†base:¬†<span class="built_in">string</span></span><br><span class="line">¬†¬†current:¬†Route</span><br><span class="line">¬†¬†pending:¬†?Route</span><br><span class="line">¬†¬†cb:¬†<span class="function">(<span class="params">r:¬†Route</span>)¬†=&gt;</span>¬†<span class="built_in">void</span></span><br><span class="line">¬†¬†ready:¬†<span class="built_in">boolean</span></span><br><span class="line">¬†¬†readyCbs:¬†<span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;</span><br><span class="line">¬†¬†readyErrorCbs:¬†<span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;</span><br><span class="line">¬†¬†errorCbs:¬†<span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†implemented¬†by¬†sub-classes</span></span><br><span class="line">¬†¬†<span class="comment">//¬†ÈúÄË¶ÅÂ≠êÁ±ª(HTML5History„ÄÅHashHistory)ÂÆûÁé∞ÁöÑÊñπÊ≥ï</span></span><br><span class="line">¬†¬†+go:¬†<span class="function">(<span class="params">n:¬†<span class="built_in">number</span></span>)¬†=&gt;</span>¬†<span class="built_in">void</span></span><br><span class="line">¬†¬†+push:¬†<span class="function">(<span class="params">loc:¬†RawLocation</span>)¬†=&gt;</span>¬†<span class="built_in">void</span></span><br><span class="line">¬†¬†+replace:¬†<span class="function">(<span class="params">loc:¬†RawLocation</span>)¬†=&gt;</span>¬†<span class="built_in">void</span></span><br><span class="line">¬†¬†+ensureURL:¬†<span class="function">(<span class="params">push?:¬†<span class="built_in">boolean</span></span>)¬†=&gt;</span>¬†<span class="built_in">void</span></span><br><span class="line">¬†¬†+getCurrentLocation:¬†<span class="function"><span class="params">()</span>¬†=&gt;</span>¬†<span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">¬†¬†<span class="keyword">constructor</span>¬†(<span class="params">router:¬†Router,¬†base:¬†?<span class="built_in">string</span></span>)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.router¬†=¬†router</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Ê†ºÂºèÂåñbaseÔºå‰øùËØÅbaseÊòØ‰ª•/ÂºÄÂ§¥</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.base¬†=¬†normalizeBase(base)</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†start¬†with¬†a¬†route¬†object¬†that¬†stands¬†for¬†"nowhere"</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.current¬†=¬†START¬†<span class="comment">//¬†ÂΩìÂâçÊåáÂêëÁöÑrouteÂØπË±°ÔºåÈªòËÆ§‰∏∫STARTÔºõÂç≥from</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.pending¬†=¬†<span class="literal">null</span>¬†<span class="comment">//¬†ËÆ∞ÂΩïÂ∞ÜË¶ÅË∑≥ËΩ¨ÁöÑrouteÔºõÂç≥to</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.ready¬†=¬†<span class="literal">false</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.readyCbs¬†=¬†[]</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.readyErrorCbs¬†=¬†[]</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.errorCbs¬†=¬†[]</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">¬†¬†</span><br><span class="line">¬†¬†...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÔºåÊûÑÈÄ†ÂáΩÊï∞‰∏≠‰∏ªË¶ÅÂπ≤‰∫Ü‰∏ãÈù¢Âá†‰ª∂‰∫ã<ul>
<li>‰øùÂ≠ò‰∫Ü<code>router</code>ÂÆû‰æã</li>
<li>ËßÑËåÉÂåñ‰∫Ü<code>base</code>ÔºåÁ°Æ‰øù<code>base</code>ÊòØ‰ª•<code>/</code>ÂºÄÂ§¥</li>
<li>ÂàùÂßãÂåñ‰∫ÜÂΩìÂâçË∑ØÁî±ÊåáÂêëÔºåÈªòËÆ§Âè™ÊÉ≥<code>START</code>ÂàùÂßãË∑ØÁî±ÔºõÂú®Ë∑ØÁî±Ë∑≥ËΩ¨Êó∂Ôºå<code>this.current</code>‰ª£Ë°®ÁöÑÊòØ<code>from</code></li>
<li>ÂàùÂßãÂåñ‰∫ÜË∑ØÁî±Ë∑≥ËΩ¨Êó∂ÁöÑ‰∏ã‰∏™Ë∑ØÁî±ÔºåÈªòËÆ§‰∏∫<code>null</code>ÔºõÂú®Ë∑ØÁî±Ë∑≥ËΩ¨Êó∂Ôºå<code>this.pending</code>‰ª£Ë°®ÁöÑÊòØ<code>to</code></li>
<li>ÂàùÂßãÂåñ‰∫Ü‰∏Ä‰∫õÂõûË∞ÉÁõ∏ÂÖ≥ÁöÑÂ±ûÊÄß</li>
</ul>
</li>
<li><code>START</code>ÂÆö‰πâÂú®<code>src/utils/route.js</code>‰∏≠</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils/route.js</span></span><br><span class="line"><span class="comment">// ÂàùÂßãË∑ØÁî±</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> START = createRoute(<span class="literal">null</span>, &#123;</span><br><span class="line">  path: <span class="string">'/'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>HistoryÁ±ª</code>ÁöÑÂÆû‰æãÂåñËøáÁ®ãÂ¶Ç‰∏ã</li>
<li>history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/history.png" alt="history.png"></li>
</ul>
</li>
</ul>
<h4 id="HTML5History-Á±ª"><a href="#HTML5History-Á±ª" class="headerlink" title="HTML5History Á±ª"></a>HTML5History Á±ª</h4><ul>
<li>Êàë‰ª¨ÂÜçÁúãÁúã<code>HTML5HistoryÁ±ª</code>,ÂÆÉÊòØÁªßÊâøËá™<code>HistoryÁ±ª</code></li>
<li>‰Ωç‰∫é<code>src/history/html5.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HTML5History <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">router: Router, base: ?<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">//¬†ÂàùÂßãÂåñÁà∂Á±ªHistory</span></span><br><span class="line">    <span class="keyword">super</span>(router, base) <span class="comment">//¬†Ê£ÄÊµãÊòØÂê¶ÈúÄË¶ÅÊîØÊåÅscroll</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectScroll = router.options.scrollBehavior</span><br><span class="line">    <span class="keyword">const</span> supportsScroll = supportsPushState &amp;&amp; expectScroll <span class="comment">//¬†Ëã•ÊîØÊåÅscroll,ÂàùÂßãÂåñscrollÁõ∏ÂÖ≥ÈÄªËæë</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">      setupScroll()</span><br><span class="line">    &#125; <span class="comment">//¬†Ëé∑ÂèñÂàùÂßãlocation</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> initLocation = getLocation(<span class="keyword">this</span>.base) <span class="comment">//¬†ÁõëÂê¨popstate‰∫ã‰ª∂</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> current = <span class="keyword">this</span>.current <span class="comment">//¬†Avoiding¬†first¬†`popstate`¬†event¬†dispatched¬†in¬†some¬†browsers¬†but¬†first //¬†history¬†route¬†not¬†updated¬†since¬†async¬†guard¬†at¬†the¬†same¬†time. //¬†Êüê‰∫õÊµèËßàÂô®Ôºå‰ºöÂú®ÊâìÂºÄÈ°µÈù¢Êó∂Ëß¶Âèë‰∏ÄÊ¨°popstate</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Ê≠§Êó∂Â¶ÇÊûúÂàùÂßãË∑ØÁî±ÊòØÂºÇÊ≠•Ë∑ØÁî±,Â∞±‰ºöÂá∫Áé∞`popstate`ÂÖàËß¶Âèë,ÂàùÂßãË∑ØÁî±ÂêéËß£ÊûêÂÆåÊàêÔºåËøõËÄåÂØºËá¥routeÊú™Êõ¥Êñ∞</span></span><br><span class="line">      <span class="comment">// ÊâÄ‰ª•ÈúÄË¶ÅÈÅøÂÖç</span></span><br><span class="line">      <span class="keyword">const</span> location = getLocation(<span class="keyword">this</span>.base)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.current === START &amp;&amp; location === initLocation) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125; <span class="comment">//¬†Ë∑ØÁî±Âú∞ÂùÄÂèëÁîüÂèòÂåñÔºåÂàôË∑≥ËΩ¨ÔºåÂπ∂Âú®Ë∑≥ËΩ¨ÂêéÂ§ÑÁêÜÊªöÂä®</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.transitionTo(location, <span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">          handleScroll(router, route, current, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÖ∂ÊòØÁªßÊâø‰∫é<code>HistoryÁ±ª</code>ÔºåÊâÄ‰ª•Âú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠Ë∞ÉÁî®‰∫ÜÁà∂Á±ªÊûÑÈÄ†ÂáΩÊï∞(<code>super(router,base)</code>)</li>
<li>Ê£ÄÊü•‰∫ÜÊòØÂê¶ÈúÄË¶ÅÊîØÊåÅÊªöÂä®Ë°å‰∏∫ÔºåÂ¶ÇÊûúÊîØÊåÅÔºåÂàôÂàùÂßãÂåñÊªöÂä®Áõ∏ÂÖ≥ÈÄªËæë</li>
<li>ÁõëÂê¨‰∫Ü<code>popstate‰∫ã‰ª∂</code>ÔºåÂπ∂Âú®<code>popstate</code>Ëß¶ÂèëÊó∂ÔºåË∞ÉÁî®<code>transitionTo</code>ÊñπÊ≥ïÂÆûÁé∞Ë∑≥ËΩ¨</li>
<li>Ê≥®ÊÑèËøôÈáåÂ§ÑÁêÜ‰∫Ü‰∏Ä‰∏™ÂºÇÂ∏∏Âú∫ÊôØ<ul>
<li>Êüê‰∫õÊµèËßàÂô®‰∏ãÔºåÊâìÂºÄÈ°µÈù¢‰ºöËß¶Âèë‰∏ÄÊ¨°<code>popstate</code>ÔºåÊ≠§Êó∂Â¶ÇÊûúË∑ØÁî±ÁªÑ‰ª∂ÊòØÂºÇÊ≠•ÁöÑÔºåÂ∞±‰ºöÂá∫Áé∞<code>popstate</code>‰∫ã‰ª∂Ëß¶Âèë‰∫ÜÔºå‰ΩÜÂºÇÊ≠•ÁªÑ‰ª∂ËøòÊ≤°Ëß£ÊûêÂÆåÊàêÔºåÊúÄÂêéÂØºËá¥<code>route</code>Ê≤°ÊúâÊõ¥Êñ∞</li>
<li>ÊâÄ‰ª•ÂØπËøôÁßçÊÉÖÂÜµÂÅö‰∫ÜÂ±èËîΩ</li>
</ul>
</li>
<li>ÂÖ≥‰∫éÊªöÂä®ÂíåË∑ØÁî±Ë∑≥ËΩ¨ÂêéÈù¢Êúâ‰∏ìÈó®Á´†ËäÇ‰ºöËÆ≤</li>
<li><code>HTML5HistoryÁ±ª</code>ÁöÑÂÆû‰æãÂåñËøáÁ®ãÂ¶Ç‰∏ã</li>
<li>h5history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/h5history.png" alt="h5history.png"></li>
</ul>
</li>
</ul>
<h4 id="HashHistory-Á±ª"><a href="#HashHistory-Á±ª" class="headerlink" title="HashHistory Á±ª"></a>HashHistory Á±ª</h4><ul>
<li>‰Ωç‰∫é<code>src/history/hash.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/hash.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HashHistory <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">router: Router, base: ?<span class="built_in">string</span>, fallback: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="comment">//¬†ÂÆû‰æãÂåñÁà∂Á±ª</span></span><br><span class="line">    <span class="keyword">super</span>(router, base) <span class="comment">//¬†check¬†history¬†fallback¬†deeplinking //¬†fallbackÂè™ÊúâÂú®ÊåáÊòé‰∫Ümode‰∏∫historyÔºå‰ΩÜÊòØÊµèËßàÂô®Âèà‰∏çÊîØÊåÅpopstateÔºåÁî®Êà∑ÊâãÂä®ÊåáÊòé‰∫Üfallback‰∏∫trueÊó∂ÔºåÊâç‰∏∫trueÔºåÂÖ∂ÂÆÉÊÉÖÂÜµ‰∏∫false //¬†Â¶ÇÊûúÈúÄË¶ÅÂõûÈÄÄÔºåÂàôÂ∞ÜurlÊç¢‰∏∫hashÊ®°Âºè(/#ÂºÄÂ§¥) //¬†this.baseÊù•Ëá™Áà∂Á±ª</span></span><br><span class="line">    <span class="keyword">if</span> (fallback &amp;&amp; checkFallback(<span class="keyword">this</span>.base)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ensureSlash()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂÆÉÁªßÊâø‰∫é<code>History</code>ÔºåÊâÄ‰ª•‰πüË∞ÉÁî®‰∫Ü<code>super(router,base)</code></li>
<li>Ê£ÄÊü•‰∫Ü<code>fallback</code>ÔºåÁúãÊòØÂê¶ÈúÄË¶ÅÂõûÈÄÄÔºåÂâçÈù¢ËØ¥ËøáÔºå‰º†ÂÖ•ÁöÑ<code>fallback</code>Âè™ÊúâÂú®Áî®Êà∑ËÆæÁΩÆ‰∫Ü<code>history</code>‰∏îÂèà‰∏çÊîØÊåÅ<code>pushState</code>Âπ∂‰∏îÂêØÁî®‰∫ÜÂõûÈÄÄÊó∂Êâç‰∏∫<code>true</code></li>
<li>ÊâÄ‰ª•ÔºåÊ≠§Êó∂ÔºåÈúÄË¶ÅÂ∞Ü<code>history</code>Ê®°ÂºèÁöÑ<code>url</code>ÊõøÊç¢Êàê<code>hash</code>Ê®°ÂºèÔºåÂç≥Ê∑ªÂä†‰∏ä<code>#</code>ÔºåËøô‰∏™ÈÄªËæëÊòØÁî±<code>checkFallback</code>ÂÆûÁé∞ÁöÑ</li>
<li>Â¶ÇÊûú‰∏çÊòØ<code>fallback</code>ÔºåÂàôÁõ¥Êé•Ë∞ÉÁî®<code>ensureSlash</code>ÔºåÁ°Æ‰øù<code>url</code>ÊòØ‰ª•<code>/</code>ÂºÄÂ§¥ÁöÑ</li>
<li>Êàë‰ª¨Áúã‰∏ã<code>checkFallback</code>„ÄÅ<code>ensureSlash</code>ÂÆûÁé∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/hash.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *¬†Ê£ÄÊü•ÂõûÈÄÄÔºåÂ∞ÜurlËΩ¨Êç¢‰∏∫hashÊ®°Âºè(Ê∑ªÂä†/#)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFallback</span>(<span class="params">base</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> location = getLocation(base) <span class="comment">//¬†Âú∞ÂùÄ‰∏ç‰ª•/#ÂºÄÂ§¥ÔºåÂàôÊ∑ªÂä†‰πã</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^\/#/</span>.test(location)) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.replace(cleanPath(base + <span class="string">'/#'</span> + location)) <span class="comment">// Ëøô‰∏ÄÊ≠•ÂÆûÁé∞‰∫ÜurlÊõøÊç¢</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *¬†Á°Æ‰øùurlÊòØ‰ª•/ÂºÄÂ§¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureSlash</span>(<span class="params"></span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> path = getHash()</span><br><span class="line">  <span class="keyword">if</span> (path.charAt(<span class="number">0</span>) === <span class="string">'/'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  replaceHash(<span class="string">'/'</span> + path)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊõøÊç¢hashËÆ∞ÂΩï</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceHash</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//¬†ÊîØÊåÅpushStateÔºåÂàô‰ºòÂÖà‰ΩøÁî®replaceState</span></span><br><span class="line">  <span class="keyword">if</span> (supportsPushState) &#123;</span><br><span class="line">    replaceState(getUrl(path))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.replace(getUrl(path))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊòØ‰∏çÊòØÂèëÁé∞<code>HashHistory</code>Â∞ë‰∫ÜÊªöÂä®ÊîØÊåÅÂíåÁõëÂê¨<code>hashChange</code>Áõ∏ÂÖ≥ÈÄªËæëÔºåËøôÊòØÂõ†‰∏∫<code>hashChange</code>Â≠òÂú®‰∏Ä‰∫õÁâπÊÆäÂú∫ÊôØÔºåÈúÄË¶ÅÁ≠âÂà∞<code>mounts</code>ÂêéÊâçËÉΩÁõëÂê¨<ul>
<li>Ëøô‰∏ÄÂùóÁöÑÈÄªËæëÂÖ®ÊîæÂú®‰∫Ü<code>setupListeners</code>ÊñπÊ≥ï‰∏≠Ôºå<code>setupListeners</code>‰ºöÂú®<code>VueRouter</code>Ë∞ÉÁî®<code>init</code>Êó∂Ë¢´Ë∞ÉÁî®ÔºåËøô‰∏™Êàë‰ª¨Âú®ÂàùÂßãÂåñÁ´†ËäÇÂÜçÁúã</li>
</ul>
</li>
<li><code>HashHistoryÁ±ª</code>ÁöÑÂÆû‰æãÂåñËøáÁ®ãÂ¶Ç‰∏ã</li>
<li>hash-history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/hash-history.png" alt="hash-history.png"></li>
</ul>
</li>
</ul>
<h4 id="AbstractHistory-Á±ª"><a href="#AbstractHistory-Á±ª" class="headerlink" title="AbstractHistory Á±ª"></a>AbstractHistory Á±ª</h4><ul>
<li><code>AbstractHistory</code>ÊòØÁî®‰∫éÈùûÊµèËßàÂô®ÁéØÂ¢ÉÁöÑ</li>
<li>‰Ωç‰∫é<code>src/history/abstract.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/abstract.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *¬†ÊîØÊåÅÊâÄÊúâ¬†JavaScript¬†ËøêË°åÁéØÂ¢ÉÔºåÂ¶Ç¬†Node.js¬†ÊúçÂä°Âô®Á´Ø„ÄÇÂ¶ÇÊûúÂèëÁé∞Ê≤°ÊúâÊµèËßàÂô®ÁöÑ¬†APIÔºåË∑ØÁî±‰ºöËá™Âä®Âº∫Âà∂ËøõÂÖ•Ëøô‰∏™Ê®°Âºè</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *¬†@export</span></span><br><span class="line"><span class="comment"> *¬†@class¬†AbstractHistory</span></span><br><span class="line"><span class="comment"> *¬†@extends¬†&#123;History&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AbstractHistory <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">router: Router, base: ?<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">//¬†ÂàùÂßãÂåñÁà∂Á±ª</span></span><br><span class="line">    <span class="keyword">super</span>(router, base)</span><br><span class="line">    <span class="keyword">this</span>.stack = []</span><br><span class="line">    <span class="keyword">this</span>.index = <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÆÉÁöÑÂÆû‰æãÂåñÊòØÊúÄÁÆÄÂçïÁöÑÔºåÂè™ÂàùÂßãÂåñ‰∫ÜÁà∂Á±ªÔºåÂπ∂ÂØπ<code>index</code>„ÄÅ<code>stack</code>ÂÅö‰∫ÜÂàùÂßãÂåñ</li>
<li>ÂâçÈù¢ËØ¥ËøáÔºåÈùûÊµèËßàÂô®ÁéØÂ¢ÉÔºåÊòØÊ≤°ÊúâÂéÜÂè≤ËÆ∞ÂΩïÊ†àÁöÑÔºåÊâÄ‰ª•‰ΩøÁî®<code>index</code>„ÄÅ<code>stack</code>Êù•Ê®°ÊãüÂéÜÂè≤ËÆ∞ÂΩïÊ†à</li>
<li><code>AbstractHistoryÁ±ª</code>ÁöÑÂÆû‰æãÂåñËøáÁ®ãÂ¶Ç‰∏ã</li>
<li>abstract-history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/abstract-history.png" alt="abstract-history.png"></li>
</ul>
</li>
</ul>
<h4 id="Â∞èÁªì-4"><a href="#Â∞èÁªì-4" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h4><ul>
<li>Ëøô‰∏ÄÂ∞èËäÇÊàë‰ª¨ÂØπ‰∏âÁßçË∑ØÁî±Ê®°ÂºèÂÅö‰∫ÜÁÆÄÂçïÂàÜÊûêÔºåÂπ∂‰∏îËøò‰∏ÄËµ∑Áúã‰∫ÜÂÆûÁé∞Ëøô‰∏âÁßçË∑ØÁî±Ê®°ÂºèÊâÄÈúÄË¶ÅÁöÑ<code>History</code>Á±ªÊòØÂ¶Ç‰ΩïÂÆû‰æãÂåñÁöÑ</li>
<li>Âà∞Ê≠§Ôºå<code>VueRouter</code>ÁöÑÊï¥‰∏™ÂÆû‰æãÂåñËøáÁ®ãÂü∫Êú¨ËÆ≤ÂÆå</li>
<li>‰∏ãÈù¢ÔºåÊàë‰ª¨ÈÄöËøá‰∏Ä‰∏™ÂõæÊù•ÁÆÄÂçïÊÄªÁªì‰∏ã<code>VueRouter</code>ÂÆû‰æãÂåñËøáÁ®ã</li>
<li>vue-router-instance.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/vue-router-instance.png" alt="vue-router-instance.png"></li>
</ul>
</li>
</ul>
<h2 id="ÂàùÂßãÂåñÊµÅÁ®ã"><a href="#ÂàùÂßãÂåñÊµÅÁ®ã" class="headerlink" title="ÂàùÂßãÂåñÊµÅÁ®ã"></a>ÂàùÂßãÂåñÊµÅÁ®ã</h2><ul>
<li>ÂàÜÊûêÂÆåÂÆû‰æãÂåñËøáÁ®ãÔºå‰∏ãÈù¢Êàë‰ª¨Êù•ÁúãÁúãÂàùÂßãÂåñÊòØÂ¶Ç‰ΩïËøõË°åÁöÑÔºåÈÉΩÂÅö‰∫ÜÂì™‰∫õ‰∫ãÊÉÖ</li>
</ul>
<h3 id="Ë∞ÉÁî®-init-Êó∂Êú∫"><a href="#Ë∞ÉÁî®-init-Êó∂Êú∫" class="headerlink" title="Ë∞ÉÁî® init Êó∂Êú∫"></a>Ë∞ÉÁî® init Êó∂Êú∫</h3><ul>
<li>Âú®ÂàÜÊûêÂÆâË£ÖÊµÅÁ®ãÊó∂ÔºåÊàë‰ª¨Áü•ÈÅì<code>VueRouter</code>Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÊ∑∑ÂÖ•ÔºåÊ∑∑ÂÖ•‰∫Ü<code>beforeCreate</code>Èí©Â≠ê</li>
<li>‰ª£Á†ÅÂ¶Ç‰∏ã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/install.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ê≥®ÂÜåÂÖ®Â±ÄÊ∑∑ÂÖ•</span></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">¬†¬†beforeCreate¬†()¬†&#123;</span><br><span class="line">¬†¬†¬†¬†</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Âà§Êñ≠ÊòØÂê¶‰ΩøÁî®‰∫Üvue-routerÊèí‰ª∂</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">if</span>¬†(isDef(<span class="keyword">this</span>.$options.router))¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†...</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>._router¬†=¬†<span class="keyword">this</span>.$options.router¬†<span class="comment">//¬†‰øùÂ≠òVueRouterÂÆû‰æãÔºåthis.$options.router‰ªÖÂ≠òÂú®‰∫éVueÊ†πÂÆû‰æã‰∏äÔºåÂÖ∂ÂÆÉVueÁªÑ‰ª∂‰∏çÂåÖÂê´Ê≠§Â±ûÊÄßÔºåÊâÄ‰ª•‰∏ãÈù¢ÁöÑÂàùÂßãÂåñÔºåÂè™‰ºöÊâßË°å‰∏ÄÊ¨°</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†beforeCreate¬†hookË¢´Ëß¶ÂèëÊó∂ÔºåË∞ÉÁî®</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>._router.init(<span class="keyword">this</span>)¬†<span class="comment">//¬†ÂàùÂßãÂåñVueRouterÂÆû‰æãÔºåÂπ∂‰º†ÂÖ•VueÊ†πÂÆû‰æã</span></span><br><span class="line">¬†¬†¬†¬†&#125;¬†<span class="keyword">else</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†...</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†...</span><br><span class="line">¬†¬†&#125;,</span><br><span class="line">¬†¬†destroyed¬†()¬†&#123;</span><br><span class="line">¬†¬†¬†...</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Êàë‰ª¨Áü•ÈÅìÂÖ®Â±ÄÊ∑∑ÂÖ•Ôºå‰ºöÂΩ±ÂìçÂêéÁª≠ÂàõÂª∫ÁöÑÊâÄÊúâ<code>VueÂÆû‰æã</code>ÔºåÊâÄ‰ª•<code>beforeCreate</code>È¶ñÊ¨°Ëß¶ÂèëÊòØÂú®<code>VueÊ†πÂÆû‰æãÂÆû‰æãÂåñÁöÑÊó∂ÂÄô</code>Âç≥<code>new Vue({router})</code>Êó∂Ôºå<br>Ëß¶ÂèëÂêéË∞ÉÁî®<code>router</code>ÂÆû‰æãÁöÑ<code>init</code>ÊñπÊ≥ïÂπ∂‰º†ÂÖ•<code>VueÊ†πÂÆû‰æã</code>ÔºåÂÆåÊàêÂàùÂßãÂåñÊµÅÁ®ãÔºõ</li>
<li>Áî±‰∫é<code>router</code>‰ªÖÂ≠òÂú®‰∫é<code>VueÊ†πÂÆû‰æã</code>ÁöÑ<code>$options</code>‰∏äÔºåÊâÄ‰ª•ÔºåÊï¥‰∏™ÂàùÂßãÂåñÂè™‰ºöË¢´Ë∞ÉÁî®‰∏ÄÊ¨°</li>
<li>Êàë‰ª¨Êé•‰∏ãÊù•Áúã‰∏ã<code>init</code>ÊñπÊ≥ïÂÆûÁé∞</li>
</ul>
<h3 id="init-ÊñπÊ≥ï"><a href="#init-ÊñπÊ≥ï" class="headerlink" title="init ÊñπÊ≥ï"></a>init ÊñπÊ≥ï</h3><ul>
<li><code>VueRouter</code>ÁöÑ<code>init</code>ÊñπÊ≥ï‰Ωç‰∫é<code>src/index.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/install.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> VueRouter &#123;</span><br><span class="line">  <span class="comment">//¬†ÂàùÂßãÂåñ,app‰∏∫VueÊ†πÂÆû‰æã</span></span><br><span class="line">  init(app: <span class="built_in">any</span> <span class="comment">/*¬†Vue¬†component¬†instance¬†*/</span>) &#123;</span><br><span class="line">    <span class="comment">//¬†ÂºÄÂèëÁéØÂ¢ÉÔºåÁ°Æ‰øùÂ∑≤ÁªèÂÆâË£ÖVueRouter</span></span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp;</span><br><span class="line">      assert(</span><br><span class="line">        install.installed,</span><br><span class="line">        <span class="string">`not¬†installed.¬†Make¬†sure¬†to¬†call¬†\`Vue.use(VueRouter)\`¬†`</span> +</span><br><span class="line">          <span class="string">`before¬†creating¬†root¬†instance.`</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.apps.push(app) <span class="comment">//¬†‰øùÂ≠òÂÆû‰æã //¬†set¬†up¬†app¬†destroyed¬†handler //¬†https://github.com/vuejs/vue-router/issues/2639 //¬†ÁªëÂÆödestroyed¬†hookÔºåÈÅøÂÖçÂÜÖÂ≠òÊ≥ÑÈú≤</span></span><br><span class="line">    app.$once(<span class="string">'hook:destroyed'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//¬†clean¬†out¬†app¬†from¬†this.apps¬†array¬†once¬†destroyed</span></span><br><span class="line">      <span class="keyword">const</span> index = <span class="keyword">this</span>.apps.indexOf(app)</span><br><span class="line">      <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) <span class="keyword">this</span>.apps.splice(index, <span class="number">1</span>) <span class="comment">//¬†ensure¬†we¬†still¬†have¬†a¬†main¬†app¬†or¬†null¬†if¬†no¬†apps //¬†we¬†do¬†not¬†release¬†the¬†router¬†so¬†it¬†can¬†be¬†reused //¬†ÈúÄË¶ÅÁ°Æ‰øùÂßãÁªàÊúâ‰∏™‰∏ªÂ∫îÁî®</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.app === app) <span class="keyword">this</span>.app = <span class="keyword">this</span>.apps[<span class="number">0</span>] || <span class="literal">null</span></span><br><span class="line">    &#125;) <span class="comment">//¬†main¬†app¬†previously¬†initialized //¬†return¬†as¬†we¬†don't¬†need¬†to¬†set¬†up¬†new¬†history¬†listener //¬†main¬†appÂ∑≤ÁªèÂ≠òÂú®ÔºåÂàô‰∏çÈúÄË¶ÅÈáçÂ§çÂàùÂßãÂåñhistory¬†ÁöÑ‰∫ã‰ª∂ÁõëÂê¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.app) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.app = app</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> history = <span class="keyword">this</span>.history</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (history <span class="keyword">instanceof</span> HTML5History) &#123;</span><br><span class="line">      <span class="comment">//¬†Ëã•ÊòØHTML5HistoryÁ±ªÔºåÂàôÁõ¥Êé•Ë∞ÉÁî®Áà∂Á±ªÁöÑtransitionToÊñπÊ≥ïÔºåË∑≥ËΩ¨Âà∞ÂΩìÂâçlocation</span></span><br><span class="line">      history.transitionTo(history.getCurrentLocation())</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (history <span class="keyword">instanceof</span> HashHistory) &#123;</span><br><span class="line">      <span class="comment">//¬†Ëã•ÊòØHashHistoryÔºåÂú®Ë∞ÉÁî®Áà∂Á±ªÁöÑtransitionToÊñπÊ≥ïÂêéÔºåÂπ∂‰º†ÂÖ•onComplete„ÄÅonAbortÂõûË∞É</span></span><br><span class="line">      <span class="keyword">const</span> setupHashListener = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//¬†Ë∞ÉÁî®HashHistory.setupListenersÊñπÊ≥ïÔºåËÆæÁΩÆhashchangeÁõëÂê¨</span></span><br><span class="line">        <span class="comment">//¬†Âú®¬†route¬†ÂàáÊç¢ÂÆåÊàê‰πãÂêéÂÜçËÆæÁΩÆ¬†hashchange¬†ÁöÑÁõëÂê¨,</span></span><br><span class="line">        <span class="comment">//¬†‰øÆÂ§çhttps://github.com/vuejs/vue-router/issues/725</span></span><br><span class="line">        <span class="comment">//¬†Âõ†‰∏∫Â¶ÇÊûúÈí©Â≠êÂáΩÊï∞¬†beforeEnter¬†ÊòØÂºÇÊ≠•ÁöÑËØù,¬†beforeEnter¬†Èí©Â≠êÂ∞±‰ºöË¢´Ëß¶Âèë‰∏§Ê¨°.¬†Âõ†‰∏∫Âú®ÂàùÂßãÂåñÊó∂,¬†Â¶ÇÊûúÊ≠§Êó∂ÁöÑ¬†hash¬†ÂÄº‰∏çÊòØ‰ª•¬†/¬†ÂºÄÂ§¥ÁöÑËØùÂ∞±‰ºöË°•‰∏ä¬†#/,¬†Ëøô‰∏™ËøáÁ®ã‰ºöËß¶Âèë¬†hashchange¬†‰∫ã‰ª∂,¬†Â∞±‰ºöÂÜçËµ∞‰∏ÄÊ¨°ÁîüÂëΩÂë®ÊúüÈí©Â≠ê,¬†‰πüÂ∞±ÊÑèÂë≥ÁùÄ‰ºöÂÜçÊ¨°Ë∞ÉÁî®¬†beforeEnter¬†Èí©Â≠êÂáΩÊï∞.</span></span><br><span class="line">        history.setupListeners()</span><br><span class="line">      &#125;</span><br><span class="line">      history.transitionTo(</span><br><span class="line">        history.getCurrentLocation(),</span><br><span class="line">        setupHashListener, <span class="comment">//¬†transitionToÁöÑonCompleteÂõûË∞É</span></span><br><span class="line">        setupHashListener <span class="comment">//¬†transitionToÁöÑonAbortÂõûË∞É</span></span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="comment">//¬†Ë∞ÉÁî®Áà∂Á±ªÁöÑlistenÊñπÊ≥ïÔºåÊ∑ªÂä†ÂõûË∞ÉÔºõ //¬†ÂõûË∞É‰ºöÂú®Áà∂Á±ªÁöÑupdateRouteÊñπÊ≥ïË¢´Ë∞ÉÁî®Êó∂Ëß¶ÂèëÔºåÈáçÊñ∞‰∏∫app._routeËµãÂÄº //¬†Áî±‰∫éapp._routeË¢´ÂÆö‰πâ‰∏∫ÂìçÂ∫îÂºèÔºåÊâÄ‰ª•app._routeÂèëÁîüÂèòÂåñÔºå‰æùËµñapp._routeÁöÑÁªÑ‰ª∂(route-viewÁªÑ‰ª∂)ÈÉΩ‰ºöË¢´ÈáçÊñ∞Ê∏≤Êüì</span></span><br><span class="line"></span><br><span class="line">    history.listen(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.apps.forEach(<span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">        app._route = route</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞Ôºå‰∏ªË¶ÅÂÅö‰∫Ü‰∏ãÈù¢Âá†‰ª∂‰∫ã</li>
<li>Ê£ÄÊü•‰∫Ü<code>VueRouter</code>ÊòØÂê¶Â∑≤ÁªèÂÆâË£Ö</li>
<li>‰øùÂ≠ò‰∫ÜÊåÇËΩΩ<code>routerÂÆû‰æã</code>ÁöÑ<code>vueÂÆû‰æã</code><ul>
<li><code>VueRouter</code>ÊîØÊåÅÂ§öÂÆû‰æãÂµåÂ•óÔºåÊâÄ‰ª•Â≠òÂú®<code>this.apps</code>Êù•‰øùÂ≠òÊåÅÊúâ<code>routerÂÆû‰æã</code>ÁöÑ<code>vueÂÆû‰æã</code></li>
</ul>
</li>
<li>Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™‰∏ÄÊ¨°ÊÄßÈí©Â≠ê<code>destroyed</code>ÔºåÂú®<code>destroyed</code>Êó∂ÔºåÂç∏ËΩΩ<code>this.app</code>ÔºåÈÅøÂÖçÂÜÖÂ≠òÊ≥ÑÈú≤</li>
<li>Ê£ÄÊü•‰∫Ü<code>this.app</code>ÔºåÈÅøÂÖçÈáçÂ§ç‰∫ã‰ª∂ÁõëÂê¨</li>
<li>Ê†πÊçÆ<code>history</code>Á±ªÂûãÔºåË∞ÉÁî®<code>transitionTo</code>Ë∑≥ËΩ¨Âà∞‰∏çÂêåÁöÑÂàùÂßãÈ°µÈù¢</li>
<li>Ê≥®ÂÜå<code>updateRoute</code>ÂõûË∞ÉÔºåÂú®<code>router</code>Êõ¥Êñ∞Êó∂ÔºåÊõ¥Êñ∞<code>app._route</code>ÂÆåÊàêÈ°µÈù¢ÈáçÊñ∞Ê∏≤Êüì<ul>
<li>Ëøô‰∏™Êàë‰ª¨Âú®<code>viewÁªÑ‰ª∂</code>Á´†ËäÇ‰ºöËØ¶ÁªÜËÆ≤</li>
</ul>
</li>
<li>Êàë‰ª¨ÈáçÁÇπÁúã‰∏ã<code>transitionTo</code>Áõ∏ÂÖ≥ÈÄªËæë</li>
</ul>
<h3 id="setupListeners"><a href="#setupListeners" class="headerlink" title="setupListeners"></a>setupListeners</h3><ul>
<li>‰∏äÈù¢ËØ¥Âà∞ÔºåÂú®ÂàùÂßãÂåñÊó∂Ôºå‰ºöÊ†πÊçÆ<code>historyÁ±ªÂûã</code>ÔºåË∞ÉÁî®<code>transitionTo</code>Ë∑≥ËΩ¨Âà∞‰∏çÂêåÁöÑÂàùÂßãÈ°µÈù¢</li>
<li>‰∏∫‰ªÄ‰πàË¶ÅË∑≥ËΩ¨ÂàùÂßãÈ°µÈù¢Ôºü<ul>
<li>Âõ†‰∏∫Âú®ÂàùÂßãÂåñÊó∂Ôºåurl ÂèØËÉΩÊåáÂêëÂÖ∂ÂÆÉÈ°µÈù¢ÔºåÊ≠§Êó∂ÈúÄË¶ÅË∞ÉÁî®<code>getCurrentLocation</code>ÊñπÊ≥ïÔºå‰ªéÂΩìÂâç url ‰∏äËß£ÊûêÂá∫Ë∑ØÁî±ÔºåÁÑ∂ÂêéË∑≥ËΩ¨‰πã</li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞<code>HTML5HistoryÁ±ª</code>Âíå<code>HashHistoryÁ±ª</code>Ë∞ÉÁî®<code>transitionTo</code>ÊñπÊ≥ïÁöÑÂèÇÊï∞‰∏çÂ§™‰∏ÄÊ†∑<ul>
<li>ÂâçËÄÖÂè™‰º†ÂÖ•‰∫Ü‰∏Ä‰∏™ÂèÇÊï∞</li>
<li>ÂêéËÄÖ‰º†ÂÖ•‰∫Ü‰∏â‰∏™ÂèÇÊï∞</li>
</ul>
</li>
<li>Êàë‰ª¨Áúã‰∏ã<code>transitionTo</code>ÊñπÊ≥ïÁöÑÊñπÊ≥ïÁ≠æÂêç</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//¬†src/history/base.js</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//¬†Áà∂Á±ª</span></span><br><span class="line"><span class="keyword">export</span>¬†<span class="keyword">class</span>¬†History¬†&#123;</span><br><span class="line">¬†¬†...</span><br><span class="line">¬†¬†</span><br><span class="line">¬†¬†<span class="comment">//¬†Ë∑ØÁî±Ë∑≥ËΩ¨</span></span><br><span class="line">¬†¬†transitionTo¬†(</span><br><span class="line">¬†¬†¬†¬†location:¬†RawLocation,¬†<span class="comment">//¬†ÂéüÂßãlocationÔºå‰∏Ä‰∏™urlÊàñËÄÖÊòØ‰∏Ä‰∏™Location¬†interface(Ëá™ÂÆö‰πâÂΩ¢Áä∂ÔºåÂú®types/router.d.ts‰∏≠ÂÆö‰πâ)</span></span><br><span class="line">¬†¬†¬†¬†onComplete?:¬†<span class="built_in">Function</span>,¬†<span class="comment">//¬†Ë∑≥ËΩ¨ÊàêÂäüÂõûË∞É</span></span><br><span class="line">¬†¬†¬†¬†onAbort?:¬†<span class="built_in">Function</span><span class="comment">//¬†Ë∑≥ËΩ¨Â§±Ë¥•ÂõûË∞É</span></span><br><span class="line">¬†¬†)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†...¬†¬†¬†</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>È¶ñ‰∏™ÂèÇÊï∞ÊòØÈúÄË¶ÅËß£ÊûêÁöÑÂú∞ÂùÄÔºåÁ¨¨‰∫åÊòØË∑≥ËΩ¨ÊàêÂäüÂõûË∞ÉÔºåÁ¨¨‰∏â‰∏™ÊòØË∑≥ËΩ¨Â§±Ë¥•ÂõûË∞É</li>
<li>Êàë‰ª¨Êù•Áúã‰∏ã<code>HashHistory</code> Á±ª‰∏∫‰ΩïÈúÄË¶Å‰º†ÂÖ•ÂõûË∞É</li>
<li>ÂèØ‰ª•ÁúãÂà∞‰º†ÂÖ•ÁöÑÊàêÂäü„ÄÅÂ§±Ë¥•ÂõûË∞ÉÈÉΩÊòØ<code>setupHashListener</code>ÂáΩÊï∞,<code>setupHashListener</code>ÂáΩÊï∞ÂÜÖÈÉ®Ë∞ÉÁî®‰∫Ü<code>history.setupListeners</code>ÊñπÊ≥ïÔºåËÄåËøô‰∏™ÊñπÊ≥ïÊòØ<code>HashHistoryÁ±ª</code>Áã¨ÊúâÁöÑ</li>
<li>ÊâìÂºÄ<code>src/history/hash.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/hash.js</span></span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†this¬†is¬†delayed¬†until¬†the¬†app¬†mounts</span></span><br><span class="line">¬†¬†<span class="comment">//¬†to¬†avoid¬†the¬†hashchange¬†listener¬†being¬†fired¬†too¬†early</span></span><br><span class="line">¬†¬†<span class="comment">//¬†‰øÆÂ§ç#725;https://github.com/vuejs/vue-router/issues/725</span></span><br><span class="line">¬†¬†<span class="comment">//¬†Âõ†‰∏∫Â¶ÇÊûúÈí©Â≠êÂáΩÊï∞¬†beforeEnter¬†ÊòØÂºÇÊ≠•ÁöÑËØù,¬†beforeEnter¬†Èí©Â≠êÂ∞±‰ºöË¢´Ëß¶Âèë‰∏§Ê¨°.¬†Âõ†‰∏∫Âú®ÂàùÂßãÂåñÊó∂,¬†Â¶ÇÊûúÊ≠§Êó∂ÁöÑ¬†hash¬†ÂÄº‰∏çÊòØ‰ª•¬†/¬†ÂºÄÂ§¥ÁöÑËØùÂ∞±‰ºöË°•‰∏ä¬†#/,¬†Ëøô‰∏™ËøáÁ®ã‰ºöËß¶Âèë¬†hashchange¬†‰∫ã‰ª∂,¬†Â∞±‰ºöÂÜçËµ∞‰∏ÄÊ¨°ÁîüÂëΩÂë®ÊúüÈí©Â≠ê,¬†‰πüÂ∞±ÊÑèÂë≥ÁùÄ‰ºöÂÜçÊ¨°Ë∞ÉÁî®¬†beforeEnter¬†Èí©Â≠êÂáΩÊï∞.</span></span><br><span class="line">¬†¬†setupListeners¬†()¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†router¬†=¬†<span class="keyword">this</span>.router</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†expectScroll¬†=¬†router.options.scrollBehavior</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†supportsScroll¬†=¬†supportsPushState¬†&amp;&amp;¬†expectScroll</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Ëã•ÊîØÊåÅscroll,ÂàùÂßãÂåñscrollÁõ∏ÂÖ≥ÈÄªËæë</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">if</span>¬†(supportsScroll)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†setupScroll()</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨</span></span><br><span class="line">¬†¬†¬†¬†<span class="built_in">window</span>.addEventListener(</span><br><span class="line">¬†¬†¬†¬†¬†¬†supportsPushState¬†?¬†<span class="string">'popstate'</span>¬†:¬†<span class="string">'hashchange'</span>,¬†<span class="comment">//¬†‰ºòÂÖà‰ΩøÁî®popstate</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†()¬†=&gt;¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">const</span>¬†current¬†=¬†<span class="keyword">this</span>.current</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(!ensureSlash())¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">return</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.transitionTo(getHash(),¬†<span class="function"><span class="params">route</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(supportsScroll)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†handleScroll(<span class="keyword">this</span>.router,¬†<span class="comment">/*¬†to*/</span>route,¬†<span class="comment">/*¬†from*/</span>current,¬†<span class="literal">true</span>)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†‰∏çÊîØÊåÅpushStateÔºåÁõ¥Êé•ÊõøÊç¢ËÆ∞ÂΩï</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(!supportsPushState)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†replaceHash(route.fullPath)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†)</span><br><span class="line">¬†¬†&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>‰∏ªË¶ÅÈÄªËæëÂ¶Ç‰∏ã</li>
<li><code>setupListeners</code>‰∏ªË¶ÅÂà§Êñ≠‰∫ÜÊòØÂê¶ÈúÄË¶ÅÊîØÊåÅÊªöÂä®Ë°å‰∏∫ÔºåÂ¶ÇÊûúÊîØÊåÅÔºåÂàôÂàùÂßãÂåñÁõ∏ÂÖ≥ÈÄªËæë</li>
<li>ÁÑ∂ÂêéÊ∑ªÂä†<code>urlÂèòÂåñ</code>‰∫ã‰ª∂ÁõëÂê¨Ôºå‰πãÂâçËØ¥ËøáÂÆûÁé∞Ë∑ØÁî±Êúâ‰∏§ÁßçÊñπÊ°à<code>pushState+popState</code>„ÄÅ<code>hash+hashChange</code></li>
<li>ÂèØ‰ª•ÁúãÂà∞ËøôÈáåÂç≥‰ΩøÊòØ<code>HashHistory</code>‰πü‰ºö‰ºòÂÖà‰ΩøÁî®<code>popstate</code>‰∫ã‰ª∂Êù•ÁõëÂê¨<code>url</code>ÁöÑÂèòÂåñ</li>
<li>ÂΩì<code>url</code>ÂèëÁîüÂèòÂåñÊó∂Ôºå‰ºöË∞ÉÁî®<code>transitionTo</code>Ë∑≥ËΩ¨Êñ∞Ë∑ØÁî±</li>
<li>ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏ÄÂùóÁöÑÈÄªËæëÂíå<code>HTML5HistoryÁ±ª</code>Âú®ÂÆû‰æãÂåñÊó∂Â§ÑÁêÜÁöÑÈÄªËæëÂæàÁ±ª‰ºº</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/html5.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HTML5History <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params">router: Router, base: ?<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ê£ÄÊµãÊòØÂê¶ÈúÄË¶ÅÊîØÊåÅscroll</span></span><br><span class="line">    <span class="keyword">const</span> expectScroll = router.options.scrollBehavior</span><br><span class="line">    <span class="keyword">const</span> supportsScroll = supportsPushState &amp;&amp; expectScroll</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ëã•ÊîØÊåÅscroll,ÂàùÂßãÂåñscrollÁõ∏ÂÖ≥ÈÄªËæë</span></span><br><span class="line">    <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">      setupScroll()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ëé∑ÂèñÂàùÂßãlocation</span></span><br><span class="line">    <span class="keyword">const</span> initLocation = getLocation(<span class="keyword">this</span>.base)</span><br><span class="line">    <span class="comment">// ÁõëÂê¨popstate‰∫ã‰ª∂</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Ë∑ØÁî±Âú∞ÂùÄÂèëÁîüÂèòÂåñÔºåÂàôË∑≥ËΩ¨ÔºåÂπ∂Âú®Ë∑≥ËΩ¨ÂêéÂ§ÑÁêÜÊªöÂä®</span></span><br><span class="line">      <span class="keyword">this</span>.transitionTo(location, <span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">          handleScroll(router, route, current, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÈÇ£‰∏∫‰Ωï‰∫åËÄÖÂ§ÑÁêÜÁöÑÊó∂Êú∫‰∏çÂêåÂë¢Ôºü<ul>
<li><code>HTML5Histroy</code>Âú®ÂÆû‰æãÂåñÊó∂ÁõëÂê¨‰∫ã‰ª∂</li>
<li><code>HashHistory</code>Âú®ÂàùÊ¨°Ë∑ØÁî±Ë∑≥ËΩ¨ÁªìÊùüÂêéÁõëÂê¨‰∫ã‰ª∂</li>
</ul>
</li>
<li>ËøôÊòØ‰∏∫‰∫Ü‰øÆÂ§ç<a href="https://github.com/vuejs/vue-router/issues/725" target="_blank" rel="noopener">#725 ÈóÆÈ¢ò</a><ul>
<li>Â¶ÇÊûú<code>beforeEnter</code>ÊòØÂºÇÊ≠•ÁöÑËØùÔºå<code>beforeEnter</code>Â∞±‰ºöËß¶Âèë‰∏§Ê¨°ÔºåËøôÊòØÂõ†‰∏∫Âú®ÂàùÂßãÂåñÊó∂Ôºå<code>hash</code>  ÂÄº‰∏çÊòØ  <code>/</code>  ÂºÄÂ§¥ÁöÑËØùÂ∞±‰ºöË°•‰∏ä<code>#/</code>ÔºåËøô‰∏™ËøáÁ®ã‰ºöËß¶Âèë  <code>hashchange</code>  ‰∫ã‰ª∂ÔºåÊâÄ‰ª•‰ºöÂÜçËµ∞‰∏ÄÊ¨°ÁîüÂëΩÂë®ÊúüÈí©Â≠êÔºåÂØºËá¥ÂÜçÊ¨°Ë∞ÉÁî®  <code>beforeEnter</code>  Èí©Â≠êÂáΩÊï∞„ÄÇÊâÄ‰ª•Âè™ËÉΩÂ∞Ü<code>hashChange</code>‰∫ã‰ª∂ÁöÑÁõëÂê¨Âª∂ËøüÂà∞ÂàùÂßãË∑ØÁî±Ë∑≥ËΩ¨ÂÆåÊàêÂêéÔºõ</li>
</ul>
</li>
</ul>
<h3 id="Â∞èÁªì-5"><a href="#Â∞èÁªì-5" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h3><ul>
<li>ÈíàÂØπ init ÊµÅÁ®ãÔºåÊÄªÁªì‰∫Ü‰∏ãÈù¢ÁöÑÊ¥ªÂä®Âõæ</li>
<li>init.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/init.png" alt="init.png"></li>
</ul>
</li>
</ul>
<h2 id="ÊÄªÁªì-2"><a href="#ÊÄªÁªì-2" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><ul>
<li>ÊñáÁ´†‰∏ªË¶Å‰ªéÂâçÁ´ØË∑ØÁî±ÁöÑÊï¥‰ΩìËÆæËÆ°ÊÄùË∑ØÂºÄÂßãÔºåÈÄêÊ≠•ÂàÜÊûêÂâçÁ´ØË∑ØÁî±ËÆæËÆ°ÁöÑÂü∫Êú¨ÂéüÂàôÔºåÁêÜÊ∏ÖËÆæËÆ°ÊÄùË∑Ø</li>
<li>ÁÑ∂Âêé‰ªãÁªç‰∫ÜË¥ØÁ©øÂÖ®Â±ÄÁöÑ<code>vue-router</code>Âá†‰∏™ÊúØËØ≠</li>
<li>ÂØπÊúØËØ≠Êúâ‰∏™Â§ßÊ¶ÇÂç∞Ë±°ÂêéÔºåÊàë‰ª¨Âèà‰ªãÁªç‰∫Ü<code>vue-router</code>ÁöÑÁõÆÂΩïÁªìÊûÑÔºåÂÖ∂ÊòØÂ¶Ç‰ΩïËøõË°åÂàÜÂ±ÇÁöÑ</li>
<li>‰∫ÜËß£ÁõÆÂΩïÁªìÊûÑÂêéÔºåÊàë‰ª¨‰ªéÂÆâË£ÖÂºÄÂßãÂâñÊûêÔºå‰∫ÜËß£<code>vue-router</code>Âú®ÂÆâË£ÖÊó∂ÈÉΩÂÅö‰∫ÜÂì™‰∫õ‰∫ã</li>
<li>ÂÆâË£ÖÁªìÊùüÔºåÊàë‰ª¨Âèà‰ªãÁªç‰∫ÜÂá†‰∏™<code>HistoryÁ±ª</code>‰πãÈó¥ÊòØÊÄéÊ†∑ÁöÑÁªßÊâøÂÖ≥Á≥ªÔºåÂÖ∂ÂèàÊòØÂ¶Ç‰ΩïÂÆû‰æãÂåñÁöÑ</li>
<li>ÂÆû‰æãÂåñÁªìÊùüÔºåÊàë‰ª¨ÊúÄÂêé‰ªãÁªç‰∫ÜÂàùÂßãÂåñÁöÑËøáÁ®ã</li>
</ul>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><ul>
<li>ÂêéÈù¢Ëøò‰ºö‰ªãÁªçÂÖ∂‰ΩôÈÉ®ÂàÜÔºåÂ¶ÇÊûúËßâÂæóËøòË°åÔºåÂèØ‰ª•Áªô‰∏™ËµûÂì¶ ‚ú®</li>
<li>‰∏™‰∫∫<code>github</code>Ôºå‰πüÊÄªÁªì‰∫Ü‰∏Ä‰∫õ‰∏úË•øÔºåÊ¨¢Ëøé star</li>
<li>Âü∫‰∫é canvas ÁöÑÁªòÂõæÊùø<a href="https://github.com/BryanAdamss/drawing-board" target="_blank" rel="noopener">drawing-board</a></li>
<li>ÂâçÁ´ØÂÖ•Èó® demo„ÄÅÊúÄ‰Ω≥ÂÆûË∑µÈõÜÂêà <a href="https://github.com/BryanAdamss/fe-awesome-demos" target="_blank" rel="noopener">fe-awesome-demos</a></li>
<li>‰∏Ä‰∏™Ëá™Âä®ÁîüÊàêÂà´ÂêçÁöÑ<code>vue-cli-plugin</code><a href="https://www.npmjs.com/package/vue-cli-plugin-auto-alias" target="_blank" rel="noopener">https://www.npmjs.com/package/vue-cli-plugin-auto-alias</a></li>
</ul>
<h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><ul>
<li><a href="https://github.com/dwqs/blog/issues/53" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/53</a></li>
<li><a href="https://github.com/dwqs/blog/issues/54" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/54</a></li>
<li><a href="https://github.com/dwqs/blog/issues/55" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/55</a></li>
<li><a href="https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643" target="_blank" rel="noopener">https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643</a></li>
<li><a href="https://juejin.im/post/5e456513f265da573c0c6d4b" target="_blank" rel="noopener">https://juejin.im/post/5e456513f265da573c0c6d4b</a></li>
<li><a href="https://juejin.im/post/584040e1ac502e006cbedb23" target="_blank" rel="noopener">https://juejin.im/post/584040e1ac502e006cbedb23</a></li>
<li><a href="https://juejin.im/post/5df0ada0f265da33d56d1a2f" target="_blank" rel="noopener">https://juejin.im/post/5df0ada0f265da33d56d1a2f</a></li>
<li><a href="https://juejin.im/post/5dbed0bef265da4cff701f68" target="_blank" rel="noopener">https://juejin.im/post/5dbed0bef265da4cff701f68</a></li>
<li><a href="https://www.jianshu.com/p/29e8214d0bee" target="_blank" rel="noopener">https://www.jianshu.com/p/29e8214d0bee</a></li>
<li><a href="https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/" target="_blank" rel="noopener">https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/</a></li>
<li><a href="https://blog.liuyunzhuge.com/2020/04/08/vue-routerÊ∫êÁ†ÅÔºöcreate-matcher/" target="_blank" rel="noopener">https://blog.liuyunzhuge.com/2020/04/08/vue-router Ê∫êÁ†ÅÔºöcreate-matcher/</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue/" rel="tag"># vue</a>
          
            <a href="/tags/vue-router/" rel="tag"># vue-router</a>
          
            <a href="/tags/Ê∫êÁ†ÅËß£Êûê/" rel="tag"># Ê∫êÁ†ÅËß£Êûê</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/27/ssh-multiple-account/" rel="next" title="ssh-multiple-account">
                <i class="fa fa-chevron-left"></i> ssh-multiple-account
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/22/vue-cli-mode/" rel="prev" title="vue-cli-mode">
                vue-cli-mode <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            ÊñáÁ´†ÁõÆÂΩï
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Á´ôÁÇπÊ¶ÇËßà
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/Avatar.png"
               alt="BryanAdamss" />
          <p class="site-author-name" itemprop="name">BryanAdamss</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">64</span>
                <span class="site-state-item-name">Êó•Âøó</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">ÂàÜÁ±ª</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">91</span>
                <span class="site-state-item-name">Ê†áÁ≠æ</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/BryanAdamss" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#vue-router-Ê∫êÁ†ÅËß£Êûê-1-3w-Â≠ó-Â§öÂõæÈ¢ÑË≠¶-„Äê‰∏ä„Äë"><span class="nav-number">1.</span> <span class="nav-text">vue-router Ê∫êÁ†ÅËß£Êûê | 1.3w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ËÆæËÆ°ÊÄùË∑Ø"><span class="nav-number">1.1.</span> <span class="nav-text">ËÆæËÆ°ÊÄùË∑Ø</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#‰ªÄ‰πàÊòØÂâçÁ´ØË∑ØÁî±"><span class="nav-number">1.1.1.</span> <span class="nav-text">‰ªÄ‰πàÊòØÂâçÁ´ØË∑ØÁî±</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Â¶Ç‰ΩïÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±"><span class="nav-number">1.1.2.</span> <span class="nav-text">Â¶Ç‰ΩïÂÆûÁé∞ÂâçÁ´ØË∑ØÁî±</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÊÄªÁªì"><span class="nav-number">1.1.3.</span> <span class="nav-text">ÊÄªÁªì</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÊúØËØ≠"><span class="nav-number">1.2.</span> <span class="nav-text">ÊúØËØ≠</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ë∑ØÁî±ËßÑÂàô„ÄÅÈÖçÁΩÆÂØπË±°-RouteConfig"><span class="nav-number">1.2.1.</span> <span class="nav-text">Ë∑ØÁî±ËßÑÂàô„ÄÅÈÖçÁΩÆÂØπË±°(RouteConfig)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ë∑ØÁî±ËÆ∞ÂΩï-RouteRecord"><span class="nav-number">1.2.2.</span> <span class="nav-text">Ë∑ØÁî±ËÆ∞ÂΩï(RouteRecord)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ë∑ØÁî±ÂØπË±°-Route"><span class="nav-number">1.2.3.</span> <span class="nav-text">Ë∑ØÁî±ÂØπË±°(Route)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#‰ΩçÁΩÆ-Location"><span class="nav-number">1.2.4.</span> <span class="nav-text">‰ΩçÁΩÆ(Location)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ë∑ØÁî±ÁªÑ‰ª∂-RouteComponent"><span class="nav-number">1.2.5.</span> <span class="nav-text">Ë∑ØÁî±ÁªÑ‰ª∂(RouteComponent)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÁéØÂ¢É"><span class="nav-number">1.3.</span> <span class="nav-text">ÁéØÂ¢É</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÁõÆÂΩïÁªìÊûÑ"><span class="nav-number">1.4.</span> <span class="nav-text">ÁõÆÂΩïÁªìÊûÑ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ÁõÆÂΩï"><span class="nav-number">1.4.1.</span> <span class="nav-text">ÁõÆÂΩï</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Âü∫Á°Ä‰æãÂ≠ê"><span class="nav-number">1.5.</span> <span class="nav-text">Âü∫Á°Ä‰æãÂ≠ê</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂÆâË£ÖÊµÅÁ®ã"><span class="nav-number">1.6.</span> <span class="nav-text">ÂÆâË£ÖÊµÅÁ®ã</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#install-js"><span class="nav-number">1.6.1.</span> <span class="nav-text">install.js</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ÈÅøÂÖçÈáçÂ§çÂÆâË£Ö"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">ÈÅøÂÖçÈáçÂ§çÂÆâË£Ö</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#‰øùÁïôVueÂºïÁî®ÔºåÈÅøÂÖçÂ∞ÜVueÂÅö‰∏∫‰æùËµñÊâìÂåÖ"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">‰øùÁïôVueÂºïÁî®ÔºåÈÅøÂÖçÂ∞ÜVueÂÅö‰∏∫‰æùËµñÊâìÂåÖ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÊ∑∑ÂÖ•"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÊ∑∑ÂÖ•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ê∑ªÂä†ÂÆû‰æãÂ±ûÊÄß„ÄÅÊñπÊ≥ï"><span class="nav-number">1.6.1.4.</span> <span class="nav-text">Ê∑ªÂä†ÂÆû‰æãÂ±ûÊÄß„ÄÅÊñπÊ≥ï</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ê≥®ÂÜå-router-view„ÄÅrouter-link-ÂÖ®Â±ÄÁªÑ‰ª∂"><span class="nav-number">1.6.1.5.</span> <span class="nav-text">Ê≥®ÂÜå router-view„ÄÅrouter-link ÂÖ®Â±ÄÁªÑ‰ª∂</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ËÆæÁΩÆË∑ØÁî±ÁªÑ‰ª∂ÂÆàÂç´ÁöÑÂêàÂπ∂Á≠ñÁï•"><span class="nav-number">1.6.1.6.</span> <span class="nav-text">ËÆæÁΩÆË∑ØÁî±ÁªÑ‰ª∂ÂÆàÂç´ÁöÑÂêàÂπ∂Á≠ñÁï•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÊÄªÁªì-1"><span class="nav-number">1.6.1.7.</span> <span class="nav-text">ÊÄªÁªì</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂÆû‰æãÂåñÊµÅÁ®ã"><span class="nav-number">1.7.</span> <span class="nav-text">ÂÆû‰æãÂåñÊµÅÁ®ã</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VueRouter-ÁöÑÊûÑÈÄ†ÂáΩÊï∞"><span class="nav-number">1.7.1.</span> <span class="nav-text">VueRouter ÁöÑÊûÑÈÄ†ÂáΩÊï∞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Êé•Êî∂-RouterOptions"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">Êé•Êî∂ RouterOptions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Â±ûÊÄßËµãÂàùÂÄº"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">Â±ûÊÄßËµãÂàùÂÄº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÂàõÂª∫-matcher"><span class="nav-number">1.7.1.3.</span> <span class="nav-text">ÂàõÂª∫ matcher</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Á°ÆÂÆöË∑ØÁî±Ê®°Âºè"><span class="nav-number">1.7.1.4.</span> <span class="nav-text">Á°ÆÂÆöË∑ØÁî±Ê®°Âºè</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ê†πÊçÆË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêåÁöÑ-History-ÂÆû‰æã"><span class="nav-number">1.7.1.5.</span> <span class="nav-text">Ê†πÊçÆË∑ØÁî±Ê®°ÂºèÁîüÊàê‰∏çÂêåÁöÑ History ÂÆû‰æã</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Â∞èÁªì"><span class="nav-number">1.7.1.6.</span> <span class="nav-text">Â∞èÁªì</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÂàõÂª∫ÂåπÈÖçÂô®"><span class="nav-number">1.7.2.</span> <span class="nav-text">ÂàõÂª∫ÂåπÈÖçÂô®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Â∞èÁªì-1"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">Â∞èÁªì</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#createRouteMap"><span class="nav-number">1.7.3.</span> <span class="nav-text">createRouteMap</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Â∞èÁªì-2"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">Â∞èÁªì</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#addRouteRecord"><span class="nav-number">1.7.4.</span> <span class="nav-text">addRouteRecord</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï"><span class="nav-number">1.7.4.1.</span> <span class="nav-text">ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÁîüÊàêÂµåÂ•óË∑ØÁî±ËÆ∞ÂΩï"><span class="nav-number">1.7.4.2.</span> <span class="nav-text">ÁîüÊàêÂµåÂ•óË∑ØÁî±ËÆ∞ÂΩï</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï"><span class="nav-number">1.7.4.3.</span> <span class="nav-text">ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Â∞èÁªì-3"><span class="nav-number">1.7.4.4.</span> <span class="nav-text">Â∞èÁªì</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ë∑ØÁî±Ê®°Âºè"><span class="nav-number">1.7.5.</span> <span class="nav-text">Ë∑ØÁî±Ê®°Âºè</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ê†∏ÂøÉÁ±ª"><span class="nav-number">1.7.5.1.</span> <span class="nav-text">Ê†∏ÂøÉÁ±ª</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#History-Á±ª"><span class="nav-number">1.7.5.2.</span> <span class="nav-text">History Á±ª</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTML5History-Á±ª"><span class="nav-number">1.7.5.3.</span> <span class="nav-text">HTML5History Á±ª</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HashHistory-Á±ª"><span class="nav-number">1.7.5.4.</span> <span class="nav-text">HashHistory Á±ª</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AbstractHistory-Á±ª"><span class="nav-number">1.7.5.5.</span> <span class="nav-text">AbstractHistory Á±ª</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Â∞èÁªì-4"><span class="nav-number">1.7.5.6.</span> <span class="nav-text">Â∞èÁªì</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂàùÂßãÂåñÊµÅÁ®ã"><span class="nav-number">1.8.</span> <span class="nav-text">ÂàùÂßãÂåñÊµÅÁ®ã</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ë∞ÉÁî®-init-Êó∂Êú∫"><span class="nav-number">1.8.1.</span> <span class="nav-text">Ë∞ÉÁî® init Êó∂Êú∫</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#init-ÊñπÊ≥ï"><span class="nav-number">1.8.2.</span> <span class="nav-text">init ÊñπÊ≥ï</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setupListeners"><span class="nav-number">1.8.3.</span> <span class="nav-text">setupListeners</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Â∞èÁªì-5"><span class="nav-number">1.8.4.</span> <span class="nav-text">Â∞èÁªì</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÊÄªÁªì-2"><span class="nav-number">1.9.</span> <span class="nav-text">ÊÄªÁªì</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PS"><span class="nav-number">1.10.</span> <span class="nav-text">PS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂèÇËÄÉ"><span class="nav-number">1.11.</span> <span class="nav-text">ÂèÇËÄÉ</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BryanAdamss</span>
</div>


<div class="powered-by">
  Áî± <a class="theme-link" href="https://hexo.io">Hexo</a> Âº∫ÂäõÈ©±Âä®
</div>

<div class="theme-info">
  ‰∏ªÈ¢ò -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


  

</body>
</html>
