<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="vue,vue-router,æºç è§£æ," />








  <link rel="shortcut icon" type="image/x-icon" href="/Avatar.png?v=5.1.0" />






<meta name="description" content="vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘ å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜ vue-routeræ˜¯æ¯ä¸ªvueå¼€å‘è€…éƒ½ä¼šæ¥è§¦åˆ°çš„ä¸€ä¸ªæ’ä»¶ æœ¬ç€è¿½æœ¬æº¯æºçš„ç†å¿µï¼Œæˆ‘å¼€å¯äº†vue-routeræºç åˆ†æä¹‹è·¯ ğŸ˜‚ å¤©å¤©åŠ ç­ï¼Œæ‰€ä»¥å‰å‰ååèŠ±äº†å¥½å‡ ä¸ªæœˆæ—¶é—´ æ—¶é—´æ‹–çš„å¾ˆé•¿ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨æ€è·¯ä¸è¿è´¯çš„æƒ…å†µï¼Œè¿˜æœ›è§è°… ğŸ¤£ ç”±äºæ˜é‡‘å­—æ•°é™åˆ¶ï¼Œæ‰€ä»¥åˆ†ä¸ºä¸Šä¸­ä¸‹ä¸‰ç¯‡æ¥ä»‹ç» ä¸Šç¯‡å³æœ¬ç¯‡ï¼Œä¸»è¦ä»‹ç»äº†å‰ç«¯è·¯">
<meta name="keywords" content="vue,vue-router,æºç è§£æ">
<meta property="og:type" content="article">
<meta property="og:title" content="vue-router-analysis-part1">
<meta property="og:url" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/index.html">
<meta property="og:site_name" content="BryanAdamssçš„åšå®¢">
<meta property="og:description" content="vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘ å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜ vue-routeræ˜¯æ¯ä¸ªvueå¼€å‘è€…éƒ½ä¼šæ¥è§¦åˆ°çš„ä¸€ä¸ªæ’ä»¶ æœ¬ç€è¿½æœ¬æº¯æºçš„ç†å¿µï¼Œæˆ‘å¼€å¯äº†vue-routeræºç åˆ†æä¹‹è·¯ ğŸ˜‚ å¤©å¤©åŠ ç­ï¼Œæ‰€ä»¥å‰å‰ååèŠ±äº†å¥½å‡ ä¸ªæœˆæ—¶é—´ æ—¶é—´æ‹–çš„å¾ˆé•¿ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨æ€è·¯ä¸è¿è´¯çš„æƒ…å†µï¼Œè¿˜æœ›è§è°… ğŸ¤£ ç”±äºæ˜é‡‘å­—æ•°é™åˆ¶ï¼Œæ‰€ä»¥åˆ†ä¸ºä¸Šä¸­ä¸‹ä¸‰ç¯‡æ¥ä»‹ç» ä¸Šç¯‡å³æœ¬ç¯‡ï¼Œä¸»è¦ä»‹ç»äº†å‰ç«¯è·¯">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/sequence.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-config.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-component.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/directory.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/examples.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/src.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/declarations.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/root-instance.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/install.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-mode.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/create-matcher.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-map-obj.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/create-route-map-sequence.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/path-to-regex-demo.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/nested-route.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/alias-route.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/add-route-record.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/route-mode-class.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/h5history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/hash-history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/abstract-history.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/vue-router-instance.png">
<meta property="og:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/init.png">
<meta property="og:updated_time" content="2020-12-06T04:24:32.735Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vue-router-analysis-part1">
<meta name="twitter:description" content="vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘ å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜ vue-routeræ˜¯æ¯ä¸ªvueå¼€å‘è€…éƒ½ä¼šæ¥è§¦åˆ°çš„ä¸€ä¸ªæ’ä»¶ æœ¬ç€è¿½æœ¬æº¯æºçš„ç†å¿µï¼Œæˆ‘å¼€å¯äº†vue-routeræºç åˆ†æä¹‹è·¯ ğŸ˜‚ å¤©å¤©åŠ ç­ï¼Œæ‰€ä»¥å‰å‰ååèŠ±äº†å¥½å‡ ä¸ªæœˆæ—¶é—´ æ—¶é—´æ‹–çš„å¾ˆé•¿ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨æ€è·¯ä¸è¿è´¯çš„æƒ…å†µï¼Œè¿˜æœ›è§è°… ğŸ¤£ ç”±äºæ˜é‡‘å­—æ•°é™åˆ¶ï¼Œæ‰€ä»¥åˆ†ä¸ºä¸Šä¸­ä¸‹ä¸‰ç¯‡æ¥ä»‹ç» ä¸Šç¯‡å³æœ¬ç¯‡ï¼Œä¸»è¦ä»‹ç»äº†å‰ç«¯è·¯">
<meta name="twitter:image" content="http://yoursite.com/2020/04/27/vue-router-analysis-part1/sequence.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/04/27/vue-router-analysis-part1/"/>





  <title> vue-router-analysis-part1 | BryanAdamssçš„åšå®¢ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BryanAdamssçš„åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¸€ä¸ªä¼ªå‰ç«¯</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/27/vue-router-analysis-part1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BryanAdamss">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/Avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BryanAdamssçš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                vue-router-analysis-part1
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-04-27T22:48:40+08:00">
                2020-04-27 22:48:40
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FrontEnd/" itemprop="url" rel="index">
                    <span itemprop="name">å‰ç«¯</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="vue-router-æºç è§£æ-1-3w-å­—-å¤šå›¾é¢„è­¦-ã€ä¸Šã€‘"><a href="#vue-router-æºç è§£æ-1-3w-å­—-å¤šå›¾é¢„è­¦-ã€ä¸Šã€‘" class="headerlink" title="vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘"></a>vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘</h1><ul>
<li>å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜</li>
<li><code>vue-router</code>æ˜¯æ¯ä¸ª<code>vueå¼€å‘è€…</code>éƒ½ä¼šæ¥è§¦åˆ°çš„ä¸€ä¸ªæ’ä»¶</li>
<li>æœ¬ç€è¿½æœ¬æº¯æºçš„ç†å¿µï¼Œæˆ‘å¼€å¯äº†<code>vue-router</code>æºç åˆ†æä¹‹è·¯ ğŸ˜‚</li>
<li>å¤©å¤©åŠ ç­ï¼Œæ‰€ä»¥å‰å‰ååèŠ±äº†å¥½å‡ ä¸ªæœˆæ—¶é—´</li>
<li>æ—¶é—´æ‹–çš„å¾ˆé•¿ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨æ€è·¯ä¸è¿è´¯çš„æƒ…å†µï¼Œè¿˜æœ›è§è°… ğŸ¤£</li>
<li>ç”±äºæ˜é‡‘å­—æ•°é™åˆ¶ï¼Œæ‰€ä»¥åˆ†ä¸ºä¸Šä¸­ä¸‹ä¸‰ç¯‡æ¥ä»‹ç»</li>
<li>ä¸Šç¯‡å³æœ¬ç¯‡ï¼Œä¸»è¦ä»‹ç»äº†å‰ç«¯è·¯ç”±çš„è®¾è®¡æ€è·¯åŠå®ç°åŸºæœ¬åŸåˆ™ã€<code>vue-router</code>çš„ç›¸å…³æœ¯è¯­ã€ç›®å½•ç»“æ„ã€å®‰è£…ã€å®ä¾‹åŒ–ã€åˆå§‹åŒ–ç›¸å…³å®ç°</li>
<li>ä¸­ç¯‡ä»‹ç»äº†å…¶æ ¸å¿ƒç‰¹æ€§è·¯ç”±åŒ¹é…ã€å¯¼èˆªå®ˆå«è§¦å‘çš„æœºåˆ¶</li>
<li>ä¸‹ç¯‡ä¸ºæ”¶å°¾ç¯‡ï¼Œä»‹ç»äº†ä¸€äº›éæ ¸å¿ƒç‰¹æ€§ï¼Œå¦‚æ»šåŠ¨å¤„ç†ã€<code>view,link</code>ç»„ä»¶çš„å®ç°</li>
<li>ç¬¬ä¸€æ¬¡åšæºç è§£æï¼Œè‚¯å®šæœ‰å¾ˆå¤šé”™è¯¯æˆ–ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ ğŸ¤</li>
<li>é¡¹ç›®åœ°å€<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis</code></li>
<li>å¦‚æœè§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç»™æˆ‘ä¸€ä¸ª<code>star</code>âœ¨</li>
</ul>
</li>
<li>uml å›¾æºæ–‡ä»¶<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis/blob/dev/vue-router.EAP</code></li>
</ul>
</li>
<li>å…³è”æ–‡ç« é“¾æ¥<ul>
<li><a href="https://juejin.cn/post/6880529850159874062" target="_blank" rel="noopener">vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘</a></li>
<li><a href="https://juejin.cn/post/6901047675227996167" target="_blank" rel="noopener">vue-router æºç è§£æ | 1.5w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸­ã€‘</a></li>
<li><a href="https://juejin.cn/post/6902992939115855880" target="_blank" rel="noopener">vue-router æºç è§£æ | 6k å­— - ã€ä¸‹ã€‘</a></li>
</ul>
</li>
</ul>
<h2 id="è®¾è®¡æ€è·¯"><a href="#è®¾è®¡æ€è·¯" class="headerlink" title="è®¾è®¡æ€è·¯"></a>è®¾è®¡æ€è·¯</h2><ul>
<li>åœ¨è§£æ<code>vue-router</code>è¿™ä¸ªè·¯ç”±åº“å‰ï¼Œæˆ‘ä»¬è¦äº†è§£ä»€ä¹ˆæ˜¯è·¯ç”±ï¼Œä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±ï¼Ÿå®ç°å‰ç«¯è·¯ç”±çš„å¸¸è§„å¥—è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±"><a href="#ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±" class="headerlink" title="ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±"></a>ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±</h3><ul>
<li>å…³äºè·¯ç”±çš„å®šä¹‰ï¼Œç»´åŸºæ˜¯è¿™æ ·å®šä¹‰çš„ï¼›<code>è·¯ç”±ï¼ˆroutingï¼‰å°±æ˜¯é€šè¿‡äº’è”çš„ç½‘ç»œæŠŠä¿¡æ¯ä»æºåœ°å€ä¼ è¾“åˆ°ç›®çš„åœ°å€çš„æ´»åŠ¨ã€‚è·¯ç”±å‘ç”Ÿåœ¨OSIç½‘ç»œå‚è€ƒæ¨¡å‹ä¸­çš„ç¬¬ä¸‰å±‚å³ç½‘ç»œå±‚ã€‚è·¯ç”±å¼•å¯¼åˆ†ç»„è½¬é€ï¼Œç»è¿‡ä¸€äº›ä¸­é—´çš„èŠ‚ç‚¹åï¼Œåˆ°å®ƒä»¬æœ€åçš„ç›®çš„åœ°ã€‚ä½œæˆç¡¬ä»¶çš„è¯ï¼Œåˆ™ç§°ä¸ºè·¯ç”±å™¨ã€‚è·¯ç”±é€šå¸¸æ ¹æ®è·¯ç”±è¡¨â€”â€”ä¸€ä¸ªå­˜å‚¨åˆ°å„ä¸ªç›®çš„åœ°çš„æœ€ä½³è·¯å¾„çš„è¡¨â€”â€”æ¥å¼•å¯¼åˆ†ç»„è½¬é€</code></li>
<li>ä¸Šé¢çš„å®šä¹‰å¯èƒ½å¾ˆå®˜æ–¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠ½å‡ºä¸€äº›é‡ç‚¹<ul>
<li>è·¯ç”±æ˜¯ä¸€ç§æ´»åŠ¨ï¼Œè´Ÿè´£å°†ä¿¡æ¯ä»æºåœ°å€ä¼ è¾“åˆ°ç›®çš„åœ°å€ï¼›</li>
<li>è¦å®Œæˆè¿™æ ·ä¸€ä¸ªæ´»åŠ¨éœ€è¦ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿<strong>è·¯ç”±è¡¨</strong>-æºåœ°å€å’Œç›®æ ‡åœ°å€çš„æ˜ å°„è¡¨</li>
</ul>
</li>
<li><code>åœ¨webåå°å¼€å‘ä¸­ï¼Œâ€œrouteâ€æ˜¯æŒ‡æ ¹æ®urlåˆ†é…åˆ°å¯¹åº”çš„å¤„ç†ç¨‹åºã€‚</code>ï¼›å¼•ç”¨è‡ª<code>https://www.zhihu.com/question/46767015</code>@è´ºå¸ˆä¿Š<ul>
<li>ç”¨æˆ·è¾“å…¥ä¸€ä¸ª urlï¼Œæµè§ˆå™¨ä¼ é€’ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åŒ¹é…æ˜ å°„è¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¤„ç†ç¨‹åºï¼Œè¿”å›å¯¹åº”çš„èµ„æº(é¡µé¢ or å…¶å®ƒ)ï¼›</li>
</ul>
</li>
<li>å¯¹äºå‰ç«¯æ¥è¯´ï¼Œè·¯ç”±æ¦‚å¿µçš„å‡ºç°æ˜¯ä¼´éšç€<code>spa</code>å‡ºç°çš„ï¼›åœ¨<code>spa</code>å‡ºç°ä¹‹å‰ï¼Œé¡µé¢çš„è·³è½¬(å¯¼èˆª)éƒ½æ˜¯é€šè¿‡æœåŠ¡ç«¯æ§åˆ¶çš„ï¼Œå¹¶ä¸”è·³è½¬å­˜åœ¨ä¸€ä¸ªæ˜æ˜¾ç™½å±è·³è½¬è¿‡ç¨‹ï¼›<code>spa</code>å‡ºç°åï¼Œä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œå°±æ²¡æœ‰å†è®©æœåŠ¡ç«¯æ§åˆ¶è·³è½¬äº†ï¼Œäºæ˜¯å‰ç«¯è·¯ç”±å‡ºç°äº†ï¼Œå‰ç«¯å¯ä»¥è‡ªç”±æ§åˆ¶ç»„ä»¶çš„æ¸²æŸ“ï¼Œæ¥æ¨¡æ‹Ÿé¡µé¢è·³è½¬</li>
<li>å°ç»“<ul>
<li>æœåŠ¡ç«¯è·¯ç”±æ ¹æ®<code>url</code>åˆ†é…å¯¹åº”å¤„ç†ç¨‹åºï¼Œè¿”å›é¡µé¢ã€æ¥å£è¿”å›</li>
<li>å‰ç«¯è·¯ç”±æ˜¯é€šè¿‡<code>js</code>æ ¹æ®<code>url</code>è¿”å›å¯¹å¯¹åº”ç»„ä»¶</li>
</ul>
</li>
</ul>
<h3 id="å¦‚ä½•å®ç°å‰ç«¯è·¯ç”±"><a href="#å¦‚ä½•å®ç°å‰ç«¯è·¯ç”±" class="headerlink" title="å¦‚ä½•å®ç°å‰ç«¯è·¯ç”±"></a>å¦‚ä½•å®ç°å‰ç«¯è·¯ç”±</h3><ul>
<li>çœ‹äº†ä¸Šé¢çš„å®šä¹‰ï¼Œè¦å®ç°è·¯ç”±ï¼Œéœ€è¦ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿-è·¯ç”±æ˜ å°„è¡¨ï¼›<ul>
<li>æœåŠ¡ç«¯åšè·¯ç”±é¡µé¢è·³è½¬æ—¶ï¼Œæ˜ å°„è¡¨çš„åæ˜ çš„æ˜¯<code>url</code>å’Œ<code>é¡µé¢</code>çš„å…³ç³»</li>
<li>ç°åœ¨å‰ç«¯åŸºæœ¬èµ°æ¨¡å—åŒ–äº†ï¼Œæ‰€ä»¥å‰ç«¯çš„è·¯ç”±æ˜ å°„è¡¨åæ˜ çš„æ˜¯<code>url</code>å’Œ<code>ç»„ä»¶</code>çš„å…³ç³»</li>
</ul>
</li>
<li>å°±åƒä¸‹é¢çš„ä¼ªä»£ç ä¸€æ ·</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨es6 map</span></span><br><span class="line"><span class="keyword">const</span> routeMap = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">'/'</span>, é¦–é¡µç»„ä»¶],</span><br><span class="line">  [<span class="string">'/bar'</span>, Barç»„ä»¶],</span><br><span class="line">  [<span class="string">'/bar/foo'</span>, Fooç»„ä»¶],</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ ä¹Ÿå¯ä»¥ç”¨å¯¹è±¡å­—é¢é‡</span></span><br><span class="line"><span class="keyword">const</span> routeMap = &#123;</span><br><span class="line">  <span class="string">'/'</span>: é¦–é¡µç»„ä»¶,</span><br><span class="line">  <span class="string">'/bar'</span>: Barç»„ä»¶,</span><br><span class="line">  <span class="string">'/bar/foo'</span>: Fooç»„ä»¶,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æœ‰äº†æ˜ å°„è¡¨ï¼Œæˆ‘ä»¬å°±çŸ¥é“<code>url</code>å’Œç»„ä»¶çš„æ˜ å°„å…³ç³»ï¼›</li>
<li>ä½†æ˜¯ï¼Œæ˜ å°„è¡¨ç»´æŠ¤çš„åªæ˜¯ä¸€ä¸ªå…³ç³»ï¼Œå¹¶ä¸èƒ½å¸®æˆ‘ä»¬å®Œæˆï¼Œè®¿é—®<code>/bar</code>ï¼Œè¿”å›<code>Barç»„ä»¶</code>è¿™æ ·ä¸€ä¸ªæµç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªåŒ¹é…å™¨ï¼Œæ¥å¸®æˆ‘ä»¬å®Œæˆä»<code>url</code>åˆ°<code>ç»„ä»¶</code>çš„åŒ¹é…å·¥ä½œï¼›</li>
<li>æ˜¯ä¸æ˜¯æœ‰äº†<code>è·¯ç”±æ˜ å°„è¡¨</code>å’Œ<code>åŒ¹é…å™¨</code>å°±å¯ä»¥å®ç°å‰ç«¯è·¯ç”±äº†å‘¢ï¼Ÿ</li>
<li>æˆ‘ä»¬çš„<code>spa</code>æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„ï¼Œæµè§ˆå™¨æ˜¯æœ‰<code>å‰è¿›ã€è¿”å›</code>åŠŸèƒ½çš„ï¼Œéœ€è¦æˆ‘ä»¬è®°å½•è®¿é—®è¿‡çš„<code>url</code>ï¼›<ul>
<li>æˆ‘ä»¬çŸ¥é“ï¼Œè¦å®ç°è¿™ç§ç±»ä¼¼<code>æ’¤é”€ã€æ¢å¤</code>çš„åŠŸèƒ½ï¼Œè‚¯å®šéœ€è¦ä½¿ç”¨åˆ°ä¸€ç§æ•°æ®ç»“æ„-<code>æ ˆ(stack)</code>ï¼›æ¯è®¿é—®ä¸€ä¸ª<code>url</code>ï¼Œå°†<code>url</code>ï¼Œ<code>push</code>åˆ°æ ˆä¸­ï¼Œè¿”å›æ—¶ï¼Œæ‰§è¡Œ<code>pop</code>å³å¯æ‹¿åˆ°ä¸Šä¸€æ¬¡è®¿é—®çš„<code>url</code></li>
<li>å¥½åœ¨æµè§ˆå™¨å¹³å°ï¼Œå·²ç»ç»™æˆ‘ä»¬æä¾›äº†è¿™æ ·çš„æ ˆï¼Œæ— éœ€æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦å»è°ƒç”¨å®ƒçš„æ¥å£<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noopener">window.history</a>å®ç°åŠŸèƒ½å³å¯</li>
</ul>
</li>
<li>ç”»äº†ä¸ªå›¾ï¼Œæè¿°äº†ä¸‹ä¸‰è€…åä½œå…³ç³»<ul>
<li>sequence.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/sequence.png" alt="sequence.png"></li>
</ul>
</li>
</ul>
</li>
<li>å½“æˆ‘ä»¬è®¿é—®æŸä¸ª url æ—¶ï¼Œå¦‚<code>/foo</code>ï¼ŒåŒ¹é…å™¨ä¼šæ‹¿ç€<code>/foo</code>å»è·¯ç”±æ˜ å°„è¡¨ä¸­å»æŸ¥æ‰¾å¯¹åº”çš„ç»„ä»¶ï¼Œå¹¶å°†ç»„ä»¶è¿”å›æ¸²æŸ“ï¼ŒåŒæ—¶å°†è®¿é—®è®°å½•æ¨å…¥å†å²æ ˆä¸­</li>
<li>å½“æˆ‘ä»¬é€šè¿‡å‰è¿›/åé€€å»è®¿é—®æŸä¸ª<code>url</code>æ—¶ï¼Œä¼šå…ˆä»å†å²æ ˆä¸­æ‰¾åˆ°å¯¹åº”<code>url</code>ï¼Œç„¶ååŒ¹é…å™¨æ‹¿<code>url</code>å»æ‰¾ç»„ä»¶ï¼Œå¹¶è¿”å›æ¸²æŸ“ï¼›åªä¸è¿‡ï¼Œè¿™æ˜¯é€šè¿‡å‰è¿›/åé€€å®ç°è®¿é—®çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦å†æ¨å…¥å†å²æ ˆäº†</li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>è¦å®ç°ä¸€ä¸ªå‰ç«¯è·¯ç”±ï¼Œéœ€è¦ä¸‰ä¸ªéƒ¨åˆ†<ul>
<li>è·¯ç”±æ˜ å°„è¡¨<ul>
<li>ä¸€ä¸ªèƒ½è¡¨è¾¾<code>url</code>å’Œ<code>ç»„ä»¶</code>å…³ç³»çš„æ˜ å°„è¡¨ï¼Œå¯ä»¥ä½¿ç”¨<code>Map</code>ã€<code>å¯¹è±¡å­—é¢é‡</code>æ¥å®ç°</li>
</ul>
</li>
<li>åŒ¹é…å™¨<ul>
<li>è´Ÿè´£åœ¨è®¿é—®<code>url</code>æ—¶ï¼Œè¿›è¡ŒåŒ¹é…ï¼Œæ‰¾å‡ºå¯¹åº”çš„<code>ç»„ä»¶</code></li>
</ul>
</li>
<li>å†å²è®°å½•æ ˆ<ul>
<li>æµè§ˆå™¨å¹³å°ï¼Œå·²ç»åŸç”Ÿæ”¯æŒï¼Œæ— éœ€å®ç°ï¼Œç›´æ¥è°ƒç”¨æ¥å£</li>
</ul>
</li>
</ul>
</li>
<li>ç°åœ¨ä¸ç”¨çº ç»“ä»–ä»¬çš„å…·ä½“å®ç°ï¼Œä½ åªéœ€è¦çŸ¥é“æœ‰è¿™ä¸‰ä¸ªä¸œè¥¿ï¼Œå¹¶ä¸”ä»–ä»¬å¤§æ¦‚æ˜¯å¦‚ä½•åä½œçš„å°±å¯ä»¥äº†ï¼›</li>
<li>åé¢æˆ‘ä»¬å°†ä¸€èµ·çœ‹çœ‹<code>vue-router</code>å¦‚ä½•åˆ©ç”¨ä»–ä»¬å®ç°å‰ç«¯è·¯ç”±çš„</li>
</ul>
<h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><ul>
<li>åœ¨åˆ†æ<code>vue-router</code>æºç å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹<code>vue-router</code>ä¸­å¸¸å‡ºç°çš„ä¸€äº›æ¦‚å¿µæœ¯è¯­ï¼Œå¦‚æœç†è§£èµ·æ¥åƒåŠ›ï¼Œå¯ä»¥å…ˆè·³è¿‡ï¼Œåé¢é‡åˆ°ï¼Œå†å›æ¥çœ‹ï¼›</li>
</ul>
<h3 id="è·¯ç”±è§„åˆ™ã€é…ç½®å¯¹è±¡-RouteConfig"><a href="#è·¯ç”±è§„åˆ™ã€é…ç½®å¯¹è±¡-RouteConfig" class="headerlink" title="è·¯ç”±è§„åˆ™ã€é…ç½®å¯¹è±¡(RouteConfig)"></a>è·¯ç”±è§„åˆ™ã€é…ç½®å¯¹è±¡(<code>RouteConfig</code>)</h3><ul>
<li>è·¯ç”±çš„é…ç½®é¡¹ï¼Œç”¨æ¥æè¿°è·¯ç”±</li>
<li>ä¸‹å›¾çº¢æ¡†é‡Œé¢æ ‡å‡ºæ¥çš„éƒ½æ˜¯è·¯ç”±é…ç½®å¯¹è±¡</li>
<li>route-config.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-config.png" alt="route-config.png"></li>
</ul>
</li>
<li>å› ä¸º<code>vue-router</code>æ˜¯æ”¯æŒ<code>åµŒå¥—è·¯ç”±</code>çš„ï¼Œæ‰€ä»¥é…ç½®å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥ç›¸äº’åµŒå¥—çš„</li>
<li>å®Œæ•´çš„å½¢çŠ¶å¦‚ä¸‹</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> RouteConfig = &#123;</span><br><span class="line">  path: <span class="built_in">string</span>,</span><br><span class="line">  component?: Component,<span class="comment">// è·¯ç”±ç»„ä»¶</span></span><br><span class="line">  name?: <span class="built_in">string</span>, <span class="comment">// å‘½åè·¯ç”±</span></span><br><span class="line">  components?: &#123; [name: <span class="built_in">string</span>]: Component &#125;, <span class="comment">// å‘½åè§†å›¾ç»„ä»¶</span></span><br><span class="line">  redirect?: <span class="built_in">string</span> | Location | <span class="built_in">Function</span>,</span><br><span class="line">  props?: <span class="built_in">boolean</span> | <span class="built_in">Object</span> | <span class="built_in">Function</span>,</span><br><span class="line">  alias?: <span class="built_in">string</span> | <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;,</span><br><span class="line">  children?: <span class="built_in">Array</span>&lt;RouteConfig&gt;, <span class="comment">// åµŒå¥—è·¯ç”±</span></span><br><span class="line">  beforeEnter?: <span class="function">(<span class="params">to: Route, <span class="keyword">from</span>: Route, next: <span class="built_in">Function</span></span>) =&gt;</span> <span class="built_in">void</span>,</span><br><span class="line">  meta?: <span class="built_in">any</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.6.0+</span></span><br><span class="line">  caseSensitive?: <span class="built_in">boolean</span>, <span class="comment">// åŒ¹é…è§„åˆ™æ˜¯å¦å¤§å°å†™æ•æ„Ÿï¼Ÿ(é»˜è®¤å€¼ï¼šfalse)</span></span><br><span class="line">  pathToRegexpOptions?: <span class="built_in">Object</span> <span class="comment">// ç¼–è¯‘æ­£åˆ™çš„é€‰é¡¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·¯ç”±è®°å½•-RouteRecord"><a href="#è·¯ç”±è®°å½•-RouteRecord" class="headerlink" title="è·¯ç”±è®°å½•(RouteRecord)"></a>è·¯ç”±è®°å½•(<code>RouteRecord</code>)</h3><ul>
<li>æ¯ä¸€æ¡è·¯ç”±è§„åˆ™éƒ½ä¼šç”Ÿæˆä¸€æ¡è·¯ç”±è®°å½•ï¼›åµŒå¥—ã€åˆ«åè·¯ç”±ä¹Ÿéƒ½ä¼šç”Ÿæˆä¸€æ¡è·¯ç”±è®°å½•ï¼›æ˜¯è·¯ç”±æ˜ å°„è¡¨çš„ç»„æˆéƒ¨åˆ†</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> record: RouteRecord = &#123;</span><br><span class="line">  path: normalizedPath,</span><br><span class="line">  regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), <span class="comment">//Â åˆ©ç”¨path-to-regexpåŒ…ç”Ÿæˆç”¨æ¥åŒ¹é…pathçš„å¢å¼ºæ­£åˆ™å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥åŒ¹é…åŠ¨æ€è·¯ç”±</span></span><br><span class="line">  components: route.components || &#123; <span class="keyword">default</span>: route.component &#125;, <span class="comment">//Â ä¿å­˜è·¯ç”±ç»„ä»¶ï¼Œæ”¯æŒå‘½åè§†å›¾https://router.vuejs.org/zh/guide/essentials/named-views.html#å‘½åè§†å›¾</span></span><br><span class="line">  instances: &#123;&#125;, <span class="comment">//Â ä¿å­˜æ¯ä¸ªå‘½årouter-viewéœ€è¦æ¸²æŸ“çš„è·¯ç”±ç»„ä»¶</span></span><br><span class="line">  name,</span><br><span class="line">  parent,</span><br><span class="line">  matchAs,</span><br><span class="line">  redirect: route.redirect, <span class="comment">//Â é‡å®šå‘çš„è·¯ç”±é…ç½®å¯¹è±¡</span></span><br><span class="line">  beforeEnter: route.beforeEnter, <span class="comment">//Â è·¯ç”±ç‹¬äº«çš„å®ˆå«</span></span><br><span class="line">  meta: route.meta || &#123;&#125;, <span class="comment">//Â å…ƒä¿¡æ¯</span></span><br><span class="line">  <span class="comment">//Â åŠ¨æ€è·¯ç”±ä¼ å‚ï¼›https://router.vuejs.org/zh/guide/essentials/passing-props.html#è·¯ç”±ç»„ä»¶ä¼ å‚</span></span><br><span class="line">  props:</span><br><span class="line">    route.props == <span class="literal">null</span></span><br><span class="line">      ? &#123;&#125;</span><br><span class="line">      : route.components <span class="comment">//Â å‘½åè§†å›¾çš„ä¼ å‚è§„åˆ™éœ€è¦ä½¿ç”¨route.propsæŒ‡å®šçš„è§„åˆ™</span></span><br><span class="line">      ? route.props</span><br><span class="line">      : &#123; <span class="keyword">default</span>: route.props &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·¯ç”±å¯¹è±¡-Route"><a href="#è·¯ç”±å¯¹è±¡-Route" class="headerlink" title="è·¯ç”±å¯¹è±¡(Route)"></a>è·¯ç”±å¯¹è±¡(<code>Route</code>)</h3><ul>
<li><code>Route</code>è¡¨ç¤ºå½“å‰æ¿€æ´»çš„è·¯ç”±çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…å«äº†å½“å‰ <code>URL</code> è§£æå¾—åˆ°çš„ä¿¡æ¯ï¼Œè¿˜æœ‰ <code>URL</code> åŒ¹é…åˆ°çš„è·¯ç”±è®°å½•<strong>ä»¬</strong> (<code>route records</code>)ã€‚<ul>
<li><code>https://router.vuejs.org/zh/api/#è·¯ç”±å¯¹è±¡</code></li>
</ul>
</li>
<li>æ³¨æ„ï¼Œè¿™è¯´æ˜ä¸€ä¸ª<code>Route</code>å¯ä»¥å…³è”å¤šä¸ª<code>RouteRecord</code></li>
<li>é€šè¿‡<code>this.$route</code>è®¿é—®åˆ°çš„å°±æ˜¯<code>Route</code>å¯¹è±¡</li>
<li>route.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route.png" alt="route.png"></li>
</ul>
</li>
<li>è·¯ç”±å¯¹è±¡æ˜¯ä¸å¯å˜ (<code>immutable</code>) çš„ï¼Œæ¯æ¬¡æˆåŠŸçš„å¯¼èˆªåéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡</li>
</ul>
<h3 id="ä½ç½®-Location"><a href="#ä½ç½®-Location" class="headerlink" title="ä½ç½®(Location)"></a>ä½ç½®(<code>Location</code>)</h3><ul>
<li>å®ƒå¹¶ä¸æ˜¯<code>window.location</code>çš„å¼•ç”¨ï¼Œ<code>vue-router</code>åœ¨å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ª<code>Location</code>ï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥æè¿°ç›®æ ‡ä½ç½®çš„å¯¹è±¡ï¼›</li>
<li><code>$router.push/replace</code>ã€<code>router-linkçš„to</code>æ¥æ”¶çš„å°±æ˜¯<code>Locationå¯¹è±¡</code><ul>
<li><code>https://router.vuejs.org/zh/api/#to</code></li>
</ul>
</li>
<li><code>vue-router</code>å†…éƒ¨å¯ä»¥å°†ä¸€ä¸ª<code>url string</code>è½¬æ¢æˆ<code>Locationå¯¹è±¡</code>ï¼Œæ‰€ä»¥ç¡®åˆ‡çš„è¯´<code>$router.push/replace</code>ã€<code>router-linkçš„to</code>æ¥æ”¶çš„éƒ½æ˜¯ä¸€ä¸ª<code>RawLocationå¯¹è±¡</code></li>
<li><code>RawLocationå¯¹è±¡</code>æ˜¯<code>String</code>å’Œ<code>Location</code>çš„è”åˆç±»å‹</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RawLocation = <span class="built_in">string</span> | Location</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Location &#123;</span><br><span class="line">  name?: <span class="built_in">string</span></span><br><span class="line">  path?: <span class="built_in">string</span></span><br><span class="line">  hash?: <span class="built_in">string</span></span><br><span class="line">  query?: Dictionary&lt;<span class="built_in">string</span> | (<span class="built_in">string</span> | <span class="literal">null</span>)[] | <span class="literal">null</span> | <span class="literal">undefined</span>&gt;</span><br><span class="line">  params?: Dictionary&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  append?: <span class="built_in">boolean</span></span><br><span class="line">  replace?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·¯ç”±ç»„ä»¶-RouteComponent"><a href="#è·¯ç”±ç»„ä»¶-RouteComponent" class="headerlink" title="è·¯ç”±ç»„ä»¶(RouteComponent)"></a>è·¯ç”±ç»„ä»¶(<code>RouteComponent</code>)</h3><ul>
<li>å½“è·¯ç”±æˆåŠŸåŒ¹é…æ—¶ï¼Œå°±éœ€è¦åœ¨<code>router-view</code>æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªéœ€è¦è¢«æ¸²æŸ“çš„ç»„ä»¶å°±æ˜¯<code>è·¯ç”±ç»„ä»¶</code></li>
<li><code>RouteConfig</code>ä¸­<code>componentã€components</code>ä¸­å®šä¹‰çš„<code>vueç»„ä»¶</code>å°±æ˜¯è·¯ç”±ç»„ä»¶</li>
<li>è·¯ç”±ç»„ä»¶çš„ç‰¹æ®Šæ€§<ul>
<li>æ‹¥æœ‰<strong>åªåœ¨è·¯ç”±ç»„ä»¶ä¸­ç”Ÿæ•ˆ</strong>çš„å®ˆå«(<code>beforeRouteEnter ã€beforeRouteUpdateã€beforeRouteLeave</code>)</li>
<li>ä½ æ˜¯å¦è·Ÿæˆ‘ä¸€æ ·ï¼Œæ›¾ç»åœ¨ç»„ä»¶ä¸­è°ƒç”¨<code>beforeRouteEnter</code>å‘ç°æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‚£æ˜¯å› ä¸ºè¿™ä¸ªå®ˆå«åªèƒ½åœ¨<code>è·¯ç”±ç»„ä»¶</code>ä¸­è¢«è°ƒç”¨ï¼Œåœ¨æ‰€æœ‰éè·¯ç”±ç»„ä»¶ä¸­éƒ½ä¸ä¼šè¢«è°ƒç”¨ï¼ŒåŒ…æ‹¬è·¯ç”±ç»„ä»¶çš„åä»£ç»„ä»¶ï¼›ä½ å¦‚æœæƒ³åœ¨è·¯ç”±ç»„ä»¶ä¸­å®ç°<code>beforeRouteEnter</code>ç±»ä¼¼å®ˆå«ç›‘å¬æ•ˆæœï¼Œå¯ä»¥é€šè¿‡<code>watch $route</code>æ¥æ‰‹åŠ¨åˆ¤æ–­</li>
</ul>
</li>
<li>çº¢æ¡†æ ‡è®°å‡ºæ¥çš„æ˜¯<code>è·¯ç”±ç»„ä»¶</code></li>
<li>route-component.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-component.png" alt="route-component.png"></li>
</ul>
</li>
<li>çœ‹å®Œä¸Šé¢çš„æœ¯è¯­ï¼Œä½ å¯èƒ½è¿˜æ˜¯äº‘é‡Œé›¾é‡Œçš„ï¼Œæ²¡äº‹ï¼Œåé¢ä¼šè¯¦è§£ï¼Œç°åœ¨ä½ åªéœ€è¦æœ‰ä¸ªå¤§æ¦‚äº†è§£å³å¯;</li>
</ul>
<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul>
<li><code>vue-router</code>ç‰ˆæœ¬:<code>v3.1.6</code></li>
<li><code>node</code>ç‰ˆæœ¬:<code>v8.17.0</code></li>
<li>åˆ†æä»“åº“åœ°å€:<code>https://github.com/BryanAdamss/vue-router-for-analysis</code><ul>
<li>åˆ’é‡ç‚¹<ul>
<li>æ³¨æ„æŸ¥çœ‹<code>commitè®°å½•</code>ï¼Œ<code>commit</code>è®°å½•äº†æˆ‘æ•´ä¸ªåˆ†æçš„æµç¨‹</li>
<li>å¦‚æœä½ è§‰å¾—è¿˜å¯ä»¥ï¼Œä¸è¦å¿˜è®°<code>star</code>ã€<code>fork</code>ğŸ¤</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><ul>
<li>é¦–å…ˆæˆ‘ä»¬å°†<code>vue-router</code>ä»“åº“<code>clone</code>ä¸‹æ¥ï¼Œçœ‹ä¸‹ç›®å½•ç»“æ„å¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·çš„</li>
<li><code>git clone git@github.com:BryanAdamss/vue-router-for-analysis.git</code></li>
</ul>
<h3 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h3><ul>
<li>å¯ä»¥çœ‹åˆ°ä¼šæœ‰å¦‚ä¸‹ç›®å½•</li>
<li>directory.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/directory.png" alt="directory.png"></li>
</ul>
</li>
<li>åˆ«çœ‹ç›®å½•å¤šä¹ˆå¤šï¼Œå…¶å®æˆ‘å·²ç»ç»™ä½ åˆ’äº†é‡ç‚¹</li>
<li>æˆ‘ä»¬å…¶å®åªéœ€è¦å…³æ³¨ä¸‹é¢å‡ ä¸ªç›®å½•æˆ–æ–‡ä»¶</li>
<li><code>examples</code><ul>
<li>è¿™é‡Œé¢å­˜æ”¾äº†å®˜æ–¹ç²¾å¿ƒå‡†å¤‡çš„æ¡ˆä¾‹</li>
<li>ä¸ä»…å‘Šè¯‰ä½ <code>vue-router</code>æœ‰å“ªäº›åŸºç¡€ç‰¹æ€§ï¼Œè¿˜ä¼šå‘Šè¯‰ä½ æ€ä¹ˆåº”å¯¹ä¸€äº›å¤æ‚åœºæ™¯ï¼Œä¾‹å¦‚æƒé™æ§åˆ¶ã€åŠ¨æ€æ·»åŠ è·¯ç”±ç­‰ï¼›æ€»ä¹‹ï¼Œå€¼å¾—ä½ å»ä¸€æ¢ç©¶ç«Ÿï¼›</li>
<li>examples.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/examples.png" alt="examples.png"></li>
</ul>
</li>
<li>å¦å¤–ï¼Œæˆ‘ä»¬åœ¨åˆ†ææºç çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥åˆ©ç”¨è¿™äº›ä¾‹å­è¿›è¡Œè°ƒè¯•<ul>
<li>åœ¨æºç ä½ æƒ³è°ƒè¯•å¤„æ·»åŠ <code>debuggeræ–­ç‚¹æ ‡è¯†</code>ï¼Œç„¶åå¯åŠ¨ä¾‹å­<code>npm run dev</code>ï¼Œæ‰“å¼€<code>localhost:8080</code>å³å¯</li>
</ul>
</li>
</ul>
</li>
<li><code>src</code>ç›®å½•<ul>
<li>è¿™æ˜¯<code>vue-router</code>æºç å­˜æ”¾çš„ç›®å½•ï¼Œæ˜¯æˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„åœ°æ–¹</li>
<li>src.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/src.png" alt="src.png"></li>
</ul>
</li>
<li>æ¡å‡ ä¸ªé‡è¦ç›®å½•å…ˆè¯´ä¸‹<ul>
<li><code>components</code>ç›®å½•æ˜¯å­˜æ”¾å†…ç½®ç»„ä»¶<code>router-link</code>ã€<code>router-view</code>çš„</li>
<li><code>history</code>æ˜¯å­˜æ”¾æ ¸å¿ƒ<code>historyç±»</code>çš„åœ°æ–¹</li>
<li><code>util</code>ä¸­å­˜æ”¾çš„æ˜¯ä¸€äº›è¾…åŠ©å‡½æ•°</li>
<li><code>index.js</code>æ˜¯<code>vue-router</code>çš„å…¥å£æ–‡ä»¶ï¼Œä¹Ÿæ˜¯<code>vue-router</code>ç±»å®šä¹‰çš„åœ°æ–¹</li>
<li><code>install.js</code>æ˜¯å®‰è£…é€»è¾‘æ‰€åœ¨æ–‡ä»¶</li>
</ul>
</li>
</ul>
</li>
<li><code>flow/declarations.js</code><ul>
<li>å®ƒæ˜¯<code>vue-router</code>çš„ flow ç±»å‹å£°æ˜æ–‡ä»¶ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬èƒ½çŸ¥é“<code>vue-router</code>ä¸­å‡ ä¸ªæ ¸å¿ƒç±»(å¯¹è±¡)æ˜¯é•¿ä»€ä¹ˆæ ·çš„</li>
<li>å®ƒé‡Œé¢ï¼Œå¤§æ¦‚é•¿è¿™æ ·</li>
<li>declarations.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/declarations.png" alt="declarations.png"></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="åŸºç¡€ä¾‹å­"><a href="#åŸºç¡€ä¾‹å­" class="headerlink" title="åŸºç¡€ä¾‹å­"></a>åŸºç¡€ä¾‹å­</h2><ul>
<li>æˆ‘ä»¬ä»æœ€åŸºç¡€çš„ä¾‹å­å¼€å§‹çœ‹</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="comment">//Â 1.Â UseÂ plugin.</span></span><br><span class="line"><span class="comment">// å®‰è£…æ’ä»¶</span></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â 2.Â DefineÂ routeÂ components</span></span><br><span class="line"><span class="comment">// å®šä¹‰è·¯ç”±ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> Home = &#123; <span class="attr">template</span>: <span class="string">'&lt;div&gt;home&lt;/div&gt;'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> Foo = &#123; <span class="attr">template</span>: <span class="string">'&lt;div&gt;foo&lt;/div&gt;'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> Bar = &#123; <span class="attr">template</span>: <span class="string">'&lt;div&gt;bar&lt;/div&gt;'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â 3.Â CreateÂ theÂ router</span></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–vue-router</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  routes: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">component</span>: Home &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/foo'</span>, <span class="attr">component</span>: Foo &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/bar'</span>, <span class="attr">component</span>: Bar &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â 4.Â CreateÂ andÂ mountÂ rootÂ instance.</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router, <span class="comment">// æ³¨å…¥routerå®ä¾‹</span></span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">Â Â Â Â &lt;divÂ id="app"&gt;</span></span><br><span class="line"><span class="string">Â Â Â Â Â Â &lt;h1&gt;Basic&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">Â Â Â Â Â Â &lt;ul&gt;</span></span><br><span class="line"><span class="string">Â Â Â Â Â Â Â Â &lt;li&gt;&lt;router-linkÂ to="/"&gt;/&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">Â Â Â Â Â Â Â Â &lt;li&gt;&lt;router-linkÂ to="/foo"&gt;/foo&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">Â Â Â Â Â Â Â Â &lt;li&gt;&lt;router-linkÂ to="/bar"&gt;/bar&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">       &lt;/ul&gt;</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">Â Â Â Â Â Â &lt;router-viewÂ class="view"&gt;&lt;/router-view&gt;</span></span><br><span class="line"><span class="string">Â Â Â Â &lt;/div&gt;</span></span><br><span class="line"><span class="string">Â Â `</span>,</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆä½¿ç”¨<code>vue</code>çš„æ’ä»¶è¯­æ³•å®‰è£…äº†<code>vue-router</code>ï¼› ç„¶åæˆ‘ä»¬å†å®ä¾‹åŒ–<code>VueRouter</code>ï¼› æœ€åæˆ‘ä»¬å°†<code>VueRouter</code>çš„å®ä¾‹æ³¨å…¥åˆ°<code>Vue</code></li>
<li>è¿™å…¶å®å°±æ¶‰åŠåˆ°ä¸‰ä¸ªæ ¸å¿ƒæµç¨‹ï¼šå®‰è£…ã€å®ä¾‹åŒ–ã€åˆå§‹åŒ–</li>
<li>æˆ‘ä»¬å…ˆä»è¿™ä¸‰ä¸ªæµç¨‹è®²èµ·</li>
</ul>
<h2 id="å®‰è£…æµç¨‹"><a href="#å®‰è£…æµç¨‹" class="headerlink" title="å®‰è£…æµç¨‹"></a>å®‰è£…æµç¨‹</h2><ul>
<li>æˆ‘ä»¬çŸ¥é“ï¼Œåªè¦æ˜¯<code>vue plugin</code>ï¼Œè‚¯å®šéƒ½ä¼šæœ‰ä¸€ä¸ª<code>install</code>æ–¹æ³•;<ul>
<li><a href="https://cn.vuejs.org/v2/guide/plugins.html#å¼€å‘æ’ä»¶" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/plugins.html#å¼€å‘æ’ä»¶</a></li>
</ul>
</li>
<li>ä¸Šé¢ä¹Ÿæåˆ°<code>vue-router</code>çš„å…¥å£æ–‡ä»¶åœ¨<code>src/index.js</code>ä¸­ï¼Œé‚£æˆ‘ä»¬å»<code>index.js</code>ä¸­æ‰¾æ‰¾<code>install</code>æ–¹æ³•</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*Â @flowÂ */</span></span><br><span class="line"><span class="keyword">import</span>Â &#123;Â installÂ &#125;Â <span class="keyword">from</span>Â <span class="string">'./install'</span>Â <span class="comment">//Â å¯¼å…¥å®‰è£…æ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â VueRouterç±»</span></span><br><span class="line"><span class="keyword">export</span>Â <span class="keyword">default</span>Â <span class="keyword">class</span>Â VueRouterÂ &#123;</span><br><span class="line">Â Â ...Â </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">VueRouter.installÂ =Â installÂ <span class="comment">//Â æŒ‚è½½å®‰è£…æ–¹æ³•ï¼ŒVue.useæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨installæ–¹æ³•</span></span><br><span class="line">VueRouter.versionÂ =Â <span class="string">'__VERSION__'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æµè§ˆå™¨ç¯å¢ƒï¼Œè‡ªåŠ¨å®‰è£…VueRouter</span></span><br><span class="line"><span class="keyword">if</span>Â (inBrowserÂ &amp;&amp;Â <span class="built_in">window</span>.Vue)Â &#123;</span><br><span class="line">Â Â <span class="built_in">window</span>.Vue.use(VueRouter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œå¼€å¤´å¯¼å…¥äº†<code>install</code>æ–¹æ³•ï¼Œå¹¶å°†å…¶åšä¸ºé™æ€æ–¹æ³•ç›´æ¥æŒ‚è½½åˆ°<code>VueRouter</code>ä¸Šï¼Œè¿™æ ·ï¼Œåœ¨<code>Vue.use(VueRouter)</code>æ—¶ï¼Œ<code>install</code>æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼›</li>
<li>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒï¼Œå¹¶ä¸”é€šè¿‡<code>scriptæ ‡ç­¾</code>çš„å½¢å¼å¼•å…¥<code>Vue</code>æ—¶(ä¼šåœ¨<code>window</code>ä¸ŠæŒ‚è½½<code>Vue</code>å…¨å±€å˜é‡)ï¼Œä¼šå°è¯•è‡ªåŠ¨ä½¿ç”¨<code>VueRouter</code></li>
<li>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹<code>install.js</code>ä¸­æ˜¯ä»€ä¹ˆ</li>
</ul>
<h3 id="install-js"><a href="#install-js" class="headerlink" title="install.js"></a>install.js</h3><ul>
<li><code>install</code>æ–¹æ³•å¹¶ä¸é•¿</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> View <span class="keyword">from</span> <span class="string">'./components/view'</span></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'./components/link'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> _Vue <span class="comment">//Â ç”¨æ¥é¿å…å°†Vueåšä¸ºä¾èµ–æ‰“åŒ…è¿›æ¥</span></span><br><span class="line"><span class="comment">//Â installæ–¹æ³•</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (install.installed &amp;&amp; _Vue === Vue) <span class="keyword">return</span> <span class="comment">//Â é¿å…é‡å¤å®‰è£…</span></span><br><span class="line">  install.installed = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  _Vue = Vue <span class="comment">//Â ä¿ç•™Vueå¼•ç”¨</span></span><br><span class="line">  <span class="keyword">const</span> isDef = <span class="function">(<span class="params">v</span>) =&gt;</span> v !== <span class="literal">undefined</span> <span class="comment">//Â ä¸ºrouter-viewç»„ä»¶å…³è”è·¯ç”±ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> registerInstance = <span class="function">(<span class="params">vm, callVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = vm.$options._parentVnode <span class="comment">//Â è°ƒç”¨vm.$options._parentVnode.data.registerRouteInstanceæ–¹æ³• //Â è€Œè¿™ä¸ªæ–¹æ³•åªåœ¨router-viewç»„ä»¶ä¸­å­˜åœ¨ï¼Œrouter-viewç»„ä»¶å®šä¹‰åœ¨(../components/view.jsÂ @71è¡Œ) //Â æ‰€ä»¥ï¼Œå¦‚æœvmçš„çˆ¶èŠ‚ç‚¹ä¸ºrouter-viewï¼Œåˆ™ä¸ºrouter-viewå…³è”å½“å‰vmï¼Œå³å°†å½“å‰vmåšä¸ºrouter-viewçš„è·¯ç”±ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      isDef(i) &amp;&amp;</span><br><span class="line">      isDef((i = i.data)) &amp;&amp;</span><br><span class="line">      isDef((i = i.registerRouteInstance))</span><br><span class="line">    ) &#123;</span><br><span class="line">      i(vm, callVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//Â æ³¨å†Œå…¨å±€æ··å…¥</span></span><br><span class="line"></span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="comment">//Â thisÂ ===Â newÂ Vue(&#123;router:router&#125;)Â ===Â Vueæ ¹å®ä¾‹</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//Â åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†vue-routeræ’ä»¶</span></span><br><span class="line">      <span class="keyword">if</span> (isDef(<span class="keyword">this</span>.$options.router)) &#123;</span><br><span class="line">        <span class="comment">//Â åœ¨Vueæ ¹å®ä¾‹ä¸Šä¿å­˜ä¸€äº›ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">this</span>._routerRoot = <span class="keyword">this</span> <span class="comment">//Â ä¿å­˜æŒ‚è½½VueRouterçš„Vueå®ä¾‹ï¼Œæ­¤å¤„ä¸ºæ ¹å®ä¾‹</span></span><br><span class="line">        <span class="keyword">this</span>._router = <span class="keyword">this</span>.$options.router <span class="comment">//Â ä¿å­˜VueRouterå®ä¾‹ï¼Œthis.$options.routerä»…å­˜åœ¨äºVueæ ¹å®ä¾‹ä¸Šï¼Œå…¶å®ƒVueç»„ä»¶ä¸åŒ…å«æ­¤å±æ€§ï¼Œæ‰€ä»¥ä¸‹é¢çš„åˆå§‹åŒ–ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ //Â beforeCreateÂ hookè¢«è§¦å‘æ—¶ï¼Œè°ƒç”¨</span></span><br><span class="line">        <span class="keyword">this</span>._router.init(<span class="keyword">this</span>) <span class="comment">//Â åˆå§‹åŒ–VueRouterå®ä¾‹ï¼Œå¹¶ä¼ å…¥Vueæ ¹å®ä¾‹ //Â å“åº”å¼å®šä¹‰_routeå±æ€§ï¼Œä¿è¯_routeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»„ä»¶(router-view)ä¼šé‡æ–°æ¸²æŸ“</span></span><br><span class="line">        Vue.util.defineReactive(<span class="keyword">this</span>, <span class="string">'_route'</span>, <span class="keyword">this</span>._router.history.current)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//Â å›æº¯æŸ¥æ‰¾_routerRoot</span></span><br><span class="line">        <span class="keyword">this</span>._routerRoot = (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._routerRoot) || <span class="keyword">this</span></span><br><span class="line">      &#125; <span class="comment">//Â ä¸ºrouter-viewç»„ä»¶å…³è”è·¯ç”±ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">      registerInstance(<span class="keyword">this</span>, <span class="keyword">this</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    destroyed() &#123;</span><br><span class="line">      <span class="comment">//Â destroyedÂ hookè§¦å‘æ—¶ï¼Œå–æ¶ˆrouter-viewå’Œè·¯ç”±ç»„ä»¶çš„å…³è”</span></span><br><span class="line">      registerInstance(<span class="keyword">this</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;) <span class="comment">//Â åœ¨åŸå‹ä¸Šæ³¨å…¥$routerã€$routeå±æ€§ï¼Œæ–¹ä¾¿å¿«æ·è®¿é—®</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(Vue.prototype, <span class="string">'$router'</span>, &#123;</span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._routerRoot._router</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(Vue.prototype, <span class="string">'$route'</span>, &#123;</span><br><span class="line">    <span class="comment">//Â æ¯ä¸ªç»„ä»¶è®¿é—®åˆ°çš„$routeï¼Œå…¶å®æœ€åè®¿é—®çš„éƒ½æ˜¯Vueæ ¹å®ä¾‹çš„_route</span></span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._routerRoot._route</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;) <span class="comment">//Â æ³¨å†Œrouter-viewã€router-linkå…¨å±€ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">  Vue.component(<span class="string">'RouterView'</span>, View)</span><br><span class="line">  Vue.component(<span class="string">'RouterLink'</span>, Link)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> strats = Vue.config.optionMergeStrategies <span class="comment">//Â useÂ theÂ sameÂ hookÂ mergingÂ strategyÂ forÂ routeÂ hooks</span></span><br><span class="line">  strats.beforeRouteEnter = strats.beforeRouteLeave = strats.beforeRouteUpdate =</span><br><span class="line">    strats.created</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œ<code>install</code>æ–¹æ³•å¹²äº†ä¸‹é¢å‡ ä»¶äº‹</li>
</ul>
<h4 id="é¿å…é‡å¤å®‰è£…"><a href="#é¿å…é‡å¤å®‰è£…" class="headerlink" title="é¿å…é‡å¤å®‰è£…"></a>é¿å…é‡å¤å®‰è£…</h4><ul>
<li>é€šè¿‡æ·»åŠ <code>installed</code>æ ‡è¯†æ¥åˆ¤æ–­æ˜¯å¦é‡å¤å®‰è£…</li>
</ul>
<h4 id="ä¿ç•™Vueå¼•ç”¨ï¼Œé¿å…å°†Vueåšä¸ºä¾èµ–æ‰“åŒ…"><a href="#ä¿ç•™Vueå¼•ç”¨ï¼Œé¿å…å°†Vueåšä¸ºä¾èµ–æ‰“åŒ…" class="headerlink" title="ä¿ç•™Vueå¼•ç”¨ï¼Œé¿å…å°†Vueåšä¸ºä¾èµ–æ‰“åŒ…"></a>ä¿ç•™<code>Vue</code>å¼•ç”¨ï¼Œé¿å…å°†<code>Vue</code>åšä¸ºä¾èµ–æ‰“åŒ…</h4><ul>
<li><code>install</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šå°†<code>Vue</code>åšä¸ºå‚æ•°ä¼ å…¥ï¼Œ<code>Vue</code>ä¼šè¢«èµ‹å€¼ç»™äº‹å…ˆå®šä¹‰å¥½çš„<code>_Vue</code>å˜é‡</li>
<li>åœ¨å…¶å®ƒæ¨¡å—ä¸­ï¼Œå¯ä»¥å¯¼å…¥è¿™ä¸ª<code>_Vue</code>ï¼Œè¿™æ ·æ—¢èƒ½è®¿é—®åˆ°<code>Vue</code>ï¼Œåˆé¿å…äº†å°†<code>Vue</code>åšä¸ºä¾èµ–æ‰“åŒ…</li>
<li>è¿™æ˜¯ä¸€ä¸ªæ’ä»¶å¼€å‘å®ç”¨å°æŠ€å·§</li>
</ul>
<h4 id="æ³¨å†Œäº†ä¸€ä¸ªå…¨å±€æ··å…¥"><a href="#æ³¨å†Œäº†ä¸€ä¸ªå…¨å±€æ··å…¥" class="headerlink" title="æ³¨å†Œäº†ä¸€ä¸ªå…¨å±€æ··å…¥"></a>æ³¨å†Œäº†ä¸€ä¸ªå…¨å±€æ··å…¥</h4><ul>
<li>è¿™ä¸ªæ··å…¥å°†å½±å“æ³¨å†Œä¹‹åæ‰€æœ‰åˆ›å»ºçš„æ¯ä¸ª <code>Vue</code> å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯åé¢æ¯ä¸ª<code>Vue</code>å®ä¾‹éƒ½ä¼šæ‰§è¡Œæ··å…¥ä¸­çš„ä»£ç </li>
<li>æˆ‘ä»¬çœ‹ä¸‹æ··å…¥ä¸­çš„ä»£ç </li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â æ³¨å†Œå…¨å±€æ··å…¥</span></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    <span class="comment">//Â thisÂ ===Â newÂ Vue(&#123;router:router&#125;)Â ===Â Vueæ ¹å®ä¾‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Â åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†vue-routeræ’ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (isDef(<span class="keyword">this</span>.$options.router)) &#123;</span><br><span class="line">      <span class="comment">//Â åœ¨Vueæ ¹å®ä¾‹ä¸Šä¿å­˜ä¸€äº›ä¿¡æ¯</span></span><br><span class="line">      <span class="keyword">this</span>._routerRoot = <span class="keyword">this</span> <span class="comment">//Â ä¿å­˜æŒ‚è½½VueRouterçš„Vueå®ä¾‹ï¼Œæ­¤å¤„ä¸ºæ ¹å®ä¾‹</span></span><br><span class="line">      <span class="keyword">this</span>._router = <span class="keyword">this</span>.$options.router <span class="comment">//Â ä¿å­˜VueRouterå®ä¾‹ï¼Œthis.$options.routerä»…å­˜åœ¨äºVueæ ¹å®ä¾‹ä¸Šï¼Œå…¶å®ƒVueç»„ä»¶ä¸åŒ…å«æ­¤å±æ€§ï¼Œæ‰€ä»¥ä¸‹é¢çš„åˆå§‹åŒ–ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ //Â beforeCreateÂ hookè¢«è§¦å‘æ—¶ï¼Œè°ƒç”¨</span></span><br><span class="line">      <span class="keyword">this</span>._router.init(<span class="keyword">this</span>) <span class="comment">//Â åˆå§‹åŒ–VueRouterå®ä¾‹ï¼Œå¹¶ä¼ å…¥Vueæ ¹å®ä¾‹ //Â å“åº”å¼å®šä¹‰_routeå±æ€§ï¼Œä¿è¯_routeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»„ä»¶(router-view)ä¼šé‡æ–°æ¸²æŸ“</span></span><br><span class="line">      Vue.util.defineReactive(<span class="keyword">this</span>, <span class="string">'_route'</span>, <span class="keyword">this</span>._router.history.current)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//Â å›æº¯æŸ¥æ‰¾_routerRoot</span></span><br><span class="line">      <span class="keyword">this</span>._routerRoot = (<span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent._routerRoot) || <span class="keyword">this</span></span><br><span class="line">    &#125; <span class="comment">//Â ä¸ºrouter-viewç»„ä»¶å…³è”è·¯ç”±ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">    registerInstance(<span class="keyword">this</span>, <span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  destroyed() &#123;</span><br><span class="line">    <span class="comment">//Â destroyedÂ hookè§¦å‘æ—¶ï¼Œå–æ¶ˆrouter-viewå’Œè·¯ç”±ç»„ä»¶çš„å…³è”</span></span><br><span class="line">    registerInstance(<span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>å®ƒæ³¨å†Œäº†ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­<code>beforeCreate</code>å’Œ<code>destroyed</code>ï¼›</li>
<li>æ³¨æ„<ul>
<li>åœ¨è¿™ä¸¤ä¸ªé’©å­ä¸­ï¼Œ<code>this</code>æ˜¯æŒ‡å‘å½“æ—¶æ­£åœ¨è°ƒç”¨é’©å­çš„<code>vueå®ä¾‹</code>ï¼›</li>
<li><strong>è¿™ä¸¤ä¸ªé’©å­ä¸­çš„é€»è¾‘ï¼Œåœ¨å®‰è£…æµç¨‹ä¸­æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ï¼Œåªæœ‰åœ¨ç»„ä»¶å®ä¾‹åŒ–æ—¶æ‰§è¡Œåˆ°é’©å­æ—¶æ‰ä¼šè¢«è°ƒç”¨</strong></li>
</ul>
</li>
<li>æˆ‘ä»¬å…ˆçœ‹<code>beforeCreate</code>é’©å­</li>
<li>å®ƒå…ˆåˆ¤æ–­äº†<code>this.$options.router</code>æ˜¯å¦å­˜åœ¨ï¼Œæˆ‘ä»¬åœ¨<code>new Vue({router})</code>æ—¶ï¼Œ<code>router</code>å·²ç»è¢«ä¿å­˜åˆ°åˆ°<code>Vueæ ¹å®ä¾‹</code>çš„<code>$options</code>ä¸Šï¼Œè€Œå…¶å®ƒ<code>Vueå®ä¾‹</code>çš„<code>$options</code>ä¸Šæ˜¯æ²¡æœ‰<code>router</code>çš„<ul>
<li>æ‰€ä»¥<code>if</code>ä¸­çš„è¯­å¥åªåœ¨<code>this === new Vue({router})</code>æ—¶ï¼Œæ‰ä¼šè¢«æ‰§è¡Œï¼Œç”±äº<code>Vueæ ¹å®ä¾‹</code>åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥è¿™ä¸ªé€»è¾‘åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡</li>
<li>æˆ‘ä»¬å¯ä»¥åœ¨<code>if</code>ä¸­æ‰“å°<code>this</code>å¹¶ç»“åˆè°ƒè¯•å·¥å…·çœ‹çœ‹</li>
<li>root-instance.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/root-instance.png" alt="root-instance.png"></li>
</ul>
</li>
<li>çš„ç¡®ï¼Œ<code>if</code>ä¸­çš„é€»è¾‘åªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œå¹¶ä¸”<code>this</code>å°±æ˜¯æŒ‡å‘<code>Vueæ ¹å®ä¾‹</code></li>
</ul>
</li>
<li>æˆ‘ä»¬çœ‹ä¸‹<code>if</code>ä¸­å…·ä½“å¹²äº†ä»€ä¹ˆ<ul>
<li>åœ¨æ ¹å®ä¾‹ä¸Šä¿å­˜äº†<code>_routerRoot</code>ï¼Œç”¨æ¥æ ‡è¯†<code>router</code>æŒ‚è½½çš„<code>Vueå®ä¾‹</code></li>
<li>åœ¨æ ¹å®ä¾‹ä¸Šä¿å­˜äº†<code>VueRouter</code>å®ä¾‹(<code>router</code>)</li>
<li>å¯¹<code>router</code>è¿›è¡Œäº†åˆå§‹åŒ–(<code>init</code>)<ul>
<li><code>router</code>åˆå§‹åŒ–é€»è¾‘æˆ‘ä»¬åé¢ç»†çœ‹</li>
</ul>
</li>
<li>åœ¨æ ¹å®ä¾‹ä¸Šï¼Œå“åº”å¼å®šä¹‰äº†<code>_route</code>å±æ€§<ul>
<li>ä¿è¯<code>_route</code>å˜åŒ–æ—¶ï¼Œ<code>router-view</code>ä¼šé‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢åœ¨<code>router-view</code>ç»„ä»¶ä¸­ä¼šç»†è®²</li>
</ul>
</li>
</ul>
</li>
<li>æˆ‘ä»¬å†çœ‹ä¸‹<code>else</code>ä¸­å…·ä½“å¹²äº†å•¥<ul>
<li>ä¸»è¦æ˜¯ä¸ºæ¯ä¸ªç»„ä»¶å®šä¹‰<code>_routerRoot</code>ï¼Œé‡‡ç”¨çš„æ˜¯é€å±‚å‘ä¸Šçš„å›æº¯æŸ¥æ‰¾æ–¹å¼</li>
</ul>
</li>
<li>æˆ‘ä»¬çœ‹åˆ°è¿˜æœ‰ä¸ª<code>registerInstance</code>æ–¹æ³•ï¼Œå®ƒåœ¨<code>beforeCreate</code>ã€<code>destroyed</code>éƒ½æœ‰è¢«è°ƒç”¨ï¼Œåªæ˜¯å‚æ•°ä¸ªæ•°ä¸ä¸€æ ·<ul>
<li>åœ¨<code>beforeCreate</code>ä¸­ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸”éƒ½æ˜¯<code>this</code>å³å½“å‰<code>vueå®ä¾‹</code>ï¼Œè€Œåœ¨<code>destroyed</code>ä¸­åªä¼ å…¥äº†ä¸€ä¸ª<code>vueå®ä¾‹</code></li>
<li>æˆ‘ä»¬åœ¨è®²<code>router-view</code>æ—¶ä¼šç»†è®²ï¼Œä½ åªéœ€è¦çŸ¥é“å®ƒæ˜¯ç”¨æ¥ä¸º<code>router-view</code>ç»„ä»¶å…³è”æˆ–è§£ç»‘<code>è·¯ç”±ç»„ä»¶</code>ç”¨çš„å³å¯</li>
<li>ä¼ å…¥ä¸¤ä¸ªå‚æ•°å³å…³è”ï¼Œä¼ å…¥ä¸€ä¸ªå‚æ•°å³è§£ç»‘</li>
</ul>
</li>
</ul>
<h4 id="æ·»åŠ å®ä¾‹å±æ€§ã€æ–¹æ³•"><a href="#æ·»åŠ å®ä¾‹å±æ€§ã€æ–¹æ³•" class="headerlink" title="æ·»åŠ å®ä¾‹å±æ€§ã€æ–¹æ³•"></a>æ·»åŠ å®ä¾‹å±æ€§ã€æ–¹æ³•</h4><ul>
<li>åœ¨<code>Vue</code>åŸå‹ä¸Šæ³¨å…¥<code>$routerã€$route</code>å±æ€§ï¼Œæ–¹ä¾¿åœ¨<code>vueå®ä¾‹</code>ä¸­é€šè¿‡<code>this.$router</code>ã€<code>this.$route</code>å¿«æ·è®¿é—®</li>
</ul>
<h4 id="æ³¨å†Œ-router-viewã€router-link-å…¨å±€ç»„ä»¶"><a href="#æ³¨å†Œ-router-viewã€router-link-å…¨å±€ç»„ä»¶" class="headerlink" title="æ³¨å†Œ router-viewã€router-link å…¨å±€ç»„ä»¶"></a>æ³¨å†Œ router-viewã€router-link å…¨å±€ç»„ä»¶</h4><ul>
<li>é€šè¿‡<code>Vue.component</code>è¯­æ³•æ³¨å†Œäº†<code>router-view</code>å’Œ<code>router-link</code>ä¸¤ä¸ªå…¨å±€ç»„ä»¶</li>
</ul>
<h4 id="è®¾ç½®è·¯ç”±ç»„ä»¶å®ˆå«çš„åˆå¹¶ç­–ç•¥"><a href="#è®¾ç½®è·¯ç”±ç»„ä»¶å®ˆå«çš„åˆå¹¶ç­–ç•¥" class="headerlink" title="è®¾ç½®è·¯ç”±ç»„ä»¶å®ˆå«çš„åˆå¹¶ç­–ç•¥"></a>è®¾ç½®è·¯ç”±ç»„ä»¶å®ˆå«çš„åˆå¹¶ç­–ç•¥</h4><ul>
<li>è®¾ç½®è·¯ç”±ç»„ä»¶çš„<code>beforeRouteEnter</code>ã€<code>beforeRouteLeave</code>ã€<code>beforeRouteUpdate</code>å®ˆå«çš„åˆå¹¶ç­–ç•¥</li>
</ul>
<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>æˆ‘ä»¬ç”¨ä¸€å¼ å›¾ï¼Œæ€»ç»“ä¸€ä¸‹å®‰è£…æµç¨‹</li>
<li>install.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/install.png" alt="install.png"></li>
</ul>
</li>
</ul>
<h2 id="å®ä¾‹åŒ–æµç¨‹"><a href="#å®ä¾‹åŒ–æµç¨‹" class="headerlink" title="å®ä¾‹åŒ–æµç¨‹"></a>å®ä¾‹åŒ–æµç¨‹</h2><ul>
<li>çœ‹å®Œå®‰è£…æµç¨‹ï¼Œæˆ‘ä»¬ç´§æ¥ç€æ¥çœ‹ä¸‹<code>VueRouter</code>çš„å®ä¾‹åŒ–è¿‡ç¨‹</li>
<li>è¿™ä¸€èŠ‚ï¼Œé‡ç‚¹å…³æ³¨å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åªçœ‹<code>constructor</code>ä¸­çš„æ ¸å¿ƒé€»è¾‘</li>
</ul>
<h3 id="VueRouter-çš„æ„é€ å‡½æ•°"><a href="#VueRouter-çš„æ„é€ å‡½æ•°" class="headerlink" title="VueRouter çš„æ„é€ å‡½æ•°"></a>VueRouter çš„æ„é€ å‡½æ•°</h3><ul>
<li>æˆ‘ä»¬æ‰“å¼€<code>src/index.js</code>çœ‹ä¸‹<code>VueRouter</code>æ„é€ å‡½æ•°</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> VueRouter &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">options: RouterOptions = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.app = <span class="literal">null</span> <span class="comment">// ä¿å­˜æŒ‚è½½å®ä¾‹</span></span><br><span class="line">    <span class="keyword">this</span>.apps = [] <span class="comment">// VueRouteræ”¯æŒå¤šå®ä¾‹</span></span><br><span class="line">    <span class="keyword">this</span>.options = options</span><br><span class="line">    <span class="keyword">this</span>.beforeHooks = [] <span class="comment">// æ¥æ”¶ beforeEach hook</span></span><br><span class="line">    <span class="keyword">this</span>.resolveHooks = [] <span class="comment">// æ¥æ”¶ beforeResolve hook</span></span><br><span class="line">    <span class="keyword">this</span>.afterHooks = [] <span class="comment">// æ¥æ”¶ afterEach hook</span></span><br><span class="line">    <span class="keyword">this</span>.matcher = createMatcher(options.routes || [], <span class="keyword">this</span>) <span class="comment">//Â åˆ›å»ºè·¯ç”±matcherå¯¹è±¡ï¼Œä¼ å…¥routesè·¯ç”±é…ç½®åˆ—è¡¨åŠVueRouterå®ä¾‹</span></span><br><span class="line">    <span class="keyword">let</span> mode = options.mode || <span class="string">'hash'</span></span><br><span class="line">    <span class="keyword">this</span>.fallback =</span><br><span class="line">      mode === <span class="string">'history'</span> &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== <span class="literal">false</span> <span class="comment">// æ˜¯å¦å›é€€</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.fallback) &#123;</span><br><span class="line">      mode = <span class="string">'hash'</span></span><br><span class="line">    &#125; <span class="comment">//Â éæµè§ˆå™¨ç¯å¢ƒï¼Œå¼ºåˆ¶ä½¿ç”¨abstractæ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!inBrowser) &#123;</span><br><span class="line">      mode = <span class="string">'abstract'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.mode = mode <span class="comment">//Â æ ¹æ®ä¸åŒmodeï¼Œå®ä¾‹åŒ–ä¸åŒhistoryå®ä¾‹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'history'</span>:</span><br><span class="line">        <span class="keyword">this</span>.history = <span class="keyword">new</span> HTML5History(<span class="keyword">this</span>, options.base)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'hash'</span>:</span><br><span class="line">        <span class="keyword">this</span>.history = <span class="keyword">new</span> HashHistory(<span class="keyword">this</span>, options.base, <span class="keyword">this</span>.fallback)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'abstract'</span>:</span><br><span class="line">        <span class="keyword">this</span>.history = <span class="keyword">new</span> AbstractHistory(<span class="keyword">this</span>, options.base)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          assert(<span class="literal">false</span>, <span class="string">`invalidÂ mode:Â <span class="subst">$&#123;mode&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ„é€ å‡½æ•°ä¸»è¦å¹²äº†ä¸‹é¢å‡ ä»¶äº‹</li>
</ul>
<h4 id="æ¥æ”¶-RouterOptions"><a href="#æ¥æ”¶-RouterOptions" class="headerlink" title="æ¥æ”¶ RouterOptions"></a>æ¥æ”¶ RouterOptions</h4><ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œæ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª<code>optionsé€‰é¡¹å¯¹è±¡</code>ï¼Œå®ƒçš„ç±»å‹æ˜¯<code>RouterOptions</code>ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹<code>RouterOptions</code></li>
<li>æ‰“å¼€<code>flow/declarations.js</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flow/declarations.js</span></span><br><span class="line"></span><br><span class="line">declare type RouterOptions = &#123;</span><br><span class="line">  routes?: <span class="built_in">Array</span>&lt;RouteConfig&gt;, <span class="comment">// è·¯ç”±é…ç½®è§„åˆ™åˆ—è¡¨</span></span><br><span class="line">  mode?: string, <span class="comment">// è·¯ç”±æ¨¡å¼</span></span><br><span class="line">  fallback?: boolean, <span class="comment">// æ˜¯å¦å¯ç”¨å›é€€</span></span><br><span class="line">  base?: string, <span class="comment">// baseåœ°å€</span></span><br><span class="line">  linkActiveClass?: string, <span class="comment">// router-linkæ¿€æ´»æ—¶ç±»å</span></span><br><span class="line">  linkExactActiveClass?: string, <span class="comment">// router-linkç²¾å‡†æ¿€æ´»æ—¶ç±»å</span></span><br><span class="line">  parseQuery?: <span class="function">(<span class="params">query: string</span>) =&gt;</span> <span class="built_in">Object</span>, <span class="comment">// è‡ªå®šä¹‰è§£æqsçš„æ–¹æ³•</span></span><br><span class="line">  stringifyQuery?: <span class="function">(<span class="params">query: <span class="built_in">Object</span></span>) =&gt;</span> string, <span class="comment">// è‡ªå®šä¹‰åºåˆ—åŒ–qsçš„æ–¹æ³•</span></span><br><span class="line">  scrollBehavior?: (</span><br><span class="line">    <span class="comment">// æ§åˆ¶æ»šåŠ¨è¡Œä¸º</span></span><br><span class="line">    to: Route,</span><br><span class="line">    <span class="keyword">from</span>: Route,</span><br><span class="line">    savedPosition: ?Position</span><br><span class="line">  ) =&gt; PositionResult | <span class="built_in">Promise</span>&lt;PositionResult&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>RouterOptions</code>å®šä¹‰äº†<code>VueRouter</code>æ‰€èƒ½æ¥æ”¶çš„æ‰€æœ‰é€‰é¡¹ï¼›<ul>
<li><a href="https://router.vuejs.org/zh/api/#router-æ„å»ºé€‰é¡¹" target="_blank" rel="noopener">https://router.vuejs.org/zh/api/#router-æ„å»ºé€‰é¡¹</a></li>
</ul>
</li>
<li>æˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸€ä¸‹ä¸‹é¢çš„å‡ ä¸ªé€‰é¡¹å€¼<ul>
<li><code>routes</code>æ˜¯è·¯ç”±é…ç½®è§„åˆ™åˆ—è¡¨ï¼Œè¿™ä¸ªä¸»è¦ç”¨æ¥åç»­ç”Ÿæˆè·¯ç”±æ˜ å°„è¡¨çš„ï¼›<ul>
<li>å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªè·¯ç”±é…ç½®è§„åˆ™(<code>RouteConfig</code>)ï¼Œå…³äº<code>RouteConfig</code>ï¼Œå¯ä»¥å›çœ‹æœ¯è¯­é‚£ä¸€èŠ‚ï¼›</li>
</ul>
</li>
<li><code>mode</code>ã€<code>fallback</code>æ˜¯è·Ÿè·¯ç”±æ¨¡å¼ç›¸å…³çš„<ul>
<li>åé¢ä¼šè¯¦ç»†è®²<code>VueRouter</code>çš„è·¯ç”±æ¨¡å¼</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="å±æ€§èµ‹åˆå€¼"><a href="#å±æ€§èµ‹åˆå€¼" class="headerlink" title="å±æ€§èµ‹åˆå€¼"></a>å±æ€§èµ‹åˆå€¼</h4><ul>
<li>å¯¹ä¸€äº›å±æ€§èµ‹äºˆäº†åˆå€¼ï¼Œä¾‹å¦‚ï¼Œå¯¹æ¥æ”¶<code>å…¨å±€å¯¼èˆªå®ˆå«(beforeEachã€beforeResolveã€afterEach)</code>çš„æ•°ç»„åšäº†åˆå§‹åŒ–</li>
</ul>
<h4 id="åˆ›å»º-matcher"><a href="#åˆ›å»º-matcher" class="headerlink" title="åˆ›å»º matcher"></a>åˆ›å»º matcher</h4><ul>
<li>é€šè¿‡<code>createMatcher</code>ç”Ÿæˆäº†<code>matcher</code></li>
<li>è¿™ä¸ª<code>matcherå¯¹è±¡</code>å°±æ˜¯æœ€åˆèŠçš„åŒ¹é…å™¨ï¼Œè´Ÿè´£ url åŒ¹é…ï¼Œå®ƒæ¥æ”¶äº†<code>routes</code>å’Œ<code>routerå®ä¾‹</code>ï¼›<code>createMatcher</code>é‡Œé¢ä¸å…‰åˆ›å»ºäº†<code>matcher</code>ï¼Œè¿˜åˆ›å»ºäº†<code>è·¯ç”±æ˜ å°„è¡¨RouteMap</code>ï¼Œæˆ‘ä»¬åé¢ç»†çœ‹</li>
</ul>
<h4 id="ç¡®å®šè·¯ç”±æ¨¡å¼"><a href="#ç¡®å®šè·¯ç”±æ¨¡å¼" class="headerlink" title="ç¡®å®šè·¯ç”±æ¨¡å¼"></a>ç¡®å®šè·¯ç”±æ¨¡å¼</h4><ul>
<li>ä¸‰ç§è·¯ç”±æ¨¡å¼æˆ‘ä»¬åé¢ç»†è®²</li>
<li>ç°åœ¨åªéœ€è¦çŸ¥é“<code>VueRouter</code>æ˜¯å¦‚ä½•ç¡®å®šè·¯ç”±æ¨¡å¼çš„</li>
<li><code>VueRouter</code>ä¼šæ ¹æ®<code>options.mode</code>ã€<code>options.fallback</code>ã€<code>supportsPushState</code>ã€<code>inBrowser</code>æ¥ç¡®å®šæœ€ç»ˆçš„è·¯ç”±æ¨¡å¼</li>
<li>å…ˆç¡®å®š<code>fallback</code>ï¼Œ<code>fallback</code>åªæœ‰åœ¨ç”¨æˆ·è®¾ç½®äº†<code>mode:history</code>å¹¶ä¸”å½“å‰ç¯å¢ƒä¸æ”¯æŒ<code>pushState</code>ä¸”ç”¨æˆ·ä¸»åŠ¨å£°æ˜äº†éœ€è¦å›é€€ï¼Œæ­¤æ—¶<code>fallback</code>æ‰ä¸º<code>true</code></li>
<li>å½“<code>fallbackä¸ºtrue</code>æ—¶ä¼šä½¿ç”¨<code>hash</code>æ¨¡å¼ï¼›</li>
<li>å¦‚æœæœ€åå‘ç°å¤„äºéæµè§ˆå™¨ç¯å¢ƒï¼Œåˆ™ä¼šå¼ºåˆ¶ä½¿ç”¨<code>abstract</code>æ¨¡å¼</li>
<li>route-mode.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-mode.png" alt="route-mode.png"></li>
</ul>
</li>
<li><code>inBrowser</code>å’Œ<code>supportsPushState</code>çš„å®ç°éƒ½å¾ˆç®€å•</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/dom.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> inBrowser = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> <span class="comment">// ç›´æ¥åˆ¤æ–­windowæ˜¯å¦å­˜åœ¨ï¼Œæ¥ç¡®å®šæ˜¯å¦åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/util/push-state.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> supportsPushState =</span><br><span class="line">  inBrowser &amp;&amp; <span class="comment">// æµè§ˆå™¨ç¯å¢ƒ</span></span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ua = <span class="built_in">window</span>.navigator.userAgent</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (ua.indexOf(<span class="string">'AndroidÂ 2.'</span>) !== <span class="number">-1</span> || ua.indexOf(<span class="string">'AndroidÂ 4.0'</span>) !== <span class="number">-1</span>) &amp;&amp;</span><br><span class="line">      ua.indexOf(<span class="string">'MobileÂ Safari'</span>) !== <span class="number">-1</span> &amp;&amp;</span><br><span class="line">      ua.indexOf(<span class="string">'Chrome'</span>) === <span class="number">-1</span> &amp;&amp;</span><br><span class="line">      ua.indexOf(<span class="string">'WindowsÂ Phone'</span>) === <span class="number">-1</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// ç‰¹æ®Šæµè§ˆå™¨ç›´æ¥ä¸æ”¯æŒ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.history &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.history.pushState === <span class="string">'function'</span> <span class="comment">// åˆ¤æ–­æ˜¯å¦æ”¯æŒpushState</span></span><br><span class="line">  &#125;)()</span><br></pre></td></tr></table></figure>
<h4 id="æ ¹æ®è·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒçš„-History-å®ä¾‹"><a href="#æ ¹æ®è·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒçš„-History-å®ä¾‹" class="headerlink" title="æ ¹æ®è·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒçš„ History å®ä¾‹"></a>æ ¹æ®è·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒçš„ History å®ä¾‹</h4><ul>
<li>æ ¹æ®ä¸Šä¸€æ­¥çš„è·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒçš„<code>Historyå®ä¾‹</code>ï¼Œå…³äºè·¯ç”±æ¨¡å¼ã€<code>Historyå®ä¾‹</code>åé¢å†è®²</li>
</ul>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li><code>VueRouter</code>çš„æ„é€ å‡½æ•°ä¸»è¦å¹²äº†ä¸‹é¢å‡ ä»¶äº‹<ul>
<li>æ¥æ”¶ä¸€ä¸ª<code>RouterOptions</code></li>
<li>ç„¶åå¯¹ä¸€äº›å±æ€§èµ‹äº†åˆå€¼</li>
<li>ç”Ÿæˆäº†<code>matcher</code>åŒ¹é…å™¨</li>
<li>ç¡®å®šè·¯ç”±æ¨¡å¼</li>
<li>æ ¹æ®ä¸åŒè·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒ<code>Historyå®ä¾‹</code></li>
</ul>
</li>
</ul>
<h3 id="åˆ›å»ºåŒ¹é…å™¨"><a href="#åˆ›å»ºåŒ¹é…å™¨" class="headerlink" title="åˆ›å»ºåŒ¹é…å™¨"></a>åˆ›å»ºåŒ¹é…å™¨</h3><ul>
<li>æˆ‘ä»¬æ¥ç»†çœ‹ä¸€ä¸‹<code>createMatcher</code>é‡Œé¢çš„å®ç°</li>
<li><code>createMatcher</code>çš„å®ç°åœ¨<code>src/create-matcher.js</code>ä¸­</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// src/create-matcher.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// Matcherç±»å‹</span></span><br><span class="line"><span class="keyword">export</span>Â <span class="keyword">type</span>Â MatcherÂ =Â &#123;</span><br><span class="line">Â Â match:Â <span class="function">(<span class="params">raw:Â RawLocation,Â current?:Â Route,Â redirectedFrom?:Â Location</span>)Â =&gt;</span>Â Route; <span class="comment">// åŒ¹é…æ–¹æ³•</span></span><br><span class="line">Â Â addRoutes:Â <span class="function">(<span class="params">routes:Â <span class="built_in">Array</span>&lt;RouteConfig&gt;</span>)Â =&gt;</span>Â <span class="built_in">void</span>; <span class="comment">// æ·»åŠ Routeæ–¹æ³•</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Matcherå·¥å‚å‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span>Â <span class="function"><span class="keyword">function</span>Â <span class="title">createMatcher</span>Â (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">Â Â routes:Â <span class="built_in">Array</span>&lt;RouteConfig&gt;,Â <span class="comment">//Â è·¯ç”±é…ç½®åˆ—è¡¨</span></span></span></span><br><span class="line"><span class="function"><span class="params">Â Â router:Â VueRouterÂ <span class="comment">//Â VueRouterå®ä¾‹</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>):Â <span class="title">Matcher</span>Â </span>&#123;</span><br><span class="line">Â Â <span class="keyword">const</span>Â &#123;Â pathList,Â pathMap,Â nameMapÂ &#125;Â =Â createRouteMap(routes)Â <span class="comment">//Â åˆ›å»ºè·¯ç”±æ˜ å°„è¡¨</span></span><br><span class="line">Â Â <span class="comment">//Â æ·»åŠ è·¯ç”±</span></span><br><span class="line">Â Â <span class="function"><span class="keyword">function</span>Â <span class="title">addRoutes</span>Â (<span class="params">routes</span>)Â </span>&#123;</span><br><span class="line">Â Â Â Â <span class="comment">//Â ç”±äºä¼ å…¥pathList,Â pathMap,Â nameMapäº†ï¼Œæ‰€ä»¥createRouteMapæ–¹æ³•ä¼šæ‰§è¡Œæ·»åŠ é€»è¾‘</span></span><br><span class="line">Â Â Â Â createRouteMap(routes,Â pathList,Â pathMap,Â nameMap)</span><br><span class="line">Â Â &#125;</span><br><span class="line">Â Â <span class="comment">//Â ä¼ å…¥location,è¿”å›åŒ¹é…çš„Routeå¯¹è±¡</span></span><br><span class="line">Â Â <span class="function"><span class="keyword">function</span>Â <span class="title">match</span>Â (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">Â Â Â Â raw:Â RawLocation,</span></span></span><br><span class="line"><span class="function"><span class="params">Â Â Â Â currentRoute?:Â Route,</span></span></span><br><span class="line"><span class="function"><span class="params">Â Â Â Â redirectedFrom?:Â Location</span></span></span><br><span class="line"><span class="function"><span class="params">Â Â </span>):Â <span class="title">Route</span>Â </span>&#123;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â &#125;</span><br><span class="line">Â Â </span><br><span class="line">Â Â <span class="comment">//Â è¿”å›Matcherå¯¹è±¡ï¼Œæš´éœ²matchã€addRoutesæ–¹æ³•</span></span><br><span class="line">Â Â <span class="keyword">return</span>Â &#123;</span><br><span class="line">Â Â Â Â match,</span><br><span class="line">Â Â Â Â addRoutes</span><br><span class="line">Â Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œ<code>createMatcher</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ªè·¯ç”±é…ç½®è§„åˆ™åˆ—è¡¨å’Œ<code>routerå®ä¾‹</code>ï¼Œè¿”å›ä¸€ä¸ª<code>Matcher</code>å¯¹è±¡</li>
<li><code>Matcher</code>å¯¹è±¡åŒ…å«ä¸€ä¸ªç”¨äºåŒ¹é…çš„<code>match</code>æ–¹æ³•å’Œä¸€ä¸ªåŠ¨æ€æ·»åŠ è·¯ç”±çš„<code>addRoutes</code>æ–¹æ³•ï¼›<ul>
<li>è€Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å£°æ˜åœ¨<code>createMatcher</code>å†…éƒ¨ï¼Œç”±äºé—­åŒ…ç‰¹æ€§ï¼Œå®ƒèƒ½è®¿é—®åˆ°<code>createMatcher</code>ä½œç”¨åŸŸçš„æ‰€æœ‰å˜é‡</li>
</ul>
</li>
</ul>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>æˆ‘ä»¬æ€»ç»“ä¸‹<code>createMatcher</code>çš„é€»è¾‘</li>
<li>create-matcher.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/create-matcher.png" alt="create-matcher.png"></li>
</ul>
</li>
<li>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>createMatcher</code>å’Œ<code>addRoutes</code>æ–¹æ³•ä¸­éƒ½è°ƒç”¨äº†<code>createRouteMap</code>æ–¹æ³•ï¼ŒäºŒè€…åªæ˜¯ä¼ é€’çš„å‚æ•°ä¸åŒï¼Œä»æ–¹æ³•åçœ‹ï¼Œè¿™ä¸ªæ–¹æ³•è‚¯å®šå’Œ<code>è·¯ç”±è¡¨RouteMap</code>æœ‰å…³</li>
<li>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹<code>createRouteMap</code>çš„å®ç°</li>
</ul>
<h3 id="createRouteMap"><a href="#createRouteMap" class="headerlink" title="createRouteMap"></a>createRouteMap</h3><ul>
<li><code>createRouteMap</code>æ–¹æ³•ä½äº<code>src/create-route-map.js</code>ä¸­</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â åˆ›å»ºè·¯ç”±æ˜ å°„mapã€æ·»åŠ è·¯ç”±è®°å½•</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createRouteMap</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  routes: <span class="built_in">Array</span>&lt;RouteConfig&gt;, <span class="comment">//Â è·¯ç”±é…ç½®åˆ—è¡¨</span></span></span></span><br><span class="line"><span class="function"><span class="params">  oldPathList?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;, <span class="comment">//Â æ—§pathList</span></span></span></span><br><span class="line"><span class="function"><span class="params">  oldPathMap?: Dictionary&lt;RouteRecord&gt;, <span class="comment">//Â æ—§pathMap</span></span></span></span><br><span class="line"><span class="function"><span class="params">  oldNameMap?: Dictionary&lt;RouteRecord&gt; <span class="comment">//Â æ—§nameMap</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): </span>&#123;</span><br><span class="line">  pathList: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  pathMap: Dictionary&lt;RouteRecord&gt;</span><br><span class="line">  nameMap: Dictionary&lt;RouteRecord&gt;</span><br><span class="line">&#125; &#123;</span><br><span class="line">  <span class="comment">//Â è‹¥æ—§çš„è·¯ç”±ç›¸å…³æ˜ å°„åˆ—è¡¨åŠmapå­˜åœ¨ï¼Œåˆ™ä½¿ç”¨æ—§çš„åˆå§‹åŒ–ï¼ˆå€Ÿæ­¤å®ç°æ·»åŠ è·¯ç”±åŠŸèƒ½ï¼‰</span></span><br><span class="line">  <span class="comment">//Â theÂ pathÂ listÂ isÂ usedÂ toÂ controlÂ pathÂ matchingÂ priority</span></span><br><span class="line">  <span class="keyword">const</span> pathList: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt; = oldPathList || [] <span class="comment">//Â $flow-disable-line</span></span><br><span class="line">  <span class="keyword">const</span> pathMap: Dictionary&lt;RouteRecord&gt; = oldPathMap || <span class="built_in">Object</span>.create(<span class="literal">null</span>) <span class="comment">//Â $flow-disable-line</span></span><br><span class="line">  <span class="keyword">const</span> nameMap: Dictionary&lt;RouteRecord&gt; = oldNameMap || <span class="built_in">Object</span>.create(<span class="literal">null</span>) <span class="comment">//Â éå†è·¯ç”±é…ç½®å¯¹è±¡ï¼Œç”Ÿæˆ/æ·»åŠ è·¯ç”±è®°å½•</span></span><br><span class="line"></span><br><span class="line">  routes.forEach(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">    addRouteRecord(pathList, pathMap, nameMap, route)</span><br><span class="line">  &#125;) <span class="comment">//Â ensureÂ wildcardÂ routesÂ areÂ alwaysÂ atÂ theÂ end //Â ç¡®ä¿path:*æ°¸è¿œåœ¨åœ¨æœ€å</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = pathList.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pathList[i] === <span class="string">'*'</span>) &#123;</span><br><span class="line">      pathList.push(pathList.splice(i, <span class="number">1</span>)[<span class="number">0</span>])</span><br><span class="line">      l--</span><br><span class="line">      i--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//Â å¼€å‘ç¯å¢ƒï¼Œæç¤ºéåµŒå¥—è·¯ç”±çš„pathå¿…é¡»ä»¥/æˆ–è€…*å¼€å¤´</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">    <span class="comment">//Â warnÂ ifÂ routesÂ doÂ notÂ includeÂ leadingÂ slashes</span></span><br><span class="line">    <span class="keyword">const</span> found = pathList <span class="comment">//Â checkÂ forÂ missingÂ leadingÂ slash</span></span><br><span class="line">      .filter(</span><br><span class="line">        (path) =&gt; path &amp;&amp; path.charAt(<span class="number">0</span>) !== <span class="string">'*'</span> &amp;&amp; path.charAt(<span class="number">0</span>) !== <span class="string">'/'</span></span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">if</span> (found.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> pathNames = found.map(<span class="function">(<span class="params">path</span>) =&gt;</span> <span class="string">`-Â <span class="subst">$&#123;path&#125;</span>`</span>).join(<span class="string">'\n'</span>)</span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`Non-nestedÂ routesÂ mustÂ includeÂ aÂ leadingÂ slashÂ character.Â FixÂ theÂ followingÂ routes:Â \n<span class="subst">$&#123;pathNames&#125;</span>`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pathList,</span><br><span class="line">    pathMap,</span><br><span class="line">    nameMap,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°<code>createRouteMap</code>è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«<code>pathList</code>ã€<code>pathMap</code>å’Œ<code>nameMap</code></li>
<li><code>pathList</code>ä¸­å­˜å‚¨äº†<code>routes</code>ä¸­çš„æ‰€æœ‰<code>path</code></li>
<li><code>pathMap</code>ç»´æŠ¤çš„æ˜¯<code>path</code>å’Œ<code>è·¯ç”±è®°å½•RouteRecord</code>çš„æ˜ å°„</li>
<li><code>nameMap</code>ç»´æŠ¤çš„æ˜¯<code>name</code>å’Œ<code>è·¯ç”±è®°å½•RouteRecord</code>çš„æ˜ å°„<ul>
<li>å› ä¸º<code>VueRouter</code>æ”¯æŒå‘½åè·¯ç”±</li>
</ul>
</li>
<li>åä¸¤è€…ï¼Œéƒ½æ˜¯ä¸ºäº†å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„<code>è·¯ç”±è®°å½•</code></li>
<li>å¯ä»¥çœ‹ä¸‹ä½¿ç”¨ä¸‹é¢çš„<code>routes</code>è°ƒç”¨<code>createRouteMap</code>ä¼šè¿”å›ä»€ä¹ˆ</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">component</span>: Home &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/foo'</span>,</span><br><span class="line">    component: Foo,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'child'</span>,</span><br><span class="line">        component: FooChild,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/bar/:dynamic'</span>, <span class="attr">component</span>: Bar &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>route-map-obj.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-map-obj.png" alt="route-map-obj.png"></li>
</ul>
</li>
<li>ç”±äºæ²¡æœ‰å‘½åè·¯ç”±ï¼Œæ‰€ä»¥<code>nameMap</code>ä¸ºç©º</li>
<li><code>pathList</code>å­˜å‚¨äº†æ‰€æœ‰<code>path</code>ï¼Œæœ‰ä¸ªä¸ºç©ºï¼Œå…¶å®æ˜¯<code>/</code>ï¼Œåœ¨<code>normalizePath</code>æ—¶è¢«åˆ é™¤äº†</li>
<li><code>pathMap</code>è®°å½•äº†æ¯ä¸ª<code>path</code>å’Œ<code>å¯¹åº”RouteRecord</code>çš„æ˜ å°„å…³ç³»</li>
</ul>
<h4 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li><code>VueRouter</code>çš„è·¯ç”±æ˜ å°„è¡¨ç”±ä¸‰éƒ¨åˆ†ç»„æˆ:<code>pathList</code>ã€<code>pathMap</code>ã€<code>nameMap</code>ï¼›åä¸¤è€…æ˜¯ç”¨æ¥å¿«é€ŸæŸ¥æ‰¾çš„</li>
<li><code>createRouteMap</code>çš„é€»è¾‘<ul>
<li>å…ˆåˆ¤æ–­è·¯ç”±ç›¸å…³æ˜ å°„è¡¨æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™ä½¿ç”¨ï¼Œå¦åˆ™æ–°å»ºï¼›<ul>
<li>è¿™å°±å®ç°äº†<code>createRouteMap</code>åˆ›å»º/æ–°å¢çš„åŒé‡åŠŸèƒ½</li>
</ul>
</li>
<li>ç„¶åéå†<code>routes</code>ï¼Œä¾æ¬¡ä¸ºæ¯ä¸ª<code>route</code>è°ƒç”¨<code>addRouteRecord</code>ç”Ÿæˆä¸€ä¸ª<code>RouteRecord</code>å¹¶æ›´æ–°<code>pathList</code>ã€<code>pathMap</code>å’Œ<code>nameMap</code></li>
<li>ç”±äº<code>pathList</code>åœ¨åç»­é€»è¾‘ä¼šç”¨æ¥éå†åŒ¹é…ï¼Œä¸ºäº†æ€§èƒ½ï¼Œæ‰€ä»¥éœ€è¦å°†<code>path:*</code>æ”¾ç½®åˆ°<code>pathList</code>çš„æœ€å</li>
<li>æœ€åæ£€æŸ¥éåµŒå¥—è·¯ç”±çš„<code>path</code>æ˜¯å¦æ˜¯ä»¥<code>/</code>æˆ–è€…<code>*</code>å¼€å¤´</li>
</ul>
</li>
<li>ç”¨å›¾æ€»ç»“å¦‚ä¸‹</li>
<li>create-route-map-sequence.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/create-route-map-sequence.png" alt="create-route-map-sequence.png"></li>
</ul>
</li>
<li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹è·¯ç”±è®°å½•æ˜¯å¦‚ä½•ç”Ÿæˆçš„</li>
</ul>
<h3 id="addRouteRecord"><a href="#addRouteRecord" class="headerlink" title="addRouteRecord"></a>addRouteRecord</h3><ul>
<li>è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯åˆ›å»ºè·¯ç”±è®°å½•å¹¶æ›´æ–°è·¯ç”±æ˜ å°„è¡¨</li>
<li>ä½äº<code>src/create-route-map.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-route-map.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æ·»åŠ è·¯ç”±è®°å½•ï¼Œæ›´æ–°pathListã€pathMapã€nameMap</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addRouteRecord</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  pathList: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  pathMap: Dictionary&lt;RouteRecord&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  nameMap: Dictionary&lt;RouteRecord&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  route: RouteConfig,</span></span></span><br><span class="line"><span class="function"><span class="params">  parent?: RouteRecord, <span class="comment">//Â çˆ¶è·¯ç”±æ—¶è®°å½•</span></span></span></span><br><span class="line"><span class="function"><span class="params">  matchAs?: <span class="built_in">string</span> <span class="comment">//Â å¤„ç†åˆ«åè·¯ç”±æ—¶ä½¿ç”¨</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; path, name &#125; = route</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="comment">//Â route.pathä¸èƒ½ä¸ºç©º</span></span><br><span class="line">    assert(path != <span class="literal">null</span>, <span class="string">`"path"Â isÂ requiredÂ inÂ aÂ routeÂ configuration.`</span>) <span class="comment">//Â route.componentä¸èƒ½ä¸ºstring</span></span><br><span class="line"></span><br><span class="line">    assert(</span><br><span class="line">      <span class="keyword">typeof</span> route.component !== <span class="string">'string'</span>,</span><br><span class="line">      <span class="string">`routeÂ configÂ "component"Â forÂ path:Â <span class="subst">$&#123;String(</span></span></span><br><span class="line"><span class="string"><span class="subst">        path || name</span></span></span><br><span class="line"><span class="string"><span class="subst">      )&#125;</span>Â cannotÂ beÂ aÂ `</span> + <span class="string">`stringÂ id.Â UseÂ anÂ actualÂ componentÂ instead.`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> pathToRegexpOptions: PathToRegexpOptions =</span><br><span class="line">    route.pathToRegexpOptions || &#123;&#125; <span class="comment">//Â ç”Ÿæˆæ ¼å¼åŒ–åçš„path(å­è·¯ç”±ä¼šæ‹¼æ¥ä¸Šçˆ¶è·¯ç”±çš„path)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> normalizedPath = normalizePath(path, parent, pathToRegexpOptions.strict)</span><br><span class="line">  <span class="comment">//Â åŒ¹é…è§„åˆ™æ˜¯å¦å¤§å°å†™æ•æ„Ÿï¼Ÿ(é»˜è®¤å€¼ï¼šfalse)</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> route.caseSensitive === <span class="string">'boolean'</span>) &#123;</span><br><span class="line">    pathToRegexpOptions.sensitive = route.caseSensitive</span><br><span class="line">  &#125; <span class="comment">//Â ç”Ÿæˆä¸€æ¡è·¯ç”±è®°å½•</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> record: RouteRecord = &#123;</span><br><span class="line">    path: normalizedPath,</span><br><span class="line">    regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), <span class="comment">//Â åˆ©ç”¨path-to-regexpåŒ…ç”Ÿæˆç”¨æ¥åŒ¹é…pathçš„å¢å¼ºæ­£åˆ™å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥åŒ¹é…åŠ¨æ€è·¯ç”±</span></span><br><span class="line">    components: route.components || &#123; <span class="keyword">default</span>: route.component &#125;, <span class="comment">//Â ä¿å­˜è·¯ç”±ç»„ä»¶ï¼Œæ”¯æŒå‘½åè§†å›¾https://router.vuejs.org/zh/guide/essentials/named-views.html#å‘½åè§†å›¾</span></span><br><span class="line">    instances: &#123;&#125;, <span class="comment">//Â ä¿å­˜router-viewå®ä¾‹</span></span><br><span class="line">    name,</span><br><span class="line">    parent,</span><br><span class="line">    matchAs,</span><br><span class="line">    redirect: route.redirect, <span class="comment">//Â é‡å®šå‘çš„è·¯ç”±é…ç½®å¯¹è±¡</span></span><br><span class="line">    beforeEnter: route.beforeEnter, <span class="comment">//Â è·¯ç”±ç‹¬äº«çš„å®ˆå«</span></span><br><span class="line">    meta: route.meta || &#123;&#125;, <span class="comment">//Â å…ƒä¿¡æ¯</span></span><br><span class="line">    <span class="comment">//Â åŠ¨æ€è·¯ç”±ä¼ å‚ï¼›https://router.vuejs.org/zh/guide/essentials/passing-props.html#è·¯ç”±ç»„ä»¶ä¼ å‚</span></span><br><span class="line">    props:</span><br><span class="line">      route.props == <span class="literal">null</span></span><br><span class="line">        ? &#123;&#125;</span><br><span class="line">        : route.components <span class="comment">//Â å‘½åè§†å›¾çš„ä¼ å‚è§„åˆ™éœ€è¦ä½¿ç”¨route.propsæŒ‡å®šçš„è§„åˆ™</span></span><br><span class="line">        ? route.props</span><br><span class="line">        : &#123; <span class="keyword">default</span>: route.props &#125;,</span><br><span class="line">  &#125; <span class="comment">//Â å¤„ç†æœ‰å­è·¯ç”±æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (route.children) &#123;</span><br><span class="line">    <span class="comment">//Â WarnÂ ifÂ routeÂ isÂ named,Â doesÂ notÂ redirectÂ andÂ hasÂ aÂ defaultÂ childÂ route.</span></span><br><span class="line">    <span class="comment">//Â IfÂ usersÂ navigateÂ toÂ thisÂ routeÂ byÂ name,Â theÂ defaultÂ childÂ will</span></span><br><span class="line">    <span class="comment">//Â notÂ beÂ renderedÂ (GHÂ IssueÂ #629)</span></span><br><span class="line">    <span class="comment">//Â https://github.com/vuejs/vue-router/issues/629</span></span><br><span class="line">    <span class="comment">//Â å‘½åè·¯ç”±Â &amp;&amp;Â æœªä½¿ç”¨é‡å®šå‘Â &amp;&amp;Â å­è·¯ç”±é…ç½®å¯¹è±¡pathä¸º''æˆ–/æ—¶ï¼Œä½¿ç”¨çˆ¶è·¯ç”±çš„nameè·³è½¬æ—¶ï¼Œå­è·¯ç”±å°†ä¸ä¼šè¢«æ¸²æŸ“</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        route.name &amp;&amp;</span><br><span class="line">        !route.redirect &amp;&amp;</span><br><span class="line">        route.children.some(<span class="function">(<span class="params">child</span>) =&gt;</span> /^\/?$/.test(child.path))</span><br><span class="line">      ) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="literal">false</span>,</span><br><span class="line">          <span class="string">`NamedÂ RouteÂ '<span class="subst">$&#123;route.name&#125;</span>'Â hasÂ aÂ defaultÂ childÂ route.Â `</span> +</span><br><span class="line">            <span class="string">`WhenÂ navigatingÂ toÂ thisÂ namedÂ routeÂ (:to="&#123;name:Â '<span class="subst">$&#123;route.name&#125;</span>'"),Â `</span> +</span><br><span class="line">            <span class="string">`theÂ defaultÂ childÂ routeÂ willÂ notÂ beÂ rendered.Â RemoveÂ theÂ nameÂ fromÂ `</span> +</span><br><span class="line">            <span class="string">`thisÂ routeÂ andÂ useÂ theÂ nameÂ ofÂ theÂ defaultÂ childÂ routeÂ forÂ namedÂ `</span> +</span><br><span class="line">            <span class="string">`linksÂ instead.`</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">//Â éå†ç”Ÿæˆå­è·¯ç”±è®°å½•</span></span><br><span class="line"></span><br><span class="line">    route.children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> childMatchAs = matchAs <span class="comment">//Â matchAsè‹¥æœ‰å€¼ï¼Œä»£è¡¨å½“å‰è·¯ç”±æ˜¯åˆ«åè·¯ç”±ï¼Œåˆ™éœ€è¦å•ç‹¬ç”Ÿæˆåˆ«åè·¯ç”±çš„å­è·¯ç”±ï¼Œè·¯å¾„å‰ç¼€éœ€ä½¿ç”¨matchAs</span></span><br><span class="line">        ? cleanPath(<span class="string">`<span class="subst">$&#123;matchAs&#125;</span>/<span class="subst">$&#123;child.path&#125;</span>`</span>)</span><br><span class="line">        : <span class="literal">undefined</span></span><br><span class="line">      addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="comment">//Â è‹¥pathMapä¸­ä¸å­˜åœ¨å½“å‰è·¯å¾„ï¼Œåˆ™æ›´æ–°pathListå’ŒpathMap</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!pathMap[record.path]) &#123;</span><br><span class="line">    pathList.push(record.path)</span><br><span class="line">    pathMap[record.path] = record</span><br><span class="line">  &#125; <span class="comment">//Â å¤„ç†åˆ«åï¼›https://router.vuejs.org/zh/guide/essentials/redirect-and-alias.html#%E5%88%AB%E5%90%8D</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (route.alias !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> aliases = <span class="built_in">Array</span>.isArray(route.alias) ? route.alias : [route.alias] <span class="comment">//Â aliasæ”¯æŒstringï¼Œå’ŒArray&lt;String&gt;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; aliases.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">const</span> alias = aliases[i]</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; alias === path) &#123;</span><br><span class="line">        <span class="comment">//Â aliasçš„å€¼å’Œpathé‡å¤ï¼Œéœ€è¦ç»™æç¤º</span></span><br><span class="line">        warn(</span><br><span class="line">          <span class="literal">false</span>,</span><br><span class="line">          <span class="string">`FoundÂ anÂ aliasÂ withÂ theÂ sameÂ valueÂ asÂ theÂ path:Â "<span class="subst">$&#123;path&#125;</span>".Â YouÂ haveÂ toÂ removeÂ thatÂ alias.Â ItÂ willÂ beÂ ignoredÂ inÂ development.`</span></span><br><span class="line">        ) <span class="comment">//Â skipÂ inÂ devÂ toÂ makeÂ itÂ work</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125; <span class="comment">//Â ç”Ÿæˆåˆ«åè·¯ç”±é…ç½®å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> aliasRoute = &#123;</span><br><span class="line">        path: alias,</span><br><span class="line">        children: route.children,</span><br><span class="line">      &#125; <span class="comment">//Â æ·»åŠ åˆ«åè·¯ç”±è®°å½•</span></span><br><span class="line"></span><br><span class="line">      addRouteRecord(</span><br><span class="line">        pathList,</span><br><span class="line">        pathMap,</span><br><span class="line">        nameMap,</span><br><span class="line">        aliasRoute, <span class="comment">//Â åˆ«åè·¯ç”±</span></span><br><span class="line">        parent, <span class="comment">//Â å½“å‰è·¯ç”±çš„çˆ¶è·¯ç”±ï¼Œå› ä¸ºæ˜¯ç»™å½“å‰è·¯ç”±å–äº†ä¸ªåˆ«åï¼Œæ‰€ä»¥äºŒè€…å…¶å®æ˜¯æœ‰åŒä¸ªçˆ¶è·¯ç”±çš„</span></span><br><span class="line">        record.path || <span class="string">'/'</span> <span class="comment">//Â matchAsï¼Œç”¨æ¥ç”Ÿæˆåˆ«åè·¯ç”±çš„å­è·¯ç”±ï¼›</span></span><br><span class="line">      ) <span class="comment">//Â !Â æ€»ç»“ï¼šå½“å‰è·¯ç”±è®¾ç½®äº†aliasåï¼Œä¼šå•ç‹¬ä¸ºå½“å‰è·¯ç”±åŠå…¶æ‰€æœ‰å­è·¯ç”±ç”Ÿæˆè·¯ç”±è®°å½•ï¼Œä¸”å­è·¯ç”±çš„pathå‰ç¼€ä¸ºmatchAs(å³åˆ«åè·¯ç”±çš„path)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//Â å¤„ç†å‘½åè·¯ç”±</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (name) &#123;</span><br><span class="line">    <span class="comment">//Â æ›´æ–°nameMap</span></span><br><span class="line">    <span class="keyword">if</span> (!nameMap[name]) &#123;</span><br><span class="line">      nameMap[name] = record</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !matchAs) &#123;</span><br><span class="line">      <span class="comment">//Â è·¯ç”±é‡åè­¦å‘Š</span></span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`DuplicateÂ namedÂ routesÂ definition:Â `</span> +</span><br><span class="line">          <span class="string">`&#123;Â name:Â "<span class="subst">$&#123;name&#125;</span>",Â path:Â "<span class="subst">$&#123;record.path&#125;</span>"Â &#125;`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>çœ‹ä¸‹é€»è¾‘<ul>
<li>æ£€æŸ¥äº†è·¯ç”±è§„åˆ™ä¸­çš„<code>path</code>å’Œ<code>component</code></li>
<li>ç”Ÿæˆ<code>path-to-regexp</code>çš„é€‰é¡¹<code>pathToRegexpOptions</code></li>
<li>æ ¼å¼åŒ–<code>path</code>ï¼Œå¦‚æœæ˜¯åµŒå¥—è·¯ç”±ï¼Œåˆ™ä¼šè¿½åŠ ä¸Šçˆ¶è·¯ç”±çš„<code>path</code></li>
<li>ç”Ÿæˆè·¯ç”±è®°å½•</li>
<li>å¤„ç†åµŒå¥—è·¯ç”±ï¼Œé€’å½’ç”Ÿæˆå­è·¯ç”±è®°å½•</li>
<li>æ›´æ–°<code>pathList</code>ã€<code>pathMap</code></li>
<li>å¤„ç†åˆ«åè·¯ç”±ï¼Œç”Ÿæˆåˆ«åè·¯ç”±è®°å½•</li>
<li>å¤„ç†å‘½åè·¯ç”±ï¼Œæ›´æ–°<code>nameMap</code></li>
</ul>
</li>
<li>æˆ‘ä»¬æ¥çœ‹ä¸‹å‡ ä¸ªæ ¸å¿ƒé€»è¾‘</li>
</ul>
<h4 id="ç”Ÿæˆè·¯ç”±è®°å½•"><a href="#ç”Ÿæˆè·¯ç”±è®°å½•" class="headerlink" title="ç”Ÿæˆè·¯ç”±è®°å½•"></a>ç”Ÿæˆè·¯ç”±è®°å½•</h4><ul>
<li>è·¯ç”±è®°å½•è®°å½•äº†è·¯ç”±çš„æ ¸å¿ƒä¿¡æ¯</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> record: RouteRecord = &#123;</span><br><span class="line">  path: normalizedPath, <span class="comment">// è§„èŒƒåŒ–åçš„è·¯å¾„</span></span><br><span class="line">  regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), <span class="comment">//Â åˆ©ç”¨path-to-regexpåŒ…ç”Ÿæˆç”¨æ¥åŒ¹é…pathçš„å¢å¼ºæ­£åˆ™å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥åŒ¹é…åŠ¨æ€è·¯ç”±</span></span><br><span class="line">  components: route.components || &#123; <span class="keyword">default</span>: route.component &#125;, <span class="comment">//Â ä¿å­˜è·¯ç”±ç»„ä»¶ï¼Œæ”¯æŒå‘½åè§†å›¾https://router.vuejs.org/zh/guide/essentials/named-views.html#å‘½åè§†å›¾</span></span><br><span class="line">  instances: &#123;&#125;, <span class="comment">//Â ä¿å­˜router-viewå®ä¾‹</span></span><br><span class="line">  name,</span><br><span class="line">  parent, <span class="comment">// çˆ¶è·¯ç”±è®°å½•</span></span><br><span class="line">  matchAs, <span class="comment">// åˆ«åè·¯ç”±éœ€è¦ä½¿ç”¨</span></span><br><span class="line">  redirect: route.redirect, <span class="comment">//Â é‡å®šå‘çš„è·¯ç”±é…ç½®å¯¹è±¡</span></span><br><span class="line">  beforeEnter: route.beforeEnter, <span class="comment">//Â è·¯ç”±ç‹¬äº«çš„å®ˆå«</span></span><br><span class="line">  meta: route.meta || &#123;&#125;, <span class="comment">//Â å…ƒä¿¡æ¯</span></span><br><span class="line">  <span class="comment">//Â åŠ¨æ€è·¯ç”±ä¼ å‚ï¼›https://router.vuejs.org/zh/guide/essentials/passing-props.html#è·¯ç”±ç»„ä»¶ä¼ å‚</span></span><br><span class="line">  props:</span><br><span class="line">    route.props == <span class="literal">null</span></span><br><span class="line">      ? &#123;&#125;</span><br><span class="line">      : route.components <span class="comment">//Â å‘½åè§†å›¾çš„ä¼ å‚è§„åˆ™éœ€è¦ä½¿ç”¨route.propsæŒ‡å®šçš„è§„åˆ™</span></span><br><span class="line">      ? route.props</span><br><span class="line">      : &#123; <span class="keyword">default</span>: route.props &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>è·¯ç”±è®°å½•æœ‰ä¸ª<code>regex</code>å­—æ®µï¼Œå®ƒæ˜¯ä¸€ä¸ªå¢å¼ºçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒæ˜¯å®ç°åŠ¨æ€è·¯ç”±åŒ¹é…çš„å…³é”®</li>
<li><code>regex</code>æ˜¯é€šè¿‡<code>compileRouteRegex</code>æ–¹æ³•è¿”å›çš„ï¼Œå®ƒé‡Œé¢è°ƒç”¨äº†<code>path-to-regexp</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>Â RegexpÂ <span class="keyword">from</span>Â <span class="string">'path-to-regexp'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â ä½¿ç”¨path-to-regexpåŒ…ï¼Œç”Ÿæˆrouteå¯¹åº”çš„æ­£åˆ™ï¼Œå¯ä»¥ç”¨æ¥ç”ŸæˆåŠ¨æ€è·¯ç”±éœ€è¦çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">compileRouteRegex</span>Â (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">Â Â path:Â <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">Â Â pathToRegexpOptions:Â PathToRegexpOptions</span></span></span><br><span class="line"><span class="function"><span class="params"></span>):Â <span class="title">RouteRegExp</span>Â </span>&#123;</span><br><span class="line"></span><br><span class="line">Â Â <span class="keyword">const</span>Â regexÂ =Â Regexp(path,Â [],Â pathToRegexpOptions)</span><br><span class="line">Â Â <span class="keyword">if</span>Â (process.env.NODE_ENVÂ !==Â <span class="string">'production'</span>)Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â keys:Â <span class="built_in">any</span>Â =Â <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">Â Â Â Â regex.keys.forEach(<span class="function"><span class="params">key</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â <span class="comment">//Â é‡å¤keyæµ¸è†</span></span><br><span class="line">Â Â Â Â Â Â warn(</span><br><span class="line">Â Â Â Â Â Â Â Â !keys[key.name],</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="string">`DuplicateÂ paramÂ keysÂ inÂ routeÂ withÂ path:Â "<span class="subst">$&#123;path&#125;</span>"`</span></span><br><span class="line">Â Â Â Â Â Â )</span><br><span class="line">Â Â Â Â Â Â keys[key.name]Â =Â <span class="literal">true</span></span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line">Â Â &#125;</span><br><span class="line">Â Â <span class="keyword">return</span>Â regex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ‘ä»¬çœ‹ä¸‹<code>path-to-regexp</code>æ˜¯å¦‚ä½•ä½¿ç”¨çš„</li>
<li>å®˜ç½‘æ˜¯:<a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="noopener">https://www.npmjs.com/package/path-to-regexp</a></li>
<li>Regexp æ¥æ”¶ä¸‰ä¸ªå‚æ•°<code>pathï¼Œkeysï¼Œoptions</code>ï¼›<code>path</code>ä¸ºéœ€è¦è½¬æ¢ä¸ºæ­£åˆ™çš„è·¯å¾„ï¼Œ<code>keys</code>ï¼Œæ˜¯ç”¨æ¥æ¥æ”¶åœ¨<code>path</code>ä¸­æ‰¾åˆ°çš„<code>key</code>ï¼Œå¯ä»¥ä¼ å…¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿”å›å€¼ä¸Šçš„<code>keys</code>å±æ€§ï¼Œ<code>options</code>ä¸ºé€‰é¡¹</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pathToRegexp = <span class="built_in">require</span>(<span class="string">'path-to-regexp'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> regexp = pathToRegexp(<span class="string">'/foo/:bar'</span>) <span class="comment">// regexpÂ =Â /^\/foo\/([^\/]+?)\/?$/i</span></span><br><span class="line"><span class="comment">// :barè¢«å¤„ç†æˆæ­£åˆ™çš„ä¸€ä¸ªç»„äº†ï¼Œå½“æ­£åˆ™è¢«æ‰§è¡Œæ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ç»„å–åˆ°barå¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="built_in">console</span>.log(regexp.keys) <span class="comment">// keysÂ =Â [&#123;Â name:Â 'bar',Â prefix:Â '/',Â suffix:Â '',Â pattern:Â '[^\\/#\\?]+?',Â modifier:Â ''Â &#125;]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡ä¸‹é¢çš„ä¾‹å­ï¼Œå°±å¯ä»¥çŸ¥é“åŠ¨æ€è·¯ç”±è·å–å‚æ•°å€¼æ˜¯å¦‚ä½•å®ç°çš„</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pathToRegexp = <span class="built_in">require</span>(<span class="string">'path-to-regexp'</span>)</span><br><span class="line"><span class="keyword">const</span> regexp = pathToRegexp(<span class="string">'/foo/:bar'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(regexp.keys) <span class="comment">// è®°å½•äº†keyä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> m = <span class="string">'/foo/test'</span>.match(regexp) <span class="comment">// æ­£åˆ™çš„ç»„è®°å½•äº†valueä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'key:'</span>, regexp.keys[<span class="number">0</span>].name, <span class="string">',value:'</span>, m[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<ul>
<li>path-to-regex-demo.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/path-to-regex-demo.png" alt="path-to-regex-demo.png"></li>
</ul>
</li>
</ul>
<h4 id="ç”ŸæˆåµŒå¥—è·¯ç”±è®°å½•"><a href="#ç”ŸæˆåµŒå¥—è·¯ç”±è®°å½•" class="headerlink" title="ç”ŸæˆåµŒå¥—è·¯ç”±è®°å½•"></a>ç”ŸæˆåµŒå¥—è·¯ç”±è®°å½•</h4><ul>
<li>æˆ‘ä»¬çŸ¥é“<code>vue-router</code>æ˜¯æ”¯æŒåµŒå¥—è·¯ç”±çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦‚ä½•ç”ŸæˆåµŒå¥—è·¯ç”±è®°å½•çš„</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-route-map</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â å¤„ç†æœ‰å­è·¯ç”±æƒ…å†µ</span></span><br><span class="line"><span class="keyword">if</span> (route.children) &#123;</span><br><span class="line">  <span class="comment">//Â WarnÂ ifÂ routeÂ isÂ named,Â doesÂ notÂ redirectÂ andÂ hasÂ aÂ defaultÂ childÂ route.</span></span><br><span class="line">  <span class="comment">//Â IfÂ usersÂ navigateÂ toÂ thisÂ routeÂ byÂ name,Â theÂ defaultÂ childÂ will</span></span><br><span class="line">  <span class="comment">//Â notÂ beÂ renderedÂ (GHÂ IssueÂ #629)</span></span><br><span class="line">  <span class="comment">//Â https://github.com/vuejs/vue-router/issues/629</span></span><br><span class="line">  <span class="comment">//Â å‘½åè·¯ç”±Â &amp;&amp;Â æœªä½¿ç”¨é‡å®šå‘Â &amp;&amp;Â å­è·¯ç”±é…ç½®å¯¹è±¡pathä¸º''æˆ–/æ—¶ï¼Œä½¿ç”¨çˆ¶è·¯ç”±çš„nameè·³è½¬æ—¶ï¼Œå­è·¯ç”±å°†ä¸ä¼šè¢«æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      route.name &amp;&amp;</span><br><span class="line">      !route.redirect &amp;&amp;</span><br><span class="line">      route.children.some(<span class="function">(<span class="params">child</span>) =&gt;</span> /^\/?$/.test(child.path))</span><br><span class="line">    ) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`NamedÂ RouteÂ '<span class="subst">$&#123;route.name&#125;</span>'Â hasÂ aÂ defaultÂ childÂ route.Â `</span> +</span><br><span class="line">          <span class="string">`WhenÂ navigatingÂ toÂ thisÂ namedÂ routeÂ (:to="&#123;name:Â '<span class="subst">$&#123;route.name&#125;</span>'"),Â `</span> +</span><br><span class="line">          <span class="string">`theÂ defaultÂ childÂ routeÂ willÂ notÂ beÂ rendered.Â RemoveÂ theÂ nameÂ fromÂ `</span> +</span><br><span class="line">          <span class="string">`thisÂ routeÂ andÂ useÂ theÂ nameÂ ofÂ theÂ defaultÂ childÂ routeÂ forÂ namedÂ `</span> +</span><br><span class="line">          <span class="string">`linksÂ instead.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//Â éå†ç”Ÿæˆå­è·¯ç”±è®°å½•</span></span><br><span class="line">  route.children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> childMatchAs = matchAs <span class="comment">//Â matchAsè‹¥æœ‰å€¼ï¼Œä»£è¡¨å½“å‰è·¯ç”±æ˜¯åˆ«åè·¯ç”±ï¼Œåˆ™éœ€è¦å•ç‹¬ç”Ÿæˆåˆ«åè·¯ç”±çš„å­è·¯ç”±ï¼Œè·¯å¾„å‰ç¼€éœ€ä½¿ç”¨matchAs</span></span><br><span class="line">      ? cleanPath(<span class="string">`<span class="subst">$&#123;matchAs&#125;</span>/<span class="subst">$&#123;child.path&#125;</span>`</span>)</span><br><span class="line">      : <span class="literal">undefined</span></span><br><span class="line">    addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆé’ˆå¯¹<code>#629</code>é—®é¢˜åšå‡ºäº†è­¦å‘Šæç¤º<ul>
<li><code>#629</code>é—®é¢˜ä¸»è¦æ˜¯ å½“ä¸€ä¸ªè·¯ç”±æ˜¯ <code>å‘½åè·¯ç”± &amp;&amp; æœªä½¿ç”¨é‡å®šå‘ &amp;&amp; å­è·¯ç”±é…ç½®å¯¹è±¡pathä¸º&#39;&#39;æˆ–/</code>æ—¶ï¼Œä½¿ç”¨çˆ¶è·¯ç”±çš„<code>name</code>è·³è½¬æ—¶ï¼Œå­è·¯ç”±å°†ä¸ä¼šè¢«æ¸²æŸ“</li>
</ul>
</li>
<li>ç„¶åéå†å­è·¯ç”±è§„åˆ™åˆ—è¡¨ï¼Œç”Ÿæˆå­è·¯ç”±è®°å½•<ul>
<li>è¿™é‡Œé¢è¿˜å¤„ç†äº†åˆ«åè·¯ç”±çš„å­è·¯ç”±æƒ…å†µ<ul>
<li>éå†æ—¶å¦‚æœå‘ç°çˆ¶è·¯ç”±è¢«æ ‡è®°ä¸ºåˆ«åè·¯ç”±ï¼Œåˆ™å­è·¯ç”±çš„<code>path</code>å‰é¢éœ€è¦åŠ ä¸Šçˆ¶è·¯ç”±çš„<code>path</code>ï¼Œç„¶åå†ç”Ÿæˆè®°å½•</li>
</ul>
</li>
</ul>
</li>
<li>æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ä¸‹é¢çš„åµŒå¥—è·¯ç”±ï¼Œç”Ÿæˆçš„è·¯ç”±æ˜ å°„è¡¨é•¿ä»€ä¹ˆæ ·</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/parent'</span>,</span><br><span class="line">    component: Parent,</span><br><span class="line">    children: [&#123; <span class="attr">path</span>: <span class="string">'foo'</span>, <span class="attr">component</span>: Foo &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>nested-route.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/nested-route.png" alt="nested-route.png"></li>
</ul>
</li>
<li>å¯ä»¥çœ‹åˆ°ï¼Œå­è·¯ç”±çš„<code>path</code>ä¼šå‰è¿½åŠ ä¸Šçˆ¶è·¯ç”±çš„<code>path</code></li>
</ul>
<h4 id="ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•"><a href="#ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•" class="headerlink" title="ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•"></a>ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•</h4><ul>
<li><code>VueRouter</code>æ”¯æŒç»™è·¯ç”±è®¾ç½®åˆ«åï¼›<code>/a</code>  çš„åˆ«åæ˜¯  <code>/b</code>ï¼Œæ„å‘³ç€ï¼Œå½“ç”¨æˆ·è®¿é—®  <code>/b</code>  æ—¶ï¼Œ<code>URL</code> ä¼šä¿æŒä¸º  <code>/b</code>ï¼Œä½†æ˜¯è·¯ç”±åŒ¹é…åˆ™ä¸º  <code>/a</code>ï¼Œå°±åƒç”¨æˆ·è®¿é—®  <code>/a</code>  ä¸€æ ·</li>
<li>æˆ‘ä»¬æ¥çœ‹çœ‹æ¤’å¦‚ä½•ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•çš„</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-route-map.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (route.alias !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> aliases = <span class="built_in">Array</span>.isArray(route.alias) ? route.alias : [route.alias] <span class="comment">//Â aliasæ”¯æŒstringï¼Œå’ŒArray&lt;String&gt;</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; aliases.length; ++i) &#123;</span><br><span class="line">    <span class="keyword">const</span> alias = aliases[i]</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; alias === path) &#123;</span><br><span class="line">      <span class="comment">//Â aliasçš„å€¼å’Œpathé‡å¤ï¼Œéœ€è¦ç»™æç¤º</span></span><br><span class="line">      warn(</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="string">`FoundÂ anÂ aliasÂ withÂ theÂ sameÂ valueÂ asÂ theÂ path:Â "<span class="subst">$&#123;path&#125;</span>".Â YouÂ haveÂ toÂ removeÂ thatÂ alias.Â ItÂ willÂ beÂ ignoredÂ inÂ development.`</span></span><br><span class="line">      ) <span class="comment">//Â skipÂ inÂ devÂ toÂ makeÂ itÂ work</span></span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125; <span class="comment">//Â ç”Ÿæˆåˆ«åè·¯ç”±é…ç½®å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aliasRoute = &#123;</span><br><span class="line">      path: alias,</span><br><span class="line">      children: route.children,</span><br><span class="line">    &#125; <span class="comment">//Â æ·»åŠ åˆ«åè·¯ç”±è®°å½•</span></span><br><span class="line"></span><br><span class="line">    addRouteRecord(</span><br><span class="line">      pathList,</span><br><span class="line">      pathMap,</span><br><span class="line">      nameMap,</span><br><span class="line">      aliasRoute, <span class="comment">//Â åˆ«åè·¯ç”±</span></span><br><span class="line">      parent, <span class="comment">//Â å½“å‰è·¯ç”±çš„çˆ¶è·¯ç”±ï¼Œå› ä¸ºæ˜¯ç»™å½“å‰è·¯ç”±å–äº†ä¸ªåˆ«åï¼Œæ‰€ä»¥äºŒè€…å…¶å®æ˜¯æœ‰åŒä¸ªçˆ¶è·¯ç”±çš„</span></span><br><span class="line">      record.path || <span class="string">'/'</span> <span class="comment">//Â matchAsï¼Œç”¨æ¥ç”Ÿæˆåˆ«åè·¯ç”±çš„å­è·¯ç”±ï¼›</span></span><br><span class="line">    ) <span class="comment">//Â !Â æ€»ç»“ï¼šå½“å‰è·¯ç”±è®¾ç½®äº†aliasåï¼Œä¼šå•ç‹¬ä¸ºå½“å‰è·¯ç”±åŠå…¶æ‰€æœ‰å­è·¯ç”±ç”Ÿæˆè·¯ç”±è®°å½•ï¼Œä¸”å­è·¯ç”±çš„pathå‰ç¼€ä¸ºmatchAs(å³åˆ«åè·¯ç”±çš„path)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ«åæ˜¯æ”¯æŒå•åˆ«åå’Œå¤šåˆ«åçš„ï¼Œå³<code>route.alias</code>æ”¯æŒä¼ å…¥<code>/foo</code>æˆ–<code>[&#39;/foo&#39;,&#39;/bar&#39;]</code>ï¼Œæ‰€ä»¥å…ˆå¯¹è¿™ä¸¤ç§æƒ…å†µåšäº†å½’ä¸€å¤„ç†ï¼Œç»Ÿä¸€å¤„ç†æˆæ•°ç»„</li>
<li>ç„¶åéå†è¿™ä¸ªæ•°ç»„ï¼Œå…ˆæ£€æŸ¥åˆ«åå’Œ<code>path</code>æ˜¯å¦é‡å¤ï¼Œç„¶åå•ç‹¬ä¸ºåˆ«åè·¯ç”±ç”Ÿæˆä¸€ä»½é…ç½®ä¼ å…¥ï¼Œæœ€åè°ƒç”¨<code>addRouteRecord</code>ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•<ul>
<li>æ³¨æ„æ­¤å¤„è¿˜é€šè¿‡<code>matchAs</code>å¤„ç†äº†åˆ«åè·¯ç”±ç”Ÿæˆå­è·¯ç”±çš„åœºæ™¯ï¼Œä¸»è¦é€šè¿‡è®¾ç½®<code>matchAs</code>ä¸º<code>record.path || &#39;/&#39;</code>ï¼Œç„¶ååœ¨ç”Ÿæˆå­è·¯ç”±è®°å½•æ—¶ï¼Œä¼šæ ¹æ®<code>matchAs</code>ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•çš„å­è®°å½•ï¼Œå…·ä½“å¯çœ‹ä¸Šé¢çš„<code>åµŒå¥—è·¯ç”±ç« èŠ‚</code></li>
</ul>
</li>
<li>æˆ‘ä»¬çœ‹çœ‹ï¼Œåˆ«åè·¯ç”±ç”Ÿæˆçš„çš„è·¯ç”±æ˜ å°„è¡¨é•¿ä»€ä¹ˆæ ·</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/root'</span>, <span class="attr">component</span>: Root, <span class="attr">alias</span>: <span class="string">'/root-alias'</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/home'</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">    children: [</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'bar'</span>, <span class="attr">component</span>: Bar, <span class="attr">alias</span>: <span class="string">'bar-alias'</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'baz'</span>, <span class="attr">component</span>: Baz, <span class="attr">alias</span>: [<span class="string">'/baz'</span>, <span class="string">'baz-alias'</span>] &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>alias-route.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/alias-route.png" alt="alias-route.png"></li>
</ul>
</li>
<li>å¯ä»¥çœ‹åˆ°ä¸ºåˆ«åè·¯ç”±å’Œåˆ«åè·¯ç”±çš„å­è·¯ç”±éƒ½å•ç‹¬ç”Ÿæˆäº†ä¸€æ¡è·¯ç”±è®°å½•</li>
</ul>
<h4 id="å°ç»“-3"><a href="#å°ç»“-3" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>è·¯ç”±è®°å½•æ˜¯<code>è·¯ç”±æ˜ å°„è¡¨</code>çš„é‡è¦ç»„æˆéƒ¨åˆ†<ul>
<li>è·¯ç”±è®°å½•ä¸­çš„<code>regex</code>æ˜¯å¤„ç†åŠ¨æ€è·¯ç”±ä¼ å‚çš„å…³é”®å­—æ®µï¼Œä¸»è¦æ˜¯å€ŸåŠ©<code>path-to-regexp</code>å®ç°çš„</li>
</ul>
</li>
<li>ç”Ÿæˆè·¯ç”±è®°å½•ä¸»è¦è€ƒè™‘äº†ä¸‹é¢å‡ ç§è·¯ç”±è®°å½•çš„ç”Ÿæˆ<ul>
<li>åµŒå¥—è·¯ç”±<ul>
<li>å­è·¯ç”±å•ç‹¬ç”Ÿæˆä¸€æ¡è·¯ç”±è®°å½•</li>
</ul>
</li>
<li>åˆ«åè·¯ç”±åŠåˆ«åè·¯ç”±å­è·¯ç”±<ul>
<li>åˆ«åè·¯ç”±åŠå…¶å­è·¯ç”±åˆ†åˆ«ä¼šç”Ÿæˆä¸€æ¡è·¯ç”±è®°å½•</li>
</ul>
</li>
<li>å‘½åè·¯ç”±</li>
</ul>
</li>
<li>ç”Ÿæˆè·¯ç”±è®°å½•çš„æ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</li>
<li>add-route-record.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/add-route-record.png" alt="add-route-record.png"></li>
</ul>
</li>
<li>è‡³æ­¤æˆ‘ä»¬å·²ç»åˆ†æå®Œäº†<code>VueRouter</code>å®ä¾‹åŒ–ä¸­åˆ›å»ºåŒ¹é…å™¨(ç”Ÿæˆè·¯ç”±æ˜ å°„è¡¨)ç›¸å…³é€»è¾‘</li>
<li>ä¸‹é¢æˆ‘ä»¬å°†çœ‹çœ‹æ ¹æ®è·¯ç”±æ¨¡å¼ç”Ÿæˆ<code>Historyå®ä¾‹</code>çš„ç›¸å…³é€»è¾‘</li>
</ul>
<h3 id="è·¯ç”±æ¨¡å¼"><a href="#è·¯ç”±æ¨¡å¼" class="headerlink" title="è·¯ç”±æ¨¡å¼"></a>è·¯ç”±æ¨¡å¼</h3><ul>
<li>å‰ç«¯è·¯ç”±ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§æ˜¯è¦å®ç°æ— åˆ·æ–°åˆ‡æ¢é¡µé¢<ul>
<li>å³ url æ”¹å˜ï¼Œé¡µé¢ä¸åˆ·æ–°å®ç°é¡µé¢çš„è·³è½¬</li>
</ul>
</li>
<li>è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆ</li>
<li>ä¸€ç§<code>hash+hashChange</code>ï¼Œå¦ä¸€ç§åˆ©ç”¨<code>History API</code>çš„<code>pushState+popState</code></li>
<li>å‰è€…ä¸»è¦åˆ©ç”¨<code>hash</code>æ”¹å˜æ—¶é¡µé¢ä¸ä¼šåˆ·æ–°å¹¶ä¼šè§¦å‘<code>hashChange</code>è¿™ä¸ªç‰¹æ€§æ¥å®ç°å‰ç«¯è·¯ç”±</li>
<li>åè€…å……åˆ†åˆ©ç”¨äº†<code>HTML5 History API</code>çš„<code>pushState</code>æ–¹æ³•å’Œ<code>popState</code>äº‹ä»¶æ¥å®ç°å‰ç«¯è·¯ç”±</li>
<li>äºŒè€…æ¯”è¾ƒ</li>
<li>å‰è€…<ul>
<li>å…¼å®¹æ€§å¥½ï¼Œ<code>hashChange</code>æ”¯æŒåˆ° IE8</li>
<li><code>url</code>ä¸­ä¼šæºå¸¦<code>/#/</code>ï¼Œä¸ç¾è§‚</li>
<li>ä¸éœ€è¦æœåŠ¡ç«¯æ”¹é€ </li>
</ul>
</li>
<li>åè€…<ul>
<li>å…¼å®¹åˆ° IE10</li>
<li><code>url</code>è·Ÿæ­£å¸¸<code>url</code>ä¸€æ ·</li>
<li>ç”±äºå…¶<code>url</code>è·Ÿæ­£å¸¸<code>url</code>ä¸€æ ·ï¼Œæ‰€ä»¥åœ¨åˆ·æ–°æ—¶ï¼Œä¼šä»¥æ­¤<code>url</code>ä¸ºé“¾æ¥è¯·æ±‚æœåŠ¡ç«¯é¡µé¢ï¼Œè€ŒæœåŠ¡ç«¯æ˜¯æ²¡æœ‰è¿™ä¸ªé¡µé¢çš„ï¼Œä¼š 404ï¼Œå› æ­¤éœ€è¦æœåŠ¡ç«¯é…åˆå°†æ‰€æœ‰è¯·æ±‚é‡å®šå‘åˆ°é¦–é¡µï¼Œå°†æ•´ä¸ªè·¯ç”±çš„æ§åˆ¶äº¤ç»™å‰ç«¯è·¯ç”±</li>
</ul>
</li>
<li><code>VueRouter</code>æ”¯æŒä¸‰ç§è·¯ç”±æ¨¡å¼ï¼Œåˆ†åˆ«ä¸º<code>hash</code>ã€<code>history</code>ã€<code>abstract</code></li>
<li><code>hash</code>æ¨¡å¼å°±æ˜¯ç¬¬ä¸€ç§æ–¹æ¡ˆçš„å®ç°</li>
<li><code>history</code>æ¨¡å¼æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆçš„å®ç°</li>
<li><code>abstract</code>æ¨¡å¼æ˜¯ç”¨åœ¨éæµè§ˆå™¨ç¯å¢ƒçš„ï¼Œä¸»è¦ç”¨äº<code>SSR</code></li>
</ul>
<h4 id="æ ¸å¿ƒç±»"><a href="#æ ¸å¿ƒç±»" class="headerlink" title="æ ¸å¿ƒç±»"></a>æ ¸å¿ƒç±»</h4><ul>
<li><code>VueRouter</code>çš„ä¸‰ç§è·¯ç”±æ¨¡å¼ï¼Œä¸»è¦ç”±ä¸‹é¢çš„ä¸‰ä¸ªæ ¸å¿ƒç±»å®ç°</li>
<li><code>History</code><ul>
<li>åŸºç¡€ç±»</li>
<li>ä½äº<code>src/history/base.js</code></li>
</ul>
</li>
<li><code>HTML5History</code><ul>
<li>ç”¨äºæ”¯æŒ<code>pushState</code>çš„æµè§ˆå™¨</li>
<li><code>src/history/html5.js</code></li>
</ul>
</li>
<li><code>HashHistory</code><ul>
<li>ç”¨äºä¸æ”¯æŒ<code>pushState</code>çš„æµè§ˆå™¨</li>
<li><code>src/history/hash.js</code></li>
</ul>
</li>
<li><code>AbstractHistory</code><ul>
<li>ç”¨äºéæµè§ˆå™¨ç¯å¢ƒ(æœåŠ¡ç«¯æ¸²æŸ“)</li>
<li><code>src/history/abstract.js</code></li>
</ul>
</li>
<li>é€šè¿‡ä¸‹é¢è¿™å¼ å›¾ï¼Œå¯ä»¥äº†è§£åˆ°ä»–ä»¬ä¹‹é—´çš„å…³ç³»</li>
<li>route-mode-class.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/route-mode-class.png" alt="route-mode-class.png"></li>
</ul>
</li>
<li><code>HTML5History</code>ã€<code>HashHistory</code>ã€<code>AbstractHistory</code>ä¸‰è€…éƒ½æ˜¯ç»§æ‰¿äºåŸºç¡€ç±»<code>History</code>ï¼›</li>
<li>ä¸‰è€…ä¸å…‰èƒ½è®¿é—®<code>Historyç±»</code>çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œä»–ä»¬è¿˜éƒ½å®ç°äº†åŸºç¡€ç±»ä¸­å£°æ˜çš„éœ€è¦å­ç±»å®ç°çš„ 5 ä¸ªæ¥å£(<code>goã€pushã€replaceã€ensureURLã€getCurrentLocation</code>)</li>
<li>ç”±äº<code>HashHistory</code>ç›‘å¬<code>hashChange</code>çš„ç‰¹æ®Šæ€§ï¼Œæ‰€ä»¥ä¼šå•ç‹¬å¤šä¸€ä¸ª<code>setupListeners</code>æ–¹æ³•</li>
<li><code>AbstractHistory</code>ç”±äºéœ€è¦åœ¨éæµè§ˆå™¨ç¯å¢ƒä½¿ç”¨ï¼Œæ²¡æœ‰å†å²è®°å½•æ ˆï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡<code>indexã€stack</code>æ¥æ¨¡æ‹Ÿ</li>
<li>å‰é¢æˆ‘ä»¬åˆ†æ<code>VueRouter</code>å®ä¾‹åŒ–è¿‡ç¨‹æ—¶ï¼ŒçŸ¥é“<code>VueRouter</code>ä¼šåœ¨ç¡®å®šå®Œè·¯ç”±æ¨¡å¼åï¼Œä¼šå®ä¾‹åŒ–ä¸åŒçš„<code>Historyå®ä¾‹</code></li>
<li>é‚£æˆ‘ä»¬æ¥çœ‹çœ‹ä¸åŒ<code>History</code>çš„å®ä¾‹åŒ–è¿‡ç¨‹</li>
</ul>
<h4 id="History-ç±»"><a href="#History-ç±»" class="headerlink" title="History ç±»"></a>History ç±»</h4><ul>
<li>å®ƒæ˜¯çˆ¶ç±»(åŸºç±»)ï¼Œå…¶å®ƒç±»éƒ½æ˜¯ç»§æ‰¿å®ƒçš„</li>
<li>ä»£ç ä½äº<code>src/history/base.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"><span class="comment">//Â çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">export</span>Â <span class="keyword">class</span>Â HistoryÂ &#123;</span><br><span class="line">Â Â router:Â Router</span><br><span class="line">Â Â base:Â <span class="built_in">string</span></span><br><span class="line">Â Â current:Â Route</span><br><span class="line">Â Â pending:Â ?Route</span><br><span class="line">Â Â cb:Â <span class="function">(<span class="params">r:Â Route</span>)Â =&gt;</span>Â <span class="built_in">void</span></span><br><span class="line">Â Â ready:Â <span class="built_in">boolean</span></span><br><span class="line">Â Â readyCbs:Â <span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;</span><br><span class="line">Â Â readyErrorCbs:Â <span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;</span><br><span class="line">Â Â errorCbs:Â <span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;</span><br><span class="line"></span><br><span class="line">Â Â <span class="comment">//Â implementedÂ byÂ sub-classes</span></span><br><span class="line">Â Â <span class="comment">//Â éœ€è¦å­ç±»(HTML5Historyã€HashHistory)å®ç°çš„æ–¹æ³•</span></span><br><span class="line">Â Â +go:Â <span class="function">(<span class="params">n:Â <span class="built_in">number</span></span>)Â =&gt;</span>Â <span class="built_in">void</span></span><br><span class="line">Â Â +push:Â <span class="function">(<span class="params">loc:Â RawLocation</span>)Â =&gt;</span>Â <span class="built_in">void</span></span><br><span class="line">Â Â +replace:Â <span class="function">(<span class="params">loc:Â RawLocation</span>)Â =&gt;</span>Â <span class="built_in">void</span></span><br><span class="line">Â Â +ensureURL:Â <span class="function">(<span class="params">push?:Â <span class="built_in">boolean</span></span>)Â =&gt;</span>Â <span class="built_in">void</span></span><br><span class="line">Â Â +getCurrentLocation:Â <span class="function"><span class="params">()</span>Â =&gt;</span>Â <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">Â Â <span class="keyword">constructor</span>Â (<span class="params">router:Â Router,Â base:Â ?<span class="built_in">string</span></span>)Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.routerÂ =Â router</span><br><span class="line">Â Â Â Â <span class="comment">//Â æ ¼å¼åŒ–baseï¼Œä¿è¯baseæ˜¯ä»¥/å¼€å¤´</span></span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.baseÂ =Â normalizeBase(base)</span><br><span class="line">Â Â Â Â <span class="comment">//Â startÂ withÂ aÂ routeÂ objectÂ thatÂ standsÂ forÂ "nowhere"</span></span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.currentÂ =Â STARTÂ <span class="comment">//Â å½“å‰æŒ‡å‘çš„routeå¯¹è±¡ï¼Œé»˜è®¤ä¸ºSTARTï¼›å³from</span></span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.pendingÂ =Â <span class="literal">null</span>Â <span class="comment">//Â è®°å½•å°†è¦è·³è½¬çš„routeï¼›å³to</span></span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.readyÂ =Â <span class="literal">false</span></span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.readyCbsÂ =Â []</span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.readyErrorCbsÂ =Â []</span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.errorCbsÂ =Â []</span><br><span class="line">Â Â &#125;</span><br><span class="line">Â Â </span><br><span class="line">Â Â ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œæ„é€ å‡½æ•°ä¸­ä¸»è¦å¹²äº†ä¸‹é¢å‡ ä»¶äº‹<ul>
<li>ä¿å­˜äº†<code>router</code>å®ä¾‹</li>
<li>è§„èŒƒåŒ–äº†<code>base</code>ï¼Œç¡®ä¿<code>base</code>æ˜¯ä»¥<code>/</code>å¼€å¤´</li>
<li>åˆå§‹åŒ–äº†å½“å‰è·¯ç”±æŒ‡å‘ï¼Œé»˜è®¤åªæƒ³<code>START</code>åˆå§‹è·¯ç”±ï¼›åœ¨è·¯ç”±è·³è½¬æ—¶ï¼Œ<code>this.current</code>ä»£è¡¨çš„æ˜¯<code>from</code></li>
<li>åˆå§‹åŒ–äº†è·¯ç”±è·³è½¬æ—¶çš„ä¸‹ä¸ªè·¯ç”±ï¼Œé»˜è®¤ä¸º<code>null</code>ï¼›åœ¨è·¯ç”±è·³è½¬æ—¶ï¼Œ<code>this.pending</code>ä»£è¡¨çš„æ˜¯<code>to</code></li>
<li>åˆå§‹åŒ–äº†ä¸€äº›å›è°ƒç›¸å…³çš„å±æ€§</li>
</ul>
</li>
<li><code>START</code>å®šä¹‰åœ¨<code>src/utils/route.js</code>ä¸­</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils/route.js</span></span><br><span class="line"><span class="comment">// åˆå§‹è·¯ç”±</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> START = createRoute(<span class="literal">null</span>, &#123;</span><br><span class="line">  path: <span class="string">'/'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Historyç±»</code>çš„å®ä¾‹åŒ–è¿‡ç¨‹å¦‚ä¸‹</li>
<li>history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/history.png" alt="history.png"></li>
</ul>
</li>
</ul>
<h4 id="HTML5History-ç±»"><a href="#HTML5History-ç±»" class="headerlink" title="HTML5History ç±»"></a>HTML5History ç±»</h4><ul>
<li>æˆ‘ä»¬å†çœ‹çœ‹<code>HTML5Historyç±»</code>,å®ƒæ˜¯ç»§æ‰¿è‡ª<code>Historyç±»</code></li>
<li>ä½äº<code>src/history/html5.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HTML5History <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">router: Router, base: ?<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">//Â åˆå§‹åŒ–çˆ¶ç±»History</span></span><br><span class="line">    <span class="keyword">super</span>(router, base) <span class="comment">//Â æ£€æµ‹æ˜¯å¦éœ€è¦æ”¯æŒscroll</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectScroll = router.options.scrollBehavior</span><br><span class="line">    <span class="keyword">const</span> supportsScroll = supportsPushState &amp;&amp; expectScroll <span class="comment">//Â è‹¥æ”¯æŒscroll,åˆå§‹åŒ–scrollç›¸å…³é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">      setupScroll()</span><br><span class="line">    &#125; <span class="comment">//Â è·å–åˆå§‹location</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> initLocation = getLocation(<span class="keyword">this</span>.base) <span class="comment">//Â ç›‘å¬popstateäº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> current = <span class="keyword">this</span>.current <span class="comment">//Â AvoidingÂ firstÂ `popstate`Â eventÂ dispatchedÂ inÂ someÂ browsersÂ butÂ first //Â historyÂ routeÂ notÂ updatedÂ sinceÂ asyncÂ guardÂ atÂ theÂ sameÂ time. //Â æŸäº›æµè§ˆå™¨ï¼Œä¼šåœ¨æ‰“å¼€é¡µé¢æ—¶è§¦å‘ä¸€æ¬¡popstate</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ­¤æ—¶å¦‚æœåˆå§‹è·¯ç”±æ˜¯å¼‚æ­¥è·¯ç”±,å°±ä¼šå‡ºç°`popstate`å…ˆè§¦å‘,åˆå§‹è·¯ç”±åè§£æå®Œæˆï¼Œè¿›è€Œå¯¼è‡´routeæœªæ›´æ–°</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥éœ€è¦é¿å…</span></span><br><span class="line">      <span class="keyword">const</span> location = getLocation(<span class="keyword">this</span>.base)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.current === START &amp;&amp; location === initLocation) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125; <span class="comment">//Â è·¯ç”±åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è·³è½¬ï¼Œå¹¶åœ¨è·³è½¬åå¤„ç†æ»šåŠ¨</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.transitionTo(location, <span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">          handleScroll(router, route, current, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°å…¶æ˜¯ç»§æ‰¿äº<code>Historyç±»</code>ï¼Œæ‰€ä»¥åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨äº†çˆ¶ç±»æ„é€ å‡½æ•°(<code>super(router,base)</code>)</li>
<li>æ£€æŸ¥äº†æ˜¯å¦éœ€è¦æ”¯æŒæ»šåŠ¨è¡Œä¸ºï¼Œå¦‚æœæ”¯æŒï¼Œåˆ™åˆå§‹åŒ–æ»šåŠ¨ç›¸å…³é€»è¾‘</li>
<li>ç›‘å¬äº†<code>popstateäº‹ä»¶</code>ï¼Œå¹¶åœ¨<code>popstate</code>è§¦å‘æ—¶ï¼Œè°ƒç”¨<code>transitionTo</code>æ–¹æ³•å®ç°è·³è½¬</li>
<li>æ³¨æ„è¿™é‡Œå¤„ç†äº†ä¸€ä¸ªå¼‚å¸¸åœºæ™¯<ul>
<li>æŸäº›æµè§ˆå™¨ä¸‹ï¼Œæ‰“å¼€é¡µé¢ä¼šè§¦å‘ä¸€æ¬¡<code>popstate</code>ï¼Œæ­¤æ—¶å¦‚æœè·¯ç”±ç»„ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œå°±ä¼šå‡ºç°<code>popstate</code>äº‹ä»¶è§¦å‘äº†ï¼Œä½†å¼‚æ­¥ç»„ä»¶è¿˜æ²¡è§£æå®Œæˆï¼Œæœ€åå¯¼è‡´<code>route</code>æ²¡æœ‰æ›´æ–°</li>
<li>æ‰€ä»¥å¯¹è¿™ç§æƒ…å†µåšäº†å±è”½</li>
</ul>
</li>
<li>å…³äºæ»šåŠ¨å’Œè·¯ç”±è·³è½¬åé¢æœ‰ä¸“é—¨ç« èŠ‚ä¼šè®²</li>
<li><code>HTML5Historyç±»</code>çš„å®ä¾‹åŒ–è¿‡ç¨‹å¦‚ä¸‹</li>
<li>h5history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/h5history.png" alt="h5history.png"></li>
</ul>
</li>
</ul>
<h4 id="HashHistory-ç±»"><a href="#HashHistory-ç±»" class="headerlink" title="HashHistory ç±»"></a>HashHistory ç±»</h4><ul>
<li>ä½äº<code>src/history/hash.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/hash.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HashHistory <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">router: Router, base: ?<span class="built_in">string</span>, fallback: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="comment">//Â å®ä¾‹åŒ–çˆ¶ç±»</span></span><br><span class="line">    <span class="keyword">super</span>(router, base) <span class="comment">//Â checkÂ historyÂ fallbackÂ deeplinking //Â fallbackåªæœ‰åœ¨æŒ‡æ˜äº†modeä¸ºhistoryï¼Œä½†æ˜¯æµè§ˆå™¨åˆä¸æ”¯æŒpopstateï¼Œç”¨æˆ·æ‰‹åŠ¨æŒ‡æ˜äº†fallbackä¸ºtrueæ—¶ï¼Œæ‰ä¸ºtrueï¼Œå…¶å®ƒæƒ…å†µä¸ºfalse //Â å¦‚æœéœ€è¦å›é€€ï¼Œåˆ™å°†urlæ¢ä¸ºhashæ¨¡å¼(/#å¼€å¤´) //Â this.baseæ¥è‡ªçˆ¶ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (fallback &amp;&amp; checkFallback(<span class="keyword">this</span>.base)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ensureSlash()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å®ƒç»§æ‰¿äº<code>History</code>ï¼Œæ‰€ä»¥ä¹Ÿè°ƒç”¨äº†<code>super(router,base)</code></li>
<li>æ£€æŸ¥äº†<code>fallback</code>ï¼Œçœ‹æ˜¯å¦éœ€è¦å›é€€ï¼Œå‰é¢è¯´è¿‡ï¼Œä¼ å…¥çš„<code>fallback</code>åªæœ‰åœ¨ç”¨æˆ·è®¾ç½®äº†<code>history</code>ä¸”åˆä¸æ”¯æŒ<code>pushState</code>å¹¶ä¸”å¯ç”¨äº†å›é€€æ—¶æ‰ä¸º<code>true</code></li>
<li>æ‰€ä»¥ï¼Œæ­¤æ—¶ï¼Œéœ€è¦å°†<code>history</code>æ¨¡å¼çš„<code>url</code>æ›¿æ¢æˆ<code>hash</code>æ¨¡å¼ï¼Œå³æ·»åŠ ä¸Š<code>#</code>ï¼Œè¿™ä¸ªé€»è¾‘æ˜¯ç”±<code>checkFallback</code>å®ç°çš„</li>
<li>å¦‚æœä¸æ˜¯<code>fallback</code>ï¼Œåˆ™ç›´æ¥è°ƒç”¨<code>ensureSlash</code>ï¼Œç¡®ä¿<code>url</code>æ˜¯ä»¥<code>/</code>å¼€å¤´çš„</li>
<li>æˆ‘ä»¬çœ‹ä¸‹<code>checkFallback</code>ã€<code>ensureSlash</code>å®ç°</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/hash.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *Â æ£€æŸ¥å›é€€ï¼Œå°†urlè½¬æ¢ä¸ºhashæ¨¡å¼(æ·»åŠ /#)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFallback</span>(<span class="params">base</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> location = getLocation(base) <span class="comment">//Â åœ°å€ä¸ä»¥/#å¼€å¤´ï¼Œåˆ™æ·»åŠ ä¹‹</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^\/#/</span>.test(location)) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.replace(cleanPath(base + <span class="string">'/#'</span> + location)) <span class="comment">// è¿™ä¸€æ­¥å®ç°äº†urlæ›¿æ¢</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *Â ç¡®ä¿urlæ˜¯ä»¥/å¼€å¤´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureSlash</span>(<span class="params"></span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> path = getHash()</span><br><span class="line">  <span class="keyword">if</span> (path.charAt(<span class="number">0</span>) === <span class="string">'/'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  replaceHash(<span class="string">'/'</span> + path)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æ›¿æ¢hashè®°å½•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceHash</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//Â æ”¯æŒpushStateï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨replaceState</span></span><br><span class="line">  <span class="keyword">if</span> (supportsPushState) &#123;</span><br><span class="line">    replaceState(getUrl(path))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.replace(getUrl(path))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ˜¯ä¸æ˜¯å‘ç°<code>HashHistory</code>å°‘äº†æ»šåŠ¨æ”¯æŒå’Œç›‘å¬<code>hashChange</code>ç›¸å…³é€»è¾‘ï¼Œè¿™æ˜¯å› ä¸º<code>hashChange</code>å­˜åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œéœ€è¦ç­‰åˆ°<code>mounts</code>åæ‰èƒ½ç›‘å¬<ul>
<li>è¿™ä¸€å—çš„é€»è¾‘å…¨æ”¾åœ¨äº†<code>setupListeners</code>æ–¹æ³•ä¸­ï¼Œ<code>setupListeners</code>ä¼šåœ¨<code>VueRouter</code>è°ƒç”¨<code>init</code>æ—¶è¢«è°ƒç”¨ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨åˆå§‹åŒ–ç« èŠ‚å†çœ‹</li>
</ul>
</li>
<li><code>HashHistoryç±»</code>çš„å®ä¾‹åŒ–è¿‡ç¨‹å¦‚ä¸‹</li>
<li>hash-history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/hash-history.png" alt="hash-history.png"></li>
</ul>
</li>
</ul>
<h4 id="AbstractHistory-ç±»"><a href="#AbstractHistory-ç±»" class="headerlink" title="AbstractHistory ç±»"></a>AbstractHistory ç±»</h4><ul>
<li><code>AbstractHistory</code>æ˜¯ç”¨äºéæµè§ˆå™¨ç¯å¢ƒçš„</li>
<li>ä½äº<code>src/history/abstract.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/abstract.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *Â æ”¯æŒæ‰€æœ‰Â JavaScriptÂ è¿è¡Œç¯å¢ƒï¼Œå¦‚Â Node.jsÂ æœåŠ¡å™¨ç«¯ã€‚å¦‚æœå‘ç°æ²¡æœ‰æµè§ˆå™¨çš„Â APIï¼Œè·¯ç”±ä¼šè‡ªåŠ¨å¼ºåˆ¶è¿›å…¥è¿™ä¸ªæ¨¡å¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *Â @export</span></span><br><span class="line"><span class="comment"> *Â @classÂ AbstractHistory</span></span><br><span class="line"><span class="comment"> *Â @extendsÂ &#123;History&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AbstractHistory <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">router: Router, base: ?<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">//Â åˆå§‹åŒ–çˆ¶ç±»</span></span><br><span class="line">    <span class="keyword">super</span>(router, base)</span><br><span class="line">    <span class="keyword">this</span>.stack = []</span><br><span class="line">    <span class="keyword">this</span>.index = <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°å®ƒçš„å®ä¾‹åŒ–æ˜¯æœ€ç®€å•çš„ï¼Œåªåˆå§‹åŒ–äº†çˆ¶ç±»ï¼Œå¹¶å¯¹<code>index</code>ã€<code>stack</code>åšäº†åˆå§‹åŒ–</li>
<li>å‰é¢è¯´è¿‡ï¼Œéæµè§ˆå™¨ç¯å¢ƒï¼Œæ˜¯æ²¡æœ‰å†å²è®°å½•æ ˆçš„ï¼Œæ‰€ä»¥ä½¿ç”¨<code>index</code>ã€<code>stack</code>æ¥æ¨¡æ‹Ÿå†å²è®°å½•æ ˆ</li>
<li><code>AbstractHistoryç±»</code>çš„å®ä¾‹åŒ–è¿‡ç¨‹å¦‚ä¸‹</li>
<li>abstract-history.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/abstract-history.png" alt="abstract-history.png"></li>
</ul>
</li>
</ul>
<h4 id="å°ç»“-4"><a href="#å°ç»“-4" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li>è¿™ä¸€å°èŠ‚æˆ‘ä»¬å¯¹ä¸‰ç§è·¯ç”±æ¨¡å¼åšäº†ç®€å•åˆ†æï¼Œå¹¶ä¸”è¿˜ä¸€èµ·çœ‹äº†å®ç°è¿™ä¸‰ç§è·¯ç”±æ¨¡å¼æ‰€éœ€è¦çš„<code>History</code>ç±»æ˜¯å¦‚ä½•å®ä¾‹åŒ–çš„</li>
<li>åˆ°æ­¤ï¼Œ<code>VueRouter</code>çš„æ•´ä¸ªå®ä¾‹åŒ–è¿‡ç¨‹åŸºæœ¬è®²å®Œ</li>
<li>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå›¾æ¥ç®€å•æ€»ç»“ä¸‹<code>VueRouter</code>å®ä¾‹åŒ–è¿‡ç¨‹</li>
<li>vue-router-instance.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/vue-router-instance.png" alt="vue-router-instance.png"></li>
</ul>
</li>
</ul>
<h2 id="åˆå§‹åŒ–æµç¨‹"><a href="#åˆå§‹åŒ–æµç¨‹" class="headerlink" title="åˆå§‹åŒ–æµç¨‹"></a>åˆå§‹åŒ–æµç¨‹</h2><ul>
<li>åˆ†æå®Œå®ä¾‹åŒ–è¿‡ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹åˆå§‹åŒ–æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Œéƒ½åšäº†å“ªäº›äº‹æƒ…</li>
</ul>
<h3 id="è°ƒç”¨-init-æ—¶æœº"><a href="#è°ƒç”¨-init-æ—¶æœº" class="headerlink" title="è°ƒç”¨ init æ—¶æœº"></a>è°ƒç”¨ init æ—¶æœº</h3><ul>
<li>åœ¨åˆ†æå®‰è£…æµç¨‹æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“<code>VueRouter</code>æ³¨å†Œäº†ä¸€ä¸ªå…¨å±€æ··å…¥ï¼Œæ··å…¥äº†<code>beforeCreate</code>é’©å­</li>
<li>ä»£ç å¦‚ä¸‹</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/install.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æ³¨å†Œå…¨å±€æ··å…¥</span></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">Â Â beforeCreateÂ ()Â &#123;</span><br><span class="line">Â Â Â Â </span><br><span class="line">Â Â Â Â <span class="comment">//Â åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†vue-routeræ’ä»¶</span></span><br><span class="line">Â Â Â Â <span class="keyword">if</span>Â (isDef(<span class="keyword">this</span>.$options.router))Â &#123;</span><br><span class="line">Â Â Â Â Â ...</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">this</span>._routerÂ =Â <span class="keyword">this</span>.$options.routerÂ <span class="comment">//Â ä¿å­˜VueRouterå®ä¾‹ï¼Œthis.$options.routerä»…å­˜åœ¨äºVueæ ¹å®ä¾‹ä¸Šï¼Œå…¶å®ƒVueç»„ä»¶ä¸åŒ…å«æ­¤å±æ€§ï¼Œæ‰€ä»¥ä¸‹é¢çš„åˆå§‹åŒ–ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">Â Â Â Â Â Â <span class="comment">//Â beforeCreateÂ hookè¢«è§¦å‘æ—¶ï¼Œè°ƒç”¨</span></span><br><span class="line">Â Â Â Â Â Â <span class="keyword">this</span>._router.init(<span class="keyword">this</span>)Â <span class="comment">//Â åˆå§‹åŒ–VueRouterå®ä¾‹ï¼Œå¹¶ä¼ å…¥Vueæ ¹å®ä¾‹</span></span><br><span class="line">Â Â Â Â &#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â ...</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â &#125;,</span><br><span class="line">Â Â destroyedÂ ()Â &#123;</span><br><span class="line">Â Â Â ...</span><br><span class="line">Â Â &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ‘ä»¬çŸ¥é“å…¨å±€æ··å…¥ï¼Œä¼šå½±å“åç»­åˆ›å»ºçš„æ‰€æœ‰<code>Vueå®ä¾‹</code>ï¼Œæ‰€ä»¥<code>beforeCreate</code>é¦–æ¬¡è§¦å‘æ˜¯åœ¨<code>Vueæ ¹å®ä¾‹å®ä¾‹åŒ–çš„æ—¶å€™</code>å³<code>new Vue({router})</code>æ—¶ï¼Œ<br>è§¦å‘åè°ƒç”¨<code>router</code>å®ä¾‹çš„<code>init</code>æ–¹æ³•å¹¶ä¼ å…¥<code>Vueæ ¹å®ä¾‹</code>ï¼Œå®Œæˆåˆå§‹åŒ–æµç¨‹ï¼›</li>
<li>ç”±äº<code>router</code>ä»…å­˜åœ¨äº<code>Vueæ ¹å®ä¾‹</code>çš„<code>$options</code>ä¸Šï¼Œæ‰€ä»¥ï¼Œæ•´ä¸ªåˆå§‹åŒ–åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</li>
<li>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸‹<code>init</code>æ–¹æ³•å®ç°</li>
</ul>
<h3 id="init-æ–¹æ³•"><a href="#init-æ–¹æ³•" class="headerlink" title="init æ–¹æ³•"></a>init æ–¹æ³•</h3><ul>
<li><code>VueRouter</code>çš„<code>init</code>æ–¹æ³•ä½äº<code>src/index.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/install.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> VueRouter &#123;</span><br><span class="line">  <span class="comment">//Â åˆå§‹åŒ–,appä¸ºVueæ ¹å®ä¾‹</span></span><br><span class="line">  init(app: <span class="built_in">any</span> <span class="comment">/*Â VueÂ componentÂ instanceÂ */</span>) &#123;</span><br><span class="line">    <span class="comment">//Â å¼€å‘ç¯å¢ƒï¼Œç¡®ä¿å·²ç»å®‰è£…VueRouter</span></span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp;</span><br><span class="line">      assert(</span><br><span class="line">        install.installed,</span><br><span class="line">        <span class="string">`notÂ installed.Â MakeÂ sureÂ toÂ callÂ \`Vue.use(VueRouter)\`Â `</span> +</span><br><span class="line">          <span class="string">`beforeÂ creatingÂ rootÂ instance.`</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.apps.push(app) <span class="comment">//Â ä¿å­˜å®ä¾‹ //Â setÂ upÂ appÂ destroyedÂ handler //Â https://github.com/vuejs/vue-router/issues/2639 //Â ç»‘å®šdestroyedÂ hookï¼Œé¿å…å†…å­˜æ³„éœ²</span></span><br><span class="line">    app.$once(<span class="string">'hook:destroyed'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//Â cleanÂ outÂ appÂ fromÂ this.appsÂ arrayÂ onceÂ destroyed</span></span><br><span class="line">      <span class="keyword">const</span> index = <span class="keyword">this</span>.apps.indexOf(app)</span><br><span class="line">      <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) <span class="keyword">this</span>.apps.splice(index, <span class="number">1</span>) <span class="comment">//Â ensureÂ weÂ stillÂ haveÂ aÂ mainÂ appÂ orÂ nullÂ ifÂ noÂ apps //Â weÂ doÂ notÂ releaseÂ theÂ routerÂ soÂ itÂ canÂ beÂ reused //Â éœ€è¦ç¡®ä¿å§‹ç»ˆæœ‰ä¸ªä¸»åº”ç”¨</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.app === app) <span class="keyword">this</span>.app = <span class="keyword">this</span>.apps[<span class="number">0</span>] || <span class="literal">null</span></span><br><span class="line">    &#125;) <span class="comment">//Â mainÂ appÂ previouslyÂ initialized //Â returnÂ asÂ weÂ don'tÂ needÂ toÂ setÂ upÂ newÂ historyÂ listener //Â mainÂ appå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸éœ€è¦é‡å¤åˆå§‹åŒ–historyÂ çš„äº‹ä»¶ç›‘å¬</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.app) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.app = app</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> history = <span class="keyword">this</span>.history</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (history <span class="keyword">instanceof</span> HTML5History) &#123;</span><br><span class="line">      <span class="comment">//Â è‹¥æ˜¯HTML5Historyç±»ï¼Œåˆ™ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„transitionToæ–¹æ³•ï¼Œè·³è½¬åˆ°å½“å‰location</span></span><br><span class="line">      history.transitionTo(history.getCurrentLocation())</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (history <span class="keyword">instanceof</span> HashHistory) &#123;</span><br><span class="line">      <span class="comment">//Â è‹¥æ˜¯HashHistoryï¼Œåœ¨è°ƒç”¨çˆ¶ç±»çš„transitionToæ–¹æ³•åï¼Œå¹¶ä¼ å…¥onCompleteã€onAbortå›è°ƒ</span></span><br><span class="line">      <span class="keyword">const</span> setupHashListener = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//Â è°ƒç”¨HashHistory.setupListenersæ–¹æ³•ï¼Œè®¾ç½®hashchangeç›‘å¬</span></span><br><span class="line">        <span class="comment">//Â åœ¨Â routeÂ åˆ‡æ¢å®Œæˆä¹‹åå†è®¾ç½®Â hashchangeÂ çš„ç›‘å¬,</span></span><br><span class="line">        <span class="comment">//Â ä¿®å¤https://github.com/vuejs/vue-router/issues/725</span></span><br><span class="line">        <span class="comment">//Â å› ä¸ºå¦‚æœé’©å­å‡½æ•°Â beforeEnterÂ æ˜¯å¼‚æ­¥çš„è¯,Â beforeEnterÂ é’©å­å°±ä¼šè¢«è§¦å‘ä¸¤æ¬¡.Â å› ä¸ºåœ¨åˆå§‹åŒ–æ—¶,Â å¦‚æœæ­¤æ—¶çš„Â hashÂ å€¼ä¸æ˜¯ä»¥Â /Â å¼€å¤´çš„è¯å°±ä¼šè¡¥ä¸ŠÂ #/,Â è¿™ä¸ªè¿‡ç¨‹ä¼šè§¦å‘Â hashchangeÂ äº‹ä»¶,Â å°±ä¼šå†èµ°ä¸€æ¬¡ç”Ÿå‘½å‘¨æœŸé’©å­,Â ä¹Ÿå°±æ„å‘³ç€ä¼šå†æ¬¡è°ƒç”¨Â beforeEnterÂ é’©å­å‡½æ•°.</span></span><br><span class="line">        history.setupListeners()</span><br><span class="line">      &#125;</span><br><span class="line">      history.transitionTo(</span><br><span class="line">        history.getCurrentLocation(),</span><br><span class="line">        setupHashListener, <span class="comment">//Â transitionToçš„onCompleteå›è°ƒ</span></span><br><span class="line">        setupHashListener <span class="comment">//Â transitionToçš„onAbortå›è°ƒ</span></span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="comment">//Â è°ƒç”¨çˆ¶ç±»çš„listenæ–¹æ³•ï¼Œæ·»åŠ å›è°ƒï¼› //Â å›è°ƒä¼šåœ¨çˆ¶ç±»çš„updateRouteæ–¹æ³•è¢«è°ƒç”¨æ—¶è§¦å‘ï¼Œé‡æ–°ä¸ºapp._routeèµ‹å€¼ //Â ç”±äºapp._routeè¢«å®šä¹‰ä¸ºå“åº”å¼ï¼Œæ‰€ä»¥app._routeå‘ç”Ÿå˜åŒ–ï¼Œä¾èµ–app._routeçš„ç»„ä»¶(route-viewç»„ä»¶)éƒ½ä¼šè¢«é‡æ–°æ¸²æŸ“</span></span><br><span class="line"></span><br><span class="line">    history.listen(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.apps.forEach(<span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">        app._route = route</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦åšäº†ä¸‹é¢å‡ ä»¶äº‹</li>
<li>æ£€æŸ¥äº†<code>VueRouter</code>æ˜¯å¦å·²ç»å®‰è£…</li>
<li>ä¿å­˜äº†æŒ‚è½½<code>routerå®ä¾‹</code>çš„<code>vueå®ä¾‹</code><ul>
<li><code>VueRouter</code>æ”¯æŒå¤šå®ä¾‹åµŒå¥—ï¼Œæ‰€ä»¥å­˜åœ¨<code>this.apps</code>æ¥ä¿å­˜æŒæœ‰<code>routerå®ä¾‹</code>çš„<code>vueå®ä¾‹</code></li>
</ul>
</li>
<li>æ³¨å†Œäº†ä¸€ä¸ªä¸€æ¬¡æ€§é’©å­<code>destroyed</code>ï¼Œåœ¨<code>destroyed</code>æ—¶ï¼Œå¸è½½<code>this.app</code>ï¼Œé¿å…å†…å­˜æ³„éœ²</li>
<li>æ£€æŸ¥äº†<code>this.app</code>ï¼Œé¿å…é‡å¤äº‹ä»¶ç›‘å¬</li>
<li>æ ¹æ®<code>history</code>ç±»å‹ï¼Œè°ƒç”¨<code>transitionTo</code>è·³è½¬åˆ°ä¸åŒçš„åˆå§‹é¡µé¢</li>
<li>æ³¨å†Œ<code>updateRoute</code>å›è°ƒï¼Œåœ¨<code>router</code>æ›´æ–°æ—¶ï¼Œæ›´æ–°<code>app._route</code>å®Œæˆé¡µé¢é‡æ–°æ¸²æŸ“<ul>
<li>è¿™ä¸ªæˆ‘ä»¬åœ¨<code>viewç»„ä»¶</code>ç« èŠ‚ä¼šè¯¦ç»†è®²</li>
</ul>
</li>
<li>æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹<code>transitionTo</code>ç›¸å…³é€»è¾‘</li>
</ul>
<h3 id="setupListeners"><a href="#setupListeners" class="headerlink" title="setupListeners"></a>setupListeners</h3><ul>
<li>ä¸Šé¢è¯´åˆ°ï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šæ ¹æ®<code>historyç±»å‹</code>ï¼Œè°ƒç”¨<code>transitionTo</code>è·³è½¬åˆ°ä¸åŒçš„åˆå§‹é¡µé¢</li>
<li>ä¸ºä»€ä¹ˆè¦è·³è½¬åˆå§‹é¡µé¢ï¼Ÿ<ul>
<li>å› ä¸ºåœ¨åˆå§‹åŒ–æ—¶ï¼Œurl å¯èƒ½æŒ‡å‘å…¶å®ƒé¡µé¢ï¼Œæ­¤æ—¶éœ€è¦è°ƒç”¨<code>getCurrentLocation</code>æ–¹æ³•ï¼Œä»å½“å‰ url ä¸Šè§£æå‡ºè·¯ç”±ï¼Œç„¶åè·³è½¬ä¹‹</li>
</ul>
</li>
<li>å¯ä»¥çœ‹åˆ°<code>HTML5Historyç±»</code>å’Œ<code>HashHistoryç±»</code>è°ƒç”¨<code>transitionTo</code>æ–¹æ³•çš„å‚æ•°ä¸å¤ªä¸€æ ·<ul>
<li>å‰è€…åªä¼ å…¥äº†ä¸€ä¸ªå‚æ•°</li>
<li>åè€…ä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°</li>
</ul>
</li>
<li>æˆ‘ä»¬çœ‹ä¸‹<code>transitionTo</code>æ–¹æ³•çš„æ–¹æ³•ç­¾å</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Â src/history/base.js</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//Â çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">export</span>Â <span class="keyword">class</span>Â HistoryÂ &#123;</span><br><span class="line">Â Â ...</span><br><span class="line">Â Â </span><br><span class="line">Â Â <span class="comment">//Â è·¯ç”±è·³è½¬</span></span><br><span class="line">Â Â transitionToÂ (</span><br><span class="line">Â Â Â Â location:Â RawLocation,Â <span class="comment">//Â åŸå§‹locationï¼Œä¸€ä¸ªurlæˆ–è€…æ˜¯ä¸€ä¸ªLocationÂ interface(è‡ªå®šä¹‰å½¢çŠ¶ï¼Œåœ¨types/router.d.tsä¸­å®šä¹‰)</span></span><br><span class="line">Â Â Â Â onComplete?:Â <span class="built_in">Function</span>,Â <span class="comment">//Â è·³è½¬æˆåŠŸå›è°ƒ</span></span><br><span class="line">Â Â Â Â onAbort?:Â <span class="built_in">Function</span><span class="comment">//Â è·³è½¬å¤±è´¥å›è°ƒ</span></span><br><span class="line">Â Â )Â &#123;</span><br><span class="line">Â Â Â Â ...Â Â Â </span><br><span class="line">Â Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–ä¸ªå‚æ•°æ˜¯éœ€è¦è§£æçš„åœ°å€ï¼Œç¬¬äºŒæ˜¯è·³è½¬æˆåŠŸå›è°ƒï¼Œç¬¬ä¸‰ä¸ªæ˜¯è·³è½¬å¤±è´¥å›è°ƒ</li>
<li>æˆ‘ä»¬æ¥çœ‹ä¸‹<code>HashHistory</code> ç±»ä¸ºä½•éœ€è¦ä¼ å…¥å›è°ƒ</li>
<li>å¯ä»¥çœ‹åˆ°ä¼ å…¥çš„æˆåŠŸã€å¤±è´¥å›è°ƒéƒ½æ˜¯<code>setupHashListener</code>å‡½æ•°,<code>setupHashListener</code>å‡½æ•°å†…éƒ¨è°ƒç”¨äº†<code>history.setupListeners</code>æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯<code>HashHistoryç±»</code>ç‹¬æœ‰çš„</li>
<li>æ‰“å¼€<code>src/history/hash.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/hash.js</span></span><br><span class="line"></span><br><span class="line">Â Â <span class="comment">//Â thisÂ isÂ delayedÂ untilÂ theÂ appÂ mounts</span></span><br><span class="line">Â Â <span class="comment">//Â toÂ avoidÂ theÂ hashchangeÂ listenerÂ beingÂ firedÂ tooÂ early</span></span><br><span class="line">Â Â <span class="comment">//Â ä¿®å¤#725;https://github.com/vuejs/vue-router/issues/725</span></span><br><span class="line">Â Â <span class="comment">//Â å› ä¸ºå¦‚æœé’©å­å‡½æ•°Â beforeEnterÂ æ˜¯å¼‚æ­¥çš„è¯,Â beforeEnterÂ é’©å­å°±ä¼šè¢«è§¦å‘ä¸¤æ¬¡.Â å› ä¸ºåœ¨åˆå§‹åŒ–æ—¶,Â å¦‚æœæ­¤æ—¶çš„Â hashÂ å€¼ä¸æ˜¯ä»¥Â /Â å¼€å¤´çš„è¯å°±ä¼šè¡¥ä¸ŠÂ #/,Â è¿™ä¸ªè¿‡ç¨‹ä¼šè§¦å‘Â hashchangeÂ äº‹ä»¶,Â å°±ä¼šå†èµ°ä¸€æ¬¡ç”Ÿå‘½å‘¨æœŸé’©å­,Â ä¹Ÿå°±æ„å‘³ç€ä¼šå†æ¬¡è°ƒç”¨Â beforeEnterÂ é’©å­å‡½æ•°.</span></span><br><span class="line">Â Â setupListenersÂ ()Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â routerÂ =Â <span class="keyword">this</span>.router</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â expectScrollÂ =Â router.options.scrollBehavior</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â supportsScrollÂ =Â supportsPushStateÂ &amp;&amp;Â expectScroll</span><br><span class="line">Â Â Â Â <span class="comment">//Â è‹¥æ”¯æŒscroll,åˆå§‹åŒ–scrollç›¸å…³é€»è¾‘</span></span><br><span class="line">Â Â Â Â <span class="keyword">if</span>Â (supportsScroll)Â &#123;</span><br><span class="line">Â Â Â Â Â Â setupScroll()</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="comment">//Â æ·»åŠ äº‹ä»¶ç›‘å¬</span></span><br><span class="line">Â Â Â Â <span class="built_in">window</span>.addEventListener(</span><br><span class="line">Â Â Â Â Â Â supportsPushStateÂ ?Â <span class="string">'popstate'</span>Â :Â <span class="string">'hashchange'</span>,Â <span class="comment">//Â ä¼˜å…ˆä½¿ç”¨popstate</span></span><br><span class="line">Â Â Â Â Â Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â currentÂ =Â <span class="keyword">this</span>.current</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (!ensureSlash())Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">return</span></span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">this</span>.transitionTo(getHash(),Â <span class="function"><span class="params">route</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (supportsScroll)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â handleScroll(<span class="keyword">this</span>.router,Â <span class="comment">/*Â to*/</span>route,Â <span class="comment">/*Â from*/</span>current,Â <span class="literal">true</span>)</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="comment">//Â ä¸æ”¯æŒpushStateï¼Œç›´æ¥æ›¿æ¢è®°å½•</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (!supportsPushState)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â replaceHash(route.fullPath)</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â )</span><br><span class="line">Â Â &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸»è¦é€»è¾‘å¦‚ä¸‹</li>
<li><code>setupListeners</code>ä¸»è¦åˆ¤æ–­äº†æ˜¯å¦éœ€è¦æ”¯æŒæ»šåŠ¨è¡Œä¸ºï¼Œå¦‚æœæ”¯æŒï¼Œåˆ™åˆå§‹åŒ–ç›¸å…³é€»è¾‘</li>
<li>ç„¶åæ·»åŠ <code>urlå˜åŒ–</code>äº‹ä»¶ç›‘å¬ï¼Œä¹‹å‰è¯´è¿‡å®ç°è·¯ç”±æœ‰ä¸¤ç§æ–¹æ¡ˆ<code>pushState+popState</code>ã€<code>hash+hashChange</code></li>
<li>å¯ä»¥çœ‹åˆ°è¿™é‡Œå³ä½¿æ˜¯<code>HashHistory</code>ä¹Ÿä¼šä¼˜å…ˆä½¿ç”¨<code>popstate</code>äº‹ä»¶æ¥ç›‘å¬<code>url</code>çš„å˜åŒ–</li>
<li>å½“<code>url</code>å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨<code>transitionTo</code>è·³è½¬æ–°è·¯ç”±</li>
<li>å¯ä»¥çœ‹åˆ°è¿™ä¸€å—çš„é€»è¾‘å’Œ<code>HTML5Historyç±»</code>åœ¨å®ä¾‹åŒ–æ—¶å¤„ç†çš„é€»è¾‘å¾ˆç±»ä¼¼</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/html5.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HTML5History <span class="keyword">extends</span> History &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params">router: Router, base: ?<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æµ‹æ˜¯å¦éœ€è¦æ”¯æŒscroll</span></span><br><span class="line">    <span class="keyword">const</span> expectScroll = router.options.scrollBehavior</span><br><span class="line">    <span class="keyword">const</span> supportsScroll = supportsPushState &amp;&amp; expectScroll</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‹¥æ”¯æŒscroll,åˆå§‹åŒ–scrollç›¸å…³é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">      setupScroll()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–åˆå§‹location</span></span><br><span class="line">    <span class="keyword">const</span> initLocation = getLocation(<span class="keyword">this</span>.base)</span><br><span class="line">    <span class="comment">// ç›‘å¬popstateäº‹ä»¶</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è·¯ç”±åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è·³è½¬ï¼Œå¹¶åœ¨è·³è½¬åå¤„ç†æ»šåŠ¨</span></span><br><span class="line">      <span class="keyword">this</span>.transitionTo(location, <span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (supportsScroll) &#123;</span><br><span class="line">          handleScroll(router, route, current, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é‚£ä¸ºä½•äºŒè€…å¤„ç†çš„æ—¶æœºä¸åŒå‘¢ï¼Ÿ<ul>
<li><code>HTML5Histroy</code>åœ¨å®ä¾‹åŒ–æ—¶ç›‘å¬äº‹ä»¶</li>
<li><code>HashHistory</code>åœ¨åˆæ¬¡è·¯ç”±è·³è½¬ç»“æŸåç›‘å¬äº‹ä»¶</li>
</ul>
</li>
<li>è¿™æ˜¯ä¸ºäº†ä¿®å¤<a href="https://github.com/vuejs/vue-router/issues/725" target="_blank" rel="noopener">#725 é—®é¢˜</a><ul>
<li>å¦‚æœ<code>beforeEnter</code>æ˜¯å¼‚æ­¥çš„è¯ï¼Œ<code>beforeEnter</code>å°±ä¼šè§¦å‘ä¸¤æ¬¡ï¼Œè¿™æ˜¯å› ä¸ºåœ¨åˆå§‹åŒ–æ—¶ï¼Œ<code>hash</code>  å€¼ä¸æ˜¯  <code>/</code>  å¼€å¤´çš„è¯å°±ä¼šè¡¥ä¸Š<code>#/</code>ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè§¦å‘  <code>hashchange</code>  äº‹ä»¶ï¼Œæ‰€ä»¥ä¼šå†èµ°ä¸€æ¬¡ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå¯¼è‡´å†æ¬¡è°ƒç”¨  <code>beforeEnter</code>  é’©å­å‡½æ•°ã€‚æ‰€ä»¥åªèƒ½å°†<code>hashChange</code>äº‹ä»¶çš„ç›‘å¬å»¶è¿Ÿåˆ°åˆå§‹è·¯ç”±è·³è½¬å®Œæˆåï¼›</li>
</ul>
</li>
</ul>
<h3 id="å°ç»“-5"><a href="#å°ç»“-5" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul>
<li>é’ˆå¯¹ init æµç¨‹ï¼Œæ€»ç»“äº†ä¸‹é¢çš„æ´»åŠ¨å›¾</li>
<li>init.png<ul>
<li><img src="/2020/04/27/vue-router-analysis-part1/init.png" alt="init.png"></li>
</ul>
</li>
</ul>
<h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>æ–‡ç« ä¸»è¦ä»å‰ç«¯è·¯ç”±çš„æ•´ä½“è®¾è®¡æ€è·¯å¼€å§‹ï¼Œé€æ­¥åˆ†æå‰ç«¯è·¯ç”±è®¾è®¡çš„åŸºæœ¬åŸåˆ™ï¼Œç†æ¸…è®¾è®¡æ€è·¯</li>
<li>ç„¶åä»‹ç»äº†è´¯ç©¿å…¨å±€çš„<code>vue-router</code>å‡ ä¸ªæœ¯è¯­</li>
<li>å¯¹æœ¯è¯­æœ‰ä¸ªå¤§æ¦‚å°è±¡åï¼Œæˆ‘ä»¬åˆä»‹ç»äº†<code>vue-router</code>çš„ç›®å½•ç»“æ„ï¼Œå…¶æ˜¯å¦‚ä½•è¿›è¡Œåˆ†å±‚çš„</li>
<li>äº†è§£ç›®å½•ç»“æ„åï¼Œæˆ‘ä»¬ä»å®‰è£…å¼€å§‹å‰–æï¼Œäº†è§£<code>vue-router</code>åœ¨å®‰è£…æ—¶éƒ½åšäº†å“ªäº›äº‹</li>
<li>å®‰è£…ç»“æŸï¼Œæˆ‘ä»¬åˆä»‹ç»äº†å‡ ä¸ª<code>Historyç±»</code>ä¹‹é—´æ˜¯æ€æ ·çš„ç»§æ‰¿å…³ç³»ï¼Œå…¶åˆæ˜¯å¦‚ä½•å®ä¾‹åŒ–çš„</li>
<li>å®ä¾‹åŒ–ç»“æŸï¼Œæˆ‘ä»¬æœ€åä»‹ç»äº†åˆå§‹åŒ–çš„è¿‡ç¨‹</li>
</ul>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><ul>
<li>åé¢è¿˜ä¼šä»‹ç»å…¶ä½™éƒ¨åˆ†ï¼Œå¦‚æœè§‰å¾—è¿˜è¡Œï¼Œå¯ä»¥ç»™ä¸ªèµå“¦ âœ¨</li>
<li>ä¸ªäºº<code>github</code>ï¼Œä¹Ÿæ€»ç»“äº†ä¸€äº›ä¸œè¥¿ï¼Œæ¬¢è¿ star</li>
<li>åŸºäº canvas çš„ç»˜å›¾æ¿<a href="https://github.com/BryanAdamss/drawing-board" target="_blank" rel="noopener">drawing-board</a></li>
<li>å‰ç«¯å…¥é—¨ demoã€æœ€ä½³å®è·µé›†åˆ <a href="https://github.com/BryanAdamss/fe-awesome-demos" target="_blank" rel="noopener">fe-awesome-demos</a></li>
<li>ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆåˆ«åçš„<code>vue-cli-plugin</code><a href="https://www.npmjs.com/package/vue-cli-plugin-auto-alias" target="_blank" rel="noopener">https://www.npmjs.com/package/vue-cli-plugin-auto-alias</a></li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/dwqs/blog/issues/53" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/53</a></li>
<li><a href="https://github.com/dwqs/blog/issues/54" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/54</a></li>
<li><a href="https://github.com/dwqs/blog/issues/55" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/55</a></li>
<li><a href="https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643" target="_blank" rel="noopener">https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643</a></li>
<li><a href="https://juejin.im/post/5e456513f265da573c0c6d4b" target="_blank" rel="noopener">https://juejin.im/post/5e456513f265da573c0c6d4b</a></li>
<li><a href="https://juejin.im/post/584040e1ac502e006cbedb23" target="_blank" rel="noopener">https://juejin.im/post/584040e1ac502e006cbedb23</a></li>
<li><a href="https://juejin.im/post/5df0ada0f265da33d56d1a2f" target="_blank" rel="noopener">https://juejin.im/post/5df0ada0f265da33d56d1a2f</a></li>
<li><a href="https://juejin.im/post/5dbed0bef265da4cff701f68" target="_blank" rel="noopener">https://juejin.im/post/5dbed0bef265da4cff701f68</a></li>
<li><a href="https://www.jianshu.com/p/29e8214d0bee" target="_blank" rel="noopener">https://www.jianshu.com/p/29e8214d0bee</a></li>
<li><a href="https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/" target="_blank" rel="noopener">https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/</a></li>
<li><a href="https://blog.liuyunzhuge.com/2020/04/08/vue-routeræºç ï¼šcreate-matcher/" target="_blank" rel="noopener">https://blog.liuyunzhuge.com/2020/04/08/vue-router æºç ï¼šcreate-matcher/</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue/" rel="tag"># vue</a>
          
            <a href="/tags/vue-router/" rel="tag"># vue-router</a>
          
            <a href="/tags/æºç è§£æ/" rel="tag"># æºç è§£æ</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/27/ssh-multiple-account/" rel="next" title="ssh-multiple-account">
                <i class="fa fa-chevron-left"></i> ssh-multiple-account
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/22/vue-cli-mode/" rel="prev" title="vue-cli-mode">
                vue-cli-mode <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/Avatar.png"
               alt="BryanAdamss" />
          <p class="site-author-name" itemprop="name">BryanAdamss</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">64</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">91</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/BryanAdamss" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#vue-router-æºç è§£æ-1-3w-å­—-å¤šå›¾é¢„è­¦-ã€ä¸Šã€‘"><span class="nav-number">1.</span> <span class="nav-text">vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#è®¾è®¡æ€è·¯"><span class="nav-number">1.1.</span> <span class="nav-text">è®¾è®¡æ€è·¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±"><span class="nav-number">1.1.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¦‚ä½•å®ç°å‰ç«¯è·¯ç”±"><span class="nav-number">1.1.2.</span> <span class="nav-text">å¦‚ä½•å®ç°å‰ç«¯è·¯ç”±</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">1.1.3.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ¯è¯­"><span class="nav-number">1.2.</span> <span class="nav-text">æœ¯è¯­</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è·¯ç”±è§„åˆ™ã€é…ç½®å¯¹è±¡-RouteConfig"><span class="nav-number">1.2.1.</span> <span class="nav-text">è·¯ç”±è§„åˆ™ã€é…ç½®å¯¹è±¡(RouteConfig)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·¯ç”±è®°å½•-RouteRecord"><span class="nav-number">1.2.2.</span> <span class="nav-text">è·¯ç”±è®°å½•(RouteRecord)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·¯ç”±å¯¹è±¡-Route"><span class="nav-number">1.2.3.</span> <span class="nav-text">è·¯ç”±å¯¹è±¡(Route)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½ç½®-Location"><span class="nav-number">1.2.4.</span> <span class="nav-text">ä½ç½®(Location)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·¯ç”±ç»„ä»¶-RouteComponent"><span class="nav-number">1.2.5.</span> <span class="nav-text">è·¯ç”±ç»„ä»¶(RouteComponent)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç¯å¢ƒ"><span class="nav-number">1.3.</span> <span class="nav-text">ç¯å¢ƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç›®å½•ç»“æ„"><span class="nav-number">1.4.</span> <span class="nav-text">ç›®å½•ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç›®å½•"><span class="nav-number">1.4.1.</span> <span class="nav-text">ç›®å½•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸºç¡€ä¾‹å­"><span class="nav-number">1.5.</span> <span class="nav-text">åŸºç¡€ä¾‹å­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£…æµç¨‹"><span class="nav-number">1.6.</span> <span class="nav-text">å®‰è£…æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#install-js"><span class="nav-number">1.6.1.</span> <span class="nav-text">install.js</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#é¿å…é‡å¤å®‰è£…"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">é¿å…é‡å¤å®‰è£…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¿ç•™Vueå¼•ç”¨ï¼Œé¿å…å°†Vueåšä¸ºä¾èµ–æ‰“åŒ…"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">ä¿ç•™Vueå¼•ç”¨ï¼Œé¿å…å°†Vueåšä¸ºä¾èµ–æ‰“åŒ…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ³¨å†Œäº†ä¸€ä¸ªå…¨å±€æ··å…¥"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">æ³¨å†Œäº†ä¸€ä¸ªå…¨å±€æ··å…¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ·»åŠ å®ä¾‹å±æ€§ã€æ–¹æ³•"><span class="nav-number">1.6.1.4.</span> <span class="nav-text">æ·»åŠ å®ä¾‹å±æ€§ã€æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ³¨å†Œ-router-viewã€router-link-å…¨å±€ç»„ä»¶"><span class="nav-number">1.6.1.5.</span> <span class="nav-text">æ³¨å†Œ router-viewã€router-link å…¨å±€ç»„ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è®¾ç½®è·¯ç”±ç»„ä»¶å®ˆå«çš„åˆå¹¶ç­–ç•¥"><span class="nav-number">1.6.1.6.</span> <span class="nav-text">è®¾ç½®è·¯ç”±ç»„ä»¶å®ˆå«çš„åˆå¹¶ç­–ç•¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ€»ç»“-1"><span class="nav-number">1.6.1.7.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ä¾‹åŒ–æµç¨‹"><span class="nav-number">1.7.</span> <span class="nav-text">å®ä¾‹åŒ–æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VueRouter-çš„æ„é€ å‡½æ•°"><span class="nav-number">1.7.1.</span> <span class="nav-text">VueRouter çš„æ„é€ å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ¥æ”¶-RouterOptions"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">æ¥æ”¶ RouterOptions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å±æ€§èµ‹åˆå€¼"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">å±æ€§èµ‹åˆå€¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ›å»º-matcher"><span class="nav-number">1.7.1.3.</span> <span class="nav-text">åˆ›å»º matcher</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç¡®å®šè·¯ç”±æ¨¡å¼"><span class="nav-number">1.7.1.4.</span> <span class="nav-text">ç¡®å®šè·¯ç”±æ¨¡å¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ ¹æ®è·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒçš„-History-å®ä¾‹"><span class="nav-number">1.7.1.5.</span> <span class="nav-text">æ ¹æ®è·¯ç”±æ¨¡å¼ç”Ÿæˆä¸åŒçš„ History å®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å°ç»“"><span class="nav-number">1.7.1.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»ºåŒ¹é…å™¨"><span class="nav-number">1.7.2.</span> <span class="nav-text">åˆ›å»ºåŒ¹é…å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å°ç»“-1"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#createRouteMap"><span class="nav-number">1.7.3.</span> <span class="nav-text">createRouteMap</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å°ç»“-2"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#addRouteRecord"><span class="nav-number">1.7.4.</span> <span class="nav-text">addRouteRecord</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç”Ÿæˆè·¯ç”±è®°å½•"><span class="nav-number">1.7.4.1.</span> <span class="nav-text">ç”Ÿæˆè·¯ç”±è®°å½•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç”ŸæˆåµŒå¥—è·¯ç”±è®°å½•"><span class="nav-number">1.7.4.2.</span> <span class="nav-text">ç”ŸæˆåµŒå¥—è·¯ç”±è®°å½•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•"><span class="nav-number">1.7.4.3.</span> <span class="nav-text">ç”Ÿæˆåˆ«åè·¯ç”±è®°å½•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å°ç»“-3"><span class="nav-number">1.7.4.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·¯ç”±æ¨¡å¼"><span class="nav-number">1.7.5.</span> <span class="nav-text">è·¯ç”±æ¨¡å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ ¸å¿ƒç±»"><span class="nav-number">1.7.5.1.</span> <span class="nav-text">æ ¸å¿ƒç±»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#History-ç±»"><span class="nav-number">1.7.5.2.</span> <span class="nav-text">History ç±»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTML5History-ç±»"><span class="nav-number">1.7.5.3.</span> <span class="nav-text">HTML5History ç±»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HashHistory-ç±»"><span class="nav-number">1.7.5.4.</span> <span class="nav-text">HashHistory ç±»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AbstractHistory-ç±»"><span class="nav-number">1.7.5.5.</span> <span class="nav-text">AbstractHistory ç±»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å°ç»“-4"><span class="nav-number">1.7.5.6.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆå§‹åŒ–æµç¨‹"><span class="nav-number">1.8.</span> <span class="nav-text">åˆå§‹åŒ–æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è°ƒç”¨-init-æ—¶æœº"><span class="nav-number">1.8.1.</span> <span class="nav-text">è°ƒç”¨ init æ—¶æœº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#init-æ–¹æ³•"><span class="nav-number">1.8.2.</span> <span class="nav-text">init æ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setupListeners"><span class="nav-number">1.8.3.</span> <span class="nav-text">setupListeners</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å°ç»“-5"><span class="nav-number">1.8.4.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“-2"><span class="nav-number">1.9.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PS"><span class="nav-number">1.10.</span> <span class="nav-text">PS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">1.11.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BryanAdamss</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


  

</body>
</html>
