<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="vue,vue-router,æºç è§£æ," />








  <link rel="shortcut icon" type="image/x-icon" href="/Avatar.png?v=5.1.0" />






<meta name="description" content="vue-router æºç è§£æ | 6k å­— | å¤šå›¾é¢„è­¦ - ã€ä¸‹ã€‘ å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜ æœ¬ç¯‡æ˜¯vue-routeræºç è§£æçš„ä¸‹ç¯‡ï¼Œå³æ”¶å°¾ç¯‡ æœ¬ç¯‡ä¸»è¦ä»‹ç»äº†ä¸‹é¢å‡ ç‚¹ ä»‹ç»äº†vue-routeræ˜¯å¦‚ä½•å¤„ç†æ»šåŠ¨çš„ viewã€linkç»„ä»¶éƒ½æ€ä¹ˆå®ç°çš„ï¼Ÿ è·¯ç”±å˜åŒ–åˆæ˜¯æ€ä¹ˆè§¦å‘é‡æ–°æ¸²æŸ“çš„ç­‰ç­‰   å¦å¤–è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ ç¬¬ä¸€æ¬¡åšæºç è§£æï¼Œè‚¯å®šæœ‰å¾ˆå¤šé”™è¯¯æˆ–ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ ğŸ¤   é¡¹ç›®åœ°å€ htt">
<meta name="keywords" content="vue,vue-router,æºç è§£æ">
<meta property="og:type" content="article">
<meta property="og:title" content="vue-router-analysis-part3">
<meta property="og:url" content="http://yoursite.com/2020/12/06/vue-router-analysis-part3/index.html">
<meta property="og:site_name" content="BryanAdamssçš„åšå®¢">
<meta property="og:description" content="vue-router æºç è§£æ | 6k å­— | å¤šå›¾é¢„è­¦ - ã€ä¸‹ã€‘ å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜ æœ¬ç¯‡æ˜¯vue-routeræºç è§£æçš„ä¸‹ç¯‡ï¼Œå³æ”¶å°¾ç¯‡ æœ¬ç¯‡ä¸»è¦ä»‹ç»äº†ä¸‹é¢å‡ ç‚¹ ä»‹ç»äº†vue-routeræ˜¯å¦‚ä½•å¤„ç†æ»šåŠ¨çš„ viewã€linkç»„ä»¶éƒ½æ€ä¹ˆå®ç°çš„ï¼Ÿ è·¯ç”±å˜åŒ–åˆæ˜¯æ€ä¹ˆè§¦å‘é‡æ–°æ¸²æŸ“çš„ç­‰ç­‰   å¦å¤–è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ ç¬¬ä¸€æ¬¡åšæºç è§£æï¼Œè‚¯å®šæœ‰å¾ˆå¤šé”™è¯¯æˆ–ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ ğŸ¤   é¡¹ç›®åœ°å€ htt">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/917b376a388f43faa6c8f8d81f730bcb~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:updated_time" content="2020-12-06T04:24:44.886Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vue-router-analysis-part3">
<meta name="twitter:description" content="vue-router æºç è§£æ | 6k å­— | å¤šå›¾é¢„è­¦ - ã€ä¸‹ã€‘ å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜ æœ¬ç¯‡æ˜¯vue-routeræºç è§£æçš„ä¸‹ç¯‡ï¼Œå³æ”¶å°¾ç¯‡ æœ¬ç¯‡ä¸»è¦ä»‹ç»äº†ä¸‹é¢å‡ ç‚¹ ä»‹ç»äº†vue-routeræ˜¯å¦‚ä½•å¤„ç†æ»šåŠ¨çš„ viewã€linkç»„ä»¶éƒ½æ€ä¹ˆå®ç°çš„ï¼Ÿ è·¯ç”±å˜åŒ–åˆæ˜¯æ€ä¹ˆè§¦å‘é‡æ–°æ¸²æŸ“çš„ç­‰ç­‰   å¦å¤–è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ ç¬¬ä¸€æ¬¡åšæºç è§£æï¼Œè‚¯å®šæœ‰å¾ˆå¤šé”™è¯¯æˆ–ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ ğŸ¤   é¡¹ç›®åœ°å€ htt">
<meta name="twitter:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/917b376a388f43faa6c8f8d81f730bcb~tplv-k3u1fbpfcp-watermark.image">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/12/06/vue-router-analysis-part3/"/>





  <title> vue-router-analysis-part3 | BryanAdamssçš„åšå®¢ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BryanAdamssçš„åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¸€ä¸ªä¼ªå‰ç«¯</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/06/vue-router-analysis-part3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BryanAdamss">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/Avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BryanAdamssçš„åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                vue-router-analysis-part3
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-12-06T12:13:35+08:00">
                2020-12-06 12:13:35
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FrontEnd/" itemprop="url" rel="index">
                    <span itemprop="name">å‰ç«¯</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="vue-router-æºç è§£æ-6k-å­—-å¤šå›¾é¢„è­¦-ã€ä¸‹ã€‘"><a href="#vue-router-æºç è§£æ-6k-å­—-å¤šå›¾é¢„è­¦-ã€ä¸‹ã€‘" class="headerlink" title="vue-router æºç è§£æ | 6k å­— | å¤šå›¾é¢„è­¦ - ã€ä¸‹ã€‘"></a>vue-router æºç è§£æ | 6k å­— | å¤šå›¾é¢„è­¦ - ã€ä¸‹ã€‘</h1><ul>
<li>å„ä½å¥½ï¼Œæˆ‘æ˜¯å…‰è¾‰ ğŸ˜</li>
<li>æœ¬ç¯‡æ˜¯<code>vue-router</code>æºç è§£æçš„ä¸‹ç¯‡ï¼Œå³æ”¶å°¾ç¯‡</li>
<li>æœ¬ç¯‡ä¸»è¦ä»‹ç»äº†ä¸‹é¢å‡ ç‚¹<ul>
<li>ä»‹ç»äº†<code>vue-router</code>æ˜¯å¦‚ä½•å¤„ç†æ»šåŠ¨çš„</li>
<li><code>viewã€link</code>ç»„ä»¶éƒ½æ€ä¹ˆå®ç°çš„ï¼Ÿ</li>
<li>è·¯ç”±å˜åŒ–åˆæ˜¯æ€ä¹ˆè§¦å‘é‡æ–°æ¸²æŸ“çš„ç­‰ç­‰</li>
</ul>
</li>
<li>å¦å¤–è¿˜æ˜¯è¦è¯´ä¸€ä¸‹<ul>
<li>ç¬¬ä¸€æ¬¡åšæºç è§£æï¼Œè‚¯å®šæœ‰å¾ˆå¤šé”™è¯¯æˆ–ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ ğŸ¤</li>
</ul>
</li>
<li>é¡¹ç›®åœ°å€<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis</code></li>
<li>å¦‚æœè§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç»™æˆ‘ä¸€ä¸ª<code>star</code>âœ¨</li>
</ul>
</li>
<li>uml å›¾æºæ–‡ä»¶<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis/blob/dev/vue-router.EAP</code></li>
</ul>
</li>
<li>å…³è”æ–‡ç« é“¾æ¥<ul>
<li><a href="https://juejin.cn/post/6880529850159874062" target="_blank" rel="noopener">vue-router æºç è§£æ | 1.3w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸Šã€‘</a></li>
<li><a href="https://juejin.cn/post/6901047675227996167" target="_blank" rel="noopener">vue-router æºç è§£æ | 1.5w å­— | å¤šå›¾é¢„è­¦ - ã€ä¸­ã€‘</a></li>
<li><a href="https://juejin.cn/post/6902992939115855880" target="_blank" rel="noopener">vue-router æºç è§£æ | 6k å­— - ã€ä¸‹ã€‘</a></li>
</ul>
</li>
</ul>
<h2 id="æ»šåŠ¨å¤„ç†"><a href="#æ»šåŠ¨å¤„ç†" class="headerlink" title="æ»šåŠ¨å¤„ç†"></a>æ»šåŠ¨å¤„ç†</h2><ul>
<li>æˆ‘ä»¬çŸ¥é“<code>vue-router</code>å¯ä»¥å¤„ç†ä¸€äº›æ»šåŠ¨è¡Œä¸ºï¼Œä¾‹å¦‚è®°å½•é¡µé¢æ»šåŠ¨ä½ç½®ï¼Œç„¶ååœ¨åˆ‡æ¢è·¯ç”±æ—¶æ»šåˆ°é¡¶éƒ¨æˆ–ä¿æŒåŸå…ˆä½ç½®ï¼›<ul>
<li><a href="https://router.vuejs.org/zh/guide/advanced/scroll-behavior.html#æ»šåŠ¨è¡Œä¸º" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/advanced/scroll-behavior.html#æ»šåŠ¨è¡Œä¸º</a></li>
</ul>
</li>
<li>å®ƒä¸»è¦æ¥æ”¶ä¸€ä¸ª<code>scrollBehavior</code>å‚æ•°ï¼Œ<code>scrollBehavior</code>æœ‰ä»¥ä¸‹ç©æ³•</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">      routes: [...],</span><br><span class="line">      scrollBehavior (to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">        <span class="comment">// return æœŸæœ›æ»šåŠ¨åˆ°å“ªä¸ªçš„ä½ç½®</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ»šåŠ¨åˆ°æŒ‡å®šåæ ‡</span></span><br><span class="line">scrollBehavior (to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; x: <span class="number">0</span>, y: <span class="number">0</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ»šåŠ¨åˆ°æŒ‡å®šé¡µé¢é”šç‚¹</span></span><br><span class="line">scrollBehavior (to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.hash) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      selector: to.hash</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// v2.8.0+ å¼‚æ­¥æ»šåŠ¨</span></span><br><span class="line">scrollBehavior (to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          resolve(&#123; x: <span class="number">0</span>, y: <span class="number">0</span> &#125;)</span><br><span class="line">        &#125;, <span class="number">500</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¢æ”¯æŒæ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ï¼Œä¹Ÿå¯ä»¥æ»šåŠ¨é¡µé¢æŸä¸ªé¡µé¢é”šç‚¹ä½ç½®å’Œå¼‚æ­¥æ»šåŠ¨</li>
<li>é‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°å‘¢?å…·ä½“çš„é€»è¾‘åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</li>
<li>æˆ‘ä»¬å‰é¢éƒ½çŸ¥é“<code>HTML5History</code>åœ¨åˆå§‹åŒ–æ—¶å’Œ<code>HashHistory</code>åœ¨<code>setupListener</code>æ—¶éƒ½ä¼šè°ƒç”¨<code>setupScroll</code>å‡½æ•°ï¼Œåˆå§‹åŒ–æ»šåŠ¨ç›¸å…³çš„é€»è¾‘</li>
<li>å¹¶åœ¨<code>popstate</code>æˆ–<code>hashchange</code>äº‹ä»¶è§¦å‘è·¯ç”±è·³è½¬æ—¶ï¼Œè°ƒç”¨<code>handleScroll</code>å¤„ç†æ»šåŠ¨è¡Œä¸º</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/hash.js</span></span><br><span class="line"></span><br><span class="line">Â setupListenersÂ ()Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â routerÂ =Â <span class="keyword">this</span>.router</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â expectScrollÂ =Â router.options.scrollBehavior</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â supportsScrollÂ =Â supportsPushStateÂ &amp;&amp;Â expectScroll</span><br><span class="line"></span><br><span class="line">Â Â Â Â <span class="comment">//Â è‹¥æ”¯æŒscroll,åˆå§‹åŒ–scrollç›¸å…³é€»è¾‘</span></span><br><span class="line">Â Â Â Â <span class="keyword">if</span>Â (supportsScroll)Â &#123;</span><br><span class="line">Â Â Â Â Â Â setupScroll()</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="comment">//Â æ·»åŠ äº‹ä»¶ç›‘å¬</span></span><br><span class="line">Â Â Â Â <span class="built_in">window</span>.addEventListener(</span><br><span class="line">Â Â Â Â Â Â supportsPushStateÂ ?Â <span class="string">'popstate'</span>Â :Â <span class="string">'hashchange'</span>,Â <span class="comment">//Â ä¼˜å…ˆä½¿ç”¨popstate</span></span><br><span class="line">Â Â Â Â Â Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â currentÂ =Â <span class="keyword">this</span>.current</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (!ensureSlash())Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">return</span></span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">this</span>.transitionTo(getHash(),Â <span class="function"><span class="params">route</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (supportsScroll)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â handleScroll(<span class="keyword">this</span>.router,Â <span class="comment">/*Â to*/</span>route,Â <span class="comment">/*Â from*/</span>current,Â <span class="literal">true</span>)</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="comment">//Â ä¸æ”¯æŒpushStateï¼Œç›´æ¥æ›¿æ¢è®°å½•</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (!supportsPushState)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â replaceHash(route.fullPath)</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â )</span><br><span class="line">Â Â &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ‘ä»¬å…ˆçœ‹æ»šåŠ¨çš„åˆå§‹åŒ–</li>
</ul>
<h3 id="setupScroll"><a href="#setupScroll" class="headerlink" title="setupScroll"></a>setupScroll</h3><ul>
<li>ä»£ç ä½äº<code>src/util/scroll.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â åˆå§‹åŒ–æ»šåŠ¨ç›¸å…³é€»è¾‘</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setupScroll</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//Â FixÂ forÂ #1585Â forÂ Firefox</span></span><br><span class="line">  <span class="comment">//Â FixÂ forÂ #2195Â AddÂ optionalÂ thirdÂ attributeÂ toÂ workaroundÂ aÂ bugÂ inÂ safariÂ https://bugs.webkit.org/show_bug.cgi?id=182678</span></span><br><span class="line">  <span class="comment">//Â FixÂ forÂ #2774Â SupportÂ forÂ appsÂ loadedÂ fromÂ WindowsÂ fileÂ sharesÂ notÂ mappedÂ toÂ networkÂ drives:Â replacedÂ location.originÂ with</span></span><br><span class="line">  <span class="comment">//Â window.location.protocolÂ +Â '//'Â +Â window.location.host</span></span><br><span class="line">  <span class="comment">//Â location.hostÂ containsÂ theÂ portÂ andÂ location.hostnameÂ doesn't</span></span><br><span class="line">  <span class="keyword">const</span> protocolAndPath = <span class="built_in">window</span>.location.protocol + <span class="string">'//'</span> + <span class="built_in">window</span>.location.host</span><br><span class="line">  <span class="keyword">const</span> absolutePath = <span class="built_in">window</span>.location.href.replace(protocolAndPath, <span class="string">''</span>) <span class="comment">//Â preserveÂ existingÂ historyÂ stateÂ asÂ itÂ couldÂ beÂ overridenÂ byÂ theÂ user //Â æ‹·è´ä¸€ä»½stateï¼Œé˜²æ­¢ç”¨æˆ·è¦†ç›–</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stateCopy = extend(&#123;&#125;, <span class="built_in">window</span>.history.state)</span><br><span class="line">  stateCopy.key = getStateKey() <span class="comment">//Â è¯­æ³•å®šä¹‰:history.replaceState(stateObj,Â title[,Â url]);</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.history.replaceState(stateCopy, <span class="string">''</span>, absolutePath) <span class="comment">//Â ç›‘å¬popstate(åªèƒ½é€šè¿‡æµè§ˆå™¨çš„Â å‰è¿›/åé€€Â æŒ‰é’®è§¦å‘)ï¼Œä¿å­˜æ»šåŠ¨ä½ç½®ï¼Œæ›´æ–°stateKey</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    saveScrollPosition()</span><br><span class="line">    <span class="keyword">if</span> (e.state &amp;&amp; e.state.key) &#123;</span><br><span class="line">      setStateKey(e.state.key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°å…¶åˆ©ç”¨<code>History API</code>çš„æ¥å®Œæˆä½ç½®çš„ä¿å­˜<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History/replaceState" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/History/replaceState</a></li>
</ul>
</li>
<li>åœ¨<code>popstate</code>æ—¶è®°å½•æ»šåŠ¨ä½ç½®å¹¶æ›´æ–°çŠ¶æ€<code>obj</code>çš„<code>key</code></li>
<li>è¿™ä¸ª<code>key</code>æ˜¯ç”¨æ¥åœ¨<code>state</code>ä¸­æ ‡è¯†æ¯ä¸ªè·¯ç”±ç”¨çš„</li>
<li>å¯ä»¥çœ‹ä¸‹<code>key</code>çš„å­˜å–</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/state-key.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â useÂ UserÂ TimingÂ apiÂ (ifÂ present)Â forÂ moreÂ accurateÂ keyÂ precision</span></span><br><span class="line"><span class="keyword">const</span> Time =</span><br><span class="line">  inBrowser &amp;&amp; <span class="built_in">window</span>.performance &amp;&amp; <span class="built_in">window</span>.performance.now</span><br><span class="line">    ? <span class="built_in">window</span>.performance</span><br><span class="line">    : <span class="built_in">Date</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â ç”Ÿæˆå”¯ä¸€keyï¼Œç”¨æ¥åœ¨stateä¸­æ ‡è¯†æ¯ä¸ªè·¯ç”±</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">genStateKey</span>(<span class="params"></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Time.now().toFixed(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _key: <span class="built_in">string</span> = genStateKey()</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getStateKey</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _key</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setStateKey</span>(<span class="params">key: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (_key = key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°å£°æ˜äº†ä¸€ä¸ª<code>_key</code>ï¼Œå…¶æ˜¯ä¸€ä¸ªä¸‰ä½çš„æ—¶é—´æˆ³ï¼Œæ›´æ–°å’Œè¯»å–éƒ½æ˜¯æ“ä½œè¿™ä¸€ä¸ª<code>_key</code></li>
<li><code>setupScroll</code>æ—¶ï¼Œé¦–å…ˆæ‹·è´äº†å½“å‰çš„<code>state</code>ï¼Œå¹¶ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªå”¯ä¸€<code>key</code></li>
<li>é€šè¿‡<code>replaceState</code>å°†æ·»åŠ äº†<code>key</code>çš„<code>state</code>ä¿å­˜åˆ°å½“å‰è·¯ç”±çš„<code>absolutePath</code>ä¸Š</li>
<li>ç„¶åç›‘å¬<code>popstate</code>äº‹ä»¶ï¼Œå…¶åªèƒ½é€šè¿‡æµè§ˆå™¨çš„   å‰è¿›/åé€€   æŒ‰é’®è§¦å‘</li>
<li>è§¦å‘åä¼šä¿å­˜å½“å‰ä½ç½®ï¼Œå¹¶æ›´æ–°<code>_key</code></li>
<li>è¿™æ ·å°±å¯ä»¥åœ¨è·¯ç”±å‘ç”Ÿå˜åŒ–è§¦å‘<code>popstate</code>æ—¶ï¼Œä¿å­˜å½“å‰ä½ç½®å¹¶è®¾ç½®å”¯ä¸€<code>_key</code></li>
<li>çœ‹ä¸‹å…¶æ˜¯å¦‚ä½•å­˜å–ä½ç½®ä¿¡æ¯çš„</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/scroll.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> positionStore = <span class="built_in">Object</span>.create(<span class="literal">null</span>) <span class="comment">//Â ä¿å­˜é¡µé¢æ»šåŠ¨ä½ç½®</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">saveScrollPosition</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = getStateKey()</span><br><span class="line">  <span class="keyword">if</span> (key) &#123;</span><br><span class="line">    positionStore[key] = &#123;</span><br><span class="line">      x: <span class="built_in">window</span>.pageXOffset,</span><br><span class="line">      y: <span class="built_in">window</span>.pageYOffset,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¶åˆ©ç”¨<code>positionStore</code>å¯¹è±¡é…åˆå”¯ä¸€çš„<code>_key</code>æ¥å­˜å–ä½ç½®</li>
<li>åœ¨<code>handleScroll</code>æ—¶å°±å¯ä»¥é€šè¿‡<code>_key</code>å–å‡ºä¹‹å‰ä¿å­˜çš„ä½ç½®</li>
</ul>
<h3 id="handleScroll"><a href="#handleScroll" class="headerlink" title="handleScroll"></a>handleScroll</h3><ul>
<li>å¤„ç†æ»šåŠ¨çš„ä»£ç ä½äº<code>src/util/scroll.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span>Â <span class="function"><span class="keyword">function</span>Â <span class="title">handleScroll</span>Â (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">Â Â router:Â Router,</span></span></span><br><span class="line"><span class="function"><span class="params">Â Â to:Â Route,</span></span></span><br><span class="line"><span class="function"><span class="params">Â Â <span class="keyword">from</span>:Â Route,</span></span></span><br><span class="line"><span class="function"><span class="params">Â Â isPop:Â <span class="built_in">boolean</span><span class="comment">//Â æ˜¯å¦popstateï¼Œåªæœ‰æµè§ˆå™¨çš„Â å‰è¿›/åé€€Â æŒ‰é’®æ‰ä¼šè§¦å‘ï¼Œä¹Ÿåªæœ‰popstateæ—¶ï¼Œæ‰ä¼šä¿å­˜æ»šåŠ¨ä½ç½®</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>)Â </span>&#123;</span><br><span class="line"></span><br><span class="line">Â Â <span class="keyword">if</span>Â (!router.app)Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span></span><br><span class="line">Â Â &#125;</span><br><span class="line">Â Â <span class="keyword">const</span>Â behaviorÂ =Â router.options.scrollBehavior</span><br><span class="line">Â Â <span class="keyword">if</span>Â (!behavior)Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span></span><br><span class="line">Â Â &#125;</span><br><span class="line">Â Â <span class="keyword">if</span>Â (process.env.NODE_ENVÂ !==Â <span class="string">'production'</span>)Â &#123;</span><br><span class="line">Â Â Â Â assert(<span class="keyword">typeof</span>Â behaviorÂ ===Â <span class="string">'function'</span>,Â <span class="string">`scrollBehaviorÂ mustÂ beÂ aÂ function`</span>)</span><br><span class="line">Â Â &#125;</span><br><span class="line"></span><br><span class="line">Â Â <span class="comment">//Â waitÂ untilÂ re-renderÂ finishesÂ beforeÂ scrolling</span></span><br><span class="line">Â Â <span class="comment">//Â é‡æ–°æ¸²æŸ“ç»“æŸï¼Œå†å¤„ç†æ»šåŠ¨</span></span><br><span class="line">Â Â router.app.$nextTick(<span class="function"><span class="params">()</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â positionÂ =Â getScrollPosition()Â <span class="comment">//Â è·å–ä¹‹å‰ä¿å­˜çš„æ»šåŠ¨ä½ç½®</span></span><br><span class="line"></span><br><span class="line">Â Â Â Â <span class="comment">//Â https://router.vuejs.org/zh/guide/advanced/scroll-behavior.html#%E6%BB%9A%E5%8A%A8%E8%A1%8C%E4%B8%BA</span></span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â shouldScrollÂ =Â behavior.call(</span><br><span class="line">Â Â Â Â Â Â router,</span><br><span class="line">Â Â Â Â Â Â to,</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">from</span>,</span><br><span class="line">Â Â Â Â Â Â isPopÂ ?Â positionÂ :Â <span class="literal">null</span>Â <span class="comment">//Â ç¬¬ä¸‰ä¸ªå‚æ•°Â savedPositionÂ å½“ä¸”ä»…å½“Â popstateÂ å¯¼èˆªÂ (é€šè¿‡æµè§ˆå™¨çš„Â å‰è¿›/åé€€Â æŒ‰é’®è§¦å‘)Â æ—¶æ‰å¯ç”¨ã€‚,æ‰€ä»¥æ˜¯popstateæ—¶ï¼Œæ‰æœ‰savedPosition</span></span><br><span class="line">Â Â Â Â )</span><br><span class="line">Â Â Â Â <span class="comment">//Â è¿”å›ä¸€ä¸ªfalsyå€¼æ—¶ï¼Œä»£è¡¨ä¸éœ€è¦æ»šåŠ¨</span></span><br><span class="line">Â Â Â Â <span class="keyword">if</span>Â (!shouldScroll)Â &#123;</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">return</span></span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line"></span><br><span class="line">Â Â Â Â <span class="comment">//Â v.2.8.0æ”¯æŒå¼‚æ­¥æ»šåŠ¨</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â https://router.vuejs.org/zh/guide/advanced/scroll-behavior.html#%E5%BC%82%E6%AD%A5%E6%BB%9A%E5%8A%A8</span></span><br><span class="line">Â Â Â Â <span class="keyword">if</span>Â (<span class="keyword">typeof</span>Â shouldScroll.thenÂ ===Â <span class="string">'function'</span>)Â &#123;</span><br><span class="line">Â Â Â Â Â Â shouldScroll</span><br><span class="line">Â Â Â Â Â Â Â Â .then(<span class="function"><span class="params">shouldScroll</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â scrollToPosition((shouldScroll:Â <span class="built_in">any</span>),Â position)</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â Â Â .catch(<span class="function"><span class="params">err</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (process.env.NODE_ENVÂ !==Â <span class="string">'production'</span>)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â assert(<span class="literal">false</span>,Â err.toString())</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â &#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â scrollToPosition(shouldScroll,Â position)</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨<code>$nextTick</code>ä¸­è°ƒç”¨<code>getScrollPosition</code>è·å–ä¹‹å‰ä¿å­˜å¥½çš„ä½ç½®</li>
<li>å†è°ƒç”¨æˆ‘ä»¬ä¼ å…¥çš„<code>scrollBehavior</code>æŸ¥çœ‹å…¶è¿”å›å€¼æ¥ç¡®å®šæ˜¯å¦éœ€è¦è¿›è¡Œæ»šåŠ¨</li>
<li>è¿˜åˆ¤æ–­äº†ä¸€æ³¢æ˜¯å¦æ˜¯å¼‚æ­¥æ»šåŠ¨</li>
<li>è‹¥æ˜¯ï¼Œåˆ™ç­‰å¾…å…¶<code>resolved</code>å†è°ƒç”¨<code>scrollToPosition</code></li>
<li>å¦åˆ™ç›´æ¥è°ƒç”¨<code>scrollToPosition</code></li>
<li><code>getScrollPosition</code>ã€<code>scrollToPosition</code>ä»£ç å¦‚ä¸‹</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/scroll.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â è·å–ä¿å­˜çš„æ»šåŠ¨ä½ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScrollPosition</span>(<span class="params"></span>): ?<span class="title">Object</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = getStateKey() <span class="comment">//Â å–å”¯ä¸€key</span></span><br><span class="line">  <span class="keyword">if</span> (key) &#123;</span><br><span class="line">    <span class="keyword">return</span> positionStore[key] <span class="comment">//Â å–ä½ç½®</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ï¼Œæ”¯æŒæ»šåŠ¨åˆ°ç‰¹å®šå…ƒç´ </span></span><br><span class="line"><span class="comment">//Â https://router.vuejs.org/zh/guide/advanced/scroll-behavior.html#%E6%BB%9A%E5%8A%A8%E8%A1%8C%E4%B8%BA</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scrollToPosition</span>(<span class="params">shouldScroll, position</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> shouldScroll === <span class="string">'object'</span> <span class="comment">//Â æ»šåŠ¨åˆ°ç‰¹å®šdom</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isObject &amp;&amp; <span class="keyword">typeof</span> shouldScroll.selector === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="comment">//Â getElementByIdÂ wouldÂ stillÂ failÂ ifÂ theÂ selectorÂ containsÂ aÂ moreÂ complicatedÂ queryÂ likeÂ #main[data-attr]</span></span><br><span class="line">    <span class="comment">//Â butÂ atÂ theÂ sameÂ time,Â itÂ doesn'tÂ makeÂ muchÂ senseÂ toÂ selectÂ anÂ elementÂ withÂ anÂ idÂ andÂ anÂ extraÂ selector</span></span><br><span class="line">    <span class="keyword">const</span> el = hashStartsWithNumberRE.test(shouldScroll.selector) <span class="comment">//Â $flow-disable-line</span></span><br><span class="line">      ? <span class="built_in">document</span>.getElementById(shouldScroll.selector.slice(<span class="number">1</span>)) <span class="comment">//Â $flow-disable-line</span></span><br><span class="line">      : <span class="built_in">document</span>.querySelector(shouldScroll.selector)</span><br><span class="line">    <span class="keyword">if</span> (el) &#123;</span><br><span class="line">      <span class="keyword">let</span> offset =</span><br><span class="line">        shouldScroll.offset &amp;&amp; <span class="keyword">typeof</span> shouldScroll.offset === <span class="string">'object'</span></span><br><span class="line">          ? shouldScroll.offset</span><br><span class="line">          : &#123;&#125;</span><br><span class="line">      offset = normalizeOffset(offset)</span><br><span class="line">      position = getElementPosition(el, offset)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isValidPosition(shouldScroll)) &#123;</span><br><span class="line">      position = normalizePosition(shouldScroll)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isObject &amp;&amp; isValidPosition(shouldScroll)) &#123;</span><br><span class="line">    <span class="comment">//Â ç›´æ¥æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">    position = normalizePosition(shouldScroll)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (position) &#123;</span><br><span class="line">    <span class="built_in">window</span>.scrollTo(position.x, position.y)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>è·å–æ»šåŠ¨ä½ç½®ï¼Œæ˜¯åˆ©ç”¨<code>_key</code>ä»<code>positionStore</code>ä¸Šè¯»å–ä¹‹å‰ä¿å­˜çš„ä½ç½®ä¿¡æ¯</li>
<li><code>scrollToPosition</code>çš„é€»è¾‘å¾ˆæ¸…æ™°ï¼Œå…¶å¤„ç†äº†æ»šåŠ¨åˆ°æŒ‡å®š<code>dom</code>å’Œç›´æ¥æ»šåŠ¨åˆ°ç‰¹å®šä½ç½®çš„åœºæ™¯</li>
</ul>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul>
<li><code>vue-router</code>å¤„ç†æ»šåŠ¨ä¸»è¦åˆ©ç”¨äº†<code>History API</code>å¯ä»¥ä¿å­˜çŠ¶æ€çš„ç‰¹æ€§å®ç°</li>
<li>åœ¨è·¯ç”±è¿›å…¥å‰ä¿å­˜æ»šåŠ¨ä½ç½®ï¼Œå¹¶åœ¨ä¸‹æ¬¡è·¯ç”±å˜åŒ–æ—¶ï¼Œå°è¯•å–å›ä¹‹å‰ä½ç½®ï¼Œåœ¨<code>$nextTick</code>ä¸­çœŸæ­£çš„å¤„ç†æ»šåŠ¨</li>
<li>å…¶æ”¯æŒæ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ã€æŒ‡å®š DOMã€å¼‚æ­¥æ»šåŠ¨ç­‰åœºæ™¯</li>
</ul>
<h2 id="view-ç»„ä»¶"><a href="#view-ç»„ä»¶" class="headerlink" title="view ç»„ä»¶"></a>view ç»„ä»¶</h2><ul>
<li><code>vue-router</code>å†…ç½®äº†<code>router-view</code>ã€<code>router-link</code>ä¸¤ä¸ªç»„ä»¶</li>
<li>å‰è€…è´Ÿè´£åœ¨åŒ¹é…åˆ°è·¯ç”±è®°å½•åå°†å¯¹åº”è·¯ç”±ç»„ä»¶æ¸²æŸ“å‡ºæ¥</li>
<li>åè€…æ”¯æŒç”¨æˆ·åœ¨å…·æœ‰è·¯ç”±åŠŸèƒ½çš„åº”ç”¨ä¸­ (ç‚¹å‡») å¯¼èˆª</li>
<li>æˆ‘ä»¬å…ˆæ¥çœ‹<code>router-view</code>ç»„ä»¶</li>
</ul>
<h3 id="router-view"><a href="#router-view" class="headerlink" title="router-view"></a>router-view</h3><ul>
<li><code>router-view</code>çš„ä¸»è¦èŒè´£å°±æ˜¯å°†è·¯ç”±ç»„ä»¶æ¸²æŸ“å‡ºæ¥</li>
<li>å®šä¹‰ä½äº<code>src/components/view.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/view.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'RouterView'</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span><span class="title">al</span>: <span class="title">true</span>, //Â å‡½æ•°å¼ç»„ä»¶ï¼Œæ²¡æœ‰<span class="title">this</span>ï¼›<span class="title">https</span>://<span class="title">cn</span>.<span class="title">vuejs</span>.<span class="title">org</span>/<span class="title">v2</span>/<span class="title">guide</span>/<span class="title">render</span>-<span class="function"><span class="keyword">function</span>.<span class="title">html</span>#å‡½æ•°å¼ç»„ä»¶</span></span></span><br><span class="line"><span class="function"><span class="function">  <span class="title">props</span>: </span>&#123;</span></span><br><span class="line"><span class="function">    <span class="title">name</span>: </span>&#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'default'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;, <span class="comment">//Â _ä¸ºhå³createElementï¼Œä½†router-viewæ²¡æœ‰ä½¿ç”¨è‡ªèº«çš„hï¼Œè€Œæ˜¯ä½¿ç”¨äº†çˆ¶èŠ‚ç‚¹çš„h</span></span><br><span class="line">  render(<span class="comment">/*Â h*/</span> _, <span class="comment">/*Â context*/</span> &#123; props, children, parent, data &#125;) &#123;</span><br><span class="line">    <span class="comment">//Â usedÂ byÂ devtoolsÂ toÂ displayÂ aÂ router-viewÂ badge</span></span><br><span class="line">    data.routerView = <span class="literal">true</span> <span class="comment">//Â æ ‡è¯†å½“å‰ç»„ä»¶ä¸ºrouter-view //Â directlyÂ useÂ parentÂ context'sÂ createElement()Â function //Â soÂ thatÂ componentsÂ renderedÂ byÂ router-viewÂ canÂ resolveÂ namedÂ slots</span></span><br><span class="line">    <span class="keyword">const</span> h = parent.$createElement <span class="comment">//Â ä½¿ç”¨çˆ¶èŠ‚ç‚¹çš„æ¸²æŸ“å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> name = props.name <span class="comment">//Â å‘½åè§†å›¾</span></span><br><span class="line">    <span class="keyword">const</span> route = parent.$route <span class="comment">//Â ä¾èµ–çˆ¶èŠ‚ç‚¹çš„$routeï¼Œè€Œåœ¨install.jsä¸­æˆ‘ä»¬çŸ¥é“,æ‰€æœ‰ç»„ä»¶è®¿é—®åˆ°çš„$routeå…¶å®éƒ½æ˜¯_routerRoot._routeï¼Œå³Vueæ ¹å®ä¾‹ä¸Šçš„_routeï¼›å½“è·¯ç”±è¢«ç¡®è®¤åï¼Œè°ƒç”¨updateRouteæ—¶ï¼Œä¼šæ›´æ–°_routerRoot._routeï¼Œè¿›è€Œå¯¼è‡´router-viewç»„ä»¶é‡æ–°æ¸²æŸ“ //Â ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">const</span> cache = parent._routerViewCache || (parent._routerViewCache = &#123;&#125;) <span class="comment">//Â determineÂ currentÂ viewÂ depth,Â alsoÂ checkÂ toÂ seeÂ ifÂ theÂ tree //Â hasÂ beenÂ toggledÂ inactiveÂ butÂ kept-alive.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> depth = <span class="number">0</span> <span class="comment">//Â å½“å‰router-viewåµŒå¥—æ·±åº¦</span></span><br><span class="line">    <span class="keyword">let</span> inactive = <span class="literal">false</span> <span class="comment">//Â æ˜¯å¦è¢«keep-aliveåŒ…è£¹å¹¶å¤„äºéæ¿€æ´»çŠ¶æ€ //Â å‘ä¸ŠæŸ¥æ‰¾ï¼Œè®¡ç®—depthã€inactive //Â å½“parentæŒ‡å‘Vueæ ¹å®ä¾‹ç»“æŸå¾ªç¯</span></span><br><span class="line">    <span class="keyword">while</span> (parent &amp;&amp; parent._routerRoot !== parent) &#123;</span><br><span class="line">      <span class="keyword">const</span> vnodeData = parent.$vnode ? parent.$vnode.data : &#123;&#125;</span><br><span class="line">      <span class="keyword">if</span> (vnodeData.routerView) &#123;</span><br><span class="line">        depth++</span><br><span class="line">      &#125; <span class="comment">//Â å¤„ç†keep-alive //Â keep-aliveç»„ä»¶ä¼šæ·»åŠ keepAlive=trueæ ‡è¯† //Â https://github.com/vuejs/vue/blob/52719ccab8fccffbdf497b96d3731dc86f04c1ce/src/core/components/keep-alive.js#L120</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (vnodeData.keepAlive &amp;&amp; parent._directInactive &amp;&amp; parent._inactive) &#123;</span><br><span class="line">        inactive = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      parent = parent.$parent</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data.routerViewDepth = depth <span class="comment">//Â renderÂ previousÂ viewÂ ifÂ theÂ treeÂ isÂ inactiveÂ andÂ kept-alive //Â å¦‚æœå½“å‰ç»„ä»¶æ ‘è¢«keep-aliveåŒ…è£¹ï¼Œä¸”å¤„äºéæ¿€æ´»çŠ¶æ€ï¼Œåˆ™æ¸²æŸ“ä¹‹å‰ä¿å­˜çš„è§†å›¾</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (inactive) &#123;</span><br><span class="line">      <span class="keyword">const</span> cachedData = cache[name]</span><br><span class="line">      <span class="keyword">const</span> cachedComponent = cachedData &amp;&amp; cachedData.component <span class="comment">//Â æ‰¾åˆ°ç¼“å­˜çš„ç»„ä»¶</span></span><br><span class="line">      <span class="keyword">if</span> (cachedComponent) &#123;</span><br><span class="line">        <span class="comment">//Â #2301</span></span><br><span class="line">        <span class="comment">//Â passÂ props</span></span><br><span class="line">        <span class="comment">//Â ä¼ é€’ç¼“å­˜çš„props</span></span><br><span class="line">        <span class="keyword">if</span> (cachedData.configProps) &#123;</span><br><span class="line">          fillPropsinData(</span><br><span class="line">            cachedComponent,</span><br><span class="line">            data,</span><br><span class="line">            cachedData.route,</span><br><span class="line">            cachedData.configProps</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> h(cachedComponent, data, children)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//Â æœªæ‰¾åˆ°ç¼“å­˜çš„ç»„ä»¶</span></span><br><span class="line">        <span class="comment">//Â renderÂ previousÂ emptyÂ view</span></span><br><span class="line">        <span class="keyword">return</span> h()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">//Â é€šè¿‡depthè·å–åŒ¹é…çš„routeÂ record //Â ç”±äºformatMatchæ˜¯é€šè¿‡unshiftæ·»åŠ çˆ¶routeÂ recordçš„ //Â æ‰€ä»¥route.matched[depth]æ­£å¥½èƒ½å–åˆ°åŒ¹é…çš„routeÂ record</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> matched = route.matched[depth]</span><br><span class="line">    <span class="keyword">const</span> component = matched &amp;&amp; matched.components[name] <span class="comment">//Â å–å‡ºè·¯ç”±ç»„ä»¶ //Â renderÂ emptyÂ nodeÂ ifÂ noÂ matchedÂ routeÂ orÂ noÂ configÂ component //Â æ‰¾ä¸åˆ°ï¼Œæ¸²æŸ“ç©ºç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (!matched || !component) &#123;</span><br><span class="line">      cache[name] = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">return</span> h()</span><br><span class="line">    &#125; <span class="comment">//Â cacheÂ component //Â ç¼“å­˜ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">    cache[name] = &#123; component &#125; <span class="comment">//Â attachÂ instanceÂ registrationÂ hook //Â thisÂ willÂ beÂ calledÂ inÂ theÂ instance'sÂ injectedÂ lifecycleÂ hooks //Â ä¸ºè·¯ç”±è®°å½•ç»‘å®šè·¯ç”±ç»„ä»¶ï¼Œåœ¨æ‰€æœ‰ç»„ä»¶çš„beforeCreateã€destoryedÂ hookä¸­è°ƒç”¨ï¼Œè§install.jsä¸­çš„registerInstanceæ–¹æ³• //Â æ­¤æ–¹æ³•åªåœ¨router-viewä¸Šå®šä¹‰äº† //Â vmï¼Œvaléƒ½ä¸ºè·¯ç”±ç»„ä»¶å®ä¾‹ //Â å¦‚ä¸‹ //Â matched.instances:&#123; //Â Â Â default:VueComp, //Â Â Â hd:VueComp2, //Â Â Â bd:VueComp3 //Â &#125;</span></span><br><span class="line"></span><br><span class="line">    data.registerRouteInstance = <span class="function">(<span class="params">vm, val</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//Â valÂ couldÂ beÂ undefinedÂ forÂ unregistration</span></span><br><span class="line">      <span class="keyword">const</span> current = matched.instances[name]</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        (val &amp;&amp; current !== vm) || <span class="comment">//Â ç»‘å®š</span></span><br><span class="line">        (!val &amp;&amp; current === vm)</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">//Â è‹¥valä¸å­˜åœ¨ï¼Œåˆ™å¯è§†ä¸ºè§£ç»‘</span></span><br><span class="line">        matched.instances[name] = val</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">//Â alsoÂ registerÂ instanceÂ inÂ prepatchÂ hook //Â inÂ caseÂ theÂ sameÂ componentÂ instanceÂ isÂ reusedÂ acrossÂ differentÂ routes //Â å½“ç›¸åŒç»„ä»¶åœ¨ä¸åŒè·¯ç”±é—´å¤ç”¨æ—¶ï¼Œä¹Ÿéœ€è¦ä¸ºrouter-viewç»‘å®šè·¯ç”±ç»„ä»¶</span></span><br><span class="line">    ;<span class="function">(<span class="params">data.hook || (<span class="params">data.hook = &#123;&#125;</span>)</span>).<span class="params">prepatch</span> = (<span class="params">_, vnode</span>) =&gt;</span> &#123;</span><br><span class="line">      matched.instances[name] = vnode.componentInstance</span><br><span class="line">    &#125; <span class="comment">//Â registerÂ instanceÂ inÂ initÂ hook //Â inÂ caseÂ kept-aliveÂ componentÂ beÂ activedÂ whenÂ routesÂ changed //Â keep-aliveç»„ä»¶è¢«æ¿€æ´»æ—¶ï¼Œéœ€è¦ä¸ºrouter-viewæ³¨å†Œè·¯ç”±ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line">    data.hook.init = <span class="function">(<span class="params">vnode</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        vnode.data.keepAlive &amp;&amp;</span><br><span class="line">        vnode.componentInstance &amp;&amp;</span><br><span class="line">        vnode.componentInstance !== matched.instances[name]</span><br><span class="line">      ) &#123;</span><br><span class="line">        matched.instances[name] = vnode.componentInstance</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">//Â routeÂ recordè®¾ç½®äº†è·¯ç”±ä¼ å‚ï¼›åŠ¨æ€è·¯ç”±ä¼ å‚ï¼›https://router.vuejs.org/zh/guide/essentials/passing-props.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> configProps = matched.props &amp;&amp; matched.props[name] <span class="comment">//Â saveÂ routeÂ andÂ configPropsÂ inÂ cachce //Â å¦‚æœè®¾ç½®äº†è·¯ç”±ä¼ å‚ï¼Œåˆ™ç¼“å­˜èµ·æ¥ï¼Œå¹¶å°†å¡«å……props</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (configProps) &#123;</span><br><span class="line">      extend(cache[name], &#123;</span><br><span class="line">        route,</span><br><span class="line">        configProps,</span><br><span class="line">      &#125;)</span><br><span class="line">      fillPropsinData(component, data, route, configProps)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h(component, data, children)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¶è¢«å®šä¹‰æˆä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ï¼Œè¿™ä»£è¡¨å®ƒæ²¡æœ‰çŠ¶æ€å’Œå®ä¾‹(this ä¸Šä¸‹æ–‡)ï¼Œåªæ¥æ”¶äº†<code>name</code>æ¥åšå‘½åè§†å›¾</li>
<li>æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹<code>render</code>æ–¹æ³•</li>
<li>ç”±äºå…¶æ˜¯ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ï¼Œæ‰€ä»¥å¾ˆå¤šæ“ä½œæ˜¯å€ŸåŠ©çˆ¶èŠ‚ç‚¹æ¥å®Œæˆçš„<ul>
<li>ä¸ºäº†æ”¯æŒè§£æå‘½åæ’æ§½ï¼Œå…¶æ²¡æœ‰ä½¿ç”¨è‡ªå·±çš„<code>createElement</code>æ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨çˆ¶èŠ‚ç‚¹çš„<code>createElement</code>æ–¹æ³•</li>
<li>ç”±äºæ²¡æœ‰ this ä¸Šä¸‹æ–‡ï¼Œæ— æ³•é€šè¿‡<code>this.$route</code>è·å¾—å½“å‰è·¯ç”±å¯¹è±¡ï¼Œå¹²è„†å°±ç›´æ¥ä½¿ç”¨çˆ¶èŠ‚ç‚¹çš„<code>$route</code></li>
</ul>
</li>
<li>å¯ä»¥çœ‹åˆ°æ·»åŠ äº†ä¸€ä¸ªæ ‡å¿—é‡<code>routerView</code>ï¼Œä¸»è¦ç”¨æ¥åœ¨<code>vue-devtools</code>ä¸­æ ‡è¯†<code>view</code>ç»„ä»¶å’Œåœ¨æŸ¥æ‰¾æ·±åº¦æ—¶ç”¨</li>
<li>ç„¶åå£°æ˜äº†ä¸€ä¸ªç¼“å­˜å¯¹è±¡<code>_routerViewCache</code>å¹¶èµ‹å€¼ç»™<code>cache</code>å˜é‡ï¼Œç”¨æ¥åœ¨<code>keep-alive</code>æ¿€æ´»æ—¶å¿«é€Ÿå–å‡ºè¢«ç¼“å­˜çš„è·¯ç”±ç»„ä»¶</li>
<li>å¼€å§‹ä»å½“å‰èŠ‚ç‚¹å¾€ä¸ŠæŸ¥æ‰¾<code>Vueæ ¹å®ä¾‹</code>ï¼Œåœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­è®¡ç®—å‡º<code>view</code>ç»„ä»¶çš„æ·±åº¦ä»¥åŠæ˜¯å¦è¢«<code>kepp-alive</code>åŒ…è£¹å¹¶å¤„äº<code>inative</code>çŠ¶æ€</li>
<li><code>depth</code>ä¸»è¦ç”¨æ¥è·å–å½“å‰<code>view</code>å¯¹åº”çš„è·¯ç”±è®°å½•<ul>
<li>å‰é¢è¯´è¿‡ï¼Œ<code>vue-router</code>æ˜¯æ”¯æŒåµŒå¥—è·¯ç”±çš„ï¼Œå¯¹åº”çš„<code>view</code>ä¹Ÿæ˜¯å¯ä»¥åµŒå¥—çš„</li>
<li>è€Œä¸”åœ¨åŒ¹é…è·¯ç”±è®°å½•æ—¶ï¼Œæœ‰ä¸‹é¢çš„é€»è¾‘ï¼Œ<code>å½“ä¸€ä¸ªè·¯ç”±è®°å½•åŒ¹é…äº†ï¼Œå¦‚æœå…¶è¿˜æœ‰çˆ¶è·¯ç”±è®°å½•ï¼Œåˆ™çˆ¶è·¯ç”±è®°å½•è‚¯å®šä¹Ÿæ˜¯åŒ¹é…çš„</code>ï¼Œå…¶ä¼šä¸€ç›´å‘ä¸ŠæŸ¥æ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªçˆ¶è®°å½•ï¼Œå°±é€šè¿‡<code>unshift</code>å¡å…¥<code>route.matched</code>æ•°ç»„ä¸­çš„ï¼Œæ‰€ä»¥çˆ¶è®°å½•è‚¯å®šåœ¨å‰ï¼Œå­è®°å½•åœ¨åï¼Œå½“å‰ç²¾å‡†åŒ¹é…çš„è®°å½•åœ¨æœ€å<ul>
<li>è§<code>src/util/route.js formatMatchæ–¹æ³•</code></li>
</ul>
</li>
<li><code>depth</code>çš„è®¡ç®—åœ¨é‡åˆ°<code>çˆ¶view</code>ç»„ä»¶æ—¶ï¼Œè‡ªå¢ 1ï¼Œé€šè¿‡ä¸æ–­å‘ä¸ŠæŸ¥æ‰¾ï¼Œä¸æ–­è‡ªå¢<code>depth</code>ï¼Œç›´åˆ°æ‰¾åˆ°<code>Vueæ ¹å®ä¾‹</code>æ‰åœæ­¢</li>
<li>åœæ­¢æ—¶<code>route.matched[depth]</code>å€¼å°±æ˜¯å½“å‰<code>view</code>å¯¹åº”çš„è·¯ç”±è®°å½•</li>
<li>æœ‰äº†è·¯ç”±è®°å½•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»ä¸Šå–å‡ºå¯¹åº”çš„è·¯ç”±ç»„ä»¶å®ä¾‹ï¼Œç„¶åæ¸²æŸ“å³å¯<ul>
<li>å…³äºè·¯ç”±è®°å½•å’Œè·¯ç”±ç»„ä»¶å®ä¾‹æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼šè®²</li>
</ul>
</li>
</ul>
</li>
<li>æˆ‘ä»¬å…ˆçœ‹<code>éinactive</code>çŠ¶æ€æ˜¯å¦‚ä½•æ¸²æŸ“è·¯ç”±ç»„ä»¶å®ä¾‹çš„<ul>
<li>é€šè¿‡<code>route.matched[depth]</code>å–å‡ºå½“å‰<code>view</code>åŒ¹é…çš„è·¯ç”±è®°å½•</li>
<li>ç„¶åå†å–å‡ºå¯¹åº”çš„è·¯ç”±ç»„ä»¶å®ä¾‹</li>
<li>å¦‚æœè·¯ç”±è®°å½•å’Œè·¯ç”±ç»„ä»¶å®ä¾‹æœ‰ä¸€ä¸ªä¸å­˜åœ¨ï¼Œåˆ™æ¸²æŸ“ç©ºç»“ç‚¹ï¼Œå¹¶é‡ç½®<code>cache[name]</code>å€¼</li>
<li>å¦‚æœéƒ½èƒ½æ‰¾åˆ°ï¼Œåˆ™å…ˆæŠŠç»„ä»¶å®ä¾‹ç¼“å­˜ä¸‹æ¥<ul>
<li>å¦‚æœæœ‰é…ç½®åŠ¨æ€è·¯ç”±å‚æ•°ï¼Œåˆ™æŠŠè·¯ç”±å‚æ•°ç¼“å­˜åˆ°è·¯ç”±ç»„ä»¶å®ä¾‹ä¸Šï¼Œå¹¶è°ƒç”¨<code>fillPropsinData</code>å¡«å……<code>props</code></li>
</ul>
</li>
<li>è°ƒç”¨<code>h</code>æ¸²æŸ“å¯¹åº”çš„è·¯ç”±ç»„ä»¶å®ä¾‹å³å¯</li>
</ul>
</li>
<li>å½“ç»„ä»¶å¤„äº<code>inactive</code>çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»<code>cache</code>ä¸­å–å‡ºä¹‹å‰ç¼“å­˜çš„è·¯ç”±ç»„ä»¶å®ä¾‹å’Œè·¯ç”±å‚æ•°ï¼Œç„¶åæ¸²æŸ“å°±å¯ä»¥äº†</li>
<li>ä¸»æµç¨‹å¦‚ä¸Šï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹æ²¡æ<ul>
<li>è·¯ç”±è®°å½•å’Œè·¯ç”±ç»„ä»¶å®ä¾‹æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</li>
<li>ç›¸ä¿¡ä½ å·²ç»æ³¨æ„åˆ°<code>data.registerRouteInstance</code>æ–¹æ³•ï¼Œæ²¡é”™ï¼Œä»–å°±æ˜¯ç”¨æ¥ä¸ºè·¯ç”±è®°å½•ç»‘å®šè·¯ç”±ç»„ä»¶å®ä¾‹çš„</li>
</ul>
</li>
</ul>
<h3 id="registerInstance"><a href="#registerInstance" class="headerlink" title="registerInstance"></a>registerInstance</h3><ul>
<li>æˆ‘ä»¬å…ˆçœ‹ä¸‹è°ƒç”¨çš„åœ°æ–¹</li>
<li>ä¸»è¦åœ¨<code>src/install.js</code>çš„å…¨å±€æ··å…¥ä¸­</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">Vue</span>)</span>&#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æ³¨å†Œå…¨å±€æ··å…¥</span></span><br><span class="line">Â Â Vue.mixin(&#123;</span><br><span class="line">Â Â Â Â beforeCreateÂ ()Â &#123;</span><br><span class="line">        ...Â </span><br><span class="line"></span><br><span class="line">Â Â Â Â Â Â <span class="comment">//Â ä¸ºrouter-viewç»„ä»¶å…³è”è·¯ç”±ç»„ä»¶</span></span><br><span class="line">Â Â Â Â Â Â registerInstance(<span class="keyword">this</span>,Â <span class="keyword">this</span>)</span><br><span class="line">Â Â Â Â &#125;,</span><br><span class="line">Â Â Â Â destroyedÂ ()Â &#123;</span><br><span class="line">Â Â Â Â Â Â <span class="comment">//Â destroyedÂ hookè§¦å‘æ—¶ï¼Œå–æ¶ˆrouter-viewå’Œè·¯ç”±ç»„ä»¶çš„å…³è”</span></span><br><span class="line">Â Â Â Â Â Â registerInstance(<span class="keyword">this</span>)</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°å…¶åœ¨å…¨å±€æ··å…¥çš„<code>beforeCreate</code>ã€<code>destroyed</code>é’©å­ä¸­éƒ½æœ‰è¢«è°ƒç”¨</li>
<li>å‰è€…ä¼ å…¥äº†ä¸¤ä¸ª vm å®ä¾‹ï¼Œåè€…åªä¼ å…¥äº†ä¸€ä¸ª vm å®ä¾‹</li>
<li>æˆ‘ä»¬çœ‹ä¸‹å®ç°ï¼Œä»£ç ä¹Ÿä½äº<code>src/install.js</code>ä¸­</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â ä¸ºè·¯ç”±è®°å½•ã€router-viewå…³è”è·¯ç”±ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> registerInstance = <span class="function">(<span class="params">vm, callVal</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> i = vm.$options._parentVnode <span class="comment">//Â è°ƒç”¨vm.$options._parentVnode.data.registerRouteInstanceæ–¹æ³• //Â è€Œè¿™ä¸ªæ–¹æ³•åªåœ¨router-viewç»„ä»¶ä¸­å­˜åœ¨ï¼Œrouter-viewç»„ä»¶å®šä¹‰åœ¨(../components/view.jsÂ @71è¡Œ) //Â æ‰€ä»¥ï¼Œå¦‚æœvmçš„çˆ¶èŠ‚ç‚¹ä¸ºrouter-viewï¼Œåˆ™ä¸ºrouter-viewå…³è”å½“å‰vmï¼Œå³å°†å½“å‰vmåšä¸ºrouter-viewçš„è·¯ç”±ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (isDef(i) &amp;&amp; isDef((i = i.data)) &amp;&amp; isDef((i = i.registerRouteInstance))) &#123;</span><br><span class="line">    i(vm, callVal)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥çœ‹åˆ°å…¶æ¥æ”¶ä¸€ä¸ª<code>vmå®ä¾‹</code>å’Œ<code>callVal</code>åšä¸ºå…¥å‚</li>
<li>ç„¶åå–äº†<code>vm</code>çš„çˆ¶èŠ‚ç‚¹åšä¸º i çš„åˆå€¼</li>
<li>æ¥ç€ä¸€æ­¥ä¸€æ­¥ç»™<code>ièµ‹å€¼</code>ï¼ŒåŒæ—¶åˆ¤æ–­<code>i</code>æ˜¯å¦å®šä¹‰</li>
<li>åˆ°æœ€åï¼Œ<code>i</code>çš„å€¼ä¸º<code>vm.$options._parentVnode.data.registerRouteInstance</code></li>
<li>ç„¶åå°†ä¸¤ä¸ªå…¥å‚ä¼ å…¥<code>i</code>ä¸­è°ƒç”¨</li>
<li><strong>æ³¨æ„ï¼Œè¿™æ—¶çš„ i æ˜¯ vm çˆ¶èŠ‚ç‚¹ä¸Šçš„æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ vm ä¸Šçš„æ–¹æ³•</strong></li>
<li>æˆ‘ä»¬å…¨å±€æ£€ç´¢ä¸‹<code>registerRouteInstance</code>å…³é”®å­—ï¼Œå‘ç°å…¶åªè¢«å®šä¹‰åœ¨äº†<code>view.js</code>ä¸­ï¼Œä¹Ÿå°±æ˜¯<code>router-view</code>ç»„ä»¶ä¸­<ul>
<li>ç»“åˆä¸Šé¢ä¸€æ¡ï¼Œi å³<code>registerRouteInstance</code>æ˜¯<code>vmçˆ¶èŠ‚ç‚¹</code>ä¸Šçš„æ–¹æ³•ï¼Œè€Œåªæœ‰<code>router-view</code>ç»„ä»¶å®šä¹‰äº†<code>registerRouteInstance</code></li>
<li>æ‰€ä»¥ï¼Œåªæœ‰å½“<code>vm</code>æ˜¯<code>router-view</code>çš„å­èŠ‚ç‚¹æ—¶ï¼Œ<code>registerRouteInstance</code>æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨</li>
<li><code>i(vm, callVal)</code>å¯ä»¥è¡¨è¾¾ä¸º<code>vm._parentVnode.registerRouteInstance(vm,vm)</code></li>
</ul>
</li>
<li>çœ‹ä¸‹<code>registerRouteInstance</code>çš„å®ç°</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/view.js</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â ä¸ºè·¯ç”±è®°å½•ç»‘å®šè·¯ç”±ç»„ä»¶ï¼Œåœ¨æ‰€æœ‰ç»„ä»¶çš„beforeCreateã€destoryedÂ hookä¸­è°ƒç”¨ï¼Œè§install.jsä¸­çš„registerInstanceæ–¹æ³•</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â æ­¤æ–¹æ³•åªåœ¨router-viewä¸Šå®šä¹‰äº†</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â vmï¼Œvaléƒ½ä¸ºè·¯ç”±ç»„ä»¶å®ä¾‹</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â å¦‚ä¸‹</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â matched.instances:&#123;</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â Â Â default:VueComp,</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â Â Â hd:VueComp2,</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â Â Â bd:VueComp3</span></span><br><span class="line">Â Â Â Â <span class="comment">//Â &#125;</span></span><br><span class="line">Â Â Â Â data.registerRouteInstanceÂ =Â <span class="function">(<span class="params">vm,Â val</span>)Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â <span class="comment">//Â valÂ couldÂ beÂ undefinedÂ forÂ unregistration</span></span><br><span class="line">Â Â Â Â Â Â <span class="keyword">const</span>Â currentÂ =Â matched.instances[name]</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">if</span>Â (</span><br><span class="line">Â Â Â Â Â Â Â Â (valÂ &amp;&amp;Â currentÂ !==Â vm)Â ||Â <span class="comment">//Â ç»‘å®š</span></span><br><span class="line">Â Â Â Â Â Â Â Â (!valÂ &amp;&amp;Â currentÂ ===Â vm)Â <span class="comment">//Â è‹¥valä¸å­˜åœ¨ï¼Œåˆ™å¯è§†ä¸ºè§£ç»‘</span></span><br><span class="line">Â Â Â Â Â Â )Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â matched.instances[name]Â =Â val</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>matched</code>ä¿å­˜çš„æ˜¯å½“å‰åŒ¹é…åˆ°çš„è·¯ç”±è®°å½•ï¼Œ<code>name</code>æ˜¯å‘½åè§†å›¾å</li>
<li>å¦‚æœ<code>val</code>å­˜åœ¨ï¼Œå¹¶ä¸”å½“å‰è·¯ç”±ç»„ä»¶å’Œä¼ å…¥çš„ä¸åŒï¼Œé‡æ–°èµ‹å€¼</li>
<li>å¦‚æœ<code>val</code>ä¸å­˜åœ¨ï¼Œä¸”å½“å‰è·¯ç”±ç»„ä»¶å’Œä¼ å…¥çš„ç›¸åŒï¼Œä¹Ÿé‡æ–°èµ‹å€¼ï¼Œä½†æ˜¯æ­¤æ—¶ val ä¸º<code>undefined</code>ï¼Œç›¸å½“äºè§£ç»‘</li>
<li>å¯ä»¥çœ‹åˆ°å‚æ•°æ•°é‡ä¸åŒï¼Œä¸€ä¸ªå‡½æ•°å®ç°äº†ç»‘å®šå’Œè§£ç»‘çš„åŒé‡æ“ä½œ</li>
<li>é€šè¿‡è¿™ä¸ªæ–¹æ³•å°±å®Œæˆäº†è·¯ç”±è®°å½•å’Œè·¯ç”±ç»„ä»¶å®ä¾‹çš„ç»‘å®šä¸è§£ç»‘æ“ä½œ</li>
<li>è¿™æ ·å°±å¯ä»¥åœ¨<code>view</code>ç»„ä»¶<code>render</code>æ—¶ï¼Œé€šè¿‡<code>route.matched[depth].components[name]</code>å–åˆ°è·¯ç”±ç»„ä»¶è¿›è¡Œæ¸²æŸ“</li>
<li>è¿˜æœ‰äº›åœºæ™¯ä¹Ÿéœ€è¦è¿›è¡Œç»‘å®š<ul>
<li>å½“ç›¸åŒç»„ä»¶åœ¨ä¸åŒè·¯ç”±é—´å¤ç”¨æ—¶ï¼Œéœ€è¦ä¸ºè·¯ç”±è®°å½•ç»‘å®šè·¯ç”±ç»„ä»¶</li>
<li><code>keep-alive</code>ç»„ä»¶è¢«æ¿€æ´»æ—¶ï¼Œéœ€è¦ä¸ºè·¯ç”±è®°å½•ç»‘å®šè·¯ç”±ç»„ä»¶</li>
</ul>
</li>
</ul>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul>
<li><code>router-view</code>æ˜¯ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ï¼Œæœ‰æ—¶éœ€è¦å€ŸåŠ©çˆ¶èŠ‚ç‚¹çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ä½¿ç”¨çˆ¶èŠ‚ç‚¹çš„æ¸²æŸ“å‡½æ•°æ¥è§£æå‘½åæ’æ§½</li>
<li>é€šè¿‡<code>routerView</code>æ¥æ ‡è¯†<code>view</code>ç»„ä»¶ï¼Œæ–¹ä¾¿<code>vue-devtools</code>è¯†åˆ«å‡º<code>view</code>ç»„ä»¶å’Œç¡®å®š<code>view</code>ç»„ä»¶æ·±åº¦</li>
<li>é€šè¿‡å‘ä¸ŠæŸ¥æ‰¾ï¼Œç¡®å®šå½“å‰<code>view</code>çš„æ·±åº¦<code>depth</code>ï¼Œé€šè¿‡<code>depth</code>å–åˆ°å¯¹åº”çš„è·¯ç”±è®°å½•</li>
<li>å†å–å‡ºé€šè¿‡<code>registerInstance</code>ç»‘å®šçš„è·¯ç”±ç»„ä»¶å®ä¾‹</li>
<li>å¦‚æœæœ‰åŠ¨æ€è·¯ç”±å‚æ•°ï¼Œåˆ™å…ˆå¡«å……<code>props</code>ç„¶åå†æ¸²æŸ“</li>
<li>å¦‚æœ<code>view</code>è¢«<code>keep-alive</code>åŒ…è£¹å¹¶ä¸”å¤„äº<code>inactive</code>çŠ¶æ€ï¼Œåˆ™ä»ç¼“å­˜ä¸­å–å‡ºè·¯ç”±ç»„ä»¶å®ä¾‹å¹¶æ¸²æŸ“</li>
</ul>
<h3 id="å¦‚ä½•è§¦å‘é‡æ–°æ¸²æŸ“"><a href="#å¦‚ä½•è§¦å‘é‡æ–°æ¸²æŸ“" class="headerlink" title="å¦‚ä½•è§¦å‘é‡æ–°æ¸²æŸ“"></a>å¦‚ä½•è§¦å‘é‡æ–°æ¸²æŸ“</h3><ul>
<li>åœ¨å¯¼èˆªè§£æçš„ç« èŠ‚ï¼Œæˆ‘ä»¬æè¿‡ï¼Œå¯¼èˆªè§£ææˆåŠŸå</li>
<li>ä¼šè°ƒç”¨<code>updateRoute</code>æ–¹æ³•ï¼Œé‡æ–°ä¸ºå…¨å±€çš„<code>_routerRoot._route</code>å³<code>$route</code>èµ‹å€¼</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æ›´æ–°è·¯ç”±ï¼Œè§¦å‘afterEaché’©å­</span></span><br><span class="line">Â Â updateRouteÂ (route:Â Route)Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â prevÂ =Â <span class="keyword">this</span>.current</span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.currentÂ =Â route<span class="comment">//Â æ›´æ–°current</span></span><br><span class="line"></span><br><span class="line">Â Â Â Â <span class="keyword">this</span>.cbÂ &amp;&amp;Â <span class="keyword">this</span>.cb(route)Â <span class="comment">//Â è°ƒç”¨updateRouteå›è°ƒï¼Œå›è°ƒä¸­ä¼šé‡æ–°ä¸º_routerRoot._routeèµ‹å€¼ï¼Œè¿›è€Œè§¦å‘router-viewçš„é‡æ–°æ¸²æŸ“</span></span><br><span class="line">    ...</span><br><span class="line">Â Â &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨<code>view</code>ç»„ä»¶ä¸­ï¼Œä¼šä½¿ç”¨<code>$parent.$route</code>å³å…¨å±€çš„<code>_routerRoot._route</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// src/components/view.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Â Â renderÂ (<span class="comment">/*Â h*/</span>_,Â <span class="comment">/*Â context*/</span>&#123;Â props,Â children,Â parent,Â dataÂ &#125;)Â &#123;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span>Â routeÂ =Â parent.$routeÂ <span class="comment">//Â ä¾èµ–çˆ¶èŠ‚ç‚¹çš„$routeï¼Œè€Œåœ¨install.jsä¸­æˆ‘ä»¬çŸ¥é“,æ‰€æœ‰ç»„ä»¶è®¿é—®åˆ°çš„$routeå…¶å®éƒ½æ˜¯_routerRoot._routeï¼Œå³Vueæ ¹å®ä¾‹ä¸Šçš„_routeï¼›å½“è·¯ç”±è¢«ç¡®è®¤åï¼Œè°ƒç”¨updateRouteæ—¶ï¼Œä¼šæ›´æ–°_routerRoot._routeï¼Œè¿›è€Œå¯¼è‡´router-viewç»„ä»¶é‡æ–°æ¸²æŸ“</span></span><br><span class="line"></span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>è€Œåœ¨<code>install.js</code>çš„å…¨å±€æ··å…¥ä¸­ï¼Œå°†<code>_route</code>å®šä¹‰ä¸ºå“åº”å¼çš„ï¼Œä¾èµ–äº†<code>_route</code>çš„åœ°æ–¹ï¼Œåœ¨<code>_route</code>å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ¸²æŸ“</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/install.js</span></span><br><span class="line"></span><br><span class="line">Â Â <span class="comment">//Â æ³¨å†Œå…¨å±€æ··å…¥</span></span><br><span class="line">Â Â Vue.mixin(&#123;</span><br><span class="line">Â Â Â Â beforeCreateÂ ()Â &#123;</span><br><span class="line">Â Â Â Â      ...</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">//Â å“åº”å¼å®šä¹‰_routeå±æ€§ï¼Œä¿è¯_routeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»„ä»¶(router-view)ä¼šé‡æ–°æ¸²æŸ“</span></span><br><span class="line">Â Â Â Â Â Â Â Â Vue.util.defineReactive(<span class="keyword">this</span>,Â <span class="string">'_route'</span>,Â <span class="keyword">this</span>._router.history.current)</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â &#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™æ ·å°±å®Œæˆäº†æ¸²æŸ“çš„é—­ç¯,<code>view</code>ä¾èµ–<code>$route</code>,å¯¼èˆªè§£ææˆåŠŸæ›´æ–°<code>$route</code>ï¼Œè§¦å‘<code>view</code>æ¸²æŸ“</li>
<li>çœ‹å®Œäº†<code>view</code>ç»„ä»¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦å¤–ä¸€ä¸ªç»„ä»¶<code>router-link</code></li>
</ul>
<h2 id="link-ç»„ä»¶"><a href="#link-ç»„ä»¶" class="headerlink" title="link ç»„ä»¶"></a>link ç»„ä»¶</h2><ul>
<li><code>router-link</code>ç»„ä»¶è¢«å®šä¹‰åœ¨<code>src/components/link.js</code>ä¸­</li>
<li>ä¸»è¦ç”¨æ¥æ”¯æŒç”¨æˆ·åœ¨å…·æœ‰è·¯ç”±åŠŸèƒ½çš„åº”ç”¨ä¸­ (ç‚¹å‡») å¯¼èˆª</li>
</ul>
<h3 id="router-link"><a href="#router-link" class="headerlink" title="router-link"></a>router-link</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Â @flowÂ */</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRoute, isSameRoute, isIncludedRoute &#125; <span class="keyword">from</span> <span class="string">'../util/route'</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">'../util/misc'</span></span><br><span class="line"><span class="keyword">import</span> &#123; normalizeLocation &#125; <span class="keyword">from</span> <span class="string">'../util/location'</span></span><br><span class="line"><span class="keyword">import</span> &#123; warn &#125; <span class="keyword">from</span> <span class="string">'../util/warn'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Â workÂ aroundÂ weirdÂ flowÂ bug</span></span><br><span class="line"><span class="keyword">const</span> toTypes: <span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt; = [<span class="built_in">String</span>, <span class="built_in">Object</span>]</span><br><span class="line"><span class="keyword">const</span> eventTypes: <span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt; = [<span class="built_in">String</span>, <span class="built_in">Array</span>]</span><br><span class="line"><span class="keyword">const</span> noop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'RouterLink'</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    to: &#123;</span><br><span class="line">      <span class="keyword">type</span>: toTypes, <span class="comment">//Â stringÂ |Â Location</span></span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    tag: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'a'</span>, <span class="comment">//Â é»˜è®¤aæ ‡ç­¾</span></span><br><span class="line">    &#125;,</span><br><span class="line">    exact: <span class="built_in">Boolean</span>, <span class="comment">//Â æ˜¯å¦ç²¾ç¡®åŒ¹é…</span></span><br><span class="line">    append: <span class="built_in">Boolean</span>, <span class="comment">//Â æ˜¯å¦è¿½åŠ </span></span><br><span class="line">    replace: <span class="built_in">Boolean</span>, <span class="comment">//Â ä¸ºtrueï¼Œè°ƒç”¨router.replaceå¦åˆ™è°ƒç”¨router.push</span></span><br><span class="line">    activeClass: <span class="built_in">String</span>, <span class="comment">//Â æ¿€æ´»çš„ç±»å</span></span><br><span class="line">    exactActiveClass: <span class="built_in">String</span>, <span class="comment">//Â ç²¾ç¡®åŒ¹é…çš„ç±»å</span></span><br><span class="line">    ariaCurrentValue: &#123;</span><br><span class="line">      <span class="comment">//Â æ— éšœç¢åŒ–</span></span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'page'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    event: &#123;</span><br><span class="line">      <span class="keyword">type</span>: eventTypes, <span class="comment">//Â è§¦å‘å¯¼èˆªçš„äº‹ä»¶</span></span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'click'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  render(h: <span class="built_in">Function</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="keyword">this</span>.$router</span><br><span class="line">    <span class="keyword">const</span> current = <span class="keyword">this</span>.$route</span><br><span class="line">    <span class="keyword">const</span> &#123; location, route, href &#125; = router.resolve(</span><br><span class="line">      <span class="keyword">this</span>.to,</span><br><span class="line">      current,</span><br><span class="line">      <span class="keyword">this</span>.append</span><br><span class="line">    ) <span class="comment">//Â è§£æç›®æ ‡ä½ç½®</span></span><br><span class="line">    <span class="keyword">const</span> classes = &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> globalActiveClass = router.options.linkActiveClass</span><br><span class="line">    <span class="keyword">const</span> globalExactActiveClass = router.options.linkExactActiveClass <span class="comment">//Â SupportÂ globalÂ emptyÂ activeÂ class</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> activeClassFallback =</span><br><span class="line">      globalActiveClass == <span class="literal">null</span> ? <span class="string">'router-link-active'</span> : globalActiveClass</span><br><span class="line">    <span class="keyword">const</span> exactActiveClassFallback =</span><br><span class="line">      globalExactActiveClass == <span class="literal">null</span></span><br><span class="line">        ? <span class="string">'router-link-exact-active'</span></span><br><span class="line">        : globalExactActiveClass</span><br><span class="line">    <span class="keyword">const</span> activeClass =</span><br><span class="line">      <span class="keyword">this</span>.activeClass == <span class="literal">null</span> ? activeClassFallback : <span class="keyword">this</span>.activeClass</span><br><span class="line">    <span class="keyword">const</span> exactActiveClass =</span><br><span class="line">      <span class="keyword">this</span>.exactActiveClass == <span class="literal">null</span></span><br><span class="line">        ? exactActiveClassFallback</span><br><span class="line">        : <span class="keyword">this</span>.exactActiveClass <span class="comment">//Â ç›®æ ‡routeï¼Œç”¨æ¥æ¯”è¾ƒæ˜¯å¦å’Œå½“å‰routeæ˜¯ç›¸åŒroute</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> compareTarget = route.redirectedFrom</span><br><span class="line">      ? createRoute(<span class="literal">null</span>, normalizeLocation(route.redirectedFrom), <span class="literal">null</span>, router)</span><br><span class="line">      : route</span><br><span class="line">    classes[exactActiveClass] = isSameRoute(current, compareTarget)</span><br><span class="line">    classes[activeClass] = <span class="keyword">this</span>.exact</span><br><span class="line">      ? classes[exactActiveClass]</span><br><span class="line">      : isIncludedRoute(current, compareTarget) <span class="comment">//Â éç²¾å‡†åŒ¹é…æ—¶ï¼Œåˆ¤æ–­ç›®æ ‡routeÂ pathæ˜¯å¦åŒ…å«å½“å‰routeÂ path</span></span><br><span class="line">    <span class="keyword">const</span> ariaCurrentValue = classes[exactActiveClass]</span><br><span class="line">      ? <span class="keyword">this</span>.ariaCurrentValue</span><br><span class="line">      : <span class="literal">null</span> <span class="comment">//Â äº‹ä»¶å¤„ç†</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handler = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (guardEvent(e)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.replace) &#123;</span><br><span class="line">          router.replace(location, noop)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          router.push(location, noop)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> on = &#123; click: guardEvent &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(<span class="keyword">this</span>.event)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.event.forEach(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        on[e] = handler</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      on[<span class="keyword">this</span>.event] = handler</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> data: <span class="built_in">any</span> = &#123; <span class="keyword">class</span>: classes &#125; <span class="comment">//Â è¯»å–ä½œç”¨åŸŸæ’æ§½</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> scopedSlot =</span><br><span class="line">      !<span class="keyword">this</span>.$scopedSlots.$hasNormal &amp;&amp;</span><br><span class="line">      <span class="keyword">this</span>.$scopedSlots.default &amp;&amp;</span><br><span class="line">      <span class="keyword">this</span>.$scopedSlots.default(&#123;</span><br><span class="line">        href,</span><br><span class="line">        route,</span><br><span class="line">        navigate: handler,</span><br><span class="line">        isActive: classes[activeClass],</span><br><span class="line">        isExactActive: classes[exactActiveClass],</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (scopedSlot) &#123;</span><br><span class="line">      <span class="comment">//Â ä½œç”¨åŸŸæ’æ§½ä»…æœ‰ä¸€ä¸ªå­å…ƒç´ </span></span><br><span class="line">      <span class="keyword">if</span> (scopedSlot.length === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> scopedSlot[<span class="number">0</span>]</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (scopedSlot.length &gt; <span class="number">1</span> || !scopedSlot.length) &#123;</span><br><span class="line">        <span class="comment">//Â ä½œç”¨åŸŸæ’æ§½æä¾›å¤šä¸ªåä»£æˆ–æœªæä¾›åï¼Œç»™äºˆæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          warn(</span><br><span class="line">            <span class="literal">false</span>,</span><br><span class="line">            <span class="string">`RouterLinkÂ withÂ to="<span class="subst">$&#123;this.to&#125;</span>"Â isÂ tryingÂ toÂ useÂ aÂ scopedÂ slotÂ butÂ itÂ didn'tÂ provideÂ exactlyÂ oneÂ child.Â WrappingÂ theÂ contentÂ withÂ aÂ spanÂ element.`</span></span><br><span class="line">          )</span><br><span class="line">        &#125; <span class="comment">//Â æœ‰å¤šä¸ªåä»£æ—¶ï¼Œåœ¨å¤–å±‚ç”¨ä¸€ä¸ªspanåŒ…è£¹</span></span><br><span class="line">        <span class="keyword">return</span> scopedSlot.length === <span class="number">0</span> ? h() : h(<span class="string">'span'</span>, &#123;&#125;, scopedSlot)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">//Â tagä¸ºa</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.tag === <span class="string">'a'</span>) &#123;</span><br><span class="line">      data.on = on</span><br><span class="line">      data.attrs = &#123; href, <span class="string">'aria-current'</span>: ariaCurrentValue &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//Â tagä¸ä¸ºaï¼Œåˆ™æ‰¾åä»£é¦–ä¸ªaç»‘å®šäº‹ä»¶</span></span><br><span class="line">      <span class="comment">//Â findÂ theÂ firstÂ &lt;a&gt;Â childÂ andÂ applyÂ listenerÂ andÂ href</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> a = findAnchor(<span class="keyword">this</span>.$slots.default)</span><br><span class="line">      <span class="keyword">if</span> (a) &#123;</span><br><span class="line">        <span class="comment">//Â inÂ caseÂ theÂ &lt;a&gt;Â isÂ aÂ staticÂ node</span></span><br><span class="line">        a.isStatic = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">const</span> aData = (a.data = extend(&#123;&#125;, a.data))</span><br><span class="line">        aData.on = aData.on || &#123;&#125; <span class="comment">//Â transformÂ existingÂ eventsÂ inÂ bothÂ objectsÂ intoÂ arraysÂ soÂ weÂ canÂ pushÂ later //Â aä¸Šå¯èƒ½è¿˜ç»‘å®šæœ‰å…¶ä»–äº‹ä»¶ï¼Œéœ€è¦å…¼å®¹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> event <span class="keyword">in</span> aData.on) &#123;</span><br><span class="line">          <span class="keyword">const</span> handler = aData.on[event]</span><br><span class="line">          <span class="keyword">if</span> (event <span class="keyword">in</span> on) &#123;</span><br><span class="line">            aData.on[event] = <span class="built_in">Array</span>.isArray(handler) ? handler : [handler]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="comment">//Â appendÂ newÂ listenersÂ forÂ router-link //Â ç»‘å®šå…¶ä»–äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> event <span class="keyword">in</span> on) &#123;</span><br><span class="line">          <span class="keyword">if</span> (event <span class="keyword">in</span> aData.on) &#123;</span><br><span class="line">            <span class="comment">//Â on[event]Â isÂ alwaysÂ aÂ function</span></span><br><span class="line">            aData.on[event].push(on[event])</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            aData.on[event] = handler</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> aAttrs = (a.data.attrs = extend(&#123;&#125;, a.data.attrs))</span><br><span class="line">        aAttrs.href = href</span><br><span class="line">        aAttrs[<span class="string">'aria-current'</span>] = ariaCurrentValue</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//Â doesn'tÂ haveÂ &lt;a&gt;Â child,Â applyÂ listenerÂ toÂ self</span></span><br><span class="line">        <span class="comment">//Â æ²¡æ‰¾åˆ°ï¼Œåˆ™ç»™å½“å‰å…ƒç´ ç»‘å®šäº‹ä»¶</span></span><br><span class="line">        data.on = on</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> h(<span class="keyword">this</span>.tag, data, <span class="keyword">this</span>.$slots.default)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â ç‰¹æ®Šåœºæ™¯ï¼Œç‚¹å‡»ä¸åšè·³è½¬å“åº”</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">guardEvent</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//Â don'tÂ redirectÂ withÂ controlÂ keys</span></span><br><span class="line">  <span class="keyword">if</span> (e.metaKey || e.altKey || e.ctrlKey || e.shiftKey) <span class="keyword">return</span> <span class="comment">//Â don'tÂ redirectÂ whenÂ preventDefaultÂ called</span></span><br><span class="line">  <span class="keyword">if</span> (e.defaultPrevented) <span class="keyword">return</span> <span class="comment">//Â don'tÂ redirectÂ onÂ rightÂ click</span></span><br><span class="line">  <span class="keyword">if</span> (e.button !== <span class="literal">undefined</span> &amp;&amp; e.button !== <span class="number">0</span>) <span class="keyword">return</span> <span class="comment">//Â don'tÂ redirectÂ ifÂ `target="_blank"`</span></span><br><span class="line">  <span class="keyword">if</span> (e.currentTarget &amp;&amp; e.currentTarget.getAttribute) &#123;</span><br><span class="line">    <span class="keyword">const</span> target = e.currentTarget.getAttribute(<span class="string">'target'</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/\b_blank\b/i</span>.test(target)) <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="comment">//Â thisÂ mayÂ beÂ aÂ WeexÂ eventÂ whichÂ doesn'tÂ haveÂ thisÂ method</span></span><br><span class="line">  <span class="keyword">if</span> (e.preventDefault) &#123;</span><br><span class="line">    e.preventDefault()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â é€’å½’æŸ¥æ‰¾åä»£aæ ‡ç­¾</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findAnchor</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (children) &#123;</span><br><span class="line">    <span class="keyword">let</span> child</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.length; i++) &#123;</span><br><span class="line">      child = children[i]</span><br><span class="line">      <span class="keyword">if</span> (child.tag === <span class="string">'a'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> child</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (child.children &amp;&amp; (child = findAnchor(child.children))) &#123;</span><br><span class="line">        <span class="keyword">return</span> child</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¶å®ç°å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç»„ä»¶ï¼Œå®ç°äº†ç‚¹å‡»æ—¶è·³è½¬åˆ°<code>to</code>å¯¹åº”çš„è·¯ç”±åŠŸèƒ½</li>
<li>ç”±äºæ”¯æŒç‚¹å‡»æ—¶éœ€è¦æ ‡è¯†æ ·å¼ç±»ã€ç²¾å‡†åŒ¹é…<code>exact</code>åœºæ™¯ï¼Œæ‰€ä»¥é€šè¿‡<code>sameRoute</code>ã€<code>isIncludedRoute</code>æ¥å®ç°æ ·å¼ç±»çš„æ ‡è¯†å’Œç²¾å‡†åŒ¹é…æ ‡è¯†</li>
<li>åœ¨ç‚¹å‡»æ—¶ï¼Œå±è”½äº†éƒ¨åˆ†ç‰¹æ®Šåœºæ™¯ï¼Œå¦‚ç‚¹å‡»æ—¶åŒæ—¶æŒ‰ä¸‹<code>ctrl</code>ã€<code>alt</code>ã€<code>shift</code>ç­‰<code>control keys</code>æ—¶ï¼Œä¸åšè·³è½¬</li>
<li>çœ‹å®Œç»„ä»¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹<code>router</code>è¿˜ç»™æˆ‘ä»¬æä¾›å“ªäº›å®ä¾‹æ–¹æ³•</li>
</ul>
<h2 id="å®ä¾‹å±æ€§ã€æ–¹æ³•"><a href="#å®ä¾‹å±æ€§ã€æ–¹æ³•" class="headerlink" title="å®ä¾‹å±æ€§ã€æ–¹æ³•"></a>å®ä¾‹å±æ€§ã€æ–¹æ³•</h2><ul>
<li><code>router</code>å¯¹å¤–æš´éœ²äº†å¾ˆå¤šå±æ€§å’Œæ–¹æ³•</li>
<li>è¿™äº›å±æ€§å’Œæ–¹æ³•åœ¨å‰é¢çš„æºç éƒ¨åˆ†ä¹Ÿéƒ½æœ‰ç”¨è¿‡</li>
</ul>
<h3 id="å®ä¾‹å±æ€§"><a href="#å®ä¾‹å±æ€§" class="headerlink" title="å®ä¾‹å±æ€§"></a>å®ä¾‹å±æ€§</h3><ul>
<li><code>router.app</code><ul>
<li>é…ç½®äº†  router  çš„ Vue æ ¹å®ä¾‹</li>
</ul>
</li>
<li><code>router.mode</code><ul>
<li>è·¯ç”±ä½¿ç”¨çš„æ¨¡å¼</li>
</ul>
</li>
<li><code>router.currentRoute</code><ul>
<li>å½“å‰è·¯ç”±å¯¹è±¡ï¼Œç­‰åŒäº<code>this.$route</code></li>
</ul>
</li>
</ul>
<h3 id="å®ä¾‹æ–¹æ³•"><a href="#å®ä¾‹æ–¹æ³•" class="headerlink" title="å®ä¾‹æ–¹æ³•"></a>å®ä¾‹æ–¹æ³•</h3><ul>
<li>ç”¨æ³¨å†Œå…¨å±€å¯¼èˆªå®ˆå«<ul>
<li><code>router.beforeEach</code></li>
<li><code>router.beforeResolve</code></li>
<li><code>router.afterEach</code></li>
</ul>
</li>
<li>ç¼–ç¨‹å¼å¯¼èˆªç›¸å…³<ul>
<li><code>router.push</code></li>
<li><code>router.replace</code></li>
<li><code>router.go</code></li>
<li><code>router.back</code></li>
<li><code>router.forward</code></li>
</ul>
</li>
<li>æœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³<ul>
<li><code>router.getMatchedComponents</code><ul>
<li>è¿”å›ç›®æ ‡ä½ç½®æˆ–æ˜¯å½“å‰è·¯ç”±åŒ¹é…çš„ç»„ä»¶æ•°ç»„ (æ˜¯æ•°ç»„çš„å®šä¹‰/æ„é€ ç±»ï¼Œä¸æ˜¯å®ä¾‹)</li>
</ul>
</li>
<li><code>router.onReady</code><ul>
<li>è¯¥æ–¹æ³•æŠŠä¸€ä¸ªå›è°ƒæ’é˜Ÿï¼Œåœ¨è·¯ç”±å®Œæˆåˆå§‹å¯¼èˆªæ—¶è°ƒç”¨ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥è§£ææ‰€æœ‰çš„å¼‚æ­¥è¿›å…¥é’©å­å’Œè·¯ç”±åˆå§‹åŒ–ç›¸å…³è”çš„å¼‚æ­¥ç»„ä»¶</li>
</ul>
</li>
<li><code>router.onError</code><ul>
<li>æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œè¯¥å›è°ƒä¼šåœ¨è·¯ç”±å¯¼èˆªè¿‡ç¨‹ä¸­å‡ºé”™æ—¶è¢«è°ƒç”¨</li>
</ul>
</li>
</ul>
</li>
<li>åŠ¨æ€è·¯ç”±<ul>
<li><code>router.addRoutes</code><ul>
<li>åŠ¨æ€æ·»åŠ è·¯ç”±è§„åˆ™</li>
</ul>
</li>
</ul>
</li>
<li>è§£æ<ul>
<li><code>router.resolve</code> - ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œå°è¯•è§£æå¹¶è¿”å›ä¸€ä¸ªç›®æ ‡ä½ç½®</li>
</ul>
</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†<code>vue-router@2</code>çš„æ‰€æœ‰æºç åˆ†æ ğŸ‰</li>
<li>å¦‚æœæ‚¨è§‰å¾—è¿˜å¯ä»¥ï¼Œè®°å¾—å¸®æˆ‘ç‚¹ä¸ªèµ ğŸ‘</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/dwqs/blog/issues/53" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/53</a></li>
<li><a href="https://github.com/dwqs/blog/issues/54" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/54</a></li>
<li><a href="https://github.com/dwqs/blog/issues/55" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/55</a></li>
<li><a href="https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643" target="_blank" rel="noopener">https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643</a></li>
<li><a href="https://juejin.im/post/5e456513f265da573c0c6d4b" target="_blank" rel="noopener">https://juejin.im/post/5e456513f265da573c0c6d4b</a></li>
<li><a href="https://juejin.im/post/584040e1ac502e006cbedb23" target="_blank" rel="noopener">https://juejin.im/post/584040e1ac502e006cbedb23</a></li>
<li><a href="https://juejin.im/post/5df0ada0f265da33d56d1a2f" target="_blank" rel="noopener">https://juejin.im/post/5df0ada0f265da33d56d1a2f</a></li>
<li><a href="https://juejin.im/post/5dbed0bef265da4cff701f68" target="_blank" rel="noopener">https://juejin.im/post/5dbed0bef265da4cff701f68</a></li>
<li><a href="https://www.jianshu.com/p/29e8214d0bee" target="_blank" rel="noopener">https://www.jianshu.com/p/29e8214d0bee</a></li>
<li><a href="https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/" target="_blank" rel="noopener">https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/</a></li>
<li><a href="https://blog.liuyunzhuge.com/2020/04/08/vue-routeræºç ï¼šcreate-matcher/" target="_blank" rel="noopener">https://blog.liuyunzhuge.com/2020/04/08/vue-router æºç ï¼šcreate-matcher/</a></li>
</ul>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><ul>
<li>åé¢è¿˜ä¼šä»‹ç»å…¶ä½™éƒ¨åˆ†ï¼Œå¦‚æœè§‰å¾—è¿˜è¡Œï¼Œå¯ä»¥ç»™ä¸ªèµå“¦ âœ¨</li>
<li>ä¸ªäºº<code>github</code>ï¼Œä¹Ÿæ€»ç»“äº†ä¸€äº›ä¸œè¥¿ï¼Œæ¬¢è¿ star</li>
<li>åŸºäº canvas çš„ç»˜å›¾æ¿<a href="https://github.com/BryanAdamss/drawing-board" target="_blank" rel="noopener">drawing-board</a></li>
<li>å‰ç«¯å…¥é—¨ demoã€æœ€ä½³å®è·µé›†åˆ <a href="https://github.com/BryanAdamss/fe-awesome-demos" target="_blank" rel="noopener">fe-awesome-demos</a></li>
<li>ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆåˆ«åçš„<code>vue-cli-plugin</code><a href="https://www.npmjs.com/package/vue-cli-plugin-auto-alias" target="_blank" rel="noopener">https://www.npmjs.com/package/vue-cli-plugin-auto-alias</a></li>
</ul>
<h2 id="npm-åŒ…"><a href="#npm-åŒ…" class="headerlink" title="npm åŒ…"></a>npm åŒ…</h2><ul>
<li><a href="https://www.npmjs.com/package/vue-cli-plugin-auto-alias" target="_blank" rel="noopener">vue-cli-plugin-auto-alias</a></li>
<li><a href="https://www.npmjs.com/package/@bryanadamss/drawing-board" target="_blank" rel="noopener">@bryanadamss/drawing-board</a></li>
<li><a href="https://www.npmjs.com/package/@bryanadamss/num2chn" target="_blank" rel="noopener">@bryanadamss/num2chn</a></li>
<li><a href="https://www.npmjs.com/package/ant-color-converter" target="_blank" rel="noopener">ant-color-converter</a></li>
</ul>
<h2 id="äº¤æµ"><a href="#äº¤æµ" class="headerlink" title="äº¤æµ"></a>äº¤æµ</h2><ul>
<li>å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥åŠ å¾®ä¿¡äº¤æµï¼Œå…±åŒæˆé•¿ï¼Œå…±åŒè¿›æ­¥~</li>
<li><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/917b376a388f43faa6c8f8d81f730bcb~tplv-k3u1fbpfcp-watermark.image" alt=""></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue/" rel="tag"># vue</a>
          
            <a href="/tags/vue-router/" rel="tag"># vue-router</a>
          
            <a href="/tags/æºç è§£æ/" rel="tag"># æºç è§£æ</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/12/01/x5-video-summary/" rel="next" title="x5-video-summary">
                <i class="fa fa-chevron-left"></i> x5-video-summary
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/Avatar.png"
               alt="BryanAdamss" />
          <p class="site-author-name" itemprop="name">BryanAdamss</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">64</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">91</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/BryanAdamss" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#vue-router-æºç è§£æ-6k-å­—-å¤šå›¾é¢„è­¦-ã€ä¸‹ã€‘"><span class="nav-number">1.</span> <span class="nav-text">vue-router æºç è§£æ | 6k å­— | å¤šå›¾é¢„è­¦ - ã€ä¸‹ã€‘</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ»šåŠ¨å¤„ç†"><span class="nav-number">1.1.</span> <span class="nav-text">æ»šåŠ¨å¤„ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#setupScroll"><span class="nav-number">1.1.1.</span> <span class="nav-text">setupScroll</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#handleScroll"><span class="nav-number">1.1.2.</span> <span class="nav-text">handleScroll</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å°ç»“"><span class="nav-number">1.1.3.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#view-ç»„ä»¶"><span class="nav-number">1.2.</span> <span class="nav-text">view ç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#router-view"><span class="nav-number">1.2.1.</span> <span class="nav-text">router-view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#registerInstance"><span class="nav-number">1.2.2.</span> <span class="nav-text">registerInstance</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å°ç»“-1"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¦‚ä½•è§¦å‘é‡æ–°æ¸²æŸ“"><span class="nav-number">1.2.3.</span> <span class="nav-text">å¦‚ä½•è§¦å‘é‡æ–°æ¸²æŸ“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#link-ç»„ä»¶"><span class="nav-number">1.3.</span> <span class="nav-text">link ç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#router-link"><span class="nav-number">1.3.1.</span> <span class="nav-text">router-link</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ä¾‹å±æ€§ã€æ–¹æ³•"><span class="nav-number">1.4.</span> <span class="nav-text">å®ä¾‹å±æ€§ã€æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ä¾‹å±æ€§"><span class="nav-number">1.4.1.</span> <span class="nav-text">å®ä¾‹å±æ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ä¾‹æ–¹æ³•"><span class="nav-number">1.4.2.</span> <span class="nav-text">å®ä¾‹æ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">1.5.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">1.6.</span> <span class="nav-text">å‚è€ƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PS"><span class="nav-number">1.7.</span> <span class="nav-text">PS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#npm-åŒ…"><span class="nav-number">1.8.</span> <span class="nav-text">npm åŒ…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äº¤æµ"><span class="nav-number">1.9.</span> <span class="nav-text">äº¤æµ</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BryanAdamss</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


  

</body>
</html>
