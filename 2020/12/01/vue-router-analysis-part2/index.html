<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="vue,vue-router,Ê∫êÁ†ÅËß£Êûê," />








  <link rel="shortcut icon" type="image/x-icon" href="/Avatar.png?v=5.1.0" />






<meta name="description" content="vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé Êú¨ÁØáÊòØvue-routerÊ∫êÁ†ÅËß£ÊûêÁöÑ‰∏≠ÁØáÔºå‰πüÊòØÊ†∏ÂøÉÁØá Êú¨ÁØá‰∏ªË¶Å‰ªãÁªç‰∫Ü‰∏ãÈù¢Âá†ÁÇπ ‰ªãÁªç‰∫Üvue-routerÊòØÂ¶Ç‰ΩïÂÅöË∑ØÁî±ÂåπÈÖçÁöÑ ‰ª•ÂèäÂÖ∂Áõ∏ÂÖ≥ÁöÑÂÆàÂç´„ÄÅÈí©Â≠êÊòØÂ¶Ç‰ΩïËß¶ÂèëÁöÑ ÂºÇÊ≠•ÁªÑ‰ª∂ÂèàÊòØÂ¶Ç‰ΩïÂ§ÑÁêÜÁöÑÁ≠âÁ≠â   ËôΩÁÑ∂ÁúãÁùÄÁü•ËØÜÁÇπÂæàÂ∞ëÔºå‰ΩÜÂÜÖÂÆπÂç¥‰∏ÄÁÇπÈÉΩ‰∏çÂ∞ë Âè¶Â§ñËøòÊòØË¶ÅËØ¥‰∏Ä‰∏ã Á¨¨‰∏ÄÊ¨°ÂÅöÊ∫êÁ†ÅËß£ÊûêÔºåËÇØÂÆöÊúâÂæàÂ§öÈîôËØØÊàñÁêÜËß£‰∏çÂà∞‰ΩçÁöÑÂú∞Êñπ">
<meta name="keywords" content="vue,vue-router,Ê∫êÁ†ÅËß£Êûê">
<meta property="og:type" content="article">
<meta property="og:title" content="vue-router-analysis-part2">
<meta property="og:url" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/index.html">
<meta property="og:site_name" content="BryanAdamssÁöÑÂçöÂÆ¢">
<meta property="og:description" content="vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé Êú¨ÁØáÊòØvue-routerÊ∫êÁ†ÅËß£ÊûêÁöÑ‰∏≠ÁØáÔºå‰πüÊòØÊ†∏ÂøÉÁØá Êú¨ÁØá‰∏ªË¶Å‰ªãÁªç‰∫Ü‰∏ãÈù¢Âá†ÁÇπ ‰ªãÁªç‰∫Üvue-routerÊòØÂ¶Ç‰ΩïÂÅöË∑ØÁî±ÂåπÈÖçÁöÑ ‰ª•ÂèäÂÖ∂Áõ∏ÂÖ≥ÁöÑÂÆàÂç´„ÄÅÈí©Â≠êÊòØÂ¶Ç‰ΩïËß¶ÂèëÁöÑ ÂºÇÊ≠•ÁªÑ‰ª∂ÂèàÊòØÂ¶Ç‰ΩïÂ§ÑÁêÜÁöÑÁ≠âÁ≠â   ËôΩÁÑ∂ÁúãÁùÄÁü•ËØÜÁÇπÂæàÂ∞ëÔºå‰ΩÜÂÜÖÂÆπÂç¥‰∏ÄÁÇπÈÉΩ‰∏çÂ∞ë Âè¶Â§ñËøòÊòØË¶ÅËØ¥‰∏Ä‰∏ã Á¨¨‰∏ÄÊ¨°ÂÅöÊ∫êÁ†ÅËß£ÊûêÔºåËÇØÂÆöÊúâÂæàÂ§öÈîôËØØÊàñÁêÜËß£‰∏çÂà∞‰ΩçÁöÑÂú∞Êñπ">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/match.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/normalize-location.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/dynamic-route.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/match-route.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/fill-params.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/create-route-inner.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/create-route.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/match-demo-record.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/alias.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/redirect-demo.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/redirect-stack-1.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/redirect-stack-2.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/redirect-stack-3.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/redirect-stack-4.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/redirect-full.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/flat-map-components.png">
<meta property="og:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/extract-guards.png">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/917b376a388f43faa6c8f8d81f730bcb~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:updated_time" content="2020-12-06T04:24:39.439Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vue-router-analysis-part2">
<meta name="twitter:description" content="vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé Êú¨ÁØáÊòØvue-routerÊ∫êÁ†ÅËß£ÊûêÁöÑ‰∏≠ÁØáÔºå‰πüÊòØÊ†∏ÂøÉÁØá Êú¨ÁØá‰∏ªË¶Å‰ªãÁªç‰∫Ü‰∏ãÈù¢Âá†ÁÇπ ‰ªãÁªç‰∫Üvue-routerÊòØÂ¶Ç‰ΩïÂÅöË∑ØÁî±ÂåπÈÖçÁöÑ ‰ª•ÂèäÂÖ∂Áõ∏ÂÖ≥ÁöÑÂÆàÂç´„ÄÅÈí©Â≠êÊòØÂ¶Ç‰ΩïËß¶ÂèëÁöÑ ÂºÇÊ≠•ÁªÑ‰ª∂ÂèàÊòØÂ¶Ç‰ΩïÂ§ÑÁêÜÁöÑÁ≠âÁ≠â   ËôΩÁÑ∂ÁúãÁùÄÁü•ËØÜÁÇπÂæàÂ∞ëÔºå‰ΩÜÂÜÖÂÆπÂç¥‰∏ÄÁÇπÈÉΩ‰∏çÂ∞ë Âè¶Â§ñËøòÊòØË¶ÅËØ¥‰∏Ä‰∏ã Á¨¨‰∏ÄÊ¨°ÂÅöÊ∫êÁ†ÅËß£ÊûêÔºåËÇØÂÆöÊúâÂæàÂ§öÈîôËØØÊàñÁêÜËß£‰∏çÂà∞‰ΩçÁöÑÂú∞Êñπ">
<meta name="twitter:image" content="http://yoursite.com/2020/12/01/vue-router-analysis-part2/match.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Âçö‰∏ª'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/12/01/vue-router-analysis-part2/"/>





  <title> vue-router-analysis-part2 | BryanAdamssÁöÑÂçöÂÆ¢ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BryanAdamssÁöÑÂçöÂÆ¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">‰∏Ä‰∏™‰º™ÂâçÁ´Ø</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            È¶ñÈ°µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            ÂàÜÁ±ª
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            ÂΩíÊ°£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Ê†áÁ≠æ
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            ÊêúÁ¥¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="ÊêúÁ¥¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/01/vue-router-analysis-part2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BryanAdamss">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/Avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BryanAdamssÁöÑÂçöÂÆ¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                vue-router-analysis-part2
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂèëË°®‰∫é</span>
              
              <time title="ÂàõÂª∫‰∫é" itemprop="dateCreated datePublished" datetime="2020-12-01T06:51:15+08:00">
                2020-12-01 06:51:15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂàÜÁ±ª‰∫é</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FrontEnd/" itemprop="url" rel="index">
                    <span itemprop="name">ÂâçÁ´Ø</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="vue-router-Ê∫êÁ†ÅËß£Êûê-1-5w-Â≠ó-Â§öÂõæÈ¢ÑË≠¶-„Äê‰∏≠„Äë"><a href="#vue-router-Ê∫êÁ†ÅËß£Êûê-1-5w-Â≠ó-Â§öÂõæÈ¢ÑË≠¶-„Äê‰∏≠„Äë" class="headerlink" title="vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë"></a>vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë</h1><ul>
<li>ÂêÑ‰ΩçÂ•ΩÔºåÊàëÊòØÂÖâËæâ üòé</li>
<li>Êú¨ÁØáÊòØ<code>vue-router</code>Ê∫êÁ†ÅËß£ÊûêÁöÑ‰∏≠ÁØáÔºå‰πüÊòØÊ†∏ÂøÉÁØá</li>
<li>Êú¨ÁØá‰∏ªË¶Å‰ªãÁªç‰∫Ü‰∏ãÈù¢Âá†ÁÇπ<ul>
<li>‰ªãÁªç‰∫Ü<code>vue-router</code>ÊòØÂ¶Ç‰ΩïÂÅöË∑ØÁî±ÂåπÈÖçÁöÑ</li>
<li>‰ª•ÂèäÂÖ∂Áõ∏ÂÖ≥ÁöÑÂÆàÂç´„ÄÅÈí©Â≠êÊòØÂ¶Ç‰ΩïËß¶ÂèëÁöÑ</li>
<li>ÂºÇÊ≠•ÁªÑ‰ª∂ÂèàÊòØÂ¶Ç‰ΩïÂ§ÑÁêÜÁöÑÁ≠âÁ≠â</li>
</ul>
</li>
<li>ËôΩÁÑ∂ÁúãÁùÄÁü•ËØÜÁÇπÂæàÂ∞ëÔºå‰ΩÜÂÜÖÂÆπÂç¥‰∏ÄÁÇπÈÉΩ‰∏çÂ∞ë</li>
<li>Âè¶Â§ñËøòÊòØË¶ÅËØ¥‰∏Ä‰∏ã<ul>
<li>Á¨¨‰∏ÄÊ¨°ÂÅöÊ∫êÁ†ÅËß£ÊûêÔºåËÇØÂÆöÊúâÂæàÂ§öÈîôËØØÊàñÁêÜËß£‰∏çÂà∞‰ΩçÁöÑÂú∞ÊñπÔºåÊ¨¢ËøéÊåáÊ≠£ ü§û</li>
</ul>
</li>
<li>È°πÁõÆÂú∞ÂùÄ<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis</code></li>
<li>Â¶ÇÊûúËßâÂæóÂØπ‰Ω†ÊúâÂ∏ÆÂä©ÔºåËÆ∞ÂæóÁªôÊàë‰∏Ä‰∏™<code>star</code>‚ú®</li>
</ul>
</li>
<li>uml ÂõæÊ∫êÊñá‰ª∂<ul>
<li><code>https://github.com/BryanAdamss/vue-router-for-analysis/blob/dev/vue-router.EAP</code></li>
</ul>
</li>
<li>ÂÖ≥ËÅîÊñáÁ´†ÈìæÊé•<ul>
<li><a href="https://juejin.cn/post/6880529850159874062" target="_blank" rel="noopener">vue-routerÊ∫êÁ†ÅËß£Êûê | 1.3wÂ≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏ä„Äë</a></li>
<li><a href="https://juejin.cn/post/6901047675227996167" target="_blank" rel="noopener">vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë</a></li>
<li><a href="https://juejin.cn/post/6902992939115855880" target="_blank" rel="noopener">vue-router Ê∫êÁ†ÅËß£Êûê | 6k Â≠ó - „Äê‰∏ã„Äë</a></li>
</ul>
</li>
</ul>
<h2 id="Ë∑ØÁî±Ë∑≥ËΩ¨"><a href="#Ë∑ØÁî±Ë∑≥ËΩ¨" class="headerlink" title="Ë∑ØÁî±Ë∑≥ËΩ¨"></a>Ë∑ØÁî±Ë∑≥ËΩ¨</h2><ul>
<li>ÂâçÈù¢‰ªãÁªçËøáÔºåË¶ÅÂÆûÁé∞Ë∑ØÁî±ÁöÑË∑≥ËΩ¨ÔºåÈ¶ñÂÖàÂæó‰ªéË∑ØÁî±Êò†Â∞ÑË°®‰∏≠ÊâæÂà∞‰∏éÂú∞ÂùÄÂåπÈÖçÁöÑË∑ØÁî±ÂØπË±°ÔºåËøô‰∏™ËøáÁ®ãÁß∞‰πã‰∏∫Ë∑ØÁî±ÂåπÈÖçÔºåÊâæÂà∞ÂåπÈÖçÁöÑË∑ØÁî±ÂêéÔºåÁÑ∂ÂêéÂÜçËß£ÊûêË∑≥ËΩ¨</li>
<li>ÊâÄ‰ª•ÂÆûÁé∞Ë∑ØÁî±Ë∑≥ËΩ¨Êúâ‰∏§‰∏™ÂÖ≥ÈîÆÊ≠•È™§ÔºöË∑ØÁî±ÂåπÈÖç„ÄÅÂØºËà™Ëß£Êûê</li>
<li><code>VueRouter</code>Â∞Ü‰∏äËø∞‰∏§‰∏™ÂÖ≥ÈîÆÊ≠•È™§Â∞ÅË£ÖÂà∞<code>transitionTo</code>ÊñπÊ≥ï‰∏≠‰∫Ü</li>
<li>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨ÂÖàÁúãÁúã<code>transitionTo</code>ÁöÑÂÆûÁé∞</li>
</ul>
<h3 id="transitionTo"><a href="#transitionTo" class="headerlink" title="transitionTo"></a>transitionTo</h3><ul>
<li>ÂâçÈù¢‰ªãÁªçËøáÔºå<code>transitionTo</code>ÊñπÊ≥ïÂÆö‰πâÂú®Âü∫Á±ª<code>History</code>‰∏äÁöÑ</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">//¬†Áà∂Á±ª</span></span><br><span class="line"><span class="keyword">export</span>¬†<span class="keyword">class</span>¬†History¬†&#123;</span><br><span class="line">¬†¬†...</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†Ë∑ØÁî±Ë∑≥ËΩ¨</span></span><br><span class="line">¬†¬†transitionTo¬†(</span><br><span class="line">¬†¬†¬†¬†location:¬†RawLocation,¬†<span class="comment">//¬†ÂéüÂßãlocationÔºå‰∏Ä‰∏™urlÊàñËÄÖÊòØ‰∏Ä‰∏™Location¬†interface(Ëá™ÂÆö‰πâÂΩ¢Áä∂ÔºåÂú®types/router.d.ts‰∏≠ÂÆö‰πâ)</span></span><br><span class="line">¬†¬†¬†¬†onComplete?:¬†<span class="built_in">Function</span>,¬†<span class="comment">//¬†Ë∑≥ËΩ¨ÊàêÂäüÂõûË∞É</span></span><br><span class="line">¬†¬†¬†¬†onAbort?:¬†<span class="built_in">Function</span><span class="comment">//¬†Ë∑≥ËΩ¨Â§±Ë¥•ÂõûË∞É</span></span><br><span class="line">¬†¬†)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†route¬†=¬†<span class="keyword">this</span>.router.match(location,¬†<span class="keyword">this</span>.current)¬†<span class="comment">//¬†‰º†ÂÖ•ÈúÄË¶ÅË∑≥ËΩ¨ÁöÑlocationÂíåÂΩìÂâçË∑ØÁî±ÂØπË±°ÔºåËøîÂõûtoÁöÑRoute</span></span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Á°ÆËÆ§Ë∑≥ËΩ¨</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.confirmTransition(</span><br><span class="line">¬†¬†¬†¬†¬†¬†route,</span><br><span class="line">¬†¬†¬†¬†¬†¬†()¬†=&gt;¬†&#123;¬†<span class="comment">//¬†onCompleteÔºåÂÆåÊàê</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.updateRoute(route)¬†<span class="comment">//¬†Êõ¥Êñ∞routeÔºå‰ºöËß¶ÂèëafterEachÈí©Â≠ê</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†onComplete¬†&amp;&amp;¬†onComplete(route)¬†<span class="comment">//¬†Ë∞ÉÁî®onCompleteÂõûË∞É</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.ensureURL()</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†fire¬†ready¬†cbs¬†once</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Ëß¶ÂèëreadyÂõûË∞É</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(!<span class="keyword">this</span>.ready)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.ready¬†=¬†<span class="literal">true</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.readyCbs.forEach(<span class="function"><span class="params">cb</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb(route)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;,</span><br><span class="line">¬†¬†¬†¬†¬†¬†err¬†=&gt;¬†&#123;¬†<span class="comment">//¬†onAbortÔºåÊä•ÈîôÔºàÂèñÊ∂àÔºâ</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(onAbort)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†onAbort(err)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Ëß¶ÂèëerrorÂõûË∞É</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(err¬†&amp;&amp;¬†!<span class="keyword">this</span>.ready)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.ready¬†=¬†<span class="literal">true</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.readyErrorCbs.forEach(<span class="function"><span class="params">cb</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb(err)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†)</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Âú®<code>setupListeners</code>Á´†ËäÇ‰πü‰ªãÁªçËøá<code>transitionTo</code>ÁöÑÊñπÊ≥ïÁ≠æÂêç</li>
<li>Êé•Êî∂‰∏â‰∏™ÂèÇÊï∞<ul>
<li><code>location</code>‰∏∫<code>RawLocation</code>Á±ªÂûãÔºå‰ª£Ë°®ÈúÄË¶ÅËß£ÊûêÁöÑÂú∞ÂùÄ</li>
<li><code>onComplete</code>ÊòØË∑≥ËΩ¨ÊàêÂäüÂõûË∞ÉÔºåÂú®Ë∑ØÁî±Ë∑≥ËΩ¨ÊàêÂäüÊó∂Ë∞ÉÁî®</li>
<li><code>onAbort</code>ÊòØË∑≥ËΩ¨Â§±Ë¥•(ÂèñÊ∂à)ÂõûË∞ÉÔºåÂú®Ë∑ØÁî±Ë¢´ÂèñÊ∂àÊó∂Ë∞ÉÁî®</li>
</ul>
</li>
<li>Áúã‰∏ãÂÜÖÈÉ®ÈÄªËæë</li>
<li>Ë∞ÉÁî®<code>routerÂÆû‰æã</code>ÁöÑ<code>match</code>ÊñπÊ≥ïÔºå‰ªéË∑ØÁî±Êò†Â∞ÑË°®‰∏≠ÂèñÂà∞Â∞ÜË¶ÅË∑≥ËΩ¨Âà∞ÁöÑË∑ØÁî±ÂØπË±°<code>route</code>ÔºõËøôÂÖ∂ÂÆûÂ∞±ÊòØ<code>Ë∑ØÁî±ÂåπÈÖç</code>ËøáÁ®ãÔºõ</li>
<li>ÊãøÂà∞Â∞ÜË¶ÅË∑≥ËΩ¨ÁöÑ<code>route</code>ÂêéÔºåË∞ÉÁî®<code>confirmTransition</code>ÂÆåÊàê<code>route</code>ÁöÑËß£ÊûêË∑≥ËΩ¨ÔºåÂπ∂Âú®Ë∑≥ËΩ¨ÊàêÂäü„ÄÅÂèñÊ∂àÊó∂Ë∞ÉÁî®ÂØπÂ∫îÂõûË∞ÉÊñπÊ≥ïÔºõËøôÊòØ<code>ÂØºËà™Ëß£Êûê</code>ËøáÁ®ã<ul>
<li>ÊàêÂäüÊó∂ÔºåË∞ÉÁî®<code>updateRoute</code>Ëß¶ÂèëÈáçÊñ∞Ê∏≤ÊüìÔºåÁÑ∂ÂêéËß¶ÂèëÁõ∏ÂÖ≥ÂõûË∞ÉÔºõÂÖ≥‰∫éÊ∏≤ÊüìÔºåÊàë‰ª¨ÂêéÈù¢Á´†ËäÇ‰ºöËÆ≤</li>
<li>ÂèñÊ∂à(Â§±Ë¥•)Êó∂ÔºåËß¶ÂèëÁõ∏ÂÖ≥ÂõûË∞É</li>
</ul>
</li>
<li>ÈÇ£Êàë‰ª¨‰∏ãÈù¢ÂÖàÁúã‰∏ãË∑ØÁî±ÂåπÈÖçËøáÁ®ã</li>
</ul>
<h2 id="Ë∑ØÁî±ÂåπÈÖç"><a href="#Ë∑ØÁî±ÂåπÈÖç" class="headerlink" title="Ë∑ØÁî±ÂåπÈÖç"></a>Ë∑ØÁî±ÂåπÈÖç</h2><ul>
<li><code>transitionTo</code>‰∏≠‰ºöË∞ÉÁî®<code>routerÂÆû‰æã</code>ÁöÑ<code>match</code>ÊñπÊ≥ïÂÆûÁé∞Ë∑ØÁî±ÂåπÈÖç</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> VueRouter &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params">options: RouterOptions = &#123;&#125;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.matcher = createMatcher(options.routes || [], <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ëé∑ÂèñÂåπÈÖçÁöÑË∑ØÁî±ÂØπË±°</span></span><br><span class="line">  match (</span><br><span class="line">    raw: RawLocation,</span><br><span class="line">    current?: Route,</span><br><span class="line">    redirectedFrom?: Location</span><br><span class="line">  ): Route &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.matcher.match(raw, current, redirectedFrom)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>routerÂÆû‰æãÁöÑmatch</code>ÊñπÊ≥ïÔºåÂèàË∞ÉÁî®ÁöÑÂåπÈÖçÂô®ÁöÑ<code>match</code>ÊñπÊ≥ïÔºåÂ∞ÜÂèÇÊï∞Áõ¥Êé•ÈÄè‰º†ËøáÂéª<ul>
<li>ÂÖ≥‰∫éÂåπÈÖçÁöÑÂàõÂª∫ÂèØ‰ª•Áúã‰πãÂâçÁöÑ<code>ÂàõÂª∫ÂåπÈÖçÂô®</code>Á´†ËäÇ</li>
</ul>
</li>
<li>Êàë‰ª¨ÁªßÁª≠ÁúãÂåπÈÖçÂô®ÁöÑ<code>match</code>ÊñπÊ≥ï</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-matcher.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span>¬†<span class="function"><span class="keyword">function</span>¬†<span class="title">createMatcher</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†routes:¬†<span class="built_in">Array</span>&lt;RouteConfig&gt;,¬†<span class="comment">//¬†Ë∑ØÁî±ÈÖçÁΩÆÂàóË°®</span></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†router:¬†VueRouter¬†<span class="comment">//¬†VueRouterÂÆû‰æã</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>):¬†<span class="title">Matcher</span>¬†</span>&#123;</span><br><span class="line">¬† ...</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†‰º†ÂÖ•location,ËøîÂõûÂåπÈÖçÁöÑRouteÂØπË±°</span></span><br><span class="line">¬†¬†<span class="function"><span class="keyword">function</span>¬†<span class="title">match</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†¬†¬†raw:¬†RawLocation,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†¬†¬†currentRoute?:¬†Route,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†¬†¬†redirectedFrom?:¬†Location</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†</span>):¬†<span class="title">Route</span>¬†</span>&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Ëé∑ÂèñÊ†ºÂºèÂåñÂêéÁöÑlocationÔºåÁî±‰∫éÈó≠ÂåÖÁâπÊÄßÔºåÊâÄ‰ª•Ê≠§Â§ÑËÉΩËÆøÈóÆÂà∞routerÂÆû‰æã</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†location¬†=¬†normalizeLocation(raw,¬†currentRoute,¬†<span class="literal">false</span>,¬†router)</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†&#123;¬†name¬†&#125;¬†=¬†location</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†ÈÄöËøánameÂåπÈÖç</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">if</span>¬†(name)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">const</span>¬†record¬†=¬†nameMap[name]</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(process.env.NODE_ENV¬†!==¬†<span class="string">'production'</span>)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Êú™ÊâæÂà∞Ë≠¶Âëä</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†warn(record,¬†<span class="string">`Route¬†with¬†name¬†'<span class="subst">$&#123;name&#125;</span>'¬†does¬†not¬†exist`</span>)</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Êú™ÊâæÂà∞Ë∑ØÁî±ËÆ∞ÂΩïÔºåÂàôÂàõÂª∫‰∏Ä‰∏™Á©∫RouteËøîÂõû</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(!record)¬†<span class="keyword">return</span>¬†_createRoute(<span class="literal">null</span>,¬†location)</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Ëé∑ÂèñÂä®ÊÄÅË∑ØÁî±ÂèÇÊï∞Âêç</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">const</span>¬†paramNames¬†=¬†record.regex.keys</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†.filter(<span class="function"><span class="params">key</span>¬†=&gt;</span>¬†!key.optional)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†.map(<span class="function"><span class="params">key</span>¬†=&gt;</span>¬†key.name)</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(<span class="keyword">typeof</span>¬†location.params¬†!==¬†<span class="string">'object'</span>)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†location.params¬†=¬†&#123;&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†ÊèêÂèñÂΩìÂâçRoute‰∏≠Á¨¶ÂêàÂä®ÊÄÅË∑ØÁî±ÂèÇÊï∞ÂêçÁöÑÂÄºËµãÂÄºÁªôlocation</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(currentRoute¬†&amp;&amp;¬†<span class="keyword">typeof</span>¬†currentRoute.params¬†===¬†<span class="string">'object'</span>)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">for</span>¬†(<span class="keyword">const</span>¬†key¬†<span class="keyword">in</span>¬†currentRoute.params)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(!(key¬†<span class="keyword">in</span>¬†location.params)¬†&amp;&amp;¬†paramNames.indexOf(key)¬†&gt;¬†<span class="number">-1</span>)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†location.params[key]¬†=¬†currentRoute.params[key]</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Â°´ÂÖÖparams</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†location.path¬†=¬†fillParams(record.path,¬†location.params,¬†<span class="string">`named¬†route¬†"<span class="subst">$&#123;name&#125;</span>"`</span>)</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†ÂàõÂª∫route</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">return</span>¬†_createRoute(record,¬†location,¬†redirectedFrom)</span><br><span class="line">¬†¬†¬†¬†&#125;¬†<span class="keyword">else</span>¬†<span class="keyword">if</span>¬†(location.path)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†location.params¬†=¬†&#123;&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†ÈÅçÂéÜpathListÔºåÊâæÂà∞ËÉΩÂåπÈÖçÂà∞ÁöÑËÆ∞ÂΩïÔºåÁÑ∂ÂêéÁîüÊàêRoute</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">for</span>¬†(<span class="keyword">let</span>¬†i¬†=¬†<span class="number">0</span>;¬†i¬†&lt;¬†pathList.length;¬†i++)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">const</span>¬†path¬†=¬†pathList[i]</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">const</span>¬†record¬†=¬†pathMap[path]</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(matchRoute(record.regex,¬†location.path,¬†location.params))¬†&#123;</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†ÊâæÂà∞ÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÂêéÔºåÁîüÊàêÂØπÂ∫îRoute</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">return</span>¬†_createRoute(record,¬†location,¬†redirectedFrom)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†no¬†match</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">return</span>¬†_createRoute(<span class="literal">null</span>,¬†location)</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">¬†¬†¬†</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Áî±‰∫é<code>router.match</code>ÊòØÂ∞ÜÂèÇÊï∞ÈÄè‰º†ËøáÊù•ÁöÑÔºåÊâÄ‰ª•‰∫åËÄÖÁöÑÁ≠æÂêç‰∏ÄÊ®°‰∏ÄÊ†∑<ul>
<li><code>raw</code>ÊòØ<code>RawLocation</code>Á±ªÂûãÔºåÊòØÈúÄË¶ÅËøõË°åË∑ØÁî±ÂåπÈÖçÁöÑÂú∞ÂùÄ</li>
<li><code>currentRoute</code>ÊòØÂΩìÂâçË∑ØÁî±ÂØπË±°</li>
<li><code>redirectedFrom</code>‰ª£Ë°®‰ªéÂì™‰∏™Âú∞ÂùÄÈáçÂÆöÂêëËøáÊù•ÁöÑ</li>
</ul>
</li>
<li>Êàë‰ª¨Áúã‰∏ã<code>match</code>ÊñπÊ≥ïÈÄªËæë<ul>
<li>È¶ñÂÖàÂÆÉÂØπ‰º†ÂÖ•ÁöÑ<code>raw</code>Âú∞ÂùÄÔºåËøõË°å‰∫ÜÊ†ºÂºèÂåñ(ËßÑËåÉÂåñ)</li>
<li>ÁÑ∂ÂêéÂèñÂá∫Ê†ºÂºèÂåñÂú∞ÂùÄ‰∏≠ÁöÑ<code>name</code></li>
<li><code>name</code>Â≠òÂú®ÔºåÂà§Êñ≠ÊòØÂê¶ËÉΩÈÄöËøá<code>name</code>Âú®<code>nameMap</code>‰∏≠ÊâæÂà∞ÂØπÂ∫îÁöÑË∑ØÁî±ËÆ∞ÂΩï<code>RouteRecord</code><ul>
<li>Êó†Ê≥ïÊâæÂà∞ÔºåÂàôÂàõÂª∫‰∏Ä‰∏™Êñ∞<code>route</code>ÂØπË±°ËøîÂõû</li>
<li>ÂèØ‰ª•ÊâæÂà∞ÔºåÂàôÂ°´ÂÖÖ<code>params</code>ÔºåÂπ∂‰ΩøÁî®Ê≠§Ë∑ØÁî±ËÆ∞ÂΩïÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ<code>Route</code>ÂØπË±°ËøîÂõû</li>
</ul>
</li>
<li><code>name</code>‰∏çÂ≠òÂú®ÔºåÂàôÂà§Êñ≠<code>path</code>ÊòØÂê¶Â≠òÂú®<ul>
<li>Â≠òÂú®ÔºåÂàôÂà©Áî®<code>pathList„ÄÅpathMap</code>Ë∞ÉÁî®<code>matchRoute</code>Âà§Êñ≠ÊòØÂê¶ÂåπÈÖçÔºåËøõËÄåÊâæÂà∞ÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÔºåÁÑ∂Âêé‰ΩøÁî®Ê≠§Ë∑ØÁî±ËÆ∞ÂΩïÂàõÂª∫Êñ∞<code>route</code>ÂØπË±°ËøîÂõû</li>
</ul>
</li>
<li><code>name</code>„ÄÅ<code>path</code>ÈÉΩ‰∏çÂ≠òÂú®<ul>
<li>ÂàôÁõ¥Êé•ÂàõÂª∫‰∏Ä‰∏™Êñ∞<code>route</code>ÂØπË±°ËøîÂõû</li>
</ul>
</li>
</ul>
</li>
<li>Ê¥ªÂä®ÂõæÂ¶Ç‰∏ã</li>
<li>match.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/match.png" alt="match.png"></li>
</ul>
</li>
<li>Êàë‰ª¨ÊèêÂèñ‰∏Ä‰∏ã‰∏äËø∞ÊµÅÁ®ãÁöÑÂÖ≥ÈîÆËØç<ul>
<li><code>Âú∞ÂùÄÊ†ºÂºèÂåñnormalizeLocation</code>„ÄÅ<code>Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠matchRoute</code>„ÄÅ<code>Â°´ÂÖÖÂèÇÊï∞fillParams</code>„ÄÅ<code>ÂàõÂª∫Ë∑ØÁî±ÂØπË±°_createRoute</code></li>
</ul>
</li>
</ul>
<h3 id="Âú∞ÂùÄÊ†ºÂºèÂåñ-normalizeLocation"><a href="#Âú∞ÂùÄÊ†ºÂºèÂåñ-normalizeLocation" class="headerlink" title="Âú∞ÂùÄÊ†ºÂºèÂåñ normalizeLocation"></a>Âú∞ÂùÄÊ†ºÂºèÂåñ normalizeLocation</h3><ul>
<li>Êàë‰ª¨Áúã‰∏ã‰∏∫‰ΩïÈúÄË¶ÅÂØπÂú∞ÂùÄÂÅöÊ†ºÂºèÂåñ</li>
<li>Êàë‰ª¨Áü•ÈÅì<code>VueRoute</code>ÂÆö‰πâÁöÑÂú∞ÂùÄÊòØ<code>RawLocation</code>Á±ªÂûãÁöÑÔºåËÄåÂÆÉÊòØËÅîÂêàÁ±ªÂûãÁöÑÔºåÊîØÊåÅ<code>string</code>Âíå<code>Location</code>Á±ªÂûã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flow/declarations.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> Location = &#123;</span><br><span class="line">  _normalized?: <span class="built_in">boolean</span></span><br><span class="line">  name?: <span class="built_in">string</span></span><br><span class="line">  path?: <span class="built_in">string</span></span><br><span class="line">  hash?: <span class="built_in">string</span></span><br><span class="line">  query?: Dictionary&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  params?: Dictionary&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">  append?: <span class="built_in">boolean</span></span><br><span class="line">  replace?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> RawLocation = <span class="built_in">string</span> | Location</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊâÄ‰ª•‰∏ãÈù¢ÁöÑÂú∞ÂùÄÈÉΩÊòØÂêàÊ≥ïÁöÑ</li>
<li><code>$router.push</code>ÊñπÊ≥ïÁöÑÂèÇÊï∞‰πüÊòØÁöÑ<code>RawLocation</code>Á±ªÂûãÔºåÊâÄ‰ª•‰ΩøÁî®<code>$router.push</code>Êù•‰∏æ‰æã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Â≠óÁ¨¶‰∏≤ÂΩ¢Âºè</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(<span class="string">'home'</span>) <span class="comment">// Áõ∏ÂØπ</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(<span class="string">'/home'</span>) <span class="comment">// ÁªùÂØπ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Location ÂØπË±°ÂΩ¢Âºè</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123; path: <span class="string">'home'</span> &#125;)</span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123; path: <span class="string">'/home'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123; path: <span class="string">'/home'</span>, query: &#123; test: <span class="number">3</span> &#125; &#125;) <span class="comment">// Êê∫Â∏¶qs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123; name: <span class="string">'home'</span> &#125;) <span class="comment">// ÂëΩÂêçË∑ØÁî±</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123; name: <span class="string">'detail'</span>, params: &#123; id: <span class="number">1</span> &#125; &#125;) <span class="comment">// ÂëΩÂêç+Â∏¶ÂèÇ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123; params: &#123; id: <span class="number">1</span> &#125; &#125;) <span class="comment">// ‰ªÖÂ∏¶ÂèÇÔºåÈíàÂØπ‰ªÖÊúâÂèÇÊï∞ÂèòÂåñÁöÑÁõ∏ÂØπË∑≥ËΩ¨ÔºõÁõ∏ÂØπÂèÇÊï∞Ë∑≥ËΩ¨</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞<code>VueRouter</code>ÈúÄË¶ÅÂÖºÂÆπ‰∏äÈù¢ÊâÄÊúâÊÉÖÂÜµÔºå‰∏∫‰∫ÜÊñπ‰æøÂ§ÑÁêÜÔºåÈúÄË¶ÅÂØπÂú∞ÂùÄÂÅöÊ†ºÂºèÂåñ</li>
<li>Áúã‰∏ãÂÆûÁé∞ÈÄªËæë</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/location.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ê†ºÂºèÂåñlocation</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">normalizeLocation</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  raw: RawLocation, <span class="comment">//¬†ÂéüÂßãlocationÔºå‰∏Ä‰∏™stringÔºåÊàñËÄÖÊòØ‰∏Ä‰∏™Â∑≤ÁªèÊ†ºÂºèÂåñÂêéÁöÑlocation</span></span></span></span><br><span class="line"><span class="function"><span class="params">  current: ?Route, <span class="comment">//¬†ÂΩìÂâçË∑ØÁî±ÂØπË±°</span></span></span></span><br><span class="line"><span class="function"><span class="params">  append: ?<span class="built_in">boolean</span>, <span class="comment">//¬†ÊòØÂê¶ÊòØËøΩÂä†Ê®°Âºè</span></span></span></span><br><span class="line"><span class="function"><span class="params">  router: ?VueRouter <span class="comment">//¬†VueRouterÂÆû‰æã</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Location</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> next: Location = <span class="keyword">typeof</span> raw === <span class="string">'string'</span> ? &#123; path: raw &#125; : raw <span class="comment">//¬†named¬†target //¬†Â∑≤ÁªèÊ†ºÂºèÂåñËøáÔºåÁõ¥Êé•ËøîÂõû</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (next._normalized) &#123;</span><br><span class="line">    <span class="keyword">return</span> next</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (next.name) &#123;</span><br><span class="line">    <span class="comment">//¬†Â§ÑÁêÜÂëΩÂêçÂΩ¢ÂºèÔºå‰æãÂ¶Ç&#123;name:'Home',params:&#123;id:3&#125;&#125;</span></span><br><span class="line">    next = extend(&#123;&#125;, raw)</span><br><span class="line">    <span class="keyword">const</span> params = next.params</span><br><span class="line">    <span class="keyword">if</span> (params &amp;&amp; <span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">      next.params = extend(&#123;&#125;, params)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> next</span><br><span class="line">  &#125; <span class="comment">//¬†relative¬†params //¬†Â§ÑÁêÜ&#123;params:&#123;id:1&#125;&#125;Áõ∏ÂØπÂèÇÊï∞ÂΩ¢ÂºèË∑≥ËΩ¨</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!next.path &amp;&amp; next.params &amp;&amp; current) &#123;</span><br><span class="line">    next = extend(&#123;&#125;, next)</span><br><span class="line">    next._normalized = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> params: <span class="built_in">any</span> = extend(extend(&#123;&#125;, current.params), next.params) <span class="comment">//¬†ÊèêÂèñÂΩìÂâçrouteÁöÑÂ≠óÊÆµÂÅö‰∏∫nextÁöÑÂ≠óÊÆµÔºåÂõ†‰∏∫Áõ∏ÂØπÂèÇÊï∞ÂΩ¢ÂºèÔºåÂè™ÊúâparamsÔºåÂøÖÈ°ªÂÄüÂä©currentÊèêÂèñ‰∏Ä‰∫õÂ≠óÊÆµ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (current.name) &#123;</span><br><span class="line">      <span class="comment">//¬†ÂëΩÂêçÂΩ¢Âºè</span></span><br><span class="line">      next.name = current.name</span><br><span class="line">      next.params = params</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (current.matched.length) &#123;</span><br><span class="line">      <span class="comment">//¬†pathÂΩ¢ÂºèÔºå‰ªéÂåπÈÖçËÆ∞ÂΩï‰∏≠ÊèêÂèñÂá∫ÂΩìÂâçpathÂπ∂Â°´ÂÖÖÂèÇÊï∞</span></span><br><span class="line">      <span class="keyword">const</span> rawPath = current.matched[current.matched.length - <span class="number">1</span>].path</span><br><span class="line">      next.path = fillParams(rawPath, params, <span class="string">`path¬†<span class="subst">$&#123;current.path&#125;</span>`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      warn(<span class="literal">false</span>, <span class="string">`relative¬†params¬†navigation¬†requires¬†a¬†current¬†route.`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> next</span><br><span class="line">  &#125; <span class="comment">//¬†Â§ÑÁêÜpathÂΩ¢ÂºèË∑≥ËΩ¨Ôºå‰æãÂ¶Ç&#123;path:'/test',query:&#123;test:3&#125;&#125; //¬†Ëß£Êûêpath</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> parsedPath = parsePath(next.path || <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">const</span> basePath = (current &amp;&amp; current.path) || <span class="string">'/'</span></span><br><span class="line">  <span class="keyword">const</span> path = parsedPath.path</span><br><span class="line">    ? resolvePath(parsedPath.path, basePath, append || next.append)</span><br><span class="line">    : basePath <span class="comment">//¬†Ëß£Êûêquery</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> query = resolveQuery(</span><br><span class="line">    parsedPath.query,</span><br><span class="line">    next.query, <span class="comment">//¬†È¢ùÂ§ñÈúÄË¶ÅËøΩÂä†ÁöÑqs</span></span><br><span class="line">    router &amp;&amp; router.options.parseQuery <span class="comment">//¬†ÊîØÊåÅ‰º†ÂÖ•Ëá™ÂÆö‰πâËß£ÊûêqueryÁöÑÊñπÊ≥ï</span></span><br><span class="line">  ) <span class="comment">//¬†Ëß£Êûêhash</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> hash = next.hash || parsedPath.hash</span><br><span class="line">  <span class="keyword">if</span> (hash &amp;&amp; hash.charAt(<span class="number">0</span>) !== <span class="string">'#'</span>) &#123;</span><br><span class="line">    hash = <span class="string">`#<span class="subst">$&#123;hash&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    _normalized: <span class="literal">true</span>, <span class="comment">//¬†Ê†áËØÜÂ∑≤ÁªèÊ†ºÂºèÂåñËøá</span></span><br><span class="line">    path,</span><br><span class="line">    query,</span><br><span class="line">    hash,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>È¶ñÂÖàÂ∞Ü<code>string</code>Á±ªÂûãÁöÑËΩ¨Êç¢‰∏∫ÂØπË±°ÂΩ¢ÂºèÔºåÊñπ‰æøÂêéÈù¢Áªü‰∏ÄÂ§ÑÁêÜ</li>
<li>Â¶ÇÊûúÂèëÁé∞Âú∞ÂùÄÂ∑≤ÁªèÂÅöËøáÊ†ºÂºèÂåñÂ§ÑÁêÜÔºåÂàôÁõ¥Êé•ËøîÂõû</li>
<li>ÂÜçÂà§Êñ≠ÊòØÂê¶ÊòØÂëΩÂêçË∑ØÁî±<ul>
<li>Ëã•ÊòØÔºåÂàôÊã∑Ë¥ùÂéüÂßãÂú∞ÂùÄ<code>raw</code>ÔºåÊã∑Ë¥ù<code>params</code>ÔºåÁõ¥Êé•ËøîÂõû</li>
</ul>
</li>
<li>Â§ÑÁêÜ‰∫Ü‰ªÖÊê∫Â∏¶ÂèÇÊï∞ÁöÑÁõ∏ÂØπË∑ØÁî±(Áõ∏ÂØπÂèÇÊï∞)Ë∑≥ËΩ¨ÔºåÂ∞±ÊòØ<code>this.$router.push({params:{id:1}})</code>ÂΩ¢Âºè<ul>
<li>ÂØπËøôÁßçÂú∞ÂùÄÁöÑÂÆö‰πâÊòØ<code>Ê≤°Êúâpath</code>„ÄÅ<code>‰ªÖÊúâparams</code>Âπ∂‰∏î<code>ÂΩìÂâçË∑ØÁî±ÂØπË±°Â≠òÂú®</code></li>
<li>‰∏ªË¶ÅÂ§ÑÁêÜÈÄªËæëÊòØ<ul>
<li>ÂÖàÂêàÂπ∂<code>params</code></li>
<li>Ëã•ÊòØÂëΩÂêçË∑ØÁî±ÔºåÂàô‰ΩøÁî®<code>current.name</code>ÂÅö‰∏∫<code>next.name</code>ÔºåÂπ∂ËµãÂÄº<code>params</code></li>
<li>ÈùûÂëΩÂêçË∑ØÁî±Ôºå‰ªéÂΩìÂâçË∑ØÁî±ÂØπË±°‰∏≠ÊâæÂà∞ÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÔºåÂπ∂ÂèñÂá∫Ë∑ØÁî±ËÆ∞ÂΩï‰∏äÁöÑ<code>path</code>ÂÅö‰∏∫<code>next.path</code>ÔºåÁÑ∂ÂêéÂ°´ÂÖÖ<code>params</code></li>
<li>ËøîÂõûÂ§ÑÁêÜÂ•ΩÁöÑÂú∞ÂùÄ</li>
</ul>
</li>
<li>Áî±‰∫éËøô‰∏≠Ë∑≥ËΩ¨ÊñπÂºèÔºå‰ªÖÊúâ<code>params</code>ÔºåÊâÄ‰ª•ÂøÖÈ°ª‰ªéÂΩìÂâçË∑ØÁî±ÂØπË±°<code>current</code>‰∏äËé∑ÂèñÂèØÁî®Â≠óÊÆµ(<code>path</code>„ÄÅ<code>name</code>)ÔºåÂÅö‰∏∫Ëá™Ë∫´ÂÄºÔºåÁÑ∂ÂêéË∑≥ËΩ¨</li>
</ul>
</li>
<li>Â§ÑÁêÜÈÄöËøá<code>path</code>Ë∑≥ËΩ¨ÁöÑÊñπÂºè<ul>
<li>Ë∞ÉÁî®<code>parsePath</code>‰ªé<code>path</code>‰∏≠Ëß£ÊûêÂá∫<code>path„ÄÅquery„ÄÅhash</code></li>
<li>ÁÑ∂Âêé‰ª•<code>current.path</code>‰∏∫<code>basePath</code>ÔºåËß£Êûê(<code>resolve</code>)Âá∫<code>ÊúÄÁªàpath</code></li>
<li>ÂØπ<code>query</code>ËøõË°åÂêàÂπ∂Êìç‰Ωú</li>
<li>ÂØπ<code>hash</code>ËøõË°åÂâçËøΩÂä†<code>#</code>Êìç‰Ωú</li>
<li>ËøîÂõûÂ∏¶Êúâ<code>_normalized:true</code>Ê†áËØÜÁöÑ<code>Location</code>ÂØπË±°</li>
</ul>
</li>
<li>ÁªèËøá‰∏äÈù¢‰∏ÄÁï™Â§ÑÁêÜÔºåÊó†ËÆ∫‰º†ÂÖ•‰ΩïÁßçÂú∞ÂùÄÔºåÈÉΩËøîÂõû‰∏Ä‰∏™Â∏¶Êúâ<code>_normalized:true</code>Ê†áËØÜÁöÑ<code>LocationÁ±ªÂûã</code>ÁöÑÂØπË±°</li>
<li>normalize-location.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/normalize-location.png" alt="normalize-location.png"></li>
</ul>
</li>
</ul>
<h3 id="Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠-matchRoute"><a href="#Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠-matchRoute" class="headerlink" title="Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠ matchRoute"></a>Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠ matchRoute</h3><ul>
<li>Êàë‰ª¨Áü•ÈÅì<code>VueRouter</code>ÊòØÊîØÊåÅÂä®ÊÄÅË∑ØÁî±ÂåπÈÖçÁöÑÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫</li>
<li>dynamic-route.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/dynamic-route.png" alt="dynamic-route.png"></li>
</ul>
</li>
<li>Êàë‰ª¨Âú®‰∏äÁØáÁöÑ<code>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï</code>Á´†ËäÇ‰πü‰ªãÁªçËøáÔºå<code>VueRouter</code>Âú®ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩïÊó∂Ôºå‰ºöÈÄöËøá<code>path-to-regexp</code>ÂåÖÁîüÊàê‰∏Ä‰∏™Ê≠£ÂàôÊâ©Â±ïÂØπË±°Âπ∂ËµãÂÄºÂà∞Ë∑ØÁî±ËÆ∞ÂΩïÁöÑ<code>regex</code>Â≠óÊÆµ‰∏äÔºåÁî®‰∫éÂêéÁª≠ÁöÑÂä®ÊÄÅË∑ØÁî±ÂèÇÊï∞ÁöÑËé∑Âèñ<ul>
<li>‰∏ªË¶ÅÁöÑÈÄªËæëÊòØÊèê‰æõ‰∏Ä‰∏™Âä®ÊÄÅË∑ØÁî±<code>user/:id</code>Âíå‰∏Ä‰∏™Âú∞ÂùÄ<code>/user/345</code>ÔºåÈÄöËøá<code>path-to-regexp</code>Â∞±ËÉΩÁîüÊàê‰∏Ä‰∏™ÂØπË±°<code>{id:345}</code>Êù•Ë°®ËææÂèÇÊï∞ÁöÑÊò†Â∞ÑÂÖ≥Á≥ª</li>
<li>ÊòØ‰∏Ä‰∏™ÂÄüÂä©Âä®ÊÄÅË∑ØÁî±Ôºå‰ªé url ‰∏äÊèêÂèñÂèÇÊï∞ÁöÑËøáÁ®ãÔºõ<code>/user/345</code>-&gt;<code>{id:345}</code></li>
<li>ÂÖ∑‰Ωì‰æãÂ≠êÂèØÊü•Áúã<code>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï</code>Á´†ËäÇ</li>
</ul>
</li>
<li>‰∏äËø∞ÊèêÂèñÂèÇÊï∞ÁöÑÈÄªËæëÊòØÂú®<code>matchRoute</code>ÂÆûÁé∞ÁöÑ</li>
<li><code>matchRoute</code>‰Ωç‰∫é<code>src/create-matcher.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-matcher.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ê£ÄÊü•pathÊòØÂê¶ËÉΩÈÄöËøáregexÁöÑÂåπÈÖçÔºåÂπ∂ÂØπparamsÂØπË±°Ê≠£Á°ÆËµãÂÄº</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matchRoute</span>(<span class="params">regex: RouteRegExp, path: <span class="built_in">string</span>, params: <span class="built_in">Object</span></span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> m = path.match(regex)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!m) &#123;</span><br><span class="line">    <span class="comment">//¬†Êó†Ê≥ïÂåπÈÖç‰∏ä</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!params) &#123;</span><br><span class="line">    <span class="comment">//¬†Á¨¶ÂêàÊ≠£Âàô¬†&amp;&amp;¬†params‰∏çÂ≠òÂú®ÔºåÂàôË°®Á§∫ÂèØ‰ª•ÂåπÈÖç</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="comment">//¬†Á¨¶ÂêàÊ≠£Âàô¬†&amp;&amp;¬†paramsÂ≠òÂú®ÔºåÈúÄË¶ÅÂØπparamsËøõË°åÊ≠£Á°ÆËµãÂÄº //¬†path-to-regexp‰ºöÂ∞ÜÊØè‰∏™Âä®ÊÄÅË∑ØÁî±Ê†áËÆ∞Â§ÑÂ§ÑÁêÜÊàêÊ≠£ÂàôÁöÑ‰∏Ä‰∏™ÁªÑÔºåÊâÄ‰ª•i‰ªé1ÂºÄÂßã //¬†ÂèÇËÄÉhttps://www.npmjs.com/package/path-to-regexp //¬†const¬†keys¬†=¬†[]; //¬†const¬†regexp¬†=¬†pathToRegexp("/foo/:bar",¬†keys); //¬†regexp¬†=¬†/^\/foo\/([^\/]+?)\/?$/i //¬†:barÂ∞±Ë¢´Â§ÑÁêÜÊàêÊ≠£ÂàôÁöÑ‰∏Ä‰∏™ÁªÑ‰∫Ü //¬†keys¬†=¬†[&#123;¬†name:¬†'bar',¬†prefix:¬†'/',¬†suffix:¬†'',¬†pattern:¬†'[^\\/#\\?]+?',¬†modifier:¬†''¬†&#125;]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>, len = m.length; i &lt; len; ++i) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = regex.keys[i - <span class="number">1</span>] <span class="comment">//¬†regex.keysËøîÂõûÂåπÈÖçÂà∞ÁöÑ</span></span><br><span class="line">    <span class="keyword">const</span> val = <span class="keyword">typeof</span> m[i] === <span class="string">'string'</span> ? <span class="built_in">decodeURIComponent</span>(m[i]) : m[i]</span><br><span class="line">    <span class="keyword">if</span> (key) &#123;</span><br><span class="line">      <span class="comment">//¬†Fix¬†#1994:¬†using¬†*¬†with¬†props:¬†true¬†generates¬†a¬†param¬†named¬†0</span></span><br><span class="line">      params[key.name || <span class="string">'pathMatch'</span>] = val</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> truee</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÈÄöËøáÊñπÊ≥ïÁ≠æÂêçÔºåÂèØ‰ª•Áü•ÈÅìÂÆÉËøîÂõû‰∏Ä‰∏™<code>boolean</code>ÂÄºÔºåËøô‰∏™ÂÄº‰ª£Ë°®‰º†ÂÖ•ÁöÑ<code>path</code>ÊòØÂê¶ËÉΩÈÄöËøá<code>regexÁöÑÂåπÈÖç</code>ÔºõËôΩÁÑ∂ËøîÂõû‰∏Ä‰∏™<code>boolean</code>ÂÄºÔºå‰ΩÜÊòØÂÖ∂ÂÜÖÈÉ®ËøòÂÅö‰∫Ü‰ª∂ÂæàÈáçË¶ÅÁöÑ‰∫ãÔºå‰ªé<code>path</code>‰∏äÊèêÂèñÂä®ÊÄÅË∑ØÁî±ÂèÇÊï∞ÂÄºÔºåÊàë‰ª¨Áúã‰∏ãÂÆåÊï¥ÈÄªËæë</li>
<li>È¶ñÂÖàË∞ÉÁî®<code>path.match(regex)</code></li>
<li>‰∏çËÉΩÂåπÈÖçÁõ¥Êé•ËøîÂõû<code>false</code></li>
<li>ÂèØ‰ª•ÂåπÈÖç‰∏îÊó†<code>params</code>ÔºåËøîÂõû<code>true</code></li>
<li>Ââ©‰∏ãÁöÑÂ∞±Âè™Êúâ‰∏ÄÁßçÊÉÖÂÜµÔºåÂèØ‰ª•ÂåπÈÖç‰∏î<code>params</code>Â≠òÂú®ÔºåÊ≠§Êó∂ÈúÄË¶ÅÂØπ<code>params</code>ËøõË°åÊ≠£Á°ÆËµãÂÄº<ul>
<li>Êï¥‰∏™ËµãÂÄºÔºå‰∏ªË¶ÅÊòØÈÅçÂéÜ<code>path.match(regex)</code>ËøîÂõûÂÄºÂπ∂ÂèñÂá∫<code>regex</code>‰∏≠Â≠òÂÇ®ÁöÑ<code>key</code>ÔºåÁÑ∂Âêé‰æùÊ¨°ËµãÂÄºÔºåÂÖ≥‰∫éÁªÜËäÇÂèØ‰ª•ÂèÇËÄÉ‰∏äÈù¢ÁöÑÊ≥®ÈáäÔºõ</li>
<li>ÂÖ≥‰∫é<code>regex</code>„ÄÅ<code>path-to-regexp</code>ÔºåÂèØ‰ª•ÂèÇËÄÉ<code>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï</code>Á´†ËäÇÂíå<code>https://www.npmjs.com/package/path-to-regexp</code></li>
</ul>
</li>
<li>ËøòÊúâ‰∏Ä‰∏™ÁÇπÔºåËµãÂÄºÊó∂ÁöÑ<code>pathMatch</code>ÊòØ‰ªÄ‰πàÔºü<ul>
<li>ËøôÂÖ∂ÂÆûÊòØË∑üÈÄöÈÖçÁ¨¶Âç≥<code>*</code>ÊúâÂÖ≥ÁöÑ</li>
<li><code>VueRouter</code>ÂÖ≥‰∫éÈÄöÈÖçÁ¨¶ÁöÑÁâπÊÆäÂ§ÑÁêÜÂèØ‰ª•Áúã<a href="https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#ÊçïËé∑ÊâÄÊúâË∑ØÁî±Êàñ-404-not-found-Ë∑ØÁî±" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#ÊçïËé∑ÊâÄÊúâË∑ØÁî±Êàñ-404-not-found-Ë∑ØÁî±</a><ul>
<li>Âç≥<code>pathMatch</code>‰ºö‰ª£Ë°®ÈÄöÈÖçÁ¨¶ÂåπÈÖçÂà∞ÁöÑË∑ØÂæÑ</li>
</ul>
</li>
</ul>
</li>
<li>ÂÆòÊñπ‰æãÂ≠êÂ¶Ç‰∏ã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ‰ºöÂåπÈÖçÊâÄÊúâË∑ØÂæÑ</span></span><br><span class="line">  path: <span class="string">'*'</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ‰ºöÂåπÈÖç‰ª• `/user-` ÂºÄÂ§¥ÁöÑ‰ªªÊÑèË∑ØÂæÑ</span></span><br><span class="line">  path: <span class="string">'/user-*'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ÁªôÂá∫‰∏Ä‰∏™Ë∑ØÁî± &#123; path: '/user-*' &#125;</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(<span class="string">'/user-admin'</span>)</span><br><span class="line"><span class="keyword">this</span>.$route.params.pathMatch <span class="comment">// 'admin'</span></span><br><span class="line"><span class="comment">// ÁªôÂá∫‰∏Ä‰∏™Ë∑ØÁî± &#123; path: '*' &#125;</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(<span class="string">'/non-existing'</span>)</span><br><span class="line"><span class="keyword">this</span>.$route.params.pathMatch <span class="comment">// '/non-existing'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>match-route.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/match-route.png" alt="match-route.png"></li>
</ul>
</li>
</ul>
<h3 id="Â°´ÂÖÖÂèÇÊï∞-fillParams"><a href="#Â°´ÂÖÖÂèÇÊï∞-fillParams" class="headerlink" title="Â°´ÂÖÖÂèÇÊï∞ fillParams"></a>Â°´ÂÖÖÂèÇÊï∞ fillParams</h3><ul>
<li><code>fillParams</code>ÂèØ‰ª•ÁúãÂÅöÊòØ<code>matchRoute</code>ÁöÑÈÄÜÊìç‰ΩúÔºåÊòØ‰∏Ä‰∏™ÂÄüÂä©Âä®ÊÄÅË∑ØÂæÑÔºå‰ΩøÁî®ÂèÇÊï∞ÁîüÊàê url ÁöÑËøáÁ®ãÔºõÂç≥<code>/user/:id</code>+<code>{id:345}</code>-&gt;<code>/user/345</code></li>
<li>ÂèØ‰ª•Áúã‰∏ãÂÆÉÁöÑÂÆûÁé∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/params.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ÁºìÂ≠ò</span></span><br><span class="line"><span class="keyword">const</span> regexpCompileCache: &#123;</span><br><span class="line">  [key: <span class="built_in">string</span>]: <span class="built_in">Function</span></span><br><span class="line">&#125; = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Â°´ÂÖÖÂä®ÊÄÅË∑ØÁî±ÂèÇÊï∞</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fillParams</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  path: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  params: ?<span class="built_in">Object</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  routeMsg: <span class="built_in">string</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  params = params || &#123;&#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//¬†compile‰∏ªË¶ÅÁî®Êù•ÈÄÜËß£ÊûêÔºåhttps://www.npmjs.com/package/path-to-regexp#compile-reverse-path-to-regexp</span></span><br><span class="line">    <span class="keyword">const</span> filler =</span><br><span class="line">      regexpCompileCache[path] ||</span><br><span class="line">      (regexpCompileCache[path] = Regexp.compile(path)) <span class="comment">//¬†‰øÆÂ§çhttps://github.com/vuejs/vue-router/issues/2505#issuecomment-442353151 //¬†Fix¬†#2505¬†resolving¬†asterisk¬†routes¬†&#123;¬†name:¬†'not-found',¬†params:¬†&#123;¬†pathMatch:¬†'/not-found'¬†&#125;&#125; //¬†and¬†fix¬†#3106¬†so¬†that¬†you¬†can¬†work¬†with¬†location¬†descriptor¬†object¬†having¬†params.pathMatch¬†equal¬†to¬†empty¬†string</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> params.pathMatch === <span class="string">'string'</span>) params[<span class="number">0</span>] = params.pathMatch <span class="comment">//¬†ËøîÂõûÈÄÜËß£ÊûêÂêéÁöÑË∑ØÂæÑ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> filler(params, &#123; pretty: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="comment">//¬†Fix¬†#3072¬†no¬†warn¬†if¬†`pathMatch`¬†is¬†string</span></span><br><span class="line">      warn(</span><br><span class="line">        <span class="keyword">typeof</span> params.pathMatch === <span class="string">'string'</span>,</span><br><span class="line">        <span class="string">`missing¬†param¬†for¬†<span class="subst">$&#123;routeMsg&#125;</span>:¬†<span class="subst">$&#123;e.message&#125;</span>`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//¬†delete¬†the¬†0¬†if¬†it¬†was¬†added</span></span><br><span class="line">    <span class="keyword">delete</span> params[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞Êï¥‰∏™ÈÄÜËß£ÊûêÈÄªËæëÊòØÂÄüÂä©<code>Regexp.compile</code>ÁªìÂêà<code>regexpCompileCache</code>ÂÆûÁé∞ÁöÑ</li>
<li><code>Regexp.compile</code>Êé•Êî∂‰∏Ä‰∏™<code>Âä®ÊÄÅË∑ØÁî±path</code>ÔºåËøîÂõû‰∏Ä‰∏™ÂáΩÊï∞ÔºåÂèØÁî®Ëøô‰∏™ÂáΩÊï∞ÂÅöÈÄÜËß£ÊûêÔºõ</li>
<li><code>Regexp.compile</code>‰æãÂ≠êÂ¶Ç‰∏ã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://www.npmjs.com/package/path-to-regexp#compile-reverse-path-to-regexp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toPath = compile(<span class="string">'/user/:id'</span>)</span><br><span class="line">toPath(&#123; id: <span class="number">123</span> &#125;) <span class="comment">//=&gt;¬†"/user/123"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞È¶ñÂÖàÂØπ<code>Regexp.compile</code>ËøîÂõûÁöÑÂáΩÊï∞ÂÅö‰∫ÜÁºìÂ≠ò</li>
<li>ÁÑ∂ÂêéÂ∞Ü<code>matchRoute</code>‰∏≠Ê∑ªÂä†ÁöÑ<code>pathMatch</code>ËµãÂÄºÁªô<code>params[0]</code></li>
<li>Ë∞ÉÁî®<code>Regexp.compile</code>ËøîÂõûÂáΩÊï∞Ôºå‰ª•<code>params</code>‰∏∫ÂÖ•ÂèÇÔºåÈÄÜËß£Êûê<code>url</code>Âπ∂ËøîÂõû</li>
<li>Âà†Èô§Ê∑ªÂä†ÁöÑ<code>params[0]</code></li>
<li>fill-params.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/fill-params.png" alt="fill-params.png"></li>
</ul>
</li>
</ul>
<h3 id="ÂàõÂª∫Ë∑ØÁî±ÂØπË±°-createRoute"><a href="#ÂàõÂª∫Ë∑ØÁî±ÂØπË±°-createRoute" class="headerlink" title="ÂàõÂª∫Ë∑ØÁî±ÂØπË±°_createRoute"></a>ÂàõÂª∫Ë∑ØÁî±ÂØπË±°_createRoute</h3><ul>
<li>‰∏äÈù¢Êó†ËÆ∫ÊòØ<code>normalizeLocation</code>„ÄÅ<code>matchRoute</code>„ÄÅ<code>fillParams</code>ÈÉΩÊòØÈíàÂØπ‰º†ÂÖ•ÁöÑ<code>Âú∞ÂùÄ</code>ÂÅö‰∏Ä‰∫õÊìç‰ΩúÔºõ</li>
<li>ËÄå<code>match</code>ÊñπÊ≥ïÁöÑ‰ΩúÁî®ÊòØÊâæÂà∞‰∏éÂú∞ÂùÄÂåπÈÖçÁöÑË∑ØÁî±ÂØπË±°ÔºåËÄåËøô‰∏™‰∏ªË¶ÅÊòØÁî±<code>_createRoute</code>ÊñπÊ≥ïÂÆûÁé∞</li>
<li>‰ªéÂëΩÂêç‰∏äÂèØ‰ª•ÁúãÂá∫ÔºåËøôÊòØ‰∏™ÂÜÖÈÉ®ÊñπÊ≥ï</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/create-matcher.js createMatcherÊñπÊ≥ïÂÜÖ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_createRoute</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  record: ?RouteRecord,</span></span></span><br><span class="line"><span class="function"><span class="params">  location: Location,</span></span></span><br><span class="line"><span class="function"><span class="params">  redirectedFrom?: Location</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Route</span> </span>&#123;</span><br><span class="line">  <span class="comment">//¬†Ë∑ØÁî±ËÆ∞ÂΩïË¢´Ê†áËÆ∞‰∏∫ÈáçÂÆöÂêë</span></span><br><span class="line">  <span class="keyword">if</span> (record &amp;&amp; record.redirect) &#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(record, redirectedFrom || location)</span><br><span class="line">  &#125; <span class="comment">//¬†Ë∑ØÁî±ËÆ∞ÂΩïË¢´Ê†áËÆ∞‰∏∫Âà´ÂêçË∑ØÁî±ÔºåËßÅcreate-route-map.js</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (record &amp;&amp; record.matchAs) &#123;</span><br><span class="line">    <span class="keyword">return</span> alias(record, location, record.matchAs)</span><br><span class="line">  &#125; <span class="comment">//¬†Ê≠£Â∏∏Ë∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> createRoute(record, location, redirectedFrom, router)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÆÉÊé•Êî∂‰∏â‰∏™ÂèÇÊï∞<ul>
<li><code>record</code>Áî®Êù•ÁîüÊàê<code>RouteÂØπË±°</code>ÁöÑÁõÆÊ†áË∑ØÁî±ËÆ∞ÂΩï</li>
<li><code>location</code>ÁõÆÊ†áÂú∞ÂùÄ</li>
<li><code>redirectedFrom</code>ÈáçÂÆöÂêëÁöÑÊù•Ê∫êÂú∞ÂùÄÔºåËøô‰∏™ÂèÇÊï∞Âè™Âú®ÂèëÁîüÈáçÂÆöÂêëÊó∂Êâç‰ºöÊúâÂÄº</li>
</ul>
</li>
<li>Êàë‰ª¨Áü•ÈÅìÔºåÂú®Êñ∞Â¢ûË∑ØÁî±ËÆ∞ÂΩïÊó∂Ôºå‰ºöÂØπ‰∏çÂêåÁ±ªÂûãÁöÑËÆ∞ÂΩïÊ∑ªÂä†‰∏ä‰∏çÂêåÁöÑÊ†áËÆ∞Â≠óÊÆµ<ul>
<li>Â¶Ç‰∏∫ÈáçÂÆöÂêëË∑ØÊúâËÆ∞ÂΩïÊ∑ªÂä†<code>redirect</code>Â≠óÊÆµ</li>
<li>‰∏∫Âà´ÂêçË∑ØÁî±Ê∑ªÂä†<code>matchAs</code>Â≠óÊÆµ<ul>
<li>ÂÖ∑‰ΩìÂèØÁúãÂâçÈù¢ÁöÑ<code>ÁîüÊàêË∑ØÁî±ËÆ∞ÂΩï</code>Á´†ËäÇ</li>
</ul>
</li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞ÈíàÂØπ‰∏çÂêåÁöÑË∑ØÁî±ËÆ∞ÂΩïÁ±ªÂûãË∞ÉÁî®‰∫Ü‰∏çÂêåÊñπÊ≥ï<ul>
<li>ÈáçÂÆöÂêëË∑ØÁî±Ë∞ÉÁî®<code>redirect</code>ÊñπÊ≥ï</li>
<li>Âà´ÂêçË∑ØÁî±Ë∞ÉÁî®<code>alias</code>ÊñπÊ≥ï</li>
<li>ÂÖ∂‰ΩôÁöÑË∞ÉÁî®<code>createRoute</code>ÊñπÊ≥ï</li>
</ul>
</li>
<li>Ê¥ªÂä®ÂõæÂ¶Ç‰∏ã</li>
<li>create-route-inner.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/create-route-inner.png" alt="create-route-inner.png"></li>
</ul>
</li>
<li>ÂÖ∂ÂÆû<code>redirect</code>„ÄÅ<code>alias</code>ÊñπÊ≥ïÂÜÖÈÉ®‰πüË∞ÉÁî®‰∫Ü<code>createRoute</code>ÊñπÊ≥ï</li>
<li>ÊâÄ‰ª•Êàë‰ª¨ÂÖàÁúã<code>createRoute</code>ÊñπÊ≥ïÂÆûÁé∞</li>
</ul>
<h4 id="createRoute"><a href="#createRoute" class="headerlink" title="createRoute"></a>createRoute</h4><ul>
<li><code>createRoute</code>‰Ωç‰∫é<code>src/util/route.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/route.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÁîüÊàêRoute</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createRoute</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  record: ?RouteRecord,</span></span></span><br><span class="line"><span class="function"><span class="params">  location: Location,</span></span></span><br><span class="line"><span class="function"><span class="params">  redirectedFrom?: ?Location,</span></span></span><br><span class="line"><span class="function"><span class="params">  router?: VueRouter</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Route</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stringifyQuery = router &amp;&amp; router.options.stringifyQuery <span class="comment">//¬†ÊîØÊåÅ‰º†ÂÖ•Ëá™ÂÆö‰πâÂ∫èÂàóÂåñqsÊñπÊ≥ï</span></span><br><span class="line">  <span class="keyword">let</span> query: <span class="built_in">any</span> = location.query || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    query = clone(query) <span class="comment">//¬†location.query‰∏∫ÂºïÁî®ÂÄºÔºåÈÅøÂÖçÁõ∏‰∫íÂΩ±ÂìçÔºåËøõË°åÊ∑±Êã∑Ë¥ù</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125; <span class="comment">//¬†ÁîüÊàêRoute</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> route: Route = &#123;</span><br><span class="line">    name: location.name || (record &amp;&amp; record.name),</span><br><span class="line">    meta: (record &amp;&amp; record.meta) || &#123;&#125;,</span><br><span class="line">    path: location.path || <span class="string">'/'</span>,</span><br><span class="line">    hash: location.hash || <span class="string">''</span>,</span><br><span class="line">    query,</span><br><span class="line">    params: location.params || &#123;&#125;,</span><br><span class="line">    fullPath: getFullPath(location, stringifyQuery), <span class="comment">//¬†ÂÆåÊï¥path</span></span><br><span class="line">    matched: record ? formatMatch(record) : [], <span class="comment">//¬†Ëé∑ÂèñÊâÄÊúâÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line">  &#125; <span class="comment">//¬†Â¶ÇÊûúÊòØ‰ªéÂÖ∂ÂÆÉË∑ØÁî±ÂØπÈáçÂÆöÂêëËøáÊù•ÁöÑÔºåÂàôÈúÄË¶ÅËÆ∞ÂΩïÈáçÂÆöÂêë‰πãÂâçÁöÑÂú∞ÂùÄ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (redirectedFrom) &#123;</span><br><span class="line">    route.redirectedFrom = getFullPath(redirectedFrom, stringifyQuery)</span><br><span class="line">  &#125; <span class="comment">//¬†Èò≤Ê≠¢ÁØ°Êîπ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.freeze(route)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Áî±‰∫é<code>VueRouter</code>ÊîØÊåÅ‰º†ÂÖ•Ëá™ÂÆö‰πâ<code>Â∫èÂàóÂåñqueryString</code>ÊñπÊ≥ïÔºåÊâÄ‰ª•Á¨¨‰∏ÄÊ≠•ÂÖàËé∑ÂèñÂ∫èÂàóÂåñ<code>queryString</code>ÁöÑÊñπÊ≥ï</li>
<li>ÁÑ∂ÂêéÂØπ<code>query</code>ÂÅö‰∫Ü‰∏Ä‰∏™Ê∑±Êã∑Ë¥ùÔºåÈÅøÂÖçÁõ∏‰∫íÂΩ±Âìç</li>
<li>Êé•‰∏ãÊù•Â∞±ÊòØÁîüÊàêÊñ∞<code>Route</code> ÂØπË±°</li>
<li>Â¶ÇÊûúÊòØ‰ªéÂÖ∂‰ªñË∑ØÁî±ÈáçÂÆöÂêëËøáÊù•ÁöÑÔºåÂàôÁîüÊàêÂÆåÊï¥ÁöÑÈáçÂÆöÂêëÊù•Ê∫êÂú∞ÂùÄÔºåÂπ∂ËµãÂÄºÁªôÊñ∞ÁîüÊàêÁöÑ<code>Route</code>ÂØπË±°</li>
<li>ÊúÄÂêéË∞ÉÁî®<code>Object.freeze</code>ÂÜªÁªìÊñ∞<code>Route</code> ÂØπË±°ÔºåÂõ†‰∏∫<code>Route</code>ÂØπË±°ÊòØ<code>immutable</code>ÁöÑ</li>
<li>Êï¥‰∏™ÊµÅÁ®ãÂ¶Ç‰∏ã</li>
<li>create-route.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/create-route.png" alt="create-route.png"></li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞ÁîüÊàê<code>Route</code>Êó∂Ôºå‰ºöË∞ÉÁî®<code>getFullPath</code>ÁîüÊàêÂÆåÊï¥<code>fullPath</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/route.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ëé∑ÂèñÂÆåÊï¥path</span></span><br><span class="line">function getFullPath(&#123; path, query = &#123;&#125;, hash = '' &#125;, _stringifyQuery): string &#123;</span><br><span class="line">  <span class="keyword">const</span> stringify = _stringifyQuery || stringifyQuery</span><br><span class="line">  <span class="keyword">return</span> (path || <span class="string">'/'</span>) + stringify(query) + hash</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞<code>getFullPath</code>ÊòØÂú®<code>path</code>ÂêéÈù¢ËøΩÂä†‰∫Ü<code>qs</code>Âíå<code>hash</code></li>
<li>Âè¶Â§ñÁîüÊàê<code>Route</code>Êó∂ÔºåËøò‰ºöË∞ÉÁî®<code>formatMatch</code>Êù•Ëé∑Âèñ<strong>ÊâÄÊúâ</strong>ÂÖ≥ËÅîÁöÑ<code>Ë∑ØÁî±ËÆ∞ÂΩï</code></li>
<li>‰∏ªË¶ÅÈÄöËøáÂêë‰∏äÊü•ÊâæÁöÑÂΩ¢ÂºèÊâæÂà∞ÊâÄÊúâÂÖ≥ËÅîÁöÑË∑ØÁî±ËÆ∞ÂΩï</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/route.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ê†ºÂºèÂåñÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÔºåÂΩì‰∏Ä‰∏™Ë∑ØÁî±ËÆ∞ÂΩïÂåπÈÖç‰∫ÜÔºåÂ¶ÇÊûúÂÖ∂ËøòÊúâÁà∂Ë∑ØÁî±ËÆ∞ÂΩïÔºåÂàôÁà∂Ë∑ØÁî±ËÆ∞ÂΩïËÇØÂÆö‰πüÊòØÂåπÈÖçÁöÑ</span></span><br><span class="line"><span class="comment">//¬†/foo/bar¬†ÂåπÈÖç‰∫ÜÔºåÂàôÂÖ∂Áà∂Ë∑ØÁî±ÂØπË±°¬†/foo¬†ËÇØÂÆö‰πüÂåπÈÖç‰∫Ü</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatMatch</span>(<span class="params">record: ?RouteRecord</span>): <span class="title">Array</span>&lt;<span class="title">RouteRecord</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = []</span><br><span class="line">  <span class="keyword">while</span> (record) &#123;</span><br><span class="line">    res.unshift(record) <span class="comment">//¬†ÈòüÂàóÂ§¥Ê∑ªÂä†ÔºåÊâÄ‰ª•Áà∂recordÊ∞∏ËøúÂú®ÂâçÈù¢ÔºåÂΩìÂâçrecordÊ∞∏ËøúÂú®ÊúÄÂêéÔºõÂú®router-viewÁªÑ‰ª∂‰∏≠Ëé∑ÂèñÂåπÈÖçÁöÑroute¬†recordÊó∂‰ºöÁî®Âà∞</span></span><br><span class="line">    record = record.parent</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÈöæÈÅì‰∏ÄÊù°<code>Route</code>‰∏çÊòØÂØπÂ∫î(ÂÖ≥ËÅî)‰∏Ä‰∏™<code>Ë∑ØÁî±ÂØπË±°</code>ÂêóÔºü</li>
<li>ÂÖ∂ÂÆûÂú®ÊúØËØ≠Ë°®‰ªãÁªç<code>RouteË∑ØÁî±ÂØπË±°</code>Êó∂Ôºå‰πüÊúâÊâÄÊèêÂèäÔºå‰∏Ä‰∏™<code>RouteË∑ØÁî±ÂØπË±°</code>ÂèØËÉΩ‰ºöÂÖ≥ËÅîÂ§ö‰∏™<code>RouteRecordË∑ØÁî±ËÆ∞ÂΩïÂØπË±°</code></li>
<li>ËøôÊòØÂõ†‰∏∫Â≠òÂú®ÂµåÂ•óË∑ØÁî±ÁöÑÊÉÖÂÜµÔºåÂΩìÂ≠êË∑ØÁî±ËÆ∞ÂΩïË¢´ÂåπÈÖçÂà∞Êó∂ÔºåÂÖ∂ÂÆû‰ª£Ë°®ÁùÄÁà∂Ë∑ØÁî±ËÆ∞ÂΩï‰πü‰∏ÄÂÆöË¢´ÂåπÈÖçÂà∞‰∫ÜÔºåÁúã‰∏ãÈù¢‰æãÂ≠ê</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ÂΩìÊúâ‰∏ãÈù¢ÁöÑË∑ØÁî±ËßÑÂàô</span></span><br><span class="line">routes: [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/parent'</span>,</span><br><span class="line">    component: Parent,</span><br><span class="line">    children: [&#123; path: <span class="string">'foo'</span>, component: Foo &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>ËÆøÈóÆ<code>/parent/foo</code>Êó∂ÔºåÂåπÈÖçÂà∞ÁöÑË∑ØÁî±ËÆ∞ÂΩïÊúâ‰∏§‰∏™</li>
<li>match-demo-record.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/match-demo-record.png" alt="match-demo-record.png"></li>
</ul>
</li>
<li>ËÄå‰∏îÁ≤æÂáÜÂåπÈÖçÂà∞Ë∑ØÁî±ËÆ∞ÂΩï‰∏ÄÂÆöÊòØÊúÄÂêé‰∏Ä‰∏™ÔºåÊâÄ‰ª•ÂêéÈù¢‰ºöÁúãÂà∞Áî®<code>route.matched[route.matched.length - 1]</code>Êù•Ëé∑ÂèñÂΩìÂâç<code>route</code>ÂØπÂ∫îÁöÑÁ≤æÂáÜÂåπÈÖçÁöÑ<code>RouteRecord</code></li>
<li>ÁúãÂÆå<code>createRoute</code>ÁöÑÂÆûÁé∞ÔºåÊàë‰ª¨ÂÜçÊù•ÁúãÁúã<code>alias</code>ÁöÑÂÆûÁé∞</li>
</ul>
<h4 id="ÂàõÂª∫Âà´ÂêçË∑ØÁî±ÂØπË±°-alias"><a href="#ÂàõÂª∫Âà´ÂêçË∑ØÁî±ÂØπË±°-alias" class="headerlink" title="ÂàõÂª∫Âà´ÂêçË∑ØÁî±ÂØπË±° alias"></a>ÂàõÂª∫Âà´ÂêçË∑ØÁî±ÂØπË±° alias</h4><ul>
<li><code>alias</code>‰Ωç‰∫é<code>src/create-matcher.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-matcher.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÂàõÂª∫Âà´ÂêçRoute</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alias</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  record: RouteRecord,</span></span></span><br><span class="line"><span class="function"><span class="params">  location: Location,</span></span></span><br><span class="line"><span class="function"><span class="params">  matchAs: <span class="built_in">string</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Route</span> </span>&#123;</span><br><span class="line">  <span class="comment">//¬†Ëé∑ÂèñÂà´ÂêçÁöÑÂÆåÊï¥Ë∑ØÂæÑ</span></span><br><span class="line">  <span class="keyword">const</span> aliasedPath = fillParams(</span><br><span class="line">    matchAs,</span><br><span class="line">    location.params,</span><br><span class="line">    <span class="string">`aliased¬†route¬†with¬†path¬†"<span class="subst">$&#123;matchAs&#125;</span>"`</span></span><br><span class="line">  ) <span class="comment">//¬†Ëé∑ÂèñÂà´ÂêçÂåπÈÖçÁöÑÂéüÂßãRoute</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> aliasedMatch = match(&#123;</span><br><span class="line">    _normalized: <span class="literal">true</span>,</span><br><span class="line">    path: aliasedPath,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (aliasedMatch) &#123;</span><br><span class="line">    <span class="keyword">const</span> matched = aliasedMatch.matched</span><br><span class="line">    <span class="keyword">const</span> aliasedRecord = matched[matched.length - <span class="number">1</span>] <span class="comment">//¬†ÊâæÂà∞ÊâÄÊúâÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÁöÑÊúÄÂêé‰∏Ä‰∏™ÔºåÂç≥ÂΩìÂâçÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÔºåÈÄªËæëËßÅroute.js¬†formatMatchÊñπÊ≥ï</span></span><br><span class="line">    location.params = aliasedMatch.params</span><br><span class="line">    <span class="keyword">return</span> _createRoute(aliasedRecord, location)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _createRoute(<span class="literal">null</span>, location)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÈÄªËæëÂ¶Ç‰∏ã</li>
<li>ÂÖàÊãø<code>matchAs</code>ÂæóÂà∞<code>aliasedPath</code>Ôºå</li>
<li>ÁÑ∂ÂêéÊãø<code>aliasedPath</code>Ëµ∞‰∏ÄÈÅç<code>match</code>ÂæóÂà∞<code>aliasedMatch</code>Ë∑ØÁî±ÂØπË±°</li>
<li><code>aliasedMatch</code>Â¶ÇÊûúÂ≠òÂú®ÔºåÊãø<code>aliasedMatch</code>Á≤æÂáÜÂåπÈÖçÁöÑ<code>Ë∑ØÁî±ËÆ∞ÂΩïÂØπË±°</code>Âíå<code>location</code>ÔºåÁîüÊàê<code>Ë∑ØÁî±ÂØπË±°</code>ËøîÂõû</li>
<li>‰∏çÂ≠òÂú®ÔºåÂàôÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ<code>Ë∑ØÁî±ÂØπË±°</code>ËøîÂõû</li>
<li>ÂèØËÉΩÊúâÁÇπÁªïÔºåÊàë‰ª¨‰∏æ‰∏™‰æãÂ≠ê<ul>
<li>ÂâçÈù¢Êàë‰ª¨Áü•ÈÅìÔºå<code>/a</code>ËÆæÁΩÆ‰∫ÜÂà´Âêç<code>/b</code>Êó∂Ôºå‰ºöÁîüÊàê‰∏§Êù°Ë∑ØÁî±ËÆ∞ÂΩïÔºå‰∏î<code>/b</code>ÁöÑË∑ØÁî±ËÆ∞ÂΩï‰∏äÁöÑ<code>matchAs</code>‰∏∫<code>/a</code><ul>
<li>ÂøòËÆ∞ÁöÑÂèØ‰ª•ÁúãÂâçÈù¢ÁöÑ<code>ÁîüÊàêÂà´ÂêçË∑ØÁî±ËÆ∞ÂΩï</code>Á´†ËäÇ</li>
</ul>
</li>
<li>Ê≠§Â§Ñ‰º†ÂÖ•ÁöÑ<code>alias</code>ÁöÑ<code>matchAs</code>Â∞±Áõ∏ÂΩì‰∫é<code>/a</code>ÔºåÂÖàÊãø<code>matchAs</code>Âç≥<code>/a</code>ÂæóÂà∞Â°´ÂÖÖËøá<code>params</code>ÁöÑË∑ØÂæÑ</li>
<li>ÂÜç‰ª•Ê≠§Ë∑ØÂæÑË∞ÉÁî®<code>match</code>ÊâæÂà∞ÂåπÈÖçÁöÑ<code>Ë∑ØÁî±ÂØπË±°</code>ÔºåËÆ∞‰∏∫<code>routeA</code></li>
<li>ÂâçÈù¢‰πüÊèêËøáÔºåË∑ØÁî±ÂØπË±°‰ºöÂÖ≥ËÅîË∑ØÁî±ËÆ∞ÂΩïÔºåÊâÄ‰ª•‰ªé<code>routeA</code>‰∏≠ÂèØ‰ª•ÂæóÂà∞Á≤æÂáÜÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩï<code>routeRecordA</code></li>
<li>ÊãøÊ≠§Ë∑ØÁî±ËÆ∞ÂΩïÂíå<code>/b</code>ÁöÑ<code>location</code>ÂéªÁîüÊàêË∑ØÁî±ÂØπË±°Âπ∂ËøîÂõû</li>
<li>ËøôÊ†∑Â∞±ÂÆûÁé∞‰∫ÜÂÆòÁΩë‰∏äËØ¥ÁöÑ<code>/a ÁöÑÂà´ÂêçÊòØ /bÔºåÊÑèÂë≥ÁùÄÔºåÂΩìÁî®Êà∑ËÆøÈóÆ /b Êó∂ÔºåURL ‰ºö‰øùÊåÅ‰∏∫ /bÔºå‰ΩÜÊòØË∑ØÁî±ÂåπÈÖçÂàô‰∏∫ /aÔºåÂ∞±ÂÉèÁî®Êà∑ËÆøÈóÆ /a ‰∏ÄÊ†∑„ÄÇ</code>ÊïàÊûú</li>
</ul>
</li>
<li>Ê¥ªÂä®ÂõæÂ¶Ç‰∏ã</li>
<li>alias.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/alias.png" alt="alias.png"></li>
</ul>
</li>
<li>Êàë‰ª¨ÂÜçÊù•ÁúãÁúã<code>redirect</code>ÁöÑÂÆûÁé∞</li>
</ul>
<h4 id="ÂàõÂª∫ÈáçÂÆöÂêëË∑ØÁî±ÂØπË±°-redirect"><a href="#ÂàõÂª∫ÈáçÂÆöÂêëË∑ØÁî±ÂØπË±°-redirect" class="headerlink" title="ÂàõÂª∫ÈáçÂÆöÂêëË∑ØÁî±ÂØπË±° redirect"></a>ÂàõÂª∫ÈáçÂÆöÂêëË∑ØÁî±ÂØπË±° redirect</h4><ul>
<li>Êàë‰ª¨ÂÖàÁúã‰∏ã<code>record.redirect</code>ÂèØËÉΩÁöÑÂá†ÁßçÊÉÖÂÜµÔºõ<code>https://router.vuejs.org/zh/guide/essentials/redirect-and-alias.html#ÈáçÂÆöÂêë</code><ul>
<li>Â≠óÁ¨¶‰∏≤<code>{redirect:&#39;/&#39;}</code></li>
<li>ÂØπË±°<code>{redirect:{path:&#39;/test&#39;}}</code>„ÄÅ<code>{redirect:{name:&#39;Test&#39;}}</code></li>
<li>‰πüÊîØÊåÅ‰º†ÂÖ•ÂáΩÊï∞<code>{redirect:to=&gt;{ return {name:&#39;Test&#39;}}}</code></li>
</ul>
</li>
<li>Êàë‰ª¨ÂÖàÁúãËøô‰∏™<code>redirect</code>ÊñπÊ≥ïÁöÑÂÖ•Âè£</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-matcher.js _createRouteÊñπÊ≥ïÂÜÖÈÉ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (record &amp;&amp; record.redirect) &#123;</span><br><span class="line">  <span class="keyword">return</span> redirect(record, redirectedFrom || location)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Áî±‰∫éÂ≠òÂú®Â§öÊ¨°ÈáçÂÆöÂêëÁöÑÂú∫ÊôØÔºåÊâÄ‰ª•ÈúÄË¶Å‰øùÁïôÈ¶ñÊ¨°Ëß¶ÂèëÈáçÂÆöÂêëÁöÑÂú∞ÂùÄÂç≥<code>redirectedFrom</code><ul>
<li><code>/a</code> -&gt; <code>/b</code> -&gt; <code>/c</code>ÔºåÂú®<code>/c</code>‰∏≠ÈúÄË¶Å‰øùÁïôÈ¶ñÊ¨°Ëß¶ÂèëÈáçÂÆöÂêëÁöÑÂú∞ÂùÄÂç≥<code>/a</code></li>
</ul>
</li>
<li>Â§öÊ¨°ÈáçÂÆöÂêëÔºåÂ¶Ç‰Ωï‰øùÁïôÈ¶ñÊ¨°Ëß¶ÂèëÈáçÂÆöÂêëÁöÑÂú∞ÂùÄÂë¢Ôºü<ul>
<li>Âú®Á¨¨‰∏ÄÊ¨°ÈáçÂÆöÂêëÊó∂Ôºå<code>redirectedFrom</code>Ê≤°ÊúâÂÄº</li>
<li>Âú®<code>redirect</code>ÊñπÊ≥ïÂÜÖÈÉ®‰ºöÂ∞Ü<code>location</code>ÂÅö‰∏∫<code>redirectedFrom</code>ÂèÇÊï∞Ë∞ÉÁî®<code>match</code>ÊñπÊ≥ïÔºå<code>match</code>Â¶ÇÊûúÂèëÁé∞‰ªçÁÑ∂ÈúÄË¶ÅÈáçÂÆöÂêëÔºåÂàô‰ºöÁªßÁª≠Ë∞ÉÁî®<code>redirect</code>ÔºåÊ≠§Êó∂<code>redirectedFrom</code>ÊòØÊúâÂÄºÁöÑÔºåÂ∞±ÊòØÈ¶ñÊ¨°‰º†ÂÖ•ÁöÑ<code>location</code>Ôºå‰æùÊ¨°Âæ™ÁéØÔºåËøôÊ†∑Â∞±ÂÆåÊàê‰∫ÜÂàùÂßãÂú∞ÂùÄÁöÑ‰º†ÈÄí</li>
</ul>
</li>
<li>ÂèØ‰ª•Áúã‰∏ã‰∏ãÈù¢ÁöÑ‰æãÂ≠ê</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  &#123; path: <span class="string">'/foo'</span>, component: Foo &#125;,</span><br><span class="line">  &#123; path: <span class="string">'/baz'</span>, component: Baz, redirect: <span class="string">'/foo'</span> &#125;, <span class="comment">//¬†named¬†redirect</span></span><br><span class="line">  &#123; path: <span class="string">'/named-redirect'</span>, redirect: <span class="string">'/baz'</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/create-matcher.js _createRouteÊñπÊ≥ïÂÜÖÈÉ®</span></span><br><span class="line"><span class="keyword">if</span> (record &amp;&amp; record.redirect) &#123;</span><br><span class="line">  <span class="built_in">console</span>.count(<span class="string">'redirect¬†count:'</span>) <span class="comment">// ÁªüËÆ°Ë∞ÉÁî®Ê¨°Êï∞</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'record:'</span>, record, <span class="string">'redirectedFrom:'</span>, redirectedFrom) <span class="comment">// ÊâìÂç∞ÈáçÂÆöÂêëÂàùÂßãÊù•Ê∫êÂú∞ÂùÄ</span></span><br><span class="line">  <span class="keyword">return</span> redirect(record, redirectedFrom || location)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂΩìÊàë‰ª¨ËÆøÈóÆ<code>/named-redirect</code>Ë∑ØÁî±Êó∂(Ëß¶ÂèëË∑ØÁî±Ë∑≥ËΩ¨)Ôºå‰ºöÈáçÂÆöÂêëÂà∞<code>/baz</code>Ôºå<code>/baz</code>Âèà‰ºöÈáçÂÆöÂêëÂà∞<code>/foo</code>ÔºåÊúÄÁªàÂ±ïÁ§∫<code>Foo</code>ÁªÑ‰ª∂ÔºõÊâÄ‰ª•Ôºå<code>redirect</code>ÊñπÊ≥ïÂ∫îËØ•‰ºöË¢´Ë∞ÉÁî®‰∏§Ê¨°Ôºõ</li>
<li>Êàë‰ª¨ÂèØ‰ª•Áúã‰∏ã‰∏äÈù¢‰æãÂ≠êÁöÑËæìÂá∫</li>
<li>redirect-demo.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/redirect-demo.png" alt="redirect-demo.png"></li>
</ul>
</li>
<li>‰ºöÂèëÁé∞<code>redirect</code>ÊñπÊ≥ïË¢´Ë∞ÉÁî®‰∫ÜÂõõÊ¨°ÔºåÂâç‰∏§Ê¨°ÊòØË∑ØÁî±Ë∑≥ËΩ¨ÂØºËá¥ÁöÑ<code>redirect</code>Ë∞ÉÁî®ÔºåÂêé‰∏§Ê¨°ÂàôÊòØÁªÑ‰ª∂Ê∏≤ÊüìÊó∂ÔºåÈúÄË¶ÅËß£ÊûêË∑ØÁî±‰ªéËÄåËß¶ÂèëÁöÑ<code>redirect</code>Ë∞ÉÁî®Ôºõ</li>
<li>ÂèØ‰ª•ÂØπÊØî‰∏ãË∞ÉÁî®Ê†à<ul>
<li>redirect-stack-1.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/redirect-stack-1.png" alt="redirect-stack-1.png"></li>
</ul>
</li>
<li>redirect-stack-2.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/redirect-stack-2.png" alt="redirect-stack-2.png"></li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞Á¨¨‰∏Ä„ÄÅÁ¨¨‰∫åÊ¨°ÁöÑ<code>redirect</code>ÊòØÁî±<code>transitionTo</code>Ëß¶ÂèëÁöÑ</li>
<li>redirect-stack-3.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/redirect-stack-3.png" alt="redirect-stack-3.png"></li>
</ul>
</li>
<li>redirect-stack-4.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/redirect-stack-4.png" alt="redirect-stack-4.png"></li>
</ul>
</li>
<li>ËÄåÁ¨¨‰∏â„ÄÅÁ¨¨ÂõõÊ¨°ÈÉΩÊòØÁªÑ‰ª∂Ê∏≤Êüì<code>render</code>Ë∞ÉÁî®<code>resolve</code>Ëß¶ÂèëÁöÑ<ul>
<li>‰∏∫‰ΩïÁªÑ‰ª∂Ê∏≤ÊüìÊó∂ÈúÄË¶ÅËß£ÊûêË∑ØÁî±ÔºåËøô‰∏™Êàë‰ª¨Âú®ÂêéÈù¢ÁªÑ‰ª∂Áõ∏ÂÖ≥Á´†ËäÇËß£Èáä</li>
</ul>
</li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®<code>redirect</code>ÊòØ‰ªé<code>/named-redirect</code>ÈáçÂÆöÂêëÂà∞<code>/baz</code>ÔºåÊ≠§Êó∂<code>redirectFrom</code>ÊòØÊ≤°ÊúâÂÄºÁöÑ</li>
<li>ËÄåÁ¨¨‰∫åÊ¨°Ë∞ÉÁî®ÊòØ‰ªé<code>/baz</code>ÈáçÂÆöÂêëÂà∞<code>/foo</code>ÔºåÊ≠§Êó∂<code>redirectFrom</code>Â∞±ÊòØËß¶ÂèëÁ¨¨‰∏ÄÊ¨°ÈáçÂÆöÂêëÁöÑÂú∞ÂùÄ<code>/named-redirect</code></li>
<li>ËÄå‰∏îÊúÄÁªàÁöÑ<code>$route</code>‰∏ä‰πü‰ºöÊúâ‰∏™<code>redirectFrom</code>‰øùÁïô‰∫ÜËß¶ÂèëÁ¨¨‰∏ÄÊ¨°ÈáçÂÆöÂêëÁöÑÂú∞ÂùÄ</li>
<li>‰∏äÈù¢Êàë‰ª¨Âè™ÊòØÁúã‰∫Ü<code>redirectFrom</code>ÁöÑÊÑè‰πâÔºå‰∏ãÈù¢Êàë‰ª¨ÁúãÁúã<code>redirect</code>ÁöÑÂÖ∑‰ΩìÂÆûÁé∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/create-matcher.js createMatcherÊñπÊ≥ïÂÜÖ</span></span><br><span class="line"><span class="comment">//¬†ÂàõÂª∫ÈáçÂÆöÂêëRoute</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">redirect</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  record: RouteRecord, <span class="comment">//¬†Ëß¶ÂèëÈáçÂÆöÂêëÁöÑË∑ØÁî±ËÆ∞ÂΩï(ÈúÄË¶ÅËøõË°åÈáçÂÆöÂêëÁöÑË∑ØÁî±ËÆ∞ÂΩïÔºåÂåÖÂê´redirect)</span></span></span></span><br><span class="line"><span class="function"><span class="params">  location: Location <span class="comment">//¬†Ëß¶ÂèëÈáçÂÆöÂêëÁöÑÂàùÂßãÂú∞ÂùÄ()</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Route</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> originalRedirect = record.redirect</span><br><span class="line">  <span class="keyword">let</span> redirect =</span><br><span class="line">    <span class="keyword">typeof</span> originalRedirect === <span class="string">'function'</span> <span class="comment">//¬†redirectÊîØÊåÅ‰º†ÂÖ•ÂáΩÊï∞;https://router.vuejs.org/zh/guide/essentials/redirect-and-alias.html#ÈáçÂÆöÂêë</span></span><br><span class="line">      ? originalRedirect(createRoute(record, location, <span class="literal">null</span>, router))</span><br><span class="line">      : originalRedirect <span class="comment">//¬†redirectËøîÂõûÁöÑÊòØ‰∏Ä‰∏™Ë∑ØÂæÑpathÔºåÂ¶Ç'/bar'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> redirect === <span class="string">'string'</span>) &#123;</span><br><span class="line">    redirect = &#123; path: redirect &#125;</span><br><span class="line">  &#125; <span class="comment">//¬†originalRedirectÂáΩÊï∞ËøîÂõû‰∏Ä‰∏™Èùûstring„ÄÅÈùûobjectÁöÑÂÄºÊó∂ÔºåÁªô‰∫àË≠¶ÂëäÔºåÂπ∂ÂàõÂª∫‰∏Ä‰∏™Á©∫Route</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!redirect || <span class="keyword">typeof</span> redirect !== <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      warn(<span class="literal">false</span>, <span class="string">`invalid¬†redirect¬†option:¬†<span class="subst">$&#123;JSON.stringify(redirect)&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _createRoute(<span class="literal">null</span>, location)</span><br><span class="line">  &#125; <span class="comment">//¬†Âà∞Ëøô‰∏ÄÊ≠•Ôºåredirect‰∏ÄÂÆöÊòØ‰∏™object</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> re: <span class="built_in">Object</span> = redirect</span><br><span class="line">  <span class="keyword">const</span> &#123; name, path &#125; = re</span><br><span class="line">  <span class="keyword">let</span> &#123; query, hash, params &#125; = location</span><br><span class="line"></span><br><span class="line">  query = re.hasOwnProperty(<span class="string">'query'</span>) ? re.query : query</span><br><span class="line">  hash = re.hasOwnProperty(<span class="string">'hash'</span>) ? re.hash : hash</span><br><span class="line">  params = re.hasOwnProperty(<span class="string">'params'</span>) ? re.params : params <span class="comment">//¬†ÈáçÂÆöÂêëÊòØÂëΩÂêçË∑ØÁî±ÂΩ¢Âºè</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (name) &#123;</span><br><span class="line">    <span class="comment">//¬†resolved¬†named¬†direct</span></span><br><span class="line">    <span class="keyword">const</span> targetRecord = nameMap[name] <span class="comment">//¬†Êú™ÊâæÂà∞ÂëΩÂêçË∑ØÁî±Ë≠¶Âëä</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      assert(targetRecord, <span class="string">`redirect¬†failed:¬†named¬†route¬†"<span class="subst">$&#123;name&#125;</span>"¬†not¬†found.`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> match(</span><br><span class="line">      &#123;</span><br><span class="line">        _normalized: <span class="literal">true</span>,</span><br><span class="line">        name,</span><br><span class="line">        query,</span><br><span class="line">        hash,</span><br><span class="line">        params,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">undefined</span>,</span><br><span class="line">      location</span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path) &#123;</span><br><span class="line">    <span class="comment">//¬†ÈáçÂÆöÂêëÊòØpathÂΩ¢Âºè</span></span><br><span class="line">    <span class="comment">//¬†1.¬†resolve¬†relative¬†redirectÔºåËß£ÊûêÂá∫ÂÆåÊï¥Ë∑ØÂæÑ</span></span><br><span class="line">    <span class="keyword">const</span> rawPath = resolveRecordPath(path, record) <span class="comment">//¬†2.¬†resolve¬†paramsÔºåÂ°´ÂÖÖparams</span></span><br><span class="line">    <span class="keyword">const</span> resolvedPath = fillParams(</span><br><span class="line">      rawPath,</span><br><span class="line">      params,</span><br><span class="line">      <span class="string">`redirect¬†route¬†with¬†path¬†"<span class="subst">$&#123;rawPath&#125;</span>"`</span></span><br><span class="line">    ) <span class="comment">//¬†3.¬†rematch¬†with¬†existing¬†query¬†and¬†hashÔºåÈáçÊñ∞ÂåπÈÖç</span></span><br><span class="line">    <span class="keyword">return</span> match(</span><br><span class="line">      &#123;</span><br><span class="line">        _normalized: <span class="literal">true</span>,</span><br><span class="line">        path: resolvedPath,</span><br><span class="line">        query,</span><br><span class="line">        hash,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">undefined</span>,</span><br><span class="line">      location</span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      warn(<span class="literal">false</span>, <span class="string">`invalid¬†redirect¬†option:¬†<span class="subst">$&#123;JSON.stringify(redirect)&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _createRoute(<span class="literal">null</span>, location)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞È¶ñÂÖàÂØπ<code>record.redirect</code>ËøõË°åËßÑËåÉÂåñÔºåÁªü‰∏ÄÁîüÊàê‰∏Ä‰∏™<code>redirect</code>ÂØπË±°(ÈáçÂÆöÂêëÁõÆÊ†á)<ul>
<li>‰∏∫‰ªÄ‰πàË¶ÅËøõË°åËßÑËåÉÂåñÔºåÂâçÈù¢‰πüÊèêËøáÔºå<code>redirect</code>ÊîØÊåÅÂ≠óÁ¨¶‰∏≤„ÄÅÂØπË±°„ÄÅÂáΩÊï∞Á±ªÂûãÔºåÊâÄ‰ª•ÈúÄË¶ÅËßÑËåÉÂåñÔºåÊñπ‰æøÂêéÈù¢Áªü‰∏ÄÂ§ÑÁêÜ</li>
</ul>
</li>
<li>Êé•‰∏ãÊù•‰ºö‰ºòÂÖàÂèñ<code>redirect</code>ÁöÑ<code>query hash params</code>ÂÄºÊù•ÂÅö<code>match</code>Ôºå‰∏çÂ≠òÂú®Êó∂Êâç‰ºöÂèñ<code>ÂàùÂßãÂú∞ÂùÄlocation</code>ÁöÑ<code>query hash params</code></li>
<li>Êé•‰∏ãÊù•‰ºöÂà§Êñ≠ÈáçÂÆöÂêëÁõÆÊ†áÊòØ<code>ÂëΩÂêçÂΩ¢Âºè</code>ËøòÊòØ<code>pathÂΩ¢Âºè</code></li>
<li>ÂëΩÂêçÂΩ¢Âºè<ul>
<li>ÂÖàÂà§Êñ≠<code>nameMap</code>‰∏≠ÊúâÊ≤°ÊúâÁõÆÊ†áË∑ØÁî±ËÆ∞ÂΩïÔºåÊ≤°ÊúâÂàô‰∏≠Êñ≠ÔºåÂπ∂Áªô‰∫àÊèêÁ§∫Ôºõ</li>
<li>ÂÜçÈáçËµ∞<code>match</code>ÊµÅÁ®ãÔºåÂπ∂Â∞Ü<code>location</code>ÂÅö‰∏∫<code>redirectedFrom</code>‰º†ÂÖ•ÔºåËøôÊ†∑Â∞±ÂÆåÊàê‰∫Ü<code>redirectedFrom</code>ÁöÑ‰º†ÈÄíÈó≠ÁéØ</li>
<li><code>match</code>ÈáåÈù¢‰ºöÁªßÁª≠Âà§Êñ≠ÊòØÂê¶ÊúâÈáçÂÆöÂêëÔºåËøôÊ†∑Â∞±Ë¶ÜÁõñ‰∫ÜÂ§öÈáçÈáçÂÆöÂêëÁöÑÂú∫ÊôØ</li>
</ul>
</li>
<li>path ÂΩ¢Âºè<ul>
<li>Êãø<code>path</code>ÂåπÈÖçÔºåÈúÄË¶ÅËé∑ÂèñÂÆåÊï¥Ë∑ØÂæÑÔºåÊâÄ‰ª•ÂÖà‰ªé<code>record</code>ÊãøÂá∫ÂéüÂßãË∑ØÂæÑ<code>rawPath</code>Âπ∂Â°´ÂÖÖÂâçÈù¢Ëß£ÊûêÂá∫ÁöÑ<code>params</code>ÂæóÂá∫ÂÆåÊï¥Âú∞ÂùÄ</li>
<li>ÂÜçÊãøÂÆåÊï¥Âú∞ÂùÄÈáçËµ∞<code>match</code>ÊµÅÁ®ãÔºåÂêåÊó∂‰πüÂ∞Ü<code>location</code>ÂÅö‰∏∫<code>redirectedFrom</code>‰º†ÂÖ•ÔºåÂÆåÊàê<code>redirectedFrom</code>ÁöÑ‰º†ÈÄíÈó≠ÁéØ</li>
<li><code>match</code>ÈáåÈù¢‰ºöÁªßÁª≠Âà§Êñ≠ÊòØÂê¶ÊúâÈáçÂÆöÂêëÔºåËøôÊ†∑Â∞±Ë¶ÜÁõñ‰∫ÜÂ§öÈáçÈáçÂÆöÂêëÁöÑÂú∫ÊôØ</li>
</ul>
</li>
<li>Â¶ÇÊûúÊó¢‰∏çÊòØ<code>ÂëΩÂêçÂΩ¢Âºè</code>‰πü‰∏çÊòØ<code>pathÂΩ¢Âºè</code>ÔºåÂàôÁõ¥Êé•ÂàõÂª∫‰∏Ä‰∏™Êñ∞Ë∑ØÁî±ÂØπË±°ËøîÂõû</li>
<li>ÊµÅÁ®ãÂ¶Ç‰∏ã</li>
<li>redirect-full.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/redirect-full.png" alt="redirect-full.png"></li>
</ul>
</li>
</ul>
<h3 id="Â∞èÁªì"><a href="#Â∞èÁªì" class="headerlink" title="Â∞èÁªì"></a>Â∞èÁªì</h3><ul>
<li>Ë∑ØÁî±ÂåπÈÖçÁöÑËøáÁ®ãÔºåÂÖ∂ÂÆûÂ∞±ÊòØÊãø<code>Âú∞ÂùÄRawLocation</code>ÁîüÊàê<code>Ë∑ØÁî±ÂØπË±°Route</code>ÁöÑËøáÁ®ãÔºåËøô‰∏≠Èó¥<code>Ë∑ØÁî±ËÆ∞ÂΩïRouteRecord</code>Ëµ∑‰∏≠Èó¥Ê°•Ê¢ÅÁöÑ‰ΩúÁî®ÔºåÂõ†‰∏∫Ë∑ØÁî±ËÆ∞ÂΩï‰∏ä‰øùÂ≠ò‰∫ÜÁîüÊàêË∑ØÁî±ÂØπË±°ÁöÑÈáçË¶Å‰ø°ÊÅØÔºõÊâÄ‰ª•ÊµÅÁ®ãÂ∫îËØ•ÊòØÊãø<code>Âú∞ÂùÄ</code>‰ªéË∑ØÁî±Êò†Â∞ÑË°®‰∏≠ÊâæÂà∞ÂØπÂ∫îÁöÑ<code>Ë∑ØÁî±ËÆ∞ÂΩï</code>ÔºåÁÑ∂ÂêéÊãø<code>Ë∑ØÁî±ËÆ∞ÂΩï</code>ÁîüÊàê<code>Ë∑ØÁî±ÂØπË±°</code></li>
<li>‰∏äËø∞ÂåπÈÖçÈÄªËæë‰∏ªË¶ÅÁî±<code>match</code>ÂáΩÊï∞ÂÆûÁé∞ÁöÑÔºåÂÖ≥ÈîÆÈÄªËæëÂåÖÂê´<code>Âú∞ÂùÄÊ†ºÂºèÂåñnormalizeLocation</code>„ÄÅ<code>Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠matchRoute</code>„ÄÅ<code>Â°´ÂÖÖÂèÇÊï∞fillParams</code>„ÄÅ<code>ÂàõÂª∫Ë∑ØÁî±ÂØπË±°_createRoute</code></li>
<li>Âú®<code>normalizeLocation</code>Êó∂Ôºå‰ºöÂØπ<code>rawLocation</code>ËøõË°åËßÑËåÉÂåñÔºåÊñπ‰æøÂêéÁª≠Â§ÑÁêÜ</li>
<li>Âú®<code>matchRoute</code>Êó∂Ôºå‰ºöÂÄüÂä©<code>path-to-regexp</code>Ê£ÄÊµãÂú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂπ∂ÊèêÂèñÂá∫<code>params</code></li>
<li><code>fillParams</code>ÂèØ‰ª•ÁúãÂÅöÊòØ<code>ÊèêÂèñparams</code>ÁöÑÈÄÜÂêëÊìç‰ΩúÔºå‰∏ªË¶ÅÁî®Êù•ÂØπÂú∞ÂùÄ‰∏≠ÁöÑÂä®ÊÄÅÈÉ®ÂàÜËøõË°åÂ°´ÂÖÖ</li>
<li>Âú®<code>_createRoute</code>Êó∂Ôºå‰ºöÂàÜÂà´Â§ÑÁêÜÂà´Âêç„ÄÅÈáçÂÆöÂêë„ÄÅÂ§öÈáçÈáçÂÆöÂêëÁ≠âÂú∫ÊôØ</li>
<li>ÁªèËøá‰∏äËø∞ÊµÅÁ®ãÔºåÂ∞±ÂèØ‰ª•ÊãøÂà∞<code>RawLocation</code>ÂØπÂ∫îÁöÑ<code>Route</code></li>
<li>ÊãøÂà∞<code>Route</code>ÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ËøõË°åÂØºËà™ÁöÑËß£Êûê</li>
</ul>
<h2 id="ÂØºËà™Ëß£Êûê-Á°ÆËÆ§-ÊµÅÁ®ã"><a href="#ÂØºËà™Ëß£Êûê-Á°ÆËÆ§-ÊµÅÁ®ã" class="headerlink" title="ÂØºËà™Ëß£Êûê(Á°ÆËÆ§)ÊµÅÁ®ã"></a>ÂØºËà™Ëß£Êûê(Á°ÆËÆ§)ÊµÅÁ®ã</h2><ul>
<li>ÂâçÈù¢ÊèêËøáÂú®<code>transitionTo</code>ÊñπÊ≥ï‰∏≠ÔºåË∞ÉÁî®ÂÆå<code>match</code>ÊñπÊ≥ïÂæóÂà∞ÁõÆÊ†á<code>Route</code>ÂêéÔºåÂ∞±‰ºöË∞ÉÁî®<code>confirmTransition</code>ÊñπÊ≥ïÊù•ÂÅöÂØºËà™Ëß£Êûê</li>
<li>Êàë‰ª¨Áü•ÈÅì<code>vue-router</code>Âú®Ë∑ØÁî±Ë∑≥ËΩ¨Êó∂Ôºå‰ºöÊåâÈ°∫Â∫èËß¶ÂèëÂêÑÁßçÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞Ôºå‰æãÂ¶Ç<code>beforeRouteLeave„ÄÅbeforeRouteEnterÁ≠âÁ≠â</code>Ôºõ</li>
<li>È¶ñÂÖàËøô‰∫õÈí©Â≠ê„ÄÅÂÆàÂç´ÊúâÁöÑÊòØÂÆö‰πâÂú®<code>vue-router</code>ÂÆû‰æã‰∏äÁöÑÔºåÊúâÁöÑÊòØË∑ØÁî±Áã¨‰∫´ÁöÑÔºåÊúâÁöÑÊòØ‰Ωç‰∫é<code>.vue</code>ÁªÑ‰ª∂‰∏≠ÁöÑÔºåÊâÄ‰ª•Á¨¨‰∏ÄÊ≠•ÂøÖÈ°ªÊäΩÂá∫Ëøô‰∫õÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞Áªü‰∏ÄÂ§ÑÁêÜ</li>
<li>ÂÖ∂Ê¨°Ëøô‰∫õÈí©Â≠ê„ÄÅÂÆàÂç´ÊòØÊåâÈ°∫Â∫è‰æùÊ¨°ÊâßË°åÁöÑÔºåÊâÄ‰ª•ÈúÄË¶ÅËÆæËÆ°‰∏Ä‰∏™ÈòüÂàóÂíåËø≠‰ª£Âô®Êù•‰øùËØÅÈ°∫Â∫èÊâßË°å</li>
<li>ÊúÄÂêéËøòÊúâ‰∏Ä‰∫õÁâπÊÆäÂú∫ÊôØÈúÄË¶ÅÂ§ÑÁêÜÔºå‰æãÂ¶ÇÂºÇÊ≠•Ë∑ØÁî±ÁªÑ‰ª∂Â¶Ç‰Ωï‰øùËØÅÈ°∫Â∫èÊâßË°å</li>
<li>‰∏äËø∞ÁöÑÁõ∏ÂÖ≥ÈÄªËæëÂ∞ÅË£ÖÂú®<code>confirmTransition</code>‰∏≠</li>
<li><code>confirmTransition</code>ÊñπÊ≥ïË¢´ÂÆö‰πâÂú®<code>src/base.js</code>‰∏≠</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/base.js HistoryÁ±ª‰∏≠</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Á°ÆËÆ§Ë∑ØÁî±Ë∑≥ËΩ¨</span></span><br><span class="line">confirmTransition¬†(<span class="comment">/*¬†to*/</span>route:¬†Route,¬†onComplete:¬†<span class="built_in">Function</span>,¬†onAbort?:¬†<span class="built_in">Function</span>)¬†&#123;</span><br><span class="line">¬†¬†<span class="keyword">const</span>¬†current¬†=¬†<span class="keyword">this</span>.current¬†<span class="comment">/*¬†from¬†*/</span></span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†ÂèñÊ∂à</span></span><br><span class="line">¬†¬†<span class="keyword">const</span>¬†abort¬†=¬†<span class="function"><span class="params">err</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†after¬†merging¬†https://github.com/vuejs/vue-router/pull/2771¬†we</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†When¬†the¬†user¬†navigates¬†through¬†history¬†through¬†back/forward¬†buttons</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†we¬†do¬†not¬†want¬†to¬†throw¬†the¬†error.¬†We¬†only¬†throw¬†it¬†if¬†directly¬†calling</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†push/replace.¬†That's¬†why¬†it's¬†not¬†included¬†in¬†isError</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">if</span>¬†(!isExtendedError(NavigationDuplicated,¬†err)¬†&amp;&amp;¬†isError(err))¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(<span class="keyword">this</span>.errorCbs.length)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.errorCbs.forEach(<span class="function"><span class="params">cb</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb(err)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;¬†<span class="keyword">else</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†warn(<span class="literal">false</span>,¬†<span class="string">'uncaught¬†error¬†during¬†route¬†navigation:'</span>)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="built_in">console</span>.error(err)</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†onAbort¬†&amp;&amp;¬†onAbort(err)</span><br><span class="line">¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†Áõ∏ÂêåRouteÔºåÊä•ÈáçÂ§çÈîôËØØ</span></span><br><span class="line">¬†¬†<span class="keyword">if</span>¬†(</span><br><span class="line">¬†¬†¬†¬†isSameRoute(route,¬†current)¬†&amp;&amp;</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†in¬†the¬†case¬†the¬†route¬†map¬†has¬†been¬†dynamically¬†appended¬†to</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Èò≤Ê≠¢route¬†map¬†Ë¢´Âä®ÊÄÅÊîπÂèò‰∫Ü</span></span><br><span class="line">¬†¬†¬†¬†route.matched.length¬†===¬†current.matched.length</span><br><span class="line">¬†¬†)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†ensureURLÁî±Â≠êÁ±ªÂÆûÁé∞Ôºå‰∏ªË¶ÅÊ†πÊçÆ‰º†ÂèÇÁ°ÆÂÆöÊòØÊ∑ªÂä†ËøòÊòØÊõøÊç¢‰∏Ä‰∏™ËÆ∞ÂΩï</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.ensureURL()¬†<span class="comment">//¬†ÊõøÊç¢ÂΩìÂâçÂéÜÂè≤ËÆ∞ÂΩï</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">return</span>¬†abort(<span class="keyword">new</span>¬†NavigationDuplicated(route))</span><br><span class="line">¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†ÂØπÊØîÂâçÂêérouteÁöÑRouteRecordÔºåÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑÁöÑË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line">¬†¬†<span class="keyword">const</span>¬†&#123;¬†updated,¬†deactivated,¬†activated¬†&#125;¬†=¬†resolveQueue(</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.current.matched,</span><br><span class="line">¬†¬†¬†¬†route.matched</span><br><span class="line">¬†¬†)</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†ÁîüÊàêÈúÄË¶ÅÊâßË°åÁöÑÂÆàÂç´„ÄÅÈí©Â≠êÈòüÂàó</span></span><br><span class="line">¬†¬†<span class="keyword">const</span>¬†queue:¬†<span class="built_in">Array</span>&lt;?NavigationGuard&gt;¬†=¬†[].concat(</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†in-component¬†leave¬†guards</span></span><br><span class="line">¬†¬†¬†¬†extractLeaveGuards(deactivated),¬†<span class="comment">//¬†ÊèêÂèñË∑ØÁî±ÁªÑ‰ª∂‰∏≠ÊâÄÊúâbeforeRouteLeaveÂÆàÂç´</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†global¬†before¬†hooks</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.router.beforeHooks,¬†<span class="comment">//¬†ÂÖ®Â±ÄÁöÑbeforeEachÂÆàÂç´</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†in-component¬†update¬†hooks</span></span><br><span class="line">¬†¬†¬†¬†extractUpdateHooks(updated),¬†<span class="comment">//¬†ÊèêÂèñË∑ØÁî±ÁªÑ‰ª∂‰∏≠ÊâÄÊúâbeforeRouteUpdateÂÆàÂç´</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†in-config¬†enter¬†guards</span></span><br><span class="line">¬†¬†¬†¬†activated.map(<span class="function"><span class="params">m</span>¬†=&gt;</span>¬†m.beforeEnter),¬†<span class="comment">//¬†Ë∑ØÁî±Áã¨‰∫´ÁöÑbeforeEnterÂÆàÂç´</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†async¬†components</span></span><br><span class="line">¬†¬†¬†¬†resolveAsyncComponents(activated)<span class="comment">//¬†Ëß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂</span></span><br><span class="line">¬†¬†)</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="keyword">this</span>.pending¬†=¬†route¬†<span class="comment">//¬†ËÆ∞ÂΩïÂ∞ÜË¶ÅË∑≥ËΩ¨ÁöÑrouteÔºåÊñπ‰æøÂèñÊ∂àÂØπÊØîÁî®</span></span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†Ëø≠‰ª£ÂáΩÊï∞</span></span><br><span class="line">¬†¬†<span class="keyword">const</span>¬†iterator¬†=¬†<span class="function">(<span class="params">hook:¬†NavigationGuard,¬†next</span>)¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">if</span>¬†(<span class="keyword">this</span>.pending¬†!==¬†route)¬†&#123;¬†<span class="comment">//¬†ÂΩìÂèëÁé∞toÂèëÁîüÂèòÂåñÔºåÂàô‰ª£Ë°®ÈúÄË¶ÅÂèñÊ∂à</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">return</span>¬†abort()</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">try</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†hook(<span class="comment">/*¬†to*/</span>route,¬†<span class="comment">/*¬†from*/</span>current,¬†<span class="comment">/*¬†next*/</span><span class="function">(<span class="params">to:¬†<span class="built_in">any</span></span>)¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(to¬†===¬†<span class="literal">false</span>¬†||¬†isError(to))¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†next(false)¬†-&gt;¬†abort¬†navigation,¬†ensure¬†current¬†URL</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†next(false)¬†-&gt;¬†ÂèñÊ∂àË∑≥ËΩ¨ÔºåÊ∑ªÂä†‰∏Ä‰∏™Êñ∞ÂéÜÂè≤ËÆ∞ÂΩï(‰ΩÜÁî±‰∫éurlÂú∞ÂùÄÊú™ÂèëÁîüÂèòÂåñÔºåÊâÄ‰ª•Âπ∂Êú™Ê∑ªÂä†ËÆ∞ÂΩï)</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.ensureURL(<span class="literal">true</span>)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abort(to)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;¬†<span class="keyword">else</span>¬†<span class="keyword">if</span>¬†(</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">typeof</span>¬†to¬†===¬†<span class="string">'string'</span>¬†||¬†<span class="comment">//¬†next('/')</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†(<span class="keyword">typeof</span>¬†to¬†===¬†<span class="string">'object'</span>¬†&amp;&amp;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†(<span class="keyword">typeof</span>¬†to.path¬†===¬†<span class="string">'string'</span>¬†||¬†<span class="keyword">typeof</span>¬†to.name¬†===¬†<span class="string">'string'</span>))¬†<span class="comment">//¬†next(&#123;path:'/'&#125;)Êàñnext(&#123;name:'Home'&#125;)</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†next('/')¬†or¬†next(&#123;¬†path:¬†'/'¬†&#125;)¬†-&gt;¬†redirect</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†abort()¬†<span class="comment">//¬†ÂèñÊ∂àÂΩìÂâç</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(<span class="keyword">typeof</span>¬†to¬†===¬†<span class="string">'object'</span>¬†&amp;&amp;¬†to.replace)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Ë∞ÉÁî®Â≠êÁ±ªÊñπÊ≥ïÁöÑÊõøÊç¢ËÆ∞ÂΩï</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.replace(to)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;¬†<span class="keyword">else</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Ë∞ÉÁî®Â≠êÁ±ªÊñπÊ≥ïÁöÑÊ∑ªÂä†ËÆ∞ÂΩï</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.push(to)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;¬†<span class="keyword">else</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†confirm¬†transition¬†and¬†pass¬†on¬†the¬†value</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†next()</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†next(to)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†&#125;¬†<span class="keyword">catch</span>¬†(e)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†abort(e)</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†ÊâßË°åÈòüÂàó</span></span><br><span class="line">¬†¬†runQueue(queue,¬†iterator,¬†<span class="comment">/*¬†ÊâßË°åÁªìÊùüÂõûË∞É*/</span><span class="function"><span class="params">()</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†postEnterCbs¬†=¬†[]¬†<span class="comment">//¬†‰øùÂ≠òbeforeRouteEnter‰∏≠‰º†ÁªônextÁöÑÂõûË∞ÉÂáΩÊï∞</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†isValid¬†=¬†<span class="function"><span class="params">()</span>¬†=&gt;</span>¬†<span class="keyword">this</span>.current¬†===¬†route¬†<span class="comment">//¬†Ë°®Á§∫Ë∑≥ËΩ¨ÁªìÊùü</span></span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†wait¬†until¬†async¬†components¬†are¬†resolved¬†before</span></span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†extracting¬†in-component¬†enter¬†guards</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†enterGuards¬†=¬†extractEnterGuards(activated,¬†postEnterCbs,¬†isValid)¬†<span class="comment">//¬†Á≠âÂæÖÂºÇÊ≠•ÁªÑ‰ª∂Ëß£ÊûêÂÆåÔºåÂÜçÊäΩÂèñÁªÑ‰ª∂ÂÜÖÁöÑbeforeRouteEnterÂÆàÂç´</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†queue¬†=¬†enterGuards.concat(<span class="keyword">this</span>.router.resolveHooks)<span class="comment">//¬†beforeResolve¬†hooks</span></span><br><span class="line">¬†¬†¬†¬†runQueue(queue,¬†iterator,¬†<span class="comment">/*¬†ÊâßË°åÁªìÊùüÂõûË∞É*/</span><span class="function"><span class="params">()</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(<span class="keyword">this</span>.pending¬†!==¬†route)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">return</span>¬†abort()</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.pending¬†=¬†<span class="literal">null</span></span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†onComplete(route)¬†<span class="comment">//¬†ÊâßË°åonCompleteÂõûË∞ÉÔºåonComplete‰∏≠‰ºöË∞ÉÁî®updateRouteÊñπÊ≥ïÔºåÂÜÖÈÉ®‰ºöËß¶ÂèëafterEachÈí©Â≠ê</span></span><br><span class="line"></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(<span class="keyword">this</span>.router.app)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="keyword">this</span>.router.app.$nextTick(<span class="function"><span class="params">()</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Ë∞ÉÁî®¬†beforeRouteEnter¬†ÂÆàÂç´‰∏≠‰º†Áªô¬†next¬†ÁöÑÂõûË∞ÉÂáΩÊï∞</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†next(vm=&gt;xxx)</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†postEnterCbs.forEach(<span class="function"><span class="params">cb</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†cb()</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Êàë‰ª¨ÂèØ‰ª•ÂÖàÁúã‰∏ãÊñπÊ≥ïÁ≠æÂêç<ul>
<li><code>route</code>ÁõÆÊ†áË∑ØÁî±ÂØπË±°ÔºåÈúÄË¶ÅËß£ÊûêÁöÑÁõÆÊ†áÔºåÂèØ‰ª•ÁêÜËß£‰∏∫Ë∑ØÁî±Ë∑≥ËΩ¨Êó∂ÁöÑ<code>to</code>ÂØπË±°ÔºåËÄå<code>current</code>ÂàôÂèØ‰ª•ÁêÜËß£‰∏∫<code>from</code>ÂØπË±°„ÄÇ</li>
<li><code>onComplete</code>Ë∑≥ËΩ¨ÂÆåÊàêÁöÑÂõûË∞É</li>
<li><code>onAbort</code>ÂèñÊ∂à„ÄÅÈîôËØØÁöÑÂõûË∞É</li>
</ul>
</li>
<li>Áúã‰∏ã‰∏ªË¶ÅÈÄªËæë<ul>
<li>È¶ñÂÖàÂ§ÑÁêÜ‰∫ÜÈáçÂ§çË∑≥ËΩ¨ÁöÑÈóÆÈ¢ò</li>
<li>ÁÑ∂ÂêéÈÄöËøáÂØπÊØîÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï</li>
<li>‰ªé‰∏äËø∞‰∏âÁßçË∑ØÁî±ËÆ∞ÂΩï‰∏≠ÊäΩÂèñÂá∫ÂØπÂ∫îÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞</li>
<li>Â∞ÜÈí©Â≠êÂèäÂÆàÂç´ÂáΩÊï∞ÊîæÂÖ•ÈòüÂàó‰∏≠Âπ∂ÊâßË°å</li>
</ul>
</li>
<li>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨‰æùÊ¨°Áúã‰∏ãÁõ∏ÂÖ≥ÈÄªËæë</li>
</ul>
<h3 id="Âà§Êñ≠ÈáçÂ§çË∑≥ËΩ¨"><a href="#Âà§Êñ≠ÈáçÂ§çË∑≥ËΩ¨" class="headerlink" title="Âà§Êñ≠ÈáçÂ§çË∑≥ËΩ¨"></a>Âà§Êñ≠ÈáçÂ§çË∑≥ËΩ¨</h3><ul>
<li>Âú®Âà§Êñ≠ÈáçÂ§çË∑≥ËΩ¨ÂâçÂÆö‰πâ‰∫Ü<code>abort</code>ÊñπÊ≥ïÔºåÂÆÉ‰∏ªË¶ÅÂØπ<code>onAbort</code>ÊñπÊ≥ïÂÅö‰∫Ü‰∏ÄÂ±ÇÂåÖË£ÖÔºõËøô‰∏™ÊñπÊ≥ïÂú®ÂØºËà™ÂèëÁîüÂèñÊ∂àÊó∂‰ºöË¢´Ë∞ÉÁî®Âà∞<ul>
<li>ÂÆÉÊé•Êî∂‰∏Ä‰∏™<code>err</code>ÂèÇÊï∞ÔºåÂ¶ÇÊûúÊúâÊ≥®ÂÜåÈîôËØØÂõûË∞ÉÂπ∂‰∏î<code>err</code>‰∏∫Èùû<code>NavigationDuplicated</code>ÈîôËØØÂàôÈÅçÂéÜ<code>errorCbs</code>ÂàóË°®ÊâßË°åÂÖ∂‰∏≠ÁöÑÈîôËØØÂõûË∞É</li>
<li>ÊúÄÂêéË∞ÉÁî®<code>onAbort</code>ÂõûË∞ÉÂπ∂‰º†ÂÖ•<code>err</code>ÂèÇÊï∞‰∫§ÁªôÂ§ñÈÉ®Â§ÑÁêÜ</li>
</ul>
</li>
<li>Êé•‰∏ãÊù•Âà§Êñ≠‰∫ÜÊòØÂê¶ÈáçÂ§çË∑≥ËΩ¨Ôºå‰∏ªË¶ÅÂà©Áî®<code>isSameRoute</code>Ê£ÄÊµã‰∫ÜÂΩìÂâçË∑ØÁî±ÂØπË±°ÂíåÁõÆÊ†áË∑ØÁî±ÂØπË±°ÊòØÂê¶Áõ∏ÂêåÔºåËã•Áõ∏Âêå‰∏î‰∫åËÄÖÂåπÈÖçÂà∞Ë∑ØÁî±ËÆ∞ÂΩïÊï∞ÈáèÁõ∏ÂêåÔºåÂàôËßÜ‰∏∫ÈáçÂ§çË∑≥ËΩ¨ÔºåÊ≠§Êó∂Ë∞ÉÁî®<code>abort</code>ÊñπÊ≥ïÂπ∂‰º†ÂÖ•<code>NavigationDuplicated</code>ÈîôËØØÂπ∂ÁªàÊ≠¢ÊµÅÁ®ã</li>
<li><code>isSameRoute</code>‰∏ªË¶ÅÂà§Êñ≠‰∫Ü<code>path„ÄÅname„ÄÅhash„ÄÅquery„ÄÅparams</code>Á≠âÂÖ≥ÈîÆ‰ø°ÊÅØÊòØÂê¶Áõ∏ÂêåÔºåËã•Áõ∏ÂêåÂàôËßÜ‰∏∫Áõ∏ÂêåË∑ØÁî±ÂØπË±°</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/route.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊòØÂê¶Áõ∏Âêåroute</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isSameRoute</span>(<span class="params">a: Route, b: ?Route</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (b === START) &#123;</span><br><span class="line">    <span class="keyword">return</span> a === b</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a.path &amp;&amp; b.path) &#123;</span><br><span class="line">    <span class="comment">//¬†pathÈÉΩÂ≠òÂú®ÔºåÊØîËæÉpath„ÄÅhash„ÄÅqueryÊòØÂê¶Áõ∏Âêå</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      a.path.replace(trailingSlashRE, <span class="string">''</span>) ===</span><br><span class="line">        b.path.replace(trailingSlashRE, <span class="string">''</span>) &amp;&amp;</span><br><span class="line">      a.hash === b.hash &amp;&amp;</span><br><span class="line">      isObjectEqual(a.query, b.query)</span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a.name &amp;&amp; b.name) &#123;</span><br><span class="line">    <span class="comment">//¬†nameÈÉΩÂ≠òÂú®ÔºåÊØîËæÉname„ÄÅhash„ÄÅquery„ÄÅparamsÊòØÂê¶Áõ∏Âêå</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      a.name === b.name &amp;&amp;</span><br><span class="line">      a.hash === b.hash &amp;&amp;</span><br><span class="line">      isObjectEqual(a.query, b.query) &amp;&amp;</span><br><span class="line">      isObjectEqual(a.params, b.params)</span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Ê≥®ÊÑèÔºåÂú®Á°ÆÂÆöÊòØÈáçÂ§çË∑≥ËΩ¨ÂêéÔºå‰ªçÁÑ∂‰ºöË∞ÉÁî®Â≠êÁ±ªÁöÑ<code>ensureURL</code>ÊñπÊ≥ïÊù•Êõ¥Êñ∞<code>url</code></li>
</ul>
<h3 id="ÂØπÊØîÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï"><a href="#ÂØπÊØîÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï" class="headerlink" title="ÂØπÊØîÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï"></a>ÂØπÊØîÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï</h3><ul>
<li>Âà§Êñ≠ÂÆåÈáçÂ§çË∑≥ËΩ¨ÂêéÔºåÂ∞±ÈúÄË¶ÅÂØπÊØî<code>from</code>„ÄÅ<code>to</code>Ë∑ØÁî±ÂØπË±°ÔºåÊâæÂá∫Âì™‰∫õË∑ØÁî±ËÆ∞ÂΩïÈúÄË¶ÅÊõ¥Êñ∞ÔºåÂì™‰∫õÂ§±Ê¥ª„ÄÅÂì™‰∫õÈúÄË¶ÅÊøÄÊ¥ªÔºåÁî®Êù•ÂêéÁª≠ÊäΩÂèñÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js confirmTransitionÊñπÊ≥ï‰∏≠</span></span><br><span class="line"><span class="comment">//¬†ÂØπÊØîÂâçÂêérouteÁöÑRouteRecordÔºåÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑÁöÑË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"><span class="keyword">const</span> &#123; updated, deactivated, activated &#125; = resolveQueue(</span><br><span class="line">  <span class="keyword">this</span>.current.matched,</span><br><span class="line">  route.matched</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÈÄªËæëÂ∞ÅË£ÖÂú®‰∫Ü<code>resolveQueue</code>ÊñπÊ≥ï‰∏≠Ôºå‰º†ÂÖ•‰∫ÜÂΩìÂâçÂíåÁõÆÊ†áË∑ØÁî±ÂØπË±°ÁöÑËÆ∞ÂΩïÂàóË°®Ôºå‰ªéËøîÂõûÂÄº‰∏≠Ëß£ÊûÑÂá∫‰∫Ü<code>updated, deactivated, activated</code></li>
<li>Áúã‰∏ã<code>resolveQueue</code>ÂÆûÁé∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//¬†ÂØπÊØîcurren„ÄÅnextÁöÑË∑ØÁî±ËÆ∞ÂΩïÂàóË°®ÔºåÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolveQueue</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  current: <span class="built_in">Array</span>&lt;RouteRecord&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  next: <span class="built_in">Array</span>&lt;RouteRecord&gt;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): </span>&#123;</span><br><span class="line">  updated: <span class="built_in">Array</span>&lt;RouteRecord&gt;</span><br><span class="line">  activated: <span class="built_in">Array</span>&lt;RouteRecord&gt;</span><br><span class="line">  deactivated: <span class="built_in">Array</span>&lt;RouteRecord&gt;</span><br><span class="line">&#125; &#123;</span><br><span class="line">  <span class="keyword">let</span> i</span><br><span class="line">  <span class="keyword">const</span> max = <span class="built_in">Math</span>.max(current.length, next.length) <span class="comment">//¬†ÊâæÂà∞È¶ñ‰∏™‰∏çÁõ∏Á≠âÁöÑË∑ØÁî±ËÆ∞ÂΩïÁ¥¢Âºï</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (current[i] !== next[i]) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">//¬†eg //¬†current:[1,2,3] //¬†next:[1,2,3,4,5] //¬†i‰∏∫3 //¬†ÈúÄË¶ÅÊõ¥Êñ∞ÁöÑ‰∏∫[1,2,3] //¬†ÈúÄË¶ÅÊøÄÊ¥ªÁöÑ‰∏∫[4,5] //¬†ÈúÄË¶ÅÂ§±Ê¥ªÁöÑ‰∏∫[]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    updated: next.slice(<span class="number">0</span>, i), <span class="comment">//¬†Á¥¢ÂºïÂ∑¶‰æßÊòØÈúÄË¶ÅÊõ¥Êñ∞ÁöÑ</span></span><br><span class="line">    activated: next.slice(i), <span class="comment">//¬†Á¥¢ÂºïÂè≥‰æßÊòØÈúÄË¶ÅÊøÄÊ¥ªÁöÑ</span></span><br><span class="line">    deactivated: current.slice(i), <span class="comment">//¬†ÂΩìÂâçÁ¥¢ÂºïÂè≥‰æßÊòØÈúÄË¶ÅÂ§±Ê¥ªÁöÑ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÈÄªËæëÂæàÁÆÄÂçï<ul>
<li>È¶ñÂÖàÊâæÂá∫<code>current</code>Âíå<code>next</code>ÂàóË°®ÈïøÂ∫¶ÁöÑÊúÄÂ§ßÂÄºÔºå</li>
<li>ÁÑ∂Âêé‰ª•Ê≠§‰∏∫Âæ™ÁéØÊúÄÂ§ßÊ¨°Êï∞Âæ™ÁéØÊâæÂá∫È¶ñ‰∏™‰∏çÁõ∏Á≠âÁöÑË∑ØÁî±ËÆ∞ÂΩïÁ¥¢Âºï</li>
<li>‰ª•Ê≠§Á¥¢Âºï‰∏∫ÂàÜÁïåÁ∫øÔºå<code>nextÂàóË°®</code>ÂΩìÂâçÁ¥¢ÂºïÂ∑¶‰æß‰∏∫ÈúÄË¶ÅÊõ¥Êñ∞ÁöÑË∑ØÁî±ËÆ∞ÂΩï„ÄÅÁ¥¢ÂºïÂèäÁ¥¢ÂºïÂè≥‰æßÁöÑ‰∏∫ÈúÄË¶ÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï</li>
<li><code>currentÂàóË°®</code>Á¥¢ÂºïÂèäÂè≥‰æßÊòØÈúÄË¶ÅÂ§±Ê¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï</li>
</ul>
</li>
<li>‰∏æ‰æã</li>
<li><code>current</code>‰∏∫:<code>[1,2,3]</code>„ÄÅ<code>next</code>‰∏∫<code>[1,2,3,4,5]</code>ÔºåÂΩìÂâçË∑ØÁî±ÂØπË±°ÂåÖÂê´<code>1„ÄÅ2„ÄÅ3</code>‰∏â‰∏™Ë∑ØÁî±ËÆ∞ÂΩïÔºåÁõÆÊ†áË∑ØÁî±ÂØπË±°ÂåÖÂê´<code>1„ÄÅ2„ÄÅ3„ÄÅ4„ÄÅ5</code>‰∫î‰∏™Ë∑ØÁî±ËÆ∞ÂΩï</li>
<li>ËÆ°ÁÆóÂêé<code>max</code>‰∏∫<code>5</code></li>
<li>Âæ™ÁéØÔºåÂèëÁé∞È¶ñ‰∏™‰∏çÁõ∏Á≠âÁöÑÁ¥¢Âºï‰∏∫<code>3</code></li>
<li>ÊâÄ‰ª•ÈúÄË¶ÅÊõ¥Êñ∞ÁöÑ‰∏∫<code>next.slice(0,3)</code>Âç≥<code>1„ÄÅ2„ÄÅ3</code></li>
<li>ÈúÄË¶ÅÊøÄÊ¥ªÁöÑ‰∏∫<code>next.slice(3)</code>Âç≥<code>4„ÄÅ5</code></li>
<li>ÈúÄË¶ÅÂ§±Ê¥ªÁöÑ‰∏∫<code>current.slice(3)</code>ÔºåÊ≤°ÊúâÈúÄË¶ÅÂ§±Ê¥ªÁöÑ</li>
<li>ÊâæÂá∫‰∫ÜÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÊøÄÊ¥ª„ÄÅÂ§±Ê¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩïÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•‰ªé‰∏≠ÊäΩÂèñÂá∫ÂØπÂ∫îÁöÑÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞</li>
</ul>
<h3 id="ÊäΩÂèñÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞„ÄÅËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂"><a href="#ÊäΩÂèñÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞„ÄÅËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂" class="headerlink" title="ÊäΩÂèñÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞„ÄÅËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂"></a>ÊäΩÂèñÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞„ÄÅËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂</h3><ul>
<li>È¶ñÂÖàÊàë‰ª¨Ê¢≥ÁêÜ‰∏ã<code>vue-router</code>ÊúâÂì™‰∫õÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞<ul>
<li><code>router.beforeEach</code>ÂÖ®Â±ÄÂâçÁΩÆÂÆàÂç´</li>
<li><code>router.beforeResolve</code>ÂÖ®Â±ÄËß£ÊûêÂÆàÂç´(v2.5.0 Êñ∞Â¢û)</li>
<li><code>router.afterEach</code>ÂÖ®Â±ÄÂêéÁΩÆÈí©Â≠ê</li>
<li><code>RouteConfig.beforeEnter</code>Ë∑ØÁî±Áã¨‰∫´ÁöÑÂÆàÂç´</li>
<li><code>vm.beforeRouteEnter</code>vue ÁªÑ‰ª∂ÂÜÖË∑ØÁî±ËøõÂÖ•ÂÆàÂç´</li>
<li><code>vm.beforeRouteUpdate</code>vue ÁªÑ‰ª∂ÂÜÖË∑ØÁî±Êõ¥Êñ∞ÂÆàÂç´(v2.2 Êñ∞Â¢û)</li>
<li><code>vm.beforeRouteLeave</code>vue ÁªÑ‰ª∂ÂÜÖË∑ØÁî±Á¶ªÂºÄÂÆàÂç´</li>
</ul>
</li>
<li>ÂèØ‰ª•ÁúãÂà∞Êúâ‰∫õÊòØÂÆö‰πâ<code>VueRouter</code>ÂÆû‰æã‰∏äÁöÑÔºåÊúâ‰∫õÊòØÂÆö‰πâÂú®ÈÖçÁΩÆËßÑÂàô<code>RouteConfig</code>‰∏äÁöÑÔºåÊúâ‰∫õÊòØÂÆö‰πâÂú®<code>RouteComponentË∑ØÁî±ÁªÑ‰ª∂</code>‰∏äÁöÑ<ul>
<li>Ââç‰∏§ËÄÖÁöÑÈí©Â≠ê„ÄÅÂÆàÂç´ÊòØÂæàÂÆπÊòìËé∑ÂèñÂà∞ÁöÑÔºåÂõ†‰∏∫Êàë‰ª¨Âú®<code>HistoryÁ±ª</code>‰∏≠ÊåÅÊúâ‰∫Ü<code>VueRouter</code>ÂÆû‰æãÔºåÂæàÂÆπÊòìËÆøÈóÆÂà∞Ëøô‰∫õÂÆàÂç´„ÄÅÈí©Â≠êÂπ∂‰∏îÂá†‰πé‰∏çÈúÄË¶ÅÂÅöÈ¢ùÂ§ñÂ§ÑÁêÜÂ∞±ÂèØ‰ª•Áõ¥Êé•ÊâßË°åÔºõ</li>
<li>ÂîØ‰∏Ä‰∏çÂ•ΩÂ§ÑÁêÜÁöÑÊòØÂÆö‰πâÂú®<code>RouteComponentË∑ØÁî±ÁªÑ‰ª∂</code>‰∏≠ÁöÑÂÆàÂç´ÂáΩÊï∞ÔºåÈúÄË¶ÅÂÄüÂä©<code>RouteRecord</code>ÊãøÂà∞ÊâÄÊúâ<code>RouteComponentË∑ØÁî±ÁªÑ‰ª∂</code>Âπ∂‰ªé‰∏≠ÊäΩÂèñÂá∫ÂØπÂ∫îÂÆàÂç´ÔºåÊúÄÂêéËøòË¶Å‰∏∫ÂÖ∂ÁªëÂÆö‰∏ä‰∏ãÊñáÔºå‰øùËØÅÊâßË°åÁªìÊûúÊ≠£Á°ÆÔºõ</li>
</ul>
</li>
<li>‰∏äËäÇÔºåÊàë‰ª¨Â∑≤ÁªèÊãøÂà∞ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÊøÄÊ¥ª„ÄÅÂ§±Ê¥ªÁöÑ<code>RouteRecordË∑ØÁî±ËÆ∞ÂΩï</code>ÔºåÊàë‰ª¨Áúã‰∏ãÂàÜÂà´Ë¶Å‰ªé‰∏≠ÊäΩÂèñÂá∫Âì™‰∫õÂÆàÂç´</li>
<li><code>deactivated</code>‰∏≠ÊäΩÂèñ<code>beforeRouteLeave</code></li>
<li><code>updated</code>‰∏≠ÊäΩÂèñ<code>beforeRouteUpdate</code></li>
<li><code>activated</code>‰∏≠ÊäΩÂèñ<code>beforeRouteEnter</code>ÔºåËøôÈáåÂ≠òÂú®‰∏Ä‰∏™ÁâπÊÆäÂú∫ÊôØÔºåÂ∞±ÊòØÂºÇÊ≠•Ë∑ØÁî±ÁªÑ‰ª∂ÔºåÈúÄË¶ÅÁ≠âÂæÖÂºÇÊ≠•Ë∑ØÁî±ÁªÑ‰ª∂Ëß£ÊûêÂÆåÊàêÂêéÔºåÊâçËÉΩÊäΩÂèñ<code>beforeRouteEnter</code>ÂÆàÂç´ÔºåËøô‰∏™ÂêéÈù¢‰ºöËÆ≤</li>
<li>Êàë‰ª¨ÂÖàÁúã‰∏ãÊäΩÂèñÁöÑÂÖ•Âè£‰ª£Á†Å</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js confirmTransitionÊñπÊ≥ïÂÜÖ</span></span><br><span class="line"><span class="comment">//¬†ÁîüÊàêÈúÄË¶ÅÊâßË°åÁöÑÂÆàÂç´„ÄÅÈí©Â≠êÈòüÂàó</span></span><br><span class="line"><span class="keyword">const</span> queue: <span class="built_in">Array</span>&lt;?NavigationGuard&gt; = [].concat(</span><br><span class="line">  <span class="comment">//¬†in-component¬†leave¬†guards</span></span><br><span class="line">  extractLeaveGuards(deactivated), <span class="comment">//¬†ÊèêÂèñË∑ØÁî±ÁªÑ‰ª∂‰∏≠ÊâÄÊúâbeforeRouteLeaveÂÆàÂç´ //¬†global¬†before¬†hooks</span></span><br><span class="line">  <span class="keyword">this</span>.router.beforeHooks, <span class="comment">//¬†ÂÖ®Â±ÄÁöÑbeforeEachÂÆàÂç´ //¬†in-component¬†update¬†hooks</span></span><br><span class="line">  extractUpdateHooks(updated), <span class="comment">//¬†ÊèêÂèñË∑ØÁî±ÁªÑ‰ª∂‰∏≠ÊâÄÊúâbeforeRouteUpdateÂÆàÂç´ //¬†in-config¬†enter¬†guards</span></span><br><span class="line">  activated.map(<span class="function">(<span class="params">m</span>) =&gt;</span> m.beforeEnter), <span class="comment">//¬†Ë∑ØÁî±Áã¨‰∫´ÁöÑbeforeEnterÂÆàÂç´ //¬†async¬†components</span></span><br><span class="line">  resolveAsyncComponents(activated) <span class="comment">//¬†Ëß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ÈòüÂàó<code>queue</code></li>
<li>‰æùÊ¨°ÂÅö‰∫Ü‰∏ãÈù¢ÁöÑ‰∫ã<ul>
<li>ÊäΩÂèñ‰∫Ü<code>deactivated</code>‰∏≠ÁöÑ<code>beforeRouteLeave</code>ÂÆàÂç´</li>
<li>Ëé∑Âèñ‰∫Ü<code>VueRouter</code>ÂÆû‰æã‰∏äÂÆö‰πâÁöÑ<code>beforeEach</code>ÂÆàÂç´<ul>
<li><code>beforeEach</code>ÂÆàÂç´ÊòØÁõ¥Êé•ÂÆö‰πâÂú®<code>VueRouter</code>ÂÆû‰æã‰∏äÁöÑ</li>
</ul>
</li>
<li>‰ªé<code>updated</code>‰∏≠ÊäΩÂèñ‰∫Ü<code>beforeRouteUpdate</code>ÂÆàÂç´</li>
<li>‰ªé<code>activated</code>‰∏≠Ëé∑Âèñ‰∫ÜË∑ØÁî±Áã¨‰∫´ÁöÑ<code>beforeEnter</code>ÂÆàÂç´<ul>
<li><code>beforeEnter</code>ÂÆàÂç´ÊúÄÂàùÊòØÂÆö‰πâÂú®<code>RouteConfig</code>‰∏äÁöÑÔºåÂêéÈù¢Âèà‰º†ÈÄíÁªôË∑ØÁî±ËÆ∞ÂΩïÔºåÊâÄ‰ª•Âú®Ë∑ØÁî±ËÆ∞ÂΩï‰∏äËÉΩÁõ¥Êé•Ëé∑ÂèñÂà∞</li>
</ul>
</li>
<li>Ëß£Êûê<code>activated</code>‰∏≠ÁöÑÂºÇÊ≠•Ë∑ØÁî±ÁªÑ‰ª∂<ul>
<li>Ë∑ØÁî±ÁªÑ‰ª∂ÊîØÊåÅ<code>import()</code>Âä®ÊÄÅÂØºÂÖ•ÔºåÊâÄ‰ª•ËøôÈáåË¶ÅÂ§ÑÁêÜ</li>
</ul>
</li>
</ul>
</li>
<li>Êàë‰ª¨ÂÖàÁúãÊñπÊ≥ïÂêçÂæàÁ±ª‰ººÁöÑ<code>extractLeaveGuards</code>Âíå<code>extractUpdateHooks</code></li>
</ul>
<h4 id="extractLeaveGuards„ÄÅextractUpdateHooks"><a href="#extractLeaveGuards„ÄÅextractUpdateHooks" class="headerlink" title="extractLeaveGuards„ÄÅextractUpdateHooks"></a>extractLeaveGuards„ÄÅextractUpdateHooks</h4><ul>
<li>‰∫åËÄÖÈÉΩ‰Ωç‰∫é<code>src/base.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/base.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†‰º†ÂÖ•Ë∑ØÁî±ËÆ∞ÂΩïÂàóË°®ÔºåÊèêÂèñÂá∫beforeRouteLeaveÂÆàÂç´Âπ∂ÈÄÜÂ∫èËæìÂá∫</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extractLeaveGuards</span>(<span class="params">deactivated: <span class="built_in">Array</span>&lt;RouteRecord&gt;</span>): <span class="title">Array</span>&lt;?<span class="title">Function</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> extractGuards(deactivated, <span class="string">'beforeRouteLeave'</span>, bindGuard, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//¬†‰º†ÂÖ•Ë∑ØÁî±ËÆ∞ÂΩïÂàóË°®ÔºåÊèêÂèñÂá∫beforeRouteUpdateÈí©Â≠ê</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extractUpdateHooks</span>(<span class="params">updated: <span class="built_in">Array</span>&lt;RouteRecord&gt;</span>): <span class="title">Array</span>&lt;?<span class="title">Function</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> extractGuards(updated, <span class="string">'beforeRouteUpdate'</span>, bindGuard)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞‰∫åËÄÖÂÜÖÈÉ®ÈÉΩË∞ÉÁî®‰∫Ü<code>extractGuards</code>ÔºåÂâçËÄÖÂ§ö‰º†‰∫Ü‰∏Ä‰∏™ÂèÇÊï∞<code>true</code></li>
<li>Êàë‰ª¨ÂÜçÁúã‰∏ã<code>extractGuards</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/base.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊèêÂèñÂÆàÂç´</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extractGuards</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  records: <span class="built_in">Array</span>&lt;RouteRecord&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  name: <span class="built_in">string</span>, <span class="comment">//¬†Ë¶ÅÊèêÂèñÁöÑÂÆàÂç´Âêç</span></span></span></span><br><span class="line"><span class="function"><span class="params">  bind: <span class="built_in">Function</span>, <span class="comment">//¬†ÁªëÂÆöÂÆàÂç´‰∏ä‰∏ãÊñáÂáΩÊï∞</span></span></span></span><br><span class="line"><span class="function"><span class="params">  reverse?: <span class="built_in">boolean</span> <span class="comment">//¬†ÊòØÂê¶ÈúÄË¶ÅÈÄÜÂ∫è</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Array</span>&lt;?<span class="title">Function</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> guards = flatMapComponents(records, (</span><br><span class="line">    def <span class="comment">/*Ë∑ØÁî±ÁªÑ‰ª∂ÂÆö‰πâ*/</span>,</span><br><span class="line">    instance <span class="comment">/*router-viewÂÆû‰æã*/</span>,</span><br><span class="line">    match <span class="comment">/*Ë∑ØÁî±ËÆ∞ÂΩï*/</span>,</span><br><span class="line">    key <span class="comment">/*ËßÜÂõæÂêç*/</span></span><br><span class="line">  ) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> guard = extractGuard(def, name) <span class="comment">//¬†ÊèêÂèñÂá∫Ë∑ØÁî±ÁªÑ‰ª∂‰∏≠ÁöÑÂÆàÂç´ÂáΩÊï∞ //¬†‰∏∫ÂÆàÂç´ÁªëÂÆö‰∏ä‰∏ãÊñá</span></span><br><span class="line">    <span class="keyword">if</span> (guard) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(guard)</span><br><span class="line">        ? guard.map(<span class="function">(<span class="params">guard</span>) =&gt;</span> bind(guard, instance, match, key))</span><br><span class="line">        : bind(guard, instance, match, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;) <span class="comment">//¬†ÊâÅÂπ≥Âåñ¬†+¬†ÈÄÜÂ∫è</span></span><br><span class="line">  <span class="keyword">return</span> flatten(reverse ? guards.reverse() : guards)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Áúã‰∏ãÊñπÊ≥ïÁ≠æÂêç<ul>
<li>Êé•Êî∂‰∏Ä‰∏™Ë∑ØÁî±ËÆ∞ÂΩïÊï∞ÁªÑ<code>records</code><ul>
<li>Âç≥<code>extractLeaveGuards</code>‰∏≠‰º†ÂÖ•ÁöÑ<code>deactivated</code>Ë∑ØÁî±ËÆ∞ÂΩïÊï∞ÁªÑÔºõ<code>extractUpdateHooks</code>‰∏≠‰º†ÂÖ•ÁöÑ<code>updated</code>Ë∑ØÁî±ËÆ∞ÂΩïÊï∞ÁªÑ</li>
</ul>
</li>
<li>Êé•Êî∂‰∏Ä‰∏™ÈúÄË¶ÅÊèêÂèñÁöÑÂÆàÂç´Âêç<code>name</code><ul>
<li><code>beforeRouteLeave</code>Âíå<code>beforeRouteUpdate</code>Â≠óÁ¨¶‰∏≤</li>
</ul>
</li>
<li>‰∏Ä‰∏™ÁªëÂÆöÂÆàÂç´‰∏ä‰∏ãÁöÑÂáΩÊï∞<code>bind</code><ul>
<li><code>extractLeaveGuards</code>„ÄÅ<code>extractUpdateHooks</code>‰º†ÈÄíÁöÑÈÉΩÊòØ<code>bindGuard</code>ÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÊàë‰ª¨Âú®‰∏ãÈù¢Ëß£Êûê</li>
</ul>
</li>
<li>‰ª•Âèä‰∏Ä‰∏™ÊòØÂê¶ÈúÄË¶ÅÈÄÜÂ∫èËæìÂá∫ÁöÑ<code>reverse</code>Â∏ÉÂ∞îÂÄºÔºõÂèØÈÄâÂèÇÊï∞Ôºõ<ul>
<li><code>extractLeaveGuards</code>‰º†ÈÄíÁöÑÊòØ<code>true</code>Ôºå‰ª£Ë°®ËøîÂõûÁöÑÊï∞ÁªÑ(ÂÆàÂç´ÂáΩÊï∞Êï∞ÁªÑ)ÈúÄË¶ÅÈÄÜÂ∫èËæìÂá∫Ôºõ</li>
</ul>
</li>
<li>ËøîÂõû‰∏Ä‰∏™<code>item</code>ÊòØ<code>Function</code>ÁöÑÊï∞ÁªÑ</li>
</ul>
</li>
<li>Áúã‰∏ãÂÜÖÈÉ®ÈÄªËæë<ul>
<li>Ë∞ÉÁî®<code>flatMapComponents</code>‰º†ÂÖ•<code>records</code>Âíå‰∏Ä‰∏™Êé•Êî∂<code>def, instance, match, key</code>ÂèÇÊï∞ÁöÑÁÆ≠Â§¥ÂáΩÊï∞ÔºåËøîÂõû‰∏Ä‰∏™<code>guards</code>ÂÆàÂç´Êï∞ÁªÑ</li>
<li>ÁÑ∂ÂêéÊ†πÊçÆ<code>reverse</code>Êù•ÂÜ≥ÂÆöÊòØÂê¶ÂØπ<code>guards</code>Êï∞ÁªÑÂÅöÈÄÜÂ∫èÂ§ÑÁêÜ<ul>
<li>‰∏∫‰ΩïÈúÄË¶ÅÈÄÜÂ∫è?</li>
<li>Âú®<code>createRoute</code>Á´†ËäÇ‰πüÊèêËøáÔºåÂú®‰øùÂ≠òË∑ØÁî±ËÆ∞ÂΩïÊó∂ÊòØÈÄÜÂ∫èÁöÑÔºåÁ≤æÂáÜÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÂú®Êï∞ÁªÑÊúÄÂêé(<code>length - 1</code>‰ΩçÁΩÆ)ÔºåÁà∂ËÆ∞ÂΩïÂú®Ââç</li>
<li>ÈÉ®ÂàÜÂÆàÂç´ÂáΩÊï∞ÈúÄË¶ÅÈÄÜÂ∫èÈÄÜÂ∫èÊâßË°åÔºå‰æãÂ¶Ç<code>beforeRouteLeave</code>ÔºåÂÆÉÈúÄË¶ÅÂÖàÂú®Á≤æÂáÜÂåπÈÖçÁöÑË∑ØÁî±ÁªÑ‰ª∂‰∏äË∞ÉÁî®ÔºåÂÜçÂú®Áà∂ÁªÑ‰ª∂‰∏äË∞ÉÁî®</li>
</ul>
</li>
<li>ÊúÄÂêéË∞ÉÁî®<code>flatten</code>Â∞Ü<code>guards</code>ÊâÅÂπ≥Âåñ</li>
</ul>
</li>
<li>ÂÖàÁúã‰∏ã<code>flatMapComponents</code>ÂÆûÁé∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/resolve-components.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊâÅÂπ≥ÂåñË∑ØÁî±ËÆ∞ÂΩï‰∏≠ÁöÑË∑ØÁî±ÁªÑ‰ª∂</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">flatMapComponents</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  matched: <span class="built_in">Array</span>&lt;RouteRecord&gt;, <span class="comment">//¬†Ë∑ØÁî±ËÆ∞ÂΩïÊï∞ÁªÑ</span></span></span></span><br><span class="line"><span class="function"><span class="params">  fn: <span class="built_in">Function</span> <span class="comment">//¬†ÂõûË∞ÉÂáΩÊï∞</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Array</span>&lt;?<span class="title">Function</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> flatten(</span><br><span class="line">    matched.map(<span class="function">(<span class="params">m</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.keys(m.components).map(<span class="function">(<span class="params">key</span>) =&gt;</span></span><br><span class="line">        fn(</span><br><span class="line">          m.components[key], <span class="comment">//¬†ÂëΩÂêçËßÜÂõæÂØπÂ∫îÁöÑË∑ØÁî±ÁªÑ‰ª∂ÂÆö‰πâÔºõ‰∏ÄËà¨ÂØπÂ∫îfnÁöÑÂÖ•ÂèÇdef</span></span><br><span class="line">          m.instances[key], <span class="comment">//¬†router-viewÂÆû‰æãÔºõ‰∏ÄËà¨ÂØπÂ∫îfnÁöÑÂÖ•ÂèÇ_Êàñinstance</span></span><br><span class="line">          m, <span class="comment">//¬†ÂåπÈÖçÁöÑË∑ØÁî±ËÆ∞ÂΩïÔºõ‰∏ÄËà¨ÂØπÂ∫îfnÁöÑÂÖ•ÂèÇmatch</span></span><br><span class="line">          key <span class="comment">//¬†ÂëΩÂêçËßÜÂõæÁöÑkeyÔºõ‰∏ÄËà¨ÂØπÂ∫îfnÁöÑÂÖ•ÂèÇkey</span></span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÖ∂Êé•Êî∂‰∏Ä‰∏™Ë∑ØÁî±ËÆ∞ÂΩïÊï∞ÁªÑ<code>matched</code>Âíå‰∏Ä‰∏™ÂáΩÊï∞<code>fn</code>ÔºåËøîÂõû‰∏Ä‰∏™ÁªèËøá<code>flatten</code>Â§ÑÁêÜÁöÑÊï∞ÁªÑ<ul>
<li><code>matched</code>Â∞±ÊòØÊàë‰ª¨‰º†ÂÖ•ÁöÑ<code>records</code></li>
<li><code>fn</code>Â∞±ÊòØÊé•Êî∂<code>def, instance, match, key</code>ÂèÇÊï∞ÁöÑÁÆ≠Â§¥ÂáΩÊï∞</li>
</ul>
</li>
<li>Ëøô‰∏™ÊñπÊ≥ï‰∏ªË¶ÅÊòØÈÅçÂéÜË∑ØÁî±ËÆ∞ÂΩï‰∏≠ÁöÑÊØè‰∏™Ë∑ØÁî±ÁªÑ‰ª∂Âπ∂Áî®ÂÖ∂ÂÅöÂÖ•ÂèÇ‰æùÊ¨°Ë∞ÉÁî®Â§ñÈÉ®ÂáΩÊï∞<code>fn</code>ÔºåËøîÂõûÁªìÊûúÁî±<code>fn</code>ÂáΩÊï∞ÂÜ≥ÂÆöÔºåÊúÄÂêéÂ∞ÜÁªìÊûúÊï∞ÁªÑÊâÅÂπ≥ÂåñËæìÂá∫<ul>
<li>Âú®Ëß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂Êó∂‰πü‰ºöÁî®Âà∞Ê≠§ÊñπÊ≥ï</li>
</ul>
</li>
<li>ÂÖ∂‰ºöÂØπ‰º†ÂÖ•ÁöÑ<code>records</code>Ë∞ÉÁî®<code>map</code>ÊñπÊ≥ïÔºåÂπ∂ÈÅçÂéÜÊØè‰∏™<code>record</code>‰∏äÂÆö‰πâÁöÑ<code>components</code>Â≠óÊÆµÔºåÂπ∂ÂØπ<code>components</code>ÂÜçÊ¨°ËøõË°å<code>map</code>ÈÅçÂéÜÔºåÁÑ∂ÂêéË∞ÉÁî®‰º†ÂÖ•ÁöÑ<code>fn</code>Ôºå<code>map</code>ÁªìÊûúÂ∞±ÊòØ<code>fn</code>ËøîÂõûÁöÑÁªìÊûú</li>
<li><code>components</code>Â≠óÊÆµÊòØÂÆö‰πâÂëΩÂêçËßÜÂõæÁî®ÁöÑÔºåÈïø‰∏ãÈù¢ËøôÊ†∑Ôºåkey ‰∏∫ËßÜÂõæÂêçÔºåvalue ‰∏∫ÂØπÂ∫îË∑ØÁî±ÁªÑ‰ª∂</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">components: &#123;</span><br><span class="line">        <span class="keyword">default</span>: Foo,</span><br><span class="line">        a: Bar,</span><br><span class="line">        b: Baz</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊâÄ‰ª•‰º†ÂÖ•ÁöÑ fnÔºåÂç≥Êé•Êî∂<code>def, instance, match, key</code>ÂèÇÊï∞ÁöÑÁÆ≠Â§¥ÂáΩÊï∞ÁöÑÂõõ‰∏™ÂèÇÊï∞ÂàÜÂà´‰∏∫<ul>
<li><code>def</code>ÂØπÂ∫î<code>m.components[key]</code>Âç≥Ë∑ØÁî±ÁªÑ‰ª∂ÂÆö‰πâ(<code>Foo„ÄÅBar„ÄÅBaz</code>)</li>
<li><code>instance</code>ÂØπÂ∫î<code>m.instances[key]</code>ÊòØ<code>router-view</code>ÁªÑ‰ª∂ÂÆû‰æãÔºåÂÖ≥‰∫éË∑ØÁî±ËÆ∞ÂΩïÂíå<code>route-view</code>ÊòØÂ¶Ç‰ΩïÂÖ≥ËÅîÁöÑÔºå‰ºöÂú®‰ªãÁªç<code>viewÁªÑ‰ª∂</code>Êó∂Ëß£Êûê</li>
<li><code>m</code>ÂØπÂ∫îÁöÑÂ∞±ÊòØÂΩìÂâçÈÅçÂéÜÂà∞ÁöÑË∑ØÁî±ËÆ∞ÂΩï</li>
<li><code>key</code>ÊòØÂΩìÂâçÈÅçÂéÜÂà∞ÁöÑËßÜÂõæÂêç</li>
</ul>
</li>
<li>Â§ß‰ΩìÈÄªËæëÂ¶Ç‰∏ã</li>
<li>flat-map-components.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/flat-map-components.png" alt="flat-map-components.png"></li>
</ul>
</li>
<li>Êàë‰ª¨Áúã‰∏ãÁÆ≠Â§¥ÂáΩÊï∞ÂÜÖÈÉ®ÁöÑÈÄªËæë</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> guards = flatMapComponents(records, (</span><br><span class="line">  def <span class="comment">/*Ë∑ØÁî±ÁªÑ‰ª∂ÂÆö‰πâ*/</span>,</span><br><span class="line">  instance <span class="comment">/*router-viewÂÆû‰æã*/</span>,</span><br><span class="line">  match <span class="comment">/*Ë∑ØÁî±ËÆ∞ÂΩï*/</span>,</span><br><span class="line">  key <span class="comment">/*ËßÜÂõæÂêç*/</span></span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> guard = extractGuard(def, name) <span class="comment">//¬†ÊèêÂèñÂá∫Ë∑ØÁî±ÁªÑ‰ª∂‰∏≠ÁöÑÂÆàÂç´ÂáΩÊï∞ //¬†‰∏∫ÂÆàÂç´ÁªëÂÆö‰∏ä‰∏ãÊñá</span></span><br><span class="line">  <span class="keyword">if</span> (guard) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(guard)</span><br><span class="line">      ? guard.map(<span class="function">(<span class="params">guard</span>) =&gt;</span> bind(guard, instance, match, key))</span><br><span class="line">      : bind(guard, instance, match, key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>È¶ñÂÖàË∞ÉÁî®<code>extractGuard</code>‰ªéË∑ØÁî±ÁªÑ‰ª∂ÂÆö‰πâ‰∏≠Áõ¥Êé•ÊäΩÂèñÂá∫ÂØπÂ∫î<code>name</code>ÁöÑÂÆàÂç´ÂáΩÊï∞</li>
<li>Êé•‰∏ãÊù•Ë∞ÉÁî®‰º†ÂÖ•<code>extractGuards</code>ÁöÑ<code>bind</code>ÊñπÊ≥ï‰∏∫ÂÆàÂç´ÁªëÂÆö‰∏ä‰∏ãÊñá</li>
<li>Êàë‰ª¨Áúã‰∏ã<code>extractGuard</code>ÂÆûÁé∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/base.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊèêÂèñÂçï‰∏™ÂÆàÂç´</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extractGuard</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  def: <span class="built_in">Object</span> | <span class="built_in">Function</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  key: <span class="built_in">string</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">NavigationGuard</span> | <span class="title">Array</span>&lt;<span class="title">NavigationGuard</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> def !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="comment">//¬†extend¬†now¬†so¬†that¬†global¬†mixins¬†are¬†applied.</span></span><br><span class="line">    def = _Vue.extend(def)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> def.options[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>‰∏ªË¶ÅÊúâ‰∏§‰∏™ÈÄªËæë<ul>
<li>Ë∞ÉÁî®<code>extend</code>‰ª•Â∫îÁî®ÂÖ®Â±Ä mixins</li>
<li>ËøîÂõûÂØπÂ∫îÂÆàÂç´ÂáΩÊï∞</li>
</ul>
</li>
<li>ÊèêÂèñÂÆåÂçï‰∏™ÂÆàÂç´ÂêéÔºåÂ∞±ÈúÄË¶ÅË∞ÉÁî®‰º†ÂÖ•ÁöÑ<code>bind</code>ÊñπÊ≥ïÂØπÂÖ∂ÁªëÂÆö‰∏ä‰∏ãÊñáÔºõ</li>
<li><code>bind</code>ÊñπÊ≥ïÂÖ∂ÂÆûÊòØ<code>bindGuard</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Â∞ÜÂÆàÂç´ÁöÑ‰∏ä‰∏ãÊñáÁªëÂÆöÂà∞vueÂÆû‰æã(Ë∑ØÁî±ÁªÑ‰ª∂)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindGuard</span>(<span class="params">guard: NavigationGuard, instance: ?_Vue</span>): ?<span class="title">NavigationGuard</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> /*Â∑≤ÁªèÁªëÂÆöËøá‰∏ä‰∏ãÊñáÁöÑÂÆàÂç´ÂáΩÊï∞*/ <span class="title">boundRouteGuard</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> guard.apply(instance, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÁªèËøá‰∏äÈù¢ÁöÑ‰∏ä‰∏ãÊñáÁªëÂÆöÔºå‰ªéË∑ØÁî±ÁªÑ‰ª∂‰∏≠ÊäΩÂèñÂá∫ÁöÑÂÆàÂç´ÂáΩÊï∞Â∞±ÂèàÂõûÊù•Âà∞Ë∑ØÁî±ÁªÑ‰ª∂‰∏ä‰∏ãÊñá‰∏≠ÊâßË°å‰∫ÜÔºåËøôÊ†∑Â∞±‰øùËØÅ‰∫ÜÂÆàÂç´ÂáΩÊï∞Êó†ËÆ∫Âú®‰ΩïÂ§ÑË¢´Ë∞ÉÁî®ÔºåÈÉΩËÉΩËøîÂõûÊ≠£Á°ÆÁöÑÁªìÊûú</li>
<li>Â∞èÁªì</li>
<li><code>extractGuards</code>‰∏ªË¶ÅÂÆåÊàê‰∫Ü‰ªéË∑ØÁî±ÁªÑ‰ª∂‰∏≠ÊäΩÂèñÂÆàÂç´ÂáΩÊï∞Âπ∂‰∏∫ÂÖ∂ÁªëÂÆö‰∏ä‰∏ãÊñáÁöÑÂ∑•‰Ωú</li>
<li>extract-guards.png<ul>
<li><img src="/2020/12/01/vue-router-analysis-part2/extract-guards.png" alt="extract-guards.png"></li>
</ul>
</li>
<li>Êé•‰∏ãÊù•Êàë‰ª¨Ë¶ÅÂØπÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩïËøõË°åÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑËß£Êûê</li>
<li>‰∏ªË¶ÅÈÄöËøá<code>resolveAsyncComponents</code>ÊñπÊ≥ïÂÆûÁé∞ÁöÑ</li>
</ul>
<h4 id="resolveAsyncComponents"><a href="#resolveAsyncComponents" class="headerlink" title="resolveAsyncComponents"></a>resolveAsyncComponents</h4><ul>
<li>Âú®ÁúãÂ¶Ç‰ΩïËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂ÂâçÔºåÊàë‰ª¨ÂÖàÁúã‰∏ã<code>vue</code>‰∏≠ÁöÑÂºÇÊ≠•ÁªÑ‰ª∂Èïø‰ªÄ‰πàÊ†∑Ôºü</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://cn.vuejs.org/v2/guide/components-dynamic-async.html#ÂºÇÊ≠•ÁªÑ‰ª∂</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Êé•Êî∂resolve,reject</span></span><br><span class="line">Vue.component(<span class="string">'async-example'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//¬†Âêë¬†`resolve`¬†ÂõûË∞É‰º†ÈÄíÁªÑ‰ª∂ÂÆö‰πâ</span></span><br><span class="line">    resolve(&#123;</span><br><span class="line">      template: <span class="string">'&lt;div&gt;I¬†am¬†async!&lt;/div&gt;'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÁªìÂêàrequire‰ΩøÁî®</span></span><br><span class="line">Vue.component(<span class="string">'async-webpack-example'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//¬†Ëøô‰∏™ÁâπÊÆäÁöÑ¬†`require`¬†ËØ≠Ê≥ïÂ∞Ü‰ºöÂëäËØâ¬†webpack</span></span><br><span class="line">  <span class="comment">//¬†Ëá™Âä®Â∞Ü‰Ω†ÁöÑÊûÑÂª∫‰ª£Á†ÅÂàáÂâ≤ÊàêÂ§ö‰∏™ÂåÖÔºåËøô‰∫õÂåÖ</span></span><br><span class="line">  <span class="comment">//¬†‰ºöÈÄöËøá¬†Ajax¬†ËØ∑Ê±ÇÂä†ËΩΩ</span></span><br><span class="line">  <span class="built_in">require</span>([<span class="string">'./my-async-component'</span>], resolve)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÁªìÂêàimport()‰ΩøÁî®</span></span><br><span class="line">Vue.component(</span><br><span class="line">  <span class="string">'async-webpack-example'</span>, <span class="comment">//¬†Ëøô‰∏™Âä®ÊÄÅÂØºÂÖ•‰ºöËøîÂõû‰∏Ä‰∏™¬†`Promise`¬†ÂØπË±°„ÄÇ</span></span><br><span class="line">  () =&gt; <span class="keyword">import</span>(<span class="string">'./my-async-component'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Â±ÄÈÉ®Ê≥®ÂÜå</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="comment">//¬†...</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    <span class="string">'my-component'</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./my-async-component'</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Â∏¶ÊúâÂä†ËΩΩÁä∂ÊÄÅ</span></span><br><span class="line"><span class="keyword">const</span> AsyncComponent = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">  <span class="comment">//¬†ÈúÄË¶ÅÂä†ËΩΩÁöÑÁªÑ‰ª∂¬†(Â∫îËØ•ÊòØ‰∏Ä‰∏™¬†`Promise`¬†ÂØπË±°)</span></span><br><span class="line">  component: <span class="keyword">import</span>(<span class="string">'./MyComponent.vue'</span>), <span class="comment">//¬†ÂºÇÊ≠•ÁªÑ‰ª∂Âä†ËΩΩÊó∂‰ΩøÁî®ÁöÑÁªÑ‰ª∂</span></span><br><span class="line">  loading: LoadingComponent, <span class="comment">//¬†Âä†ËΩΩÂ§±Ë¥•Êó∂‰ΩøÁî®ÁöÑÁªÑ‰ª∂</span></span><br><span class="line">  error: ErrorComponent, <span class="comment">//¬†Â±ïÁ§∫Âä†ËΩΩÊó∂ÁªÑ‰ª∂ÁöÑÂª∂Êó∂Êó∂Èó¥„ÄÇÈªòËÆ§ÂÄºÊòØ¬†200¬†(ÊØ´Áßí)</span></span><br><span class="line">  delay: <span class="number">200</span>, <span class="comment">//¬†Â¶ÇÊûúÊèê‰æõ‰∫ÜË∂ÖÊó∂Êó∂Èó¥‰∏îÁªÑ‰ª∂Âä†ËΩΩ‰πüË∂ÖÊó∂‰∫ÜÔºå //¬†Âàô‰ΩøÁî®Âä†ËΩΩÂ§±Ë¥•Êó∂‰ΩøÁî®ÁöÑÁªÑ‰ª∂„ÄÇÈªòËÆ§ÂÄºÊòØÔºö`Infinity`</span></span><br><span class="line">  timeout: <span class="number">3000</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊñáÊ°£ÂØπÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑÊèèËø∞ÊòØ<code>Vue ÂÖÅËÆ∏‰Ω†‰ª•‰∏Ä‰∏™Â∑•ÂéÇÂáΩÊï∞ÁöÑÊñπÂºèÂÆö‰πâ‰Ω†ÁöÑÁªÑ‰ª∂ÔºåËøô‰∏™Â∑•ÂéÇÂáΩÊï∞‰ºöÂºÇÊ≠•Ëß£Êûê‰Ω†ÁöÑÁªÑ‰ª∂ÂÆö‰πâ</code></li>
<li>ÂèØ‰ª•ÁêÜËß£‰∏∫ÔºöÂºÇÊ≠•ÁªÑ‰ª∂ÊòØ‰∏Ä‰∏™Â∑•ÂéÇÂáΩÊï∞ÔºåÂáΩÊï∞ÂÜÖ<code>resolve„ÄÅreject</code>ÁªÑ‰ª∂ÁöÑÂÆö‰πâ„ÄÅËøîÂõû‰∏Ä‰∏™<code>Promise</code>„ÄÅËøîÂõû‰∏Ä‰∏™Â∏¶ÊúâÁâπÂÆöÊ†áËØÜÂ≠óÊÆµÁöÑÂØπË±°</li>
<li>Ëß£ÊûêË∑ØÁî±ËÆ∞ÂΩï‰∏≠ÁöÑÂºÇÊ≠•ÁªÑ‰ª∂‰ª£Á†Å‰Ωç‰∫é<code>src/util/resolve-components.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/resolve-components.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ëß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂ÔºåËøîÂõû‰∏Ä‰∏™Êé•Êî∂to,¬†from,¬†nextÂèÇÊï∞ÁöÑÂáΩÊï∞</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resolveAsyncComponents</span>(<span class="params">matched: <span class="built_in">Array</span>&lt;RouteRecord&gt;</span>): <span class="title">Function</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> hasAsync = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> pending = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> error = <span class="literal">null</span></span><br><span class="line">    flatMapComponents(matched, (</span><br><span class="line">      <span class="comment">/*Ë∑ØÁî±ÁªÑ‰ª∂ÂÆö‰πâ*/</span> def,</span><br><span class="line">      <span class="comment">/*router-viewÂÆû‰æã*/</span> _,</span><br><span class="line">      <span class="comment">/*Ë∑ØÁî±ËÆ∞ÂΩï*/</span> match,</span><br><span class="line">      <span class="comment">/*ËßÜÂõæÂêç*/</span> key</span><br><span class="line">    ) =&gt; &#123;</span><br><span class="line">      <span class="comment">//¬†if¬†it's¬†a¬†function¬†and¬†doesn't¬†have¬†cid¬†attached,</span></span><br><span class="line">      <span class="comment">//¬†assume¬†it's¬†an¬†async¬†component¬†resolve¬†function.</span></span><br><span class="line">      <span class="comment">//¬†we¬†are¬†not¬†using¬†Vue's¬†default¬†async¬†resolving¬†mechanism¬†because</span></span><br><span class="line">      <span class="comment">//¬†we¬†want¬†to¬†halt¬†the¬†navigation¬†until¬†the¬†incoming¬†component¬†has¬†been</span></span><br><span class="line">      <span class="comment">//¬†resolved.</span></span><br><span class="line">      <span class="comment">//¬†def.cid‰∏∫ÂÆû‰æãÊûÑÈÄ†ÂáΩÊï∞Ê†áËØÜÔºõhttps://github.com/vuejs/vue/search?q=cid&amp;unscoped_q=cid</span></span><br><span class="line">      <span class="comment">//¬†ÁªÑ‰ª∂ÁöÑÂÆö‰πâÊòØÂáΩÊï∞‰∏îÁªÑ‰ª∂cidËøòÊú™ËÆæÁΩÆÔºåÂàôËÆ§‰∏∫ÂÖ∂ÊòØ‰∏Ä‰∏™ÂºÇÊ≠•ÁªÑ‰ª∂</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> def === <span class="string">'function'</span> &amp;&amp; def.cid === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        hasAsync = <span class="literal">true</span></span><br><span class="line">        pending++ <span class="comment">//¬†Ëß£Êûê</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> resolve = once(<span class="function">(<span class="params">resolvedDef</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//¬†Âä†ËΩΩÂêéÁöÑÁªÑ‰ª∂ÂÆö‰πâÊòØ‰∏Ä‰∏™esm</span></span><br><span class="line">          <span class="keyword">if</span> (isESModule(resolvedDef)) &#123;</span><br><span class="line">            resolvedDef = resolvedDef.default</span><br><span class="line">          &#125; <span class="comment">//¬†save¬†resolved¬†on¬†async¬†factory¬†in¬†case¬†it's¬†used¬†elsewhere //¬†‰øùÁïôÂºÇÊ≠•ÁªÑ‰ª∂Â∑•ÂéÇÂáΩÊï∞ÔºåÊñπ‰æøÂêéÁª≠‰ΩøÁî®</span></span><br><span class="line">          def.resolved =</span><br><span class="line">            <span class="keyword">typeof</span> resolvedDef === <span class="string">'function'</span></span><br><span class="line">              ? resolvedDef</span><br><span class="line">              : _Vue.extend(resolvedDef)</span><br><span class="line">          match.components[key] = resolvedDef <span class="comment">//¬†ÊõøÊç¢Ë∑ØÁî±ËÆ∞ÂΩïÁöÑÂëΩÂêçËßÜÂõæ‰∏≠ÁöÑÁªÑ‰ª∂</span></span><br><span class="line">          pending--</span><br><span class="line">          <span class="keyword">if</span> (pending &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//¬†ÊâÄÊúâÂºÇÊ≠•ÁªÑ‰ª∂Âä†ËΩΩÂÆå</span></span><br><span class="line">            next()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;) <span class="comment">//¬†Êä•Èîô</span></span><br><span class="line">        <span class="keyword">const</span> reject = once(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> msg = <span class="string">`Failed¬†to¬†resolve¬†async¬†component¬†<span class="subst">$&#123;key&#125;</span>:¬†<span class="subst">$&#123;reason&#125;</span>`</span></span><br><span class="line">          process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(<span class="literal">false</span>, msg)</span><br><span class="line">          <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">            error = isError(reason) ? reason : <span class="keyword">new</span> <span class="built_in">Error</span>(msg)</span><br><span class="line">            next(error)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;) <span class="comment">//¬†ÂºÇÊ≠•ÁªÑ‰ª∂Ôºåhttps://cn.vuejs.org/v2/guide/components-dynamic-async.html#ÂºÇÊ≠•ÁªÑ‰ª∂</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> res</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          res = def(resolve, reject) <span class="comment">//¬†ËøîÂõûpromise</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> res.then === <span class="string">'function'</span>) &#123;</span><br><span class="line">            res.then(resolve, reject)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//¬†new¬†syntax¬†in¬†Vue¬†2.3</span></span><br><span class="line">            <span class="comment">//¬†Â§ÑÁêÜÂä†ËΩΩÁä∂ÊÄÅÔºåËøîÂõû‰∏Ä‰∏™ÂåÖÂØπË±°Ôºõhttps://cn.vuejs.org/v2/guide/components-dynamic-async.html#Â§ÑÁêÜÂä†ËΩΩÁä∂ÊÄÅ</span></span><br><span class="line">            <span class="keyword">const</span> comp = res.component <span class="comment">//¬†ÊòØÈÄöËøáimport()Âä†ËΩΩÔºåËøîÂõûÁöÑÊòØ‰∏Ä‰∏™promise</span></span><br><span class="line">            <span class="keyword">if</span> (comp &amp;&amp; <span class="keyword">typeof</span> comp.then === <span class="string">'function'</span>) &#123;</span><br><span class="line">              comp.then(resolve, reject)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;) <span class="comment">//¬†Ê≤°ÊúâÂºÇÊ≠•ÁªÑ‰ª∂ÔºåÁõ¥Êé•next</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!hasAsync) next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÖ∂Êé•Êî∂‰∏Ä‰∏™Ë∑ØÁî±ËÆ∞ÂΩïÊï∞ÁªÑ<code>matched</code>ÔºåËøîÂõû‰∏Ä‰∏™Êé•Êî∂<code>from„ÄÅto„ÄÅnext</code>ÁöÑÂáΩÊï∞ÔºåÂÜÖÈÉ®ÊòØÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑËß£ÊûêÈÄªËæë</li>
<li><code>resolveAsyncComponents</code>Ë¢´Ë∞ÉÁî®Êó∂Âπ∂‰∏ç‰ºöÊâßË°åËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑÈÄªËæëÔºåÂõ†‰∏∫ÂÖ∂Âè™‰ºöËøîÂõû‰∏Ä‰∏™ÂáΩÊï∞ÔºåËøîÂõûÁöÑÂáΩÊï∞‰ºöÂú®ËøêË°åÈòüÂàóÊó∂Êâç‰ºöË¢´Ë∞ÉÁî®ÔºåËøôÊó∂Êâç‰ºöËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂</li>
<li>ÈòüÂàóÁöÑËøêË°åÔºåÊàë‰ª¨ÂêéÈù¢ÂÜçÁúãÔºåÊàë‰ª¨ÂÖàÁúã‰∏ãËøîÂõûÁöÑÂáΩÊï∞ÂÜÖÈÉ®ÊòØ‰ªÄ‰πàÈÄªËæë<ul>
<li>ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ÊòØÂê¶ÊúâÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑÊ†áËØÜÂ≠óÊÆµ<code>hasAsync</code>„ÄÅ‰ª•ÂèäÂΩìÂâçÂæÖËß£ÊûêÁöÑÂºÇÊ≠•ÁªÑ‰ª∂Êï∞Èáè<code>pending</code></li>
<li>ÁÑ∂ÂêéË∞ÉÁî®‰∫Ü<code>flatMapComponents</code>ÊãøÂà∞<code>records</code>‰∏≠ÁöÑÊâÄÊúâË∑ØÁî±ÁªÑ‰ª∂ÔºåÂπ∂‰æùÊ¨°Ë∞ÉÁî®‰º†ÂÖ•ÁöÑÂõûË∞ÉÊñπÊ≥ï</li>
<li>ÂõûË∞ÉÊñπÊ≥ï‰ºöÊé•Êî∂Âà∞Ë¢´ÈÅçÂéÜÁöÑË∑ØÁî±ÁªÑ‰ª∂ÔºåÊ≠§Êó∂ÈúÄË¶ÅÂà§Êñ≠Ëøô‰∏™Ë∑ØÁî±ÁªÑ‰ª∂ÊòØÂê¶ÊòØÂºÇÊ≠•ÁªÑ‰ª∂ÔºåÂ¶ÇÊûúÊòØÔºåÂàôÂºÄÂßãÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑËß£ÊûêÔºåÂê¶ÂàôË∑≥Ëøá</li>
<li>Â¶ÇÊûúÈÅçÂéÜÁªìÊùüÂèëÁé∞<code>hasAsync</code>‰ªçÁÑ∂‰∏∫<code>false</code>Ôºå‰ª£Ë°®Ê≤°ÊúâÂºÇÊ≠•ÁªÑ‰ª∂Áõ¥Êé•<code>next()</code>ËøõË°å‰∏ã‰∏ÄÊ≠•Âç≥ÂèØ</li>
</ul>
</li>
<li>Â¶Ç‰ΩïÁ°ÆÂÆöÊüê‰∏™ÁªÑ‰ª∂ÊòØÂê¶ÊòØÂºÇÊ≠•ÁªÑ‰ª∂Âë¢Ôºü<ul>
<li>ÂâçÈù¢Êàë‰ª¨ËØ¥ËøáÔºåÂú®<code>vue</code>‰∏≠ÂºÇÊ≠•ÁªÑ‰ª∂‰∏ÄÂÆöÊòØ‰∏™Â∑•ÂéÇÂáΩÊï∞ÔºåÂÜÖÈÉ®‰ºöË∞ÉÁî®<code>resove„ÄÅreject</code>ÊàñËøîÂõû<code>Promise</code>ÊàñËøîÂõûÁâπÂÆöÊ†ºÂºèÂØπË±°ÔºåÊÄª‰πã‰ªñËÇØÂÆöÊòØ‰∏™ÂáΩÊï∞</li>
<li>ÂÖ∂Ê¨°<code>vue</code>‰∏≠ÊØè‰∏™ÂÆû‰æãÈÉΩ‰ºöÊúâ‰∏™ÂîØ‰∏ÄÊ†áËØÜ<code>cid</code>ÔºåÂ¶ÇÊûúÊúâ<code>cid</code>Â∞±‰ª£Ë°®Â∑≤ÁªèÁîüÊàêÁõ∏Â∫îÂÆû‰æãÔºåÊâÄ‰ª•ÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑ<code>cid</code>‰∏ÄÂÆö‰∏∫<code>undefined</code></li>
<li>ÊâÄ‰ª•Âà§Êñ≠ÊòØÂê¶ÊòØÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑ‰æùÊçÆÂ∞±ÊòØ <code>ÂáΩÊï∞ &amp;&amp; cid === &#39;undefined&#39;</code></li>
</ul>
</li>
<li>Â¶ÇÊûúÂà§Êñ≠ÊòØÂºÇÊ≠•ÁªÑ‰ª∂ÔºåÂàôÂ∞Ü<code>hasAsync</code>ÁΩÆ‰∏∫<code>true</code>Âπ∂ËÆ©<code>pending</code>Ëá™Â¢ûÔºå‰ª£Ë°®ÊúâÂèëÁé∞ÂºÇÊ≠•ÁªÑ‰ª∂ÔºåÂú®Ëß£ÊûêÂÆåÁªÑ‰ª∂Âêé<code>pending</code>Ëá™ÂáèÔºåÂΩì<code>pending&lt;=0</code>Âàô‰ª£Ë°®ÂºÇÊ≠•ÁªÑ‰ª∂Ëß£ÊûêÁªìÊùüÔºåÂèØ‰ª•Ë∞ÉÁî®<code>next</code>ËøõË°å‰∏ã‰∏ÄÊ≠•</li>
<li>ÂâçÈù¢ÊèêËøáÔºå<code>vue</code>ÁöÑÂºÇÊ≠•ÁªÑ‰ª∂Â∑•ÂéÇÂáΩÊï∞‰ºöÊé•Êî∂<code>resolve„ÄÅreject</code>‰∏§‰∏™ÊñπÊ≥ïÂπ∂Âú®‰ªéÊúçÂä°Âô®ÂæóÂà∞ÁªÑ‰ª∂ÂÆö‰πâÂêéË¢´Ë∞ÉÁî®Ôºõ</li>
<li>Âú®Êé•Êî∂Âà∞ÊúçÂä°Âô®ËøîÂõûÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑÂÆö‰πâÊó∂ÔºåËøô‰∏§‰∏™ÊñπÊ≥ï‰ºöË¢´‰º†ÂÖ•ÂºÇÊ≠•ÁªÑ‰ª∂Â∑•ÂéÇÂáΩÊï∞</li>
<li>Áî±‰∫éÂºÇÊ≠•ÁªÑ‰ª∂Â∑•ÂéÇÂáΩÊï∞‰ºöËøîÂõû‰∏Ä‰∏™<code>Promise</code>ÂáΩÊï∞ÊàñÁâπÂÆöÊ†ºÂºèÁöÑÂØπË±°ÔºåÊâÄ‰ª•‰ºöÊúâ‰∏ãÈù¢ÊÉÖÂÜµ<ul>
<li>Â¶ÇÊûúÊòØËøîÂõû<code>Promise</code>ÔºåÂàôÂ∞ÜËøô‰∏§ÊñπÊ≥ïÂÜç‰º†ÂÖ•ËøîÂõûÁöÑ<code>Promise.then</code>‰∏≠</li>
<li>Â¶ÇÊûúËøîÂõûÁâπÂÆöÊ†ºÂºèÂØπË±°ÔºåÂàôÊâæÂà∞<code>component</code>Â≠óÊÆµÔºåÂπ∂Â∞ÜËøô‰∏§ÊñπÊ≥ïÂÜç‰º†ÂÖ•<code>component.then</code>‰∏≠</li>
</ul>
</li>
<li>Áî±‰∫é<code>resolve„ÄÅreject</code>Â∑≤ÁªèË¢´<code>once</code>ÂåÖË£ÖÔºåÂç≥‰Ωø‰º†ÂÖ•Â§öÊ¨°Ôºå‰πüÂè™‰ºöË¢´ÊâßË°å‰∏ÄÊ¨°</li>
<li>Êàë‰ª¨Áúã‰∏ã<code>resolve„ÄÅreject</code>ÊñπÊ≥ï</li>
<li>‰ªñ‰ª¨ÈÉΩË¢´‰∏Ä‰∏™<code>once</code>ÊñπÊ≥ïÂåÖË£π‰ª•‰øùËØÅÂè™‰ºöË¢´ÊâßË°å‰∏ÄÊ¨°</li>
<li><code>reject</code><ul>
<li>Áõ¥Êé•ÊäõÂá∫‰∏Ä‰∏™ÈîôËØØÂπ∂Ë∞ÉÁî®<code>next</code>‰º†ÈÄíÂà∞‰∏ã‰∏ÄÊµÅÁ®ã</li>
</ul>
</li>
<li><code>resolve</code><ul>
<li>ÂÖàÂà§Êñ≠‰∏ãÊòØÂê¶ÊòØ<code>esm</code>ÔºåËã•ÊòØÔºåÂàôÂèñÂÖ∂<code>.default</code>Â≠óÊÆµÊù•Ëé∑ÂèñÁªÑ‰ª∂ÂÆö‰πâ</li>
<li>ÊãøÂà∞ÁªÑ‰ª∂ÂÆö‰πâÂêéÔºå‰ºöÂÖà‰øùÁïôÂºÇÊ≠•ÁªÑ‰ª∂Â∑•ÂéÇÂáΩÊï∞ÔºåÊñπ‰æøÂêéÁª≠‰ΩøÁî®</li>
<li>ÁÑ∂ÂêéÊõøÊç¢Ë∑ØÁî±ËÆ∞ÂΩïÁöÑÂëΩÂêçËßÜÂõæ‰∏≠ÁöÑÂØπÂ∫îÁªÑ‰ª∂ÔºåËøôÂ∞±ÂÆåÊàê‰∫ÜÁªÑ‰ª∂ÁöÑËß£ÊûêÂπ∂ÁªëÂÆöÂà∞Ë∑ØÁî±ËÆ∞ÂΩï‰∏ä</li>
</ul>
</li>
<li>ÂÜçÊ¨°ÈáçÁî≥‰∏äÈù¢ÊèêÂà∞ÁöÑÈÄªËæëÈÉΩÊòØ<code>resolveAsyncComponents</code>ËøîÂõûÁöÑÂáΩÊï∞ÈÄªËæëÔºåËøô‰∏™ÂáΩÊï∞ÈÄªËæë‰ºöÁ≠âÂà∞ÈòüÂàóË¢´ÊâßË°åÊó∂ÊâçÂÆûÈôÖË∞ÉÁî®</li>
<li>Ëá≥Ê≠§ÔºåÊàë‰ª¨ÁöÑÈòüÂàó<code>queue</code>Â∑≤ÁªèÂåÖÂê´‰∫ÜÊäΩÂèñÂá∫Êù•ÁöÑ<code>ÂÆàÂç´„ÄÅÈí©Â≠ê„ÄÅÂåÖÂê´Ëß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂ÈÄªËæëÁöÑÂáΩÊï∞</code></li>
<li>ÈòüÂàóÂ∑≤ÁªèÊûÑÂª∫ÂÆåÊàêÔºå‰∏ãÈù¢Êàë‰ª¨Êù•ÁúãÁúãÂÆÉÊòØÂ¶Ç‰ΩïÊâßË°åÁöÑ</li>
</ul>
<h3 id="ÂÆàÂç´ÈòüÂàóÁöÑÊâßË°å"><a href="#ÂÆàÂç´ÈòüÂàóÁöÑÊâßË°å" class="headerlink" title="ÂÆàÂç´ÈòüÂàóÁöÑÊâßË°å"></a>ÂÆàÂç´ÈòüÂàóÁöÑÊâßË°å</h3><ul>
<li>ÈòüÂàóÁöÑÊâßË°åÊòØÈÄöËøá<code>runQueue„ÄÅiterator</code>Áõ∏‰∫íÈÖçÂêàÊù•ÂÆûÁé∞ÁöÑ</li>
</ul>
<h4 id="runQueue"><a href="#runQueue" class="headerlink" title="runQueue"></a>runQueue</h4><ul>
<li><code>runQueue</code>ÊñπÊ≥ï‰Ωç‰∫é<code>src/util/async.js</code></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/util/async.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*¬†@flow¬†*/</span></span><br><span class="line"><span class="comment">//¬†ÈòüÂàóÊâßË°åÂáΩÊï∞</span></span><br><span class="line"><span class="comment">//¬†queue¬†ÈúÄË¶ÅÊâßË°åÁöÑÈòüÂàó</span></span><br><span class="line"><span class="comment">//¬†fn¬†Ëø≠‰ª£ÂáΩÊï∞</span></span><br><span class="line"><span class="comment">//¬†cb¬†ÂõûË∞ÉÂáΩÊï∞</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runQueue</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  queue: <span class="built_in">Array</span>&lt;?NavigationGuard&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  fn: <span class="built_in">Function</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  cb: <span class="built_in">Function</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> step = <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//¬†ÂÖ®ÈÉ®ÊâßË°åÂÆåÔºåÊâßË°åÂõûË∞É</span></span><br><span class="line">    <span class="keyword">if</span> (index &gt;= queue.length) &#123;</span><br><span class="line">      cb()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//¬†Â≠òÂú®ÔºåÊâßË°åËø≠‰ª£ÂáΩÊï∞</span></span><br><span class="line">      <span class="keyword">if</span> (queue[index]) &#123;</span><br><span class="line">        fn(</span><br><span class="line">          queue[index],</span><br><span class="line">          <span class="comment">/*¬†next*/</span> () =&gt; &#123;</span><br><span class="line">            step(index + <span class="number">1</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//¬†Âê¶ÂàôÔºåË∑≥Âà∞‰∏ã‰∏™ÊâßË°å</span></span><br><span class="line">        step(index + <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  step(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÆÉÊé•Êî∂‰∏Ä‰∏™ÈòüÂàó<code>queue</code>„ÄÅ‰∏Ä‰∏™Ëø≠‰ª£ÂáΩÊï∞<code>fn</code>„ÄÅ‰∏Ä‰∏™ÊâßË°åÂÆåÊØïÁöÑÂõûË∞ÉÂáΩÊï∞<code>cb</code></li>
<li>ÂÜÖÈÉ®ÊòØ‰∏Ä‰∏™ÈÄíÂΩíÁöÑÂÆûÁé∞</li>
<li>ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™<code>step</code>ÂáΩÊï∞Âπ∂Êé•Êî∂‰∏Ä‰∏™Ê†áËØÜÈòüÂàóÊâßË°åÊ≠•È™§ÁöÑ<code>index</code></li>
<li>ÂøÖÈ°ªÈÄöËøáÊâãÂä®Ë∞ÉÁî®<code>step</code>ÊâçËÉΩË∑≥Âà∞‰∏ã‰∏Ä‰∏™ÈòüÂàóÈ°πÁöÑÊâßË°å<ul>
<li>Âú®Ëß£ÊûêÁªÑ‰ª∂Êó∂‰ºöÁî®Âà∞</li>
</ul>
</li>
<li>ÂΩì<code>index</code>Â§ß‰∫éÁ≠â‰∫éÈòüÂàóÁöÑÈïøÂ∫¶Êó∂(ÈÄíÂΩíÁöÑÁªìÊùüÊù°‰ª∂)Ôºå‰ª£Ë°®ÈòüÂàóÈ°πÂÖ®ÊâßË°åÂÆåÊØïÔºåÂèØ‰ª•Ë∞ÉÁî®<code>cb</code></li>
<li>Âê¶ÂàôÔºåËã•ËøòÊúâÈòüÂàóÈ°πÔºåÂàôÁªßÁª≠Ë∞ÉÁî®Ëø≠‰ª£ÂáΩÊï∞<code>fn</code>Âπ∂‰º†ÂÖ•ÈòüÂàóÈ°πÂíåË∑≥ËΩ¨‰∏ã‰∏™ÈòüÂàóÈ°πÁöÑ<code>step(index + 1)</code>ÂáΩÊï∞</li>
<li>Ëã•Êó†ÈòüÂàóÈ°π‰∫ÜÔºåÂàôÁõ¥Êé•Ë∑≥Âà∞‰∏ã‰∏™ÈòüÂàóÈ°πÁöÑÊâßË°å</li>
<li>ÈÄíÂΩíÈÄöËøá<code>step(0)</code>Êù•ÊøÄÊ¥ª</li>
</ul>
<h4 id="iterator"><a href="#iterator" class="headerlink" title="iterator"></a>iterator</h4><ul>
<li>Ëø≠‰ª£Âô®Áõ∏ÂÖ≥‰ª£Á†ÅÂ•Ω‰∏ã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†Ëø≠‰ª£ÂáΩÊï∞</span></span><br><span class="line"><span class="keyword">const</span> iterator = <span class="function">(<span class="params">hook: NavigationGuard, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.pending !== route) &#123;</span><br><span class="line">    <span class="comment">//¬†ÂΩìÂèëÁé∞toÂèëÁîüÂèòÂåñÔºåÂàô‰ª£Ë°®ÈúÄË¶ÅÂèñÊ∂à</span></span><br><span class="line">    <span class="keyword">return</span> abort()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    hook(</span><br><span class="line">      <span class="comment">/*¬†to*/</span> route,</span><br><span class="line">      <span class="comment">/*¬†from*/</span> current,</span><br><span class="line">      <span class="comment">/*¬†next*/</span> (to: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (to === <span class="literal">false</span> || isError(to)) &#123;</span><br><span class="line">          <span class="comment">//¬†next(false)¬†-&gt;¬†abort¬†navigation,¬†ensure¬†current¬†URL</span></span><br><span class="line">          <span class="comment">//¬†next(false)¬†-&gt;¬†ÂèñÊ∂àË∑≥ËΩ¨ÔºåÊ∑ªÂä†‰∏Ä‰∏™Êñ∞ÂéÜÂè≤ËÆ∞ÂΩï(‰ΩÜÁî±‰∫éurlÂú∞ÂùÄÊú™ÂèëÁîüÂèòÂåñÔºåÊâÄ‰ª•Âπ∂Êú™Ê∑ªÂä†ËÆ∞ÂΩï)</span></span><br><span class="line">          <span class="keyword">this</span>.ensureURL(<span class="literal">true</span>)</span><br><span class="line">          abort(to)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">          <span class="keyword">typeof</span> to === <span class="string">'string'</span> || <span class="comment">//¬†next('/')</span></span><br><span class="line">          (<span class="keyword">typeof</span> to === <span class="string">'object'</span> &amp;&amp;</span><br><span class="line">            (<span class="keyword">typeof</span> to.path === <span class="string">'string'</span> || <span class="keyword">typeof</span> to.name === <span class="string">'string'</span>))</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="comment">//¬†next(&#123;path:'/'&#125;)Êàñnext(&#123;name:'Home'&#125;)</span></span><br><span class="line">          <span class="comment">//¬†next('/')¬†or¬†next(&#123;¬†path:¬†'/'¬†&#125;)¬†-&gt;¬†redirect</span></span><br><span class="line">          abort() <span class="comment">//¬†ÂèñÊ∂àÂΩìÂâç</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> to === <span class="string">'object'</span> &amp;&amp; to.replace) &#123;</span><br><span class="line">            <span class="comment">//¬†Ë∞ÉÁî®Â≠êÁ±ªÊñπÊ≥ïÁöÑÊõøÊç¢ËÆ∞ÂΩï</span></span><br><span class="line">            <span class="keyword">this</span>.replace(to)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//¬†Ë∞ÉÁî®Â≠êÁ±ªÊñπÊ≥ïÁöÑÊ∑ªÂä†ËÆ∞ÂΩï</span></span><br><span class="line">            <span class="keyword">this</span>.push(to)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//¬†confirm¬†transition¬†and¬†pass¬†on¬†the¬†value</span></span><br><span class="line">          <span class="comment">//¬†next()</span></span><br><span class="line">          next(to)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    abort(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÖ∂Êé•Êî∂‰∏Ä‰∏™<code>hook</code>‰πüÂ∞±ÊòØÂÆàÂç´ÈòüÂàó‰∏≠ÁöÑÂÆàÂç´„ÄÅÈí©Â≠êÂáΩÊï∞Âíå<code>next</code>ÂáΩÊï∞(<code>runQueue‰º†ÈÄíËøáÊù•ÁöÑstepÂáΩÊï∞</code>)</li>
<li>ÂΩìÂú®ÊâßË°åÁöÑËøáÁ®ã‰∏≠ÔºåË∑ØÁî±ÂèëÁîüÂèòÂåñÔºå‰ºöÁ´ãÂç≥ÂèñÊ∂à</li>
<li>ÁÑ∂ÂêéÂ∞ùËØïË∞ÉÁî®<code>hook</code>ÔºåÂπ∂‰º†ÂÖ•ÁõÆÊ†áË∑ØÁî±ÂØπË±°„ÄÅÂΩìÂâçË∑ØÁî±ÂØπË±°„ÄÅ‰ª•Âèä‰∏Ä‰∏™Êé•Êî∂<code>to</code>ÁöÑÁÆ≠Â§¥ÂáΩÊï∞</li>
<li>ÂÖ∂ÂÆûËøô‰∏â‰∏™ÂèÇÊï∞Â∞±ÂØπÂ∫îÂÆàÂç´‰ºöÊé•Êî∂Âà∞ÁöÑ<code>from„ÄÅto„ÄÅnext</code>‰∏â‰∏™ÂèÇÊï∞</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Êàë‰ª¨Áü•ÈÅìÂÆàÂç´ÁöÑ<code>next</code>ÊòØ‰∏Ä‰∏™<code>function</code>ÔºåÂπ∂ËÉΩÊé•Êî∂‰∏ãÈù¢Âá†ÁßçÂèÇÊï∞‰ª•Êª°Ë∂≥‰∏çÂêåÁöÑË∑ØÁî±Ë∑≥ËΩ¨ÈúÄÊ±Ç<ul>
<li><code>next()</code>: ËøõË°åÁÆ°ÈÅì‰∏≠ÁöÑ‰∏ã‰∏Ä‰∏™Èí©Â≠ê„ÄÇ</li>
<li><code>next(false)</code>: ‰∏≠Êñ≠ÂΩìÂâçÁöÑÂØºËà™„ÄÇ</li>
<li><code>next(&#39;/&#39;)</code>  ÊàñËÄÖ  <code>next({ path: &#39;/&#39; })</code>: Ë∑≥ËΩ¨Âà∞‰∏Ä‰∏™‰∏çÂêåÁöÑÂú∞ÂùÄ„ÄÇÂΩìÂâçÁöÑÂØºËà™Ë¢´‰∏≠Êñ≠ÔºåÁÑ∂ÂêéËøõË°å‰∏Ä‰∏™Êñ∞ÁöÑÂØºËà™„ÄÇ‰Ω†ÂèØ‰ª•Âêë  next  ‰º†ÈÄí‰ªªÊÑè‰ΩçÁΩÆÂØπË±°Ôºå‰∏îÂÖÅËÆ∏ËÆæÁΩÆËØ∏Â¶Ç  replace: true„ÄÅname: ‚Äòhome‚Äô  ‰πãÁ±ªÁöÑÈÄâÈ°π‰ª•Âèä‰ªª‰ΩïÁî®Âú®  router-link  ÁöÑ  to prop  Êàñ  router.push  ‰∏≠ÁöÑÈÄâÈ°π„ÄÇ</li>
<li><code>next(error)</code>: (2.4.0+) Â¶ÇÊûú‰º†ÂÖ•  next  ÁöÑÂèÇÊï∞ÊòØ‰∏Ä‰∏™  Error  ÂÆû‰æãÔºåÂàôÂØºËà™‰ºöË¢´ÁªàÊ≠¢‰∏îËØ•ÈîôËØØ‰ºöË¢´‰º†ÈÄíÁªô  router.onError()  Ê≥®ÂÜåËøáÁöÑÂõûË∞É„ÄÇ</li>
</ul>
</li>
<li>‰∏äÈù¢Êé•Êî∂<code>to</code>ÁöÑÁÆ≠Â§¥ÂáΩÊï∞Â∞±Â§ÑÁêÜ‰∫Ü‰∏äËø∞Âá†ÁßçÂú∫ÊôØ</li>
<li>ÈòüÂàó‰∏≠ÁöÑÊØè‰∏ÄÈ°πÈÉΩ‰ºöÂú®<code>iterator</code>‰∏≠Ë¢´Ë∞ÉÁî®‰∏ÄÊ¨°Âπ∂ÈÄöËøá<code>next()</code>Âà∞Ë∑≥ËΩ¨Âà∞‰∏ã‰∏Ä‰∏™ÈòüÂàóÈ°πÁöÑÊâßË°å</li>
<li>‰∫ÜËß£‰∫Ü<code>runQueue„ÄÅiterator</code>ÂêéÔºåÊàë‰ª¨ÂÜçÊù•ÁúãÁúãÈòüÂàóÂÆûÈôÖÊâßË°åÁöÑ‰ª£Á†ÅÊòØ‰ªÄ‰πàÊ†∑ÁöÑ</li>
</ul>
<h4 id="ÈòüÂàóÊâßË°å"><a href="#ÈòüÂàóÊâßË°å" class="headerlink" title="ÈòüÂàóÊâßË°å"></a>ÈòüÂàóÊâßË°å</h4><ul>
<li>ÈòüÂàóÊâßË°åÁöÑÂÆåÊï¥‰ª£Á†ÅÂ¶Ç‰∏ã</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊâßË°åÈòüÂàó</span></span><br><span class="line">runQueue(</span><br><span class="line">  queue,</span><br><span class="line">  iterator,</span><br><span class="line">  <span class="comment">/*¬†ÊâßË°åÁªìÊùüÂõûË∞É*/</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> postEnterCbs = [] <span class="comment">//¬†‰øùÂ≠òbeforeRouteEnter‰∏≠‰º†ÁªônextÁöÑÂõûË∞ÉÂáΩÊï∞</span></span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.current === route <span class="comment">//¬†Ë°®Á§∫Ë∑≥ËΩ¨ÁªìÊùü //¬†wait¬†until¬†async¬†components¬†are¬†resolved¬†before //¬†extracting¬†in-component¬†enter¬†guards</span></span><br><span class="line">    <span class="keyword">const</span> enterGuards = extractEnterGuards(activated, postEnterCbs, isValid) <span class="comment">//¬†Á≠âÂæÖÂºÇÊ≠•ÁªÑ‰ª∂Ëß£ÊûêÂÆåÔºåÂÜçÊäΩÂèñÁªÑ‰ª∂ÂÜÖÁöÑbeforeRouteEnterÂÆàÂç´</span></span><br><span class="line">    <span class="keyword">const</span> queue = enterGuards.concat(<span class="keyword">this</span>.router.resolveHooks) <span class="comment">//¬†beforeResolve¬†hooks</span></span><br><span class="line">    runQueue(</span><br><span class="line">      queue,</span><br><span class="line">      iterator,</span><br><span class="line">      <span class="comment">/*¬†ÊâßË°åÁªìÊùüÂõûË∞É*/</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.pending !== route) &#123;</span><br><span class="line">          <span class="keyword">return</span> abort()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.pending = <span class="literal">null</span></span><br><span class="line">        onComplete(route) <span class="comment">//¬†ÊâßË°åonCompleteÂõûË∞ÉÔºåonComplete‰∏≠‰ºöË∞ÉÁî®updateRouteÊñπÊ≥ïÔºåÂÜÖÈÉ®‰ºöËß¶ÂèëafterEachÈí©Â≠ê</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.router.app) &#123;</span><br><span class="line">          <span class="keyword">this</span>.router.app.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//¬†Ë∞ÉÁî®¬†beforeRouteEnter¬†ÂÆàÂç´‰∏≠‰º†Áªô¬†next¬†ÁöÑÂõûË∞ÉÂáΩÊï∞</span></span><br><span class="line">            <span class="comment">//¬†next(vm=&gt;xxx)</span></span><br><span class="line">            postEnterCbs.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">              cb()</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞Ôºå‰º†ÂÖ•‰∫ÜÈòüÂàó<code>queue</code>„ÄÅËø≠‰ª£Âô®<code>iterator</code>‰ª•Âèä‰∏Ä‰∏™ÂÖ®ÈÉ®ÊâßË°åÁªìÊùüÁöÑÂõûË∞ÉÂáΩÊï∞</li>
<li>ÂÖàÂõûÈ°æ‰∏ã<code>queue</code>ÈòüÂàó‰∏≠ÊúâÂì™‰∫õÂÖÉÁ¥†<ul>
<li><code>beforeRouteLeaveÂÆàÂç´</code></li>
<li>ÂÖ®Â±ÄÁöÑ<code>beforeEachÂÆàÂç´</code></li>
<li><code>beforeRouteUpdateÂÆàÂç´</code></li>
<li><code>beforeEnterÂÆàÂç´</code></li>
<li>‰ª•Âèä‰∏Ä‰∏™È´òÈò∂ÂáΩÊï∞ÔºåÊâßË°åÂêé‰ºöËøîÂõûËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑÂáΩÊï∞</li>
</ul>
</li>
<li>ÈòüÂàó‰∏≠ÁöÑÂáΩÊï∞‰ºöÂú®ÈòüÂàóÊâßË°åÊó∂‰æùÊ¨°Âú®<code>iterator</code>‰∏≠Ë¢´Ë∞ÉÁî®</li>
<li>ÂâçÈù¢Âá†‰∏™ÈÉΩÊòØÂ∑≤ÁªèÊèêÂèñÂá∫Êù•ÁöÑÂÆàÂç´ÂáΩÊï∞ÔºåÂèØ‰ª•ÂêåÊ≠•ÊâßË°å</li>
<li>‰ΩÜÊòØÊúÄÂêé‰∏Ä‰∏™È´òÈò∂ÂáΩÊï∞ÊâßË°åÂêéÔºå‰ºöËøîÂõû‰∏Ä‰∏™Ëß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑÂáΩÊï∞</li>
<li>ÂÖ∂ÂÄüÂä©Èó≠ÂåÖÁöÑÁâπÊÄßÔºåËÉΩËÆøÈóÆ‰ªé<code>iterator</code>‰∏≠‰º†ÂÖ•ÁöÑ<code>from„ÄÅto„ÄÅnext</code></li>
<li>ÁÑ∂ÂêéÂú®Ëß£ÊûêÂÆåÂºÇÊ≠•ÁªÑ‰ª∂ÂêéË∞ÉÁî®<code>next</code>ÔºåËøõÂÖ•ÈòüÂàó‰∏ã‰∏ÄÈ°πÁöÑÊâßË°å</li>
<li>ËøôÊ†∑Â∞±ËÉΩ‰øùËØÅÔºåÂç≥‰ΩøÈòüÂàó‰∏≠ÊúâÂºÇÊ≠•ÂáΩÊï∞Ôºå‰πüËÉΩÈ°∫Â∫èÂú∞Â∞ÜÈòüÂàóÊâßË°åÂÆå</li>
<li>Âú®Êï¥‰∏™ÂÆàÂç´ÈòüÂàóÊâßË°åÂÆåÂêéÔºåÂ∞±‰ºöÊâßË°åÁªìÊùüÂõûË∞É</li>
<li>ÊâßË°åÁªìÊùüÂõûË∞ÉÊó∂ÔºåÊ≠§Êó∂ÂºÇÊ≠•ÁªÑ‰ª∂Â∑≤ÁªèÂÖ®ÈÉ®Ëß£ÊûêÂÆåÊØïÔºåÂ∞±ÂèØ‰ª•ÊäΩÂèñ<code>beforeRouteEnter</code>‰∫Ü</li>
</ul>
<h4 id="ÊäΩÂèñ-beforeRouteEnter"><a href="#ÊäΩÂèñ-beforeRouteEnter" class="headerlink" title="ÊäΩÂèñ beforeRouteEnter"></a>ÊäΩÂèñ beforeRouteEnter</h4><ul>
<li>ÊäΩÂèñ<code>beforeRouteEnter</code>ÂíåÂÖ∂ÂÆÉÂÆàÂç´Á®çÂæÆÊúâÁÇπ‰∏çÂêå</li>
<li><ol>
<li>Âõ†‰∏∫<code>beforeRouteEnter</code>ÊâÄÂú®ÁöÑÁªÑ‰ª∂ÂèØËÉΩÊòØÂºÇÊ≠•ÁöÑÔºåÊâÄ‰ª•<code>beforeRouteEnter</code>ÂøÖÈ°ªÁ≠âÂà∞ÂºÇÊ≠•ÁªÑ‰ª∂Ëß£ÊûêÂÆåÊØïÊâçËÉΩÂºÄÂßãÊäΩÂèñ</li>
</ol>
</li>
<li><ol start="2">
<li>ËøòÊúâ‰∏Ä‰∏™‰∏çÂêåÔºåÂ∞±ÊòØÂú®Ë∑ØÁî±ËøáÊ∏°Âä®Áîª‰∏∫<code>out-in</code>Êó∂ÔºåÂºÇÊ≠•ÁªÑ‰ª∂ÂèØËÉΩÂ∑≤ÁªèËß£ÊûêÂÆåÊØï‰∫ÜÔºå‰ΩÜÊòØ<code>router-view</code>ÂÆû‰æãÂèØËÉΩËøòÊú™Ê≥®ÂÜåÔºåÊ≠§Êó∂ÊòØ‰∏çËÉΩË∞ÉÁî®<code>beforeRouteEnter</code>ÁöÑÔºõÂÖ∑‰ΩìËßÅ<a href="https://github.com/vuejs/vue-router/issues/750" target="_blank" rel="noopener">issue #750</a></li>
</ol>
</li>
<li>Âõ†‰∏∫<code>beforeRouteEnter</code>ÊîØÊåÅ‰º†‰∏Ä‰∏™ÂõûË∞ÉÁªô<code>next</code>Êù•ËÆøÈóÆÁªÑ‰ª∂ÂÆû‰æãÔºåÂ∞±ÂÉè‰∏ãÈù¢ËøôÊ†∑</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">  next(<span class="comment">/*postEnterCb*/</span><span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ÈÄöËøá `vm` ËÆøÈóÆÁªÑ‰ª∂ÂÆû‰æã</span></span><br><span class="line">  &#125;)&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ËÄåËøô‰∏™<code>vm</code>ÊòØ‰øùÂ≠òÂú®<code>router-view</code>ÂÆû‰æã‰∏äÁöÑÔºåÊâÄ‰ª•ÈúÄË¶ÅÁ≠âÂà∞<code>router-view</code>ÂÆû‰æãÂ≠òÂú®Êó∂ÔºåÊâçËÉΩË∞ÉÁî®ÂõûË∞É</li>
<li>Êàë‰ª¨Áúã‰∏ã‰ª£Á†ÅÂÆûÁé∞</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/history/base.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span>¬†postEnterCbs¬†=¬†[]¬†<span class="comment">//¬†‰øùÂ≠òbeforeRouteEnter‰∏≠‰º†ÁªônextÁöÑÂõûË∞ÉÂáΩÊï∞</span></span><br><span class="line"><span class="keyword">const</span>¬†isValid¬†=¬†<span class="function"><span class="params">()</span>¬†=&gt;</span>¬†<span class="keyword">this</span>.current¬†===¬†route¬†<span class="comment">//¬†Ë°®Á§∫Ë∑≥ËΩ¨ÁªìÊùü</span></span><br><span class="line"><span class="comment">//¬†wait¬†until¬†async¬†components¬†are¬†resolved¬†before</span></span><br><span class="line"><span class="comment">//¬†extracting¬†in-component¬†enter¬†guards</span></span><br><span class="line"><span class="keyword">const</span>¬†enterGuards¬†=¬†extractEnterGuards(activated,¬†postEnterCbs,¬†isValid)¬†<span class="comment">//¬†Á≠âÂæÖÂºÇÊ≠•ÁªÑ‰ª∂Ëß£ÊûêÂÆåÔºåÂÜçÊäΩÂèñÁªÑ‰ª∂ÂÜÖÁöÑbeforeRouteEnterÂÆàÂç´</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÊèêÂèñÁªÑ‰ª∂ÁöÑbeforeRouteEnterÂÆàÂç´</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>¬†<span class="title">extractEnterGuards</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†activated:¬†<span class="built_in">Array</span>&lt;RouteRecord&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†cbs:¬†<span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;,¬†<span class="comment">//¬†postEnterCbs</span></span></span></span><br><span class="line">¬†¬†isValid:¬†()¬†=&gt;¬†boolean</span><br><span class="line">):¬†<span class="built_in">Array</span>&lt;?<span class="built_in">Function</span>&gt;¬†&#123;</span><br><span class="line">¬†¬†<span class="keyword">return</span>¬†extractGuards(</span><br><span class="line">¬†¬†¬†¬†activated,</span><br><span class="line">¬†¬†¬†¬†<span class="string">'beforeRouteEnter'</span>,</span><br><span class="line">¬†¬†¬†¬†(guard,¬†_,¬†match,¬†key)¬†=&gt;¬†&#123;¬†<span class="comment">/*¬†ÁªëÂÆöbeforeRouteEnterÁöÑÊâßË°å‰∏ä‰∏ãÊñá¬†*/</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">return</span>¬†bindEnterGuard(guard,¬†match,¬†key,¬†cbs,¬†isValid)</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ÁªëÂÆöbeforeRouteEnterÁöÑÊâßË°å‰∏ä‰∏ãÊñá</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>¬†<span class="title">bindEnterGuard</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†guard:¬†NavigationGuard,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†match:¬†RouteRecord,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†key:¬†<span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†cbs:¬†<span class="built_in">Array</span>&lt;<span class="built_in">Function</span>&gt;,¬†<span class="comment">//¬†postEnterCbs</span></span></span></span><br><span class="line">¬†¬†isValid:¬†()¬†=&gt;¬†boolean</span><br><span class="line">):¬†NavigationGuard¬†&#123;</span><br><span class="line">¬†¬†<span class="comment">//¬†ÂØπÁªÑ‰ª∂ÂÜÖÁöÑbeforeRouteEnterËøõË°å‰∫ÜÂåÖË£Ö</span></span><br><span class="line">¬†¬†<span class="keyword">return</span>¬†<span class="function"><span class="keyword">function</span>¬†<span class="title">routeEnterGuard</span>¬†(<span class="params">to,¬†<span class="keyword">from</span>,¬†next</span>)¬†</span>&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="comment">//¬†Ë∞ÉÁî®ÁªÑ‰ª∂ÂÜÖbeforeRouteEnterÂÆàÂç´</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">return</span>¬†guard(to,¬†<span class="keyword">from</span>,¬†<span class="comment">/*¬†beforeRouteEnter¬†nextÂáΩÊï∞Ôºõcb‰∏∫next‰∏≠ÂõûË∞É*/</span><span class="function"><span class="params">cb</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="keyword">if</span>¬†(<span class="keyword">typeof</span>¬†cb¬†===¬†<span class="string">'function'</span>)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†cbs.push(<span class="function"><span class="params">()</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†#750</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†if¬†a¬†router-view¬†is¬†wrapped¬†with¬†an¬†out-in¬†transition,</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†the¬†instance¬†may¬†not¬†have¬†been¬†registered¬†at¬†this¬†time.</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†we¬†will¬†need¬†to¬†poll¬†for¬†registration¬†until¬†current¬†route</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†is¬†no¬†longer¬†valid.</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Â¶ÇÊûúrouter-viewË¢´out-in¬†transitionÂåÖË£π</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Âú®Á°ÆËÆ§Ë∑ØÁî±ÔºåÂáÜÂ§áË∞ÉÁî®beforeRouteEnterÂÆàÂç´Êó∂Ôºårouter-viewÂÆû‰æãÂèØËÉΩËøò‰∏çÂ≠òÂú®</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†‰ΩÜÊòØÊ≠§Êó∂this.currentÂ∑≤Áªè‰∏∫to</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="comment">//¬†ÊâÄ‰ª•ÂøÖÈ°ªËΩÆËØ¢Ë∞ÉÁî®cbÁõ¥Âà∞instanceÂ≠òÂú®</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†poll(cb,¬†match.instances,¬†key,¬†isValid)</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="comment">//¬†Ëø≠‰ª£Âô®‰∏ãÊ≠•</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†next(cb)</span><br><span class="line">¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//¬†ËΩÆËØ¢Ë∞ÉÁî®cb</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>¬†<span class="title">poll</span>¬†(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†cb:¬†<span class="built_in">any</span>,¬†<span class="comment">/*¬†cb‰∏∫beforeRouteEnter¬†next‰∏≠ÂõûË∞É*/</span>¬†<span class="comment">//¬†somehow¬†flow¬†cannot¬†infer¬†this¬†is¬†a¬†function</span></span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†instances:¬†<span class="built_in">Object</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">¬†¬†key:¬†<span class="built_in">string</span>,</span></span></span><br><span class="line">¬†¬†isValid:¬†()¬†=&gt;¬†boolean</span><br><span class="line">)¬†&#123;</span><br><span class="line">¬†¬†<span class="keyword">if</span>¬†(</span><br><span class="line">¬†¬†¬†¬†instances[key]¬†&amp;&amp;</span><br><span class="line">¬†¬†¬†¬†!instances[key]._isBeingDestroyed¬†<span class="comment">//¬†do¬†not¬†reuse¬†being¬†destroyed¬†instance</span></span><br><span class="line">¬†¬†)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†cb(instances[key])</span><br><span class="line">¬†¬†&#125;¬†<span class="keyword">else</span>¬†<span class="keyword">if</span>¬†(isValid())¬†&#123;</span><br><span class="line">¬†¬†¬†¬†setTimeout(<span class="function"><span class="params">()</span>¬†=&gt;</span>¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†poll(cb,¬†instances,¬†key,¬†isValid)</span><br><span class="line">¬†¬†¬†¬†&#125;,¬†<span class="number">16</span>)</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞Âú®Ë∞ÉÁî®<code>extractEnterGuards</code>Ââç</li>
<li>Âú®Â§ñÂ±ÇÂ£∞Êòé‰∫Ü‰∏Ä‰∏™<code>postEnterCbs</code>Êï∞ÁªÑ<ul>
<li>Áî®Êù•‰øùÂ≠ò<code>beforeRouteEnter‰∏≠‰º†ÁªônextÁöÑÂõûË∞ÉÂáΩÊï∞</code>ÔºåÊàë‰ª¨Áß∞‰∏∫<code>postEnterCb</code>Ôºå‰πüÂ∞±ÊòØËøõÂÖ•ÂêéÁöÑÂõûË∞É</li>
</ul>
</li>
<li>‰ª•Âèä‰∏Ä‰∏™Âà§Êñ≠Ë∑≥ËΩ¨ÊòØÂê¶ÁªìÊùüÁöÑ<code>isValid</code>ÂáΩÊï∞</li>
<li><code>isValid</code>ÂáΩÊï∞‰ºöË¢´‰º†ÂÖ•<code>extractEnterGuards</code>‰∏≠</li>
<li><code>extractEnterGuards</code>‰∏≠ÈÄöËøáÈ´òÈò∂ÂáΩÊï∞ÂΩ¢ÂºèËøîÂõû‰∏Ä‰∏™ÂåÖË£Ö‰∫Ü<code>beforeRouteEnter</code>ÁöÑÂÖ∑ÂêçÂáΩÊï∞<code>routeEnterGuard</code>ÔºåÂÖ∂‰ºöÂú®ÊâßË°åÈòüÂàóÊó∂Ë¢´Ë∞ÉÁî®ÔºåÂπ∂ÊâßË°åÁúüÊ≠£ÁöÑ<code>beforeRouteEnter</code>ÂÆàÂç´<code>guard</code></li>
<li><code>guard</code>Âú®Ë¢´ÊâßË°åÊó∂Ôºå‰ºöÊé•Êî∂<code>from„ÄÅto</code>‰ª•Âèä‰∏Ä‰∏™Ë¢´‚ÄôÊîπÈÄ†‚ÄôËøáÁöÑ<code>next</code>ÔºåÂÖ∂Êé•Êî∂‰∏Ä‰∏™<code>postEnterCb</code></li>
<li>Ëøô‰∏™<code>postEnterCb</code>ÂèØËÉΩÂú®Â∞ÜÊù•ÈúÄË¶ÅËÆøÈóÆ<code>vm</code></li>
<li>ÊâÄ‰ª•Â∞Ü<code>postEnterCb</code>Áî®<code>poll</code>ÊñπÊ≥ïÂåÖË£πÂ°ûÂÖ•Âú®Â§ñÈù¢ÂÆö‰πâÂ•ΩÁöÑ<code>postEnterCbs</code>Êï∞ÁªÑ‰∏≠</li>
<li><code>poll</code>ÊñπÊ≥ï‰∏ªË¶ÅÊòØÁî®Êù•Ëß£ÂÜ≥ÂâçÈù¢ÊèêÂà∞ÁöÑ<code>issue #750</code>ÁöÑÔºåÂÆÉ‰ºö‰∏ÄÁõ¥ËΩÆËØ¢ÔºåÁõ¥Âà∞<code>router-view</code>ÂÆû‰æãÂ≠òÂú®Êó∂ÔºåÂÜçË∞ÉÁî®<code>postEnterCb</code>Âπ∂‰º†ÂÖ•ÊåÇËΩΩÂà∞<code>router-view</code>‰∏äÁöÑÁªÑ‰ª∂ÂÆû‰æã</li>
<li>ËøôÊ†∑Â∞±ÂÆûÁé∞‰∫Ü<code>next</code>‰∏≠ËÉΩËÆøÈóÆÂà∞ÁªÑ‰ª∂ÂÆû‰æãÁöÑÈÄªËæë</li>
<li>ÊäΩÂèñÂÆå<code>beforeRouteEnter</code>ÂÆàÂç´ÂíåÂÖ∂‰∏≠ÁöÑ<code>postEnterCbs</code>ÂêéÔºåÂèàÂú®<code>queue</code>ÂêéÊãºÊé•‰∫Ü<code>beforeResolve</code>ÂÆàÂç´</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> enterGuards = extractEnterGuards(activated, postEnterCbs, isValid) <span class="comment">//¬†Á≠âÂæÖÂºÇÊ≠•ÁªÑ‰ª∂Ëß£ÊûêÂÆåÔºåÂÜçÊäΩÂèñÁªÑ‰ª∂ÂÜÖÁöÑbeforeRouteEnterÂÆàÂç´</span></span><br><span class="line"><span class="keyword">const</span> queue = enterGuards.concat(<span class="keyword">this</span>.router.resolveHooks) <span class="comment">//¬†beforeResolve¬†hooks</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Ê≠§Êó∂<code>queue</code>‰∏≠ÊòØ<code>routeEnterGuard</code>ÂáΩÊï∞Âèä<code>resolveHook</code></li>
<li>ÁÑ∂ÂêéÊâßË°åÊ≠§ÈòüÂàóÔºåÈòüÂàó‰∏≠ÁöÑ<code>routerEnterGuard</code>Âíå<code>resolveHook</code>‰ºöÊâßË°å</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">runQueue(</span><br><span class="line">  queue,</span><br><span class="line">  iterator,</span><br><span class="line">  <span class="comment">/*¬†ÊâßË°åÁªìÊùüÂõûË∞É*/</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.pending !== route) &#123;</span><br><span class="line">      <span class="keyword">return</span> abort()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.pending = <span class="literal">null</span></span><br><span class="line">    onComplete(route) <span class="comment">//¬†ÊâßË°åonCompleteÂõûË∞ÉÔºåonComplete‰∏≠‰ºöË∞ÉÁî®updateRouteÊñπÊ≥ïÔºåÂÜÖÈÉ®‰ºöËß¶ÂèëafterEachÈí©Â≠ê</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.router.app) &#123;</span><br><span class="line">      <span class="keyword">this</span>.router.app.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//¬†Ë∞ÉÁî®¬†beforeRouteEnter¬†ÂÆàÂç´‰∏≠‰º†Áªô¬†next¬†ÁöÑÂõûË∞ÉÂáΩÊï∞</span></span><br><span class="line">        <span class="comment">//¬†next(vm=&gt;xxx)</span></span><br><span class="line">        postEnterCbs.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">          cb()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÊâßË°åÁöÑÈÄªËæëÂíå‰πãÂâçÁ±ª‰ººÔºå<code>beforeRouteEnter</code>Âíå<code>beforeResolve</code>‰ºöË¢´‰æùÊ¨°Ë∞ÉÁî®ÔºåÁÑ∂ÂêéÊâßË°åÈòüÂàóÁªìÊùüÂõûË∞É</li>
<li>ÈòüÂàóÁªìÊùüÂõûË∞É‰∏≠‰ºöË∞ÉÁî®<code>onComplete</code>Âπ∂‰º†ÂÖ•<code>ÁõÆÊ†áRoute</code>Âπ∂Âú®<code>$nextTick</code>‰∏≠ÈÅçÂéÜ‰πãÂâç‰øùÂ≠òÁöÑ<code>postEnterCbs</code>ÔºåÂç≥‰º†ÂÖ•<code>next</code>ÁöÑÂõûË∞É</li>
<li>Ê≠§Â§ÑÁöÑ<code>onComplete</code>ÊòØÁ°ÆËÆ§Ë∑ØÁî±Êó∂(<code>confirmTransition</code>)‰º†ÂÖ•ÁöÑ</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js transitionToÊñπÊ≥ï‰∏≠</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">this</span>.confirmTransition(</span><br><span class="line">      route,</span><br><span class="line">      () =&gt; &#123; <span class="comment">// onCompleteÔºåÂÆåÊàê</span></span><br><span class="line">        <span class="keyword">this</span>.updateRoute(route) <span class="comment">// Êõ¥Êñ∞routeÔºå‰ºöËß¶ÂèëafterEachÈí©Â≠ê</span></span><br><span class="line">        onComplete &amp;&amp; onComplete(route) <span class="comment">// Ë∞ÉÁî®onCompleteÂõûË∞É</span></span><br><span class="line">        <span class="keyword">this</span>.ensureURL()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// fire ready cbs once</span></span><br><span class="line">        <span class="comment">// Ëß¶ÂèëreadyÂõûË∞É</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.ready) &#123;</span><br><span class="line">          <span class="keyword">this</span>.ready = <span class="literal">true</span></span><br><span class="line">          <span class="keyword">this</span>.readyCbs.forEach(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">            cb(route)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// onAbortÂõûË∞É</span></span><br><span class="line">      err=&gt;&#123;...&#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<ul>
<li>ÂèØ‰ª•ÁúãÂà∞ÂÖ∂Ë∞ÉÁî®<code>updateRoute</code>Êù•Êõ¥Êñ∞<code>route</code>ÔºåËøô‰ºöËß¶Âèë<code>afterEach</code>Èí©Â≠ê</li>
<li>Ë∞ÉÁî®<code>ensureURL</code>Êõ¥Êñ∞ url</li>
<li>Âπ∂Ë∞ÉÁî®‰º†ÂÖ•<code>transitionTo</code>ÁöÑ<code>onComplete</code>ÂáΩÊï∞Ôºå‰∏ªË¶ÅÁî®Êù•Âú®<code>vue-router</code>ÂàùÂßãÂåñÊó∂‰∏∫<code>hash</code>Ê®°ÂºèÂÅöÂàùÂßãÂåñÁªëÂÆö(<code>setupHashListener</code>)</li>
<li>ÊúÄÂêéËß¶ÂèëÈÄöËøá<code>onReady</code>Ê≥®ÂÜåÁöÑ<code>readyCbs</code>ÂõûË∞É</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/history/base.js</span></span><br><span class="line"></span><br><span class="line">¬†¬†<span class="comment">//¬†Êõ¥Êñ∞Ë∑ØÁî±ÔºåËß¶ÂèëafterEachÈí©Â≠ê</span></span><br><span class="line">¬†¬†updateRoute¬†(route:¬†Route)¬†&#123;</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">const</span>¬†prev¬†=¬†<span class="keyword">this</span>.current</span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.current¬†=¬†route<span class="comment">//¬†Êõ¥Êñ∞current</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.cb¬†&amp;&amp;¬†<span class="keyword">this</span>.cb(route)¬†<span class="comment">//¬†Ë∞ÉÁî®updateRouteÂõûË∞ÉÔºåÂõûË∞É‰∏≠‰ºöÈáçÊñ∞‰∏∫_routerRoot._routeËµãÂÄºÔºåËøõËÄåËß¶Âèërouter-viewÁöÑÈáçÊñ∞Ê∏≤Êüì</span></span><br><span class="line">¬†¬†¬†¬†<span class="keyword">this</span>.router.afterHooks.forEach(<span class="function"><span class="params">hook</span>¬†=&gt;</span>¬†&#123;¬†<span class="comment">//¬†Ëß¶ÂèëafterEachÁãóÂ≠ê</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†hook¬†&amp;&amp;¬†hook(<span class="comment">/*¬†to*/</span>route,¬†<span class="comment">/*¬†from*/</span>prev)</span><br><span class="line">¬†¬†¬†¬†&#125;)</span><br><span class="line">¬†¬†&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>updateRoute</code>‰ºöË∞ÉÁî®<code>History</code>‰∏äÈÄöËøá<code>listen</code>ÊñπÊ≥ïÊ≥®ÂÜåÁöÑÊõ¥Êñ∞ÂõûË∞ÉÔºåËß¶Âèë<code>roter-view</code>ÁöÑÈáçÊñ∞Ê∏≤Êüì</li>
<li>Ëøô‰∫õÊõ¥Êñ∞ÂõûË∞ÉÊòØÂú®<code>vue-router</code>ÂàùÂßãÂåñÊó∂Ê≥®ÂÜåÁöÑ</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js init</span></span><br><span class="line">history.listen(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.apps.forEach(<span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">    app._route = route <span class="comment">// Êõ¥Êñ∞route</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ÁÑ∂ÂêéÊâßË°åÊâÄÊúâ<code>afterEach</code>Èí©Â≠ê</li>
<li>Ëá≥Ê≠§‰∏ÄÊ¨°ÂÆåÊï¥ÁöÑË∑ØÁî±Ë∑≥ËΩ¨ÂÆåÊàêÔºåÁõ∏Â∫îÁöÑÂÆàÂç´ÂèäÈí©Â≠ê‰πüËß¶ÂèëÂÆåÊàê</li>
</ul>
<h3 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h3><ul>
<li>Êï¥‰∏™ÂØºËà™ÁöÑËß£Êûê(Á°ÆËÆ§)ÔºåÂÖ∂ÂÆûÂ∞±ÊòØ‰ªé‰∏çÂêåÁä∂ÊÄÅÁöÑË∑ØÁî±ËÆ∞ÂΩï‰∏≠ÊäΩÂèñÂá∫ÂØπÂ∫îÁöÑÂÆàÂç´ÂèäÈí©Â≠ê</li>
<li>ÁÑ∂ÂêéÁªÑÊàêÈòüÂàóÔºå‰ΩøÁî®<code>runQueue</code>„ÄÅ<code>iterator</code>Â∑ßÂ¶ôÁöÑÂÆåÊàêÂÆàÂç´ÁöÑÊâßË°å</li>
<li>Âπ∂Âú®ÂÖ∂‰∏≠Â§ÑÁêÜ‰∫ÜÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑËß£Êûê„ÄÅ<code>postEnterCb</code>‰∏≠ÂÆû‰æãËé∑ÂèñÁöÑÈóÆÈ¢ò</li>
<li>Êï¥‰∏™ÂÆàÂç´„ÄÅÈí©Â≠êÁöÑÊâßË°åÊµÅÁ®ãÂ¶Ç‰∏ã<ul>
<li>ÂØºËà™Ë¢´Ëß¶Âèë„ÄÇ</li>
<li>Âú®Â§±Ê¥ªÁöÑÁªÑ‰ª∂ÈáåË∞ÉÁî®  beforeRouteLeave  ÂÆàÂç´„ÄÇ</li>
<li>Ë∞ÉÁî®ÂÖ®Â±ÄÁöÑ  beforeEach  ÂÆàÂç´„ÄÇ</li>
<li>Âú®ÈáçÁî®ÁöÑÁªÑ‰ª∂ÈáåË∞ÉÁî®  beforeRouteUpdate  ÂÆàÂç´ (2.2+)„ÄÇ</li>
<li>Âú®Ë∑ØÁî±ÈÖçÁΩÆÈáåË∞ÉÁî®  beforeEnter„ÄÇ</li>
<li>Ëß£ÊûêÂºÇÊ≠•Ë∑ØÁî±ÁªÑ‰ª∂„ÄÇ</li>
<li>Âú®Ë¢´ÊøÄÊ¥ªÁöÑÁªÑ‰ª∂ÈáåË∞ÉÁî®  beforeRouteEnter„ÄÇ</li>
<li>Ë∞ÉÁî®ÂÖ®Â±ÄÁöÑ  beforeResolve  ÂÆàÂç´ (2.5+)„ÄÇ</li>
<li>ÂØºËà™Ë¢´Á°ÆËÆ§„ÄÇ</li>
<li>Ë∞ÉÁî®ÂÖ®Â±ÄÁöÑ  afterEach  Èí©Â≠ê„ÄÇ</li>
<li>Ëß¶Âèë DOM Êõ¥Êñ∞„ÄÇ</li>
<li>Áî®ÂàõÂª∫Â•ΩÁöÑÂÆû‰æãË∞ÉÁî®  beforeRouteEnter  ÂÆàÂç´‰∏≠‰º†Áªô  next  ÁöÑÂõûË∞ÉÂáΩÊï∞„ÄÇ</li>
</ul>
</li>
</ul>
<h2 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h2><ul>
<li><a href="https://github.com/dwqs/blog/issues/53" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/53</a></li>
<li><a href="https://github.com/dwqs/blog/issues/54" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/54</a></li>
<li><a href="https://github.com/dwqs/blog/issues/55" target="_blank" rel="noopener">https://github.com/dwqs/blog/issues/55</a></li>
<li><a href="https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643" target="_blank" rel="noopener">https://github.com/vuejs/vue-router/issues/2184#issuecomment-393484643</a></li>
<li><a href="https://juejin.im/post/5e456513f265da573c0c6d4b" target="_blank" rel="noopener">https://juejin.im/post/5e456513f265da573c0c6d4b</a></li>
<li><a href="https://juejin.im/post/584040e1ac502e006cbedb23" target="_blank" rel="noopener">https://juejin.im/post/584040e1ac502e006cbedb23</a></li>
<li><a href="https://juejin.im/post/5df0ada0f265da33d56d1a2f" target="_blank" rel="noopener">https://juejin.im/post/5df0ada0f265da33d56d1a2f</a></li>
<li><a href="https://juejin.im/post/5dbed0bef265da4cff701f68" target="_blank" rel="noopener">https://juejin.im/post/5dbed0bef265da4cff701f68</a></li>
<li><a href="https://www.jianshu.com/p/29e8214d0bee" target="_blank" rel="noopener">https://www.jianshu.com/p/29e8214d0bee</a></li>
<li><a href="https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/" target="_blank" rel="noopener">https://ustbhuangyi.github.io/vue-analysis/v2/vue-router/</a></li>
<li><a href="https://blog.liuyunzhuge.com/2020/04/08/vue-routerÊ∫êÁ†ÅÔºöcreate-matcher/" target="_blank" rel="noopener">https://blog.liuyunzhuge.com/2020/04/08/vue-router Ê∫êÁ†ÅÔºöcreate-matcher/</a></li>
</ul>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><ul>
<li>ÂêéÈù¢Ëøò‰ºö‰ªãÁªçÂÖ∂‰ΩôÈÉ®ÂàÜÔºåÂ¶ÇÊûúËßâÂæóËøòË°åÔºåÂèØ‰ª•Áªô‰∏™ËµûÂì¶ ‚ú®</li>
<li>‰∏™‰∫∫<code>github</code>Ôºå‰πüÊÄªÁªì‰∫Ü‰∏Ä‰∫õ‰∏úË•øÔºåÊ¨¢Ëøé star</li>
<li>Âü∫‰∫é canvas ÁöÑÁªòÂõæÊùø<a href="https://github.com/BryanAdamss/drawing-board" target="_blank" rel="noopener">drawing-board</a></li>
<li>ÂâçÁ´ØÂÖ•Èó® demo„ÄÅÊúÄ‰Ω≥ÂÆûË∑µÈõÜÂêà <a href="https://github.com/BryanAdamss/fe-awesome-demos" target="_blank" rel="noopener">fe-awesome-demos</a></li>
<li>‰∏Ä‰∏™Ëá™Âä®ÁîüÊàêÂà´ÂêçÁöÑ<code>vue-cli-plugin</code><a href="https://www.npmjs.com/package/vue-cli-plugin-auto-alias" target="_blank" rel="noopener">https://www.npmjs.com/package/vue-cli-plugin-auto-alias</a></li>
</ul>
<h2 id="npm-ÂåÖ"><a href="#npm-ÂåÖ" class="headerlink" title="npm ÂåÖ"></a>npm ÂåÖ</h2><ul>
<li><a href="https://www.npmjs.com/package/vue-cli-plugin-auto-alias" target="_blank" rel="noopener">vue-cli-plugin-auto-alias</a></li>
<li><a href="https://www.npmjs.com/package/@bryanadamss/drawing-board" target="_blank" rel="noopener">@bryanadamss/drawing-board</a></li>
<li><a href="https://www.npmjs.com/package/@bryanadamss/num2chn" target="_blank" rel="noopener">@bryanadamss/num2chn</a></li>
<li><a href="https://www.npmjs.com/package/ant-color-converter" target="_blank" rel="noopener">ant-color-converter</a></li>
</ul>
<h2 id="‰∫§ÊµÅ"><a href="#‰∫§ÊµÅ" class="headerlink" title="‰∫§ÊµÅ"></a>‰∫§ÊµÅ</h2><ul>
<li>Â¶ÇÊûúÊúâÈóÆÈ¢òÔºåÂèØ‰ª•Âä†ÂæÆ‰ø°‰∫§ÊµÅÔºåÂÖ±ÂêåÊàêÈïøÔºåÂÖ±ÂêåËøõÊ≠•~</li>
<li><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/917b376a388f43faa6c8f8d81f730bcb~tplv-k3u1fbpfcp-watermark.image" alt=""></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue/" rel="tag"># vue</a>
          
            <a href="/tags/vue-router/" rel="tag"># vue-router</a>
          
            <a href="/tags/Ê∫êÁ†ÅËß£Êûê/" rel="tag"># Ê∫êÁ†ÅËß£Êûê</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/22/vue-cli-mode/" rel="next" title="vue-cli-mode">
                <i class="fa fa-chevron-left"></i> vue-cli-mode
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/12/01/x5-video-summary/" rel="prev" title="x5-video-summary">
                x5-video-summary <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            ÊñáÁ´†ÁõÆÂΩï
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Á´ôÁÇπÊ¶ÇËßà
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/Avatar.png"
               alt="BryanAdamss" />
          <p class="site-author-name" itemprop="name">BryanAdamss</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">64</span>
                <span class="site-state-item-name">Êó•Âøó</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">ÂàÜÁ±ª</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">91</span>
                <span class="site-state-item-name">Ê†áÁ≠æ</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/BryanAdamss" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#vue-router-Ê∫êÁ†ÅËß£Êûê-1-5w-Â≠ó-Â§öÂõæÈ¢ÑË≠¶-„Äê‰∏≠„Äë"><span class="nav-number">1.</span> <span class="nav-text">vue-router Ê∫êÁ†ÅËß£Êûê | 1.5w Â≠ó | Â§öÂõæÈ¢ÑË≠¶ - „Äê‰∏≠„Äë</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ë∑ØÁî±Ë∑≥ËΩ¨"><span class="nav-number">1.1.</span> <span class="nav-text">Ë∑ØÁî±Ë∑≥ËΩ¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#transitionTo"><span class="nav-number">1.1.1.</span> <span class="nav-text">transitionTo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ë∑ØÁî±ÂåπÈÖç"><span class="nav-number">1.2.</span> <span class="nav-text">Ë∑ØÁî±ÂåπÈÖç</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Âú∞ÂùÄÊ†ºÂºèÂåñ-normalizeLocation"><span class="nav-number">1.2.1.</span> <span class="nav-text">Âú∞ÂùÄÊ†ºÂºèÂåñ normalizeLocation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠-matchRoute"><span class="nav-number">1.2.2.</span> <span class="nav-text">Âú∞ÂùÄÊòØÂê¶ÂåπÈÖçÂà§Êñ≠ matchRoute</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Â°´ÂÖÖÂèÇÊï∞-fillParams"><span class="nav-number">1.2.3.</span> <span class="nav-text">Â°´ÂÖÖÂèÇÊï∞ fillParams</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÂàõÂª∫Ë∑ØÁî±ÂØπË±°-createRoute"><span class="nav-number">1.2.4.</span> <span class="nav-text">ÂàõÂª∫Ë∑ØÁî±ÂØπË±°_createRoute</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#createRoute"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">createRoute</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÂàõÂª∫Âà´ÂêçË∑ØÁî±ÂØπË±°-alias"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">ÂàõÂª∫Âà´ÂêçË∑ØÁî±ÂØπË±° alias</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÂàõÂª∫ÈáçÂÆöÂêëË∑ØÁî±ÂØπË±°-redirect"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">ÂàõÂª∫ÈáçÂÆöÂêëË∑ØÁî±ÂØπË±° redirect</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Â∞èÁªì"><span class="nav-number">1.2.5.</span> <span class="nav-text">Â∞èÁªì</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂØºËà™Ëß£Êûê-Á°ÆËÆ§-ÊµÅÁ®ã"><span class="nav-number">1.3.</span> <span class="nav-text">ÂØºËà™Ëß£Êûê(Á°ÆËÆ§)ÊµÅÁ®ã</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Âà§Êñ≠ÈáçÂ§çË∑≥ËΩ¨"><span class="nav-number">1.3.1.</span> <span class="nav-text">Âà§Êñ≠ÈáçÂ§çË∑≥ËΩ¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÂØπÊØîÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï"><span class="nav-number">1.3.2.</span> <span class="nav-text">ÂØπÊØîÊâæÂá∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÅÂ§±Ê¥ª„ÄÅÊøÄÊ¥ªÁöÑË∑ØÁî±ËÆ∞ÂΩï</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÊäΩÂèñÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞„ÄÅËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂"><span class="nav-number">1.3.3.</span> <span class="nav-text">ÊäΩÂèñÈí©Â≠ê„ÄÅÂÆàÂç´ÂáΩÊï∞„ÄÅËß£ÊûêÂºÇÊ≠•ÁªÑ‰ª∂</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#extractLeaveGuards„ÄÅextractUpdateHooks"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">extractLeaveGuards„ÄÅextractUpdateHooks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resolveAsyncComponents"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">resolveAsyncComponents</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÂÆàÂç´ÈòüÂàóÁöÑÊâßË°å"><span class="nav-number">1.3.4.</span> <span class="nav-text">ÂÆàÂç´ÈòüÂàóÁöÑÊâßË°å</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#runQueue"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">runQueue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iterator"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">iterator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÈòüÂàóÊâßË°å"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">ÈòüÂàóÊâßË°å</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ÊäΩÂèñ-beforeRouteEnter"><span class="nav-number">1.3.4.4.</span> <span class="nav-text">ÊäΩÂèñ beforeRouteEnter</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÊÄªÁªì"><span class="nav-number">1.3.5.</span> <span class="nav-text">ÊÄªÁªì</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂèÇËÄÉ"><span class="nav-number">1.4.</span> <span class="nav-text">ÂèÇËÄÉ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PS"><span class="nav-number">1.5.</span> <span class="nav-text">PS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#npm-ÂåÖ"><span class="nav-number">1.6.</span> <span class="nav-text">npm ÂåÖ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#‰∫§ÊµÅ"><span class="nav-number">1.7.</span> <span class="nav-text">‰∫§ÊµÅ</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BryanAdamss</span>
</div>


<div class="powered-by">
  Áî± <a class="theme-link" href="https://hexo.io">Hexo</a> Âº∫ÂäõÈ©±Âä®
</div>

<div class="theme-info">
  ‰∏ªÈ¢ò -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


  

</body>
</html>
