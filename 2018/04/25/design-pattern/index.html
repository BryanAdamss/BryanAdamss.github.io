<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="设计模式," />








  <link rel="shortcut icon" type="image/x-icon" href="/Avatar.png?v=5.1.0" />






<meta name="description" content="此文是《JavaScript设计模式与开发实践》的读书笔记本文所有源码可在这里找到

JavaScript设计模式与开发实践基础知识鸭子类型1234567891011121314151617181920212223242526272829303132333435363738&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html lang=&quot;en&quot;&amp;gt;&amp;lt;head&amp;gt;    &amp;lt">
<meta property="og:type" content="article">
<meta property="og:title" content="design-pattern">
<meta property="og:url" content="http://yoursite.com/2018/04/25/design-pattern/index.html">
<meta property="og:site_name" content="BryanAdamss的博客">
<meta property="og:description" content="此文是《JavaScript设计模式与开发实践》的读书笔记本文所有源码可在这里找到

JavaScript设计模式与开发实践基础知识鸭子类型1234567891011121314151617181920212223242526272829303132333435363738&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html lang=&quot;en&quot;&amp;gt;&amp;lt;head&amp;gt;    &amp;lt">
<meta property="og:updated_time" content="2018-04-25T08:32:46.111Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="design-pattern">
<meta name="twitter:description" content="此文是《JavaScript设计模式与开发实践》的读书笔记本文所有源码可在这里找到

JavaScript设计模式与开发实践基础知识鸭子类型1234567891011121314151617181920212223242526272829303132333435363738&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html lang=&quot;en&quot;&amp;gt;&amp;lt;head&amp;gt;    &amp;lt">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/04/25/design-pattern/"/>





  <title> design-pattern | BryanAdamss的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BryanAdamss的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个伪前端</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/25/design-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BryanAdamss">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/Avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BryanAdamss的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                design-pattern
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-25T10:18:10+08:00">
                2018-04-25 10:18:10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FrontEnd/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>此文是《JavaScript设计模式与开发实践》的读书笔记<br>本文所有源码可在<a href="https://github.com/BryanAdamss/SourceSave/tree/master/Sjms" target="_blank" rel="external">这里</a>找到</p>
</blockquote>
<h1 id="JavaScript设计模式与开发实践"><a href="#JavaScript设计模式与开发实践" class="headerlink" title="JavaScript设计模式与开发实践"></a>JavaScript设计模式与开发实践</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 鸭子类型</span></div><div class="line">    <span class="comment">// 如果它走起来像鸭子，叫起来也像鸭子，那它就是鸭子</span></div><div class="line">    <span class="comment">// 鸭子类型指导我们只关注对象的行为，而不关注对象本身</span></div><div class="line">    <span class="keyword">var</span> duck = &#123;</div><div class="line">        <span class="attr">duckSinging</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"嘎嘎"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> chicken = &#123;</div><div class="line">        <span class="attr">duckSinging</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"嘎嘎"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 合唱团</span></div><div class="line">    <span class="keyword">var</span> choir = [];</div><div class="line">    <span class="keyword">var</span> joinChoir = <span class="function"><span class="keyword">function</span>(<span class="params">animal</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (animal &amp;&amp; <span class="keyword">typeof</span> animal.duckSinging === <span class="string">"function"</span>) &#123;</div><div class="line">            choir.push(animal);</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"恭喜加入合唱团"</span>);</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"合唱团当前人数:"</span> + choir.length);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    joinChoir(duck);</div><div class="line">    joinChoir(chicken);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 多态:同一操作应用在不同的对象上面，可以产生不同的解释和不同的执行结果</span></div><div class="line">    <span class="comment">// 即给不同的对象发送同一个消息的时候，这些对象会根据这个消息分别给出不同的反馈</span></div><div class="line">    <span class="keyword">var</span> makeSound = <span class="function"><span class="keyword">function</span>(<span class="params">animal</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (animal <span class="keyword">instanceof</span> Duck) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"嘎嘎"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (animal <span class="keyword">instanceof</span> Chicken) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"咯咯"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Duck = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    <span class="keyword">var</span> Chicken = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    makeSound(<span class="keyword">new</span> Duck());</div><div class="line">    makeSound(<span class="keyword">new</span> Chicken());</div><div class="line">    <span class="comment">// 这里是不优雅的，因为如果再来一条狗，需要修改makeSound</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="多态2"><a href="#多态2" class="headerlink" title="多态2"></a>多态2</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 多态背后是将"做什么"和"谁去做，怎么做"分离开来，即将不变的和可变的分离开来</span></div><div class="line">    <span class="comment">// 把不变的隔离出来，把可变的部分封装起来,叫是不变的，动物怎么叫是可变的</span></div><div class="line"></div><div class="line">    <span class="comment">// 隔离出不变的</span></div><div class="line">    <span class="keyword">var</span> makeSound = <span class="function"><span class="keyword">function</span>(<span class="params">animal</span>) </span>&#123;</div><div class="line">        animal.sound();</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 封装可变的</span></div><div class="line">    <span class="keyword">var</span> Duck = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line">    Duck.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"嘎嘎"</span>);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> Chicken = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line">    Chicken.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"咯咯"</span>);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    makeSound(<span class="keyword">new</span> Duck());</div><div class="line">    makeSound(<span class="keyword">new</span> Chicken());</div><div class="line">    <span class="comment">// 添加新动物</span></div><div class="line">    <span class="keyword">var</span> Dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    Dog.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"汪汪"</span>);</div><div class="line">    &#125;;</div><div class="line">    makeSound(<span class="keyword">new</span> Dog());</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="多态3"><a href="#多态3" class="headerlink" title="多态3"></a>多态3</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> googleMap = &#123;</div><div class="line">        <span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始渲染谷歌地图'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> baiduMap = &#123;</div><div class="line">        <span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始渲染百度地图'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> renderMap = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (type === <span class="string">'google'</span>) &#123;</div><div class="line">            googleMap.show();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'baidu'</span>) &#123;</div><div class="line">            baiduMap.show();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    renderMap(<span class="string">'google'</span>); <span class="comment">// 输出：开始渲染谷歌地图</span></div><div class="line">    renderMap(<span class="string">'baidu'</span>); <span class="comment">// 输出：开始渲染百度地图</span></div><div class="line"></div><div class="line">    <span class="comment">// 如果添加其他地图，则需要在renderMap中继续判断，这里显示地图是不变的，显示哪个，怎么显示是可变的，所以可将show隔离(提取)出来</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> renderMap2 = <span class="function"><span class="keyword">function</span>(<span class="params">map</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (map.show <span class="keyword">instanceof</span> <span class="built_in">Function</span>) &#123;</div><div class="line">            map.show();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 添加其他地图</span></div><div class="line">    <span class="keyword">var</span> sosoMap = &#123;</div><div class="line">        <span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"开始渲染Soso地图"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    renderMap2(googleMap); <span class="comment">// 输出：开始渲染谷歌地图</span></div><div class="line">    renderMap2(baiduMap); <span class="comment">// 输出：开始渲染百度地图</span></div><div class="line">    renderMap2(sosoMap); <span class="comment">// 输出:开始渲染Soso地图</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="封装数据"><a href="#封装数据" class="headerlink" title="封装数据"></a>封装数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// js一般通过函数来创建作用域来封装数据</span></div><div class="line">    <span class="keyword">var</span> myObj = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// 私有变量</span></div><div class="line">        <span class="keyword">var</span> _name = <span class="string">"haha"</span>;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="comment">// 公开方法</span></div><div class="line">            getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> _name;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    <span class="built_in">console</span>.log(myObj.getName()); <span class="comment">// "haha"</span></div><div class="line">    <span class="built_in">console</span>.log(myObj._name); <span class="comment">// undefined</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="封装实现"><a href="#封装实现" class="headerlink" title="封装实现"></a>封装实现</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 封装实现，例如sort()函数的具体实现你并不知道，它对外界来说是透明的，不可见的</span></div><div class="line">    <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>];</div><div class="line">    <span class="built_in">console</span>.log(arr.sort());</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 原型模式是用来创建对象的一种模式，如果想创建一个对象有2种方法</span></div><div class="line">    <span class="comment">// 1.先指定类型，然后通过类型创建对象</span></div><div class="line">    <span class="comment">// 2.找到一个对象做为原型，通过克隆创建一个一模一样的对象</span></div><div class="line">    <span class="comment">// 原型模式是选用的第二种</span></div><div class="line">    <span class="comment">// 使用场景:创建一个跟某个对象一模一样的对象时</span></div><div class="line">    <span class="comment">// 实现关键:语言本身是否提供了克隆的方法,js中可用Object.create()</span></div><div class="line">    <span class="keyword">var</span> Plane = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.blood = <span class="number">100</span>;</div><div class="line">        <span class="keyword">this</span>.attackLevel = <span class="number">1</span>;</div><div class="line">        <span class="keyword">this</span>.defenseLevel = <span class="number">1</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> plane = <span class="keyword">new</span> Plane();</div><div class="line">    plane.blood = <span class="number">500</span>;</div><div class="line">    plane.attackLevel = <span class="number">3</span>;</div><div class="line">    plane.defenseLevel = <span class="number">4</span>;</div><div class="line">    <span class="comment">// Object.create的兼容</span></div><div class="line">    <span class="built_in">Object</span>.create = <span class="built_in">Object</span>.create || <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">        F.prototype = obj;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> F();</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 克隆</span></div><div class="line">    <span class="keyword">var</span> clonePlane = <span class="built_in">Object</span>.create(plane);</div><div class="line">    <span class="built_in">console</span>.log(clonePlane);</div><div class="line">    <span class="built_in">console</span>.log(clonePlane.blood);</div><div class="line">    <span class="built_in">console</span>.log(clonePlane.attackLevel);</div><div class="line">    <span class="built_in">console</span>.log(clonePlane.defenseLevel);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// js中this是在函数被调用时才确定的，它是指向被调用时的执行环境</span></div><div class="line">    <span class="comment">// 1.全局环境下this-&gt;window</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// window</span></div><div class="line">    <span class="comment">// 2.当函数做为对象方法调用时,this指向此对象</span></div><div class="line">    <span class="keyword">var</span> a = &#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">"aaaa"</span>,</div><div class="line">        <span class="attr">getName</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    a.getName(); <span class="comment">// aaaa</span></div><div class="line">    (a.getName)(); <span class="comment">// aaaa</span></div><div class="line"></div><div class="line">    (a.getName = a.getName)(); <span class="comment">// 空</span></div><div class="line">    (a.getName || a.getName)(); <span class="comment">// 空</span></div><div class="line">    (a.getName, a.getName)(); <span class="comment">// 空</span></div><div class="line"></div><div class="line">    <span class="comment">// 注意this是指向最靠近方法的对象</span></div><div class="line">    <span class="keyword">var</span> b = &#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">"bbbb"</span></div><div class="line">    &#125;;</div><div class="line">    b.bar = a;</div><div class="line">    b.bar.getName(); <span class="comment">// aaaa</span></div><div class="line">    <span class="comment">// 3.匿名函数的执行环境具有全局性，所以this通常指向window</span></div><div class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// window</span></div><div class="line">    &#125;)();</div><div class="line">    <span class="comment">// 4.做为构造器调用时,this指向被新创建的对象</span></div><div class="line">    <span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">"haha"</span>);</div><div class="line">    <span class="built_in">console</span>.log(person.name);</div><div class="line">    <span class="comment">// 5.Function.prototype.call 或Function.prototype.apply 可以动态地改变传入函数的this</span></div><div class="line">    a.getName.call(b); <span class="comment">// bbbb 相当于b.getName()</span></div><div class="line">    a.getName.apply(b); <span class="comment">// bbbb 相当于b.getName()</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="call、apply"><a href="#call、apply" class="headerlink" title="call、apply"></a>call、apply</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// call、apply都可以改变函数中this的指向</span></div><div class="line"></div><div class="line">    <span class="comment">// 第一个参数都指定了函数体内this的指向，如果传入null,则代表在全局环境下调用。apply的第二个参数为带下标的集合(类数组),call参数个数不限制，会按顺序依依对应到形参上</span></div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log([a, b, c]);</div><div class="line">    &#125;;</div><div class="line">    func.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 输出 [ 1, 2, 3 ]</span></div><div class="line">    func.call(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 输出 [ 1, 2, 3 ]</span></div><div class="line"></div><div class="line">    <span class="comment">// call、apply通常用来实现函数借用，用来在类数组(arguments)上调用数组的方法</span></div><div class="line">    <span class="comment">// 函数的参数列表arguments 是一个类数组对象，虽然它也有“下标”，但它并非真正的数组，所以也不能像数组一样，进行排序操作或者往集合里添加一个新的元素</span></div><div class="line">    <span class="comment">// arguments转成真正的数组的时候，可以借用Array.prototype.slice方法</span></div><div class="line">    <span class="comment">// 想截取arguments列表中的头一个元素时，可以借用Array.prototype.shift方法。</span></div><div class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">Array</span>.prototype.push.call(<span class="built_in">arguments</span>, <span class="number">6</span>);</div><div class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">// 输出[4,5,6]</span></div><div class="line">    &#125;)(<span class="number">4</span>, <span class="number">5</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 通过call、apply实现绑定this</span></div><div class="line">    <span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>, <span class="comment">// 保存原函数</span></div><div class="line">            context = [].shift.call(<span class="built_in">arguments</span>), <span class="comment">// 需要绑定的this上下文,arguments上为shift方法，通过call来实现调用数组的shift方法</span></div><div class="line">            args = [].slice.call(<span class="built_in">arguments</span>); <span class="comment">// 剩余的参数转成数组</span></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 返回一个新的函数</span></div><div class="line">            <span class="keyword">return</span> self.apply(context, [].concat.call(args, [].slice.call(<span class="built_in">arguments</span>)));</div><div class="line">            <span class="comment">// 执行新的函数的时候，会把之前传入的context 当作新函数体内的this</span></div><div class="line">            <span class="comment">// 并且组合两次分别传入的参数，作为新函数的参数</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> obj = &#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'sven'</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c, d</span>) </span>&#123;</div><div class="line">        alert(<span class="keyword">this</span>.name); <span class="comment">// 输出：sven</span></div><div class="line">        alert([a, b, c, d])</div><div class="line">    &#125;.bind(obj, <span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 将func中的this绑定到obj上，并传入了默认参数</span></div><div class="line">    func(<span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 输出：[ 1, 2, 3, 4 ]</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 函数中声明另外一个函数就会出现闭包</span></div><div class="line">    <span class="comment">// 经典案例，每个都弹出5</span></div><div class="line">    <span class="keyword">var</span> nodes = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'div'</span>);</div><div class="line">    <span class="comment">// for (var i = 0, len = nodes.length; i &lt; len; i++) &#123;</span></div><div class="line">    <span class="comment">//     nodes[i].onclick = function() &#123;</span></div><div class="line">    <span class="comment">//         alert(i);</span></div><div class="line">    <span class="comment">//     &#125;;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// 这是因为onclick事件是异步触发的，当触发时for循环早结束了，i已经变成5了，所以事件处理函数中引用的i都为5</span></div><div class="line">    <span class="comment">// 修正</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = nodes.length; i &lt; len; i++) &#123;</div><div class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</div><div class="line">            nodes[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                alert(i);</div><div class="line">            &#125;</div><div class="line">        &#125;)(i)</div><div class="line">    &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="利用闭包创建测试类型函数"><a href="#利用闭包创建测试类型函数" class="headerlink" title="利用闭包创建测试类型函数"></a>利用闭包创建测试类型函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> Type = &#123;&#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, type; type = [<span class="string">'String'</span>, <span class="string">'Array'</span>, <span class="string">'Number'</span>][i++];) &#123; <span class="comment">// 当语句2条件为false时，就会退出for循环，当i为3时，type[3]为undefined，为false跳出循环</span></div><div class="line">        <span class="comment">// 利用闭包创建判断类型的函数</span></div><div class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</div><div class="line">            Type[<span class="string">'is'</span> + type] = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object '</span> + type + <span class="string">']'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;)(type)</div><div class="line">    &#125;;</div><div class="line">    Type.isArray([]); <span class="comment">// 输出：true</span></div><div class="line">    Type.isString(<span class="string">"str"</span>); <span class="comment">// 输出：true</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="闭包封装变量"><a href="#闭包封装变量" class="headerlink" title="闭包封装变量"></a>闭包封装变量</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 乘积</span></div><div class="line">    <span class="comment">// 1.普通方法</span></div><div class="line">    <span class="keyword">var</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</div><div class="line">            a *= <span class="built_in">arguments</span>[i];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">console</span>.log(mult(<span class="number">8</span>, <span class="number">9</span>)); <span class="comment">// 72</span></div><div class="line">    <span class="comment">// 2.进阶添加缓存机制</span></div><div class="line">    <span class="keyword">var</span> cache = &#123;&#125;;</div><div class="line">    <span class="keyword">var</span> mult2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">","</span>); <span class="comment">// 将实参数组转换为字符串</span></div><div class="line">        <span class="keyword">if</span> (cache[args]) &#123;</div><div class="line">            <span class="comment">// cache中存在原先的计算结果，则直接返回结果</span></div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"我是从缓存2取的"</span>);</div><div class="line">            <span class="keyword">return</span> cache[args];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</div><div class="line">            a *= <span class="built_in">arguments</span>[i];</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 将结果存入缓存中</span></div><div class="line">        cache[args] = a;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">console</span>.log(mult2(<span class="number">8</span>, <span class="number">9</span>));</div><div class="line">    <span class="comment">// console.log(cache);</span></div><div class="line">    <span class="built_in">console</span>.log(mult2(<span class="number">8</span>, <span class="number">9</span>));</div><div class="line">    <span class="comment">// 3.超进阶使用闭包封装cache，因为这个cache是单独属于mult3的，所以可以封装到mult3中</span></div><div class="line">    <span class="keyword">var</span> mult3 = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cache3 = &#123;&#125;;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">","</span>); <span class="comment">// 将实参数组转换为字符串</span></div><div class="line">            <span class="keyword">if</span> (args <span class="keyword">in</span> cache3) &#123;</div><div class="line">                <span class="comment">// cache中存在原先的计算结果，则直接返回结果</span></div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"我是从缓存3取的"</span>);</div><div class="line">                <span class="keyword">return</span> cache3[args];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</div><div class="line">                a *= <span class="built_in">arguments</span>[i];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 将结果存入缓存中</span></div><div class="line">            cache3[args] = a;</div><div class="line">            <span class="keyword">return</span> a;</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="built_in">console</span>.log(mult3(<span class="number">8</span>, <span class="number">10</span>));</div><div class="line">    <span class="built_in">console</span>.log(mult3(<span class="number">8</span>, <span class="number">10</span>));</div><div class="line">    <span class="comment">// console.log(cache3); // error</span></div><div class="line">    <span class="comment">// 4.Max版本提炼函数</span></div><div class="line">    <span class="keyword">var</span> mult4 = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cache4 = &#123;&#125;;</div><div class="line">        <span class="comment">// 将重复使用到的计算提炼出来</span></div><div class="line">        <span class="keyword">var</span> calcuate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</div><div class="line">                a *= <span class="built_in">arguments</span>[i];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> a;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">","</span>); <span class="comment">// 将实参数组转换为字符串</span></div><div class="line">            <span class="keyword">if</span> (args <span class="keyword">in</span> cache4) &#123;</div><div class="line">                <span class="comment">// cache中存在原先的计算结果，则直接返回结果</span></div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"我是从缓存4取的"</span>);</div><div class="line">                <span class="keyword">return</span> cache4[args];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 全局环境下调用calcuate</span></div><div class="line">            cache4[args] = calcuate.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">return</span> cache4[args];</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="built_in">console</span>.log(mult4(<span class="number">9</span>, <span class="number">9</span>));</div><div class="line">    <span class="built_in">console</span>.log(mult4(<span class="number">9</span>, <span class="number">9</span>));</div><div class="line">    <span class="comment">// console.log(calcuate);// error</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> appendDiv = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</div><div class="line">            <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">            div.innerHTML = i;</div><div class="line">            <span class="built_in">document</span>.body.appendChild(div);</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">"function"</span>) &#123;</div><div class="line">                callback(div);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    appendDiv();</div><div class="line">    <span class="comment">// 通过回调函数来确定是否隐藏</span></div><div class="line">    appendDiv(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</div><div class="line">        node.style.display = <span class="string">"none"</span>;</div><div class="line">    &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// AOP 面向切片编程，将跟核心业务无关的功能抽离出来，再通过动态织入</span></div><div class="line">    <span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">beforefn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>; <span class="comment">// 保存原函数的引用</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 返回包含了原函数和新函数的"代理"函数</span></div><div class="line">            beforefn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 执行新函数，修正this</span></div><div class="line">            <span class="keyword">return</span> __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 执行原函数</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">afterfn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> ret = __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            afterfn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">    &#125;;</div><div class="line">    func = func.before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">    &#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    func(); <span class="comment">// 1,2,3</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="函数柯里化"><a href="#函数柯里化" class="headerlink" title="函数柯里化"></a>函数柯里化</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 柯里化一般用于创建已经设置好了一个或多个参数的函数(创建带有默认参数值函数的过程)</span></div><div class="line">    <span class="keyword">var</span> curry = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> _args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>); <span class="comment">//保存默认参数, 一般curry接收的第一个参数为需要柯里化的函数，后面的实参都是要设置为默认值的参数</span></div><div class="line">        <span class="built_in">console</span>.log(_args);</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> innerArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>); <span class="comment">// 新参数</span></div><div class="line">            <span class="keyword">var</span> finalArgs = _args.concat(innerArgs); <span class="comment">// 最终参数</span></div><div class="line">            <span class="keyword">return</span> fn.apply(<span class="literal">null</span>, finalArgs); <span class="comment">// 在全局调用柯里化好的函数</span></div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">num1, num2</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> num1 + num2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> curriedAdd = curry(add, <span class="number">5</span>); <span class="comment">// curriedAdd此时已经有一个默认参数5了， 使用时就只用再传入一个参数</span></div><div class="line">    <span class="built_in">console</span>.log(curriedAdd(<span class="number">3</span>)); <span class="comment">//8</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="反柯理化"><a href="#反柯理化" class="headerlink" title="反柯理化"></a>反柯理化</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 将特有函数普通化</span></div><div class="line">    <span class="built_in">Function</span>.prototype.uncurrying = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> _self = <span class="keyword">this</span>; <span class="comment">// 保存原函数</span></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> obj = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>); <span class="comment">// 保存调用环境</span></div><div class="line">            <span class="keyword">return</span> _self.apply(obj, <span class="built_in">arguments</span>); <span class="comment">// 调用原函数</span></div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 反柯里化的另一种写法</span></div><div class="line">    <span class="comment">// Function.prototype.uncurrying = function() &#123;</span></div><div class="line">    <span class="comment">//     var _self = this;</span></div><div class="line">    <span class="comment">//     return function() &#123;</span></div><div class="line">    <span class="comment">//         return Function.prototype.call.apply(_self, arguments);</span></div><div class="line">    <span class="comment">//     &#125;;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> push = <span class="built_in">Array</span>.prototype.push.uncurrying();</div><div class="line"></div><div class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        push(<span class="built_in">arguments</span>, <span class="number">4</span>);</div><div class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">// 输出：[1, 2, 3, 4]</span></div><div class="line">    &#125;)(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="函数截流"><a href="#函数截流" class="headerlink" title="函数截流"></a>函数截流</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 有些时候函数会被系统频繁的触发,如window.onresize事件、mousemove、上传进度时会频繁触发相应的处理函数</span></div><div class="line">    <span class="comment">// 实现函数节流可通过setTimeout延迟执行来解决</span></div><div class="line">    <span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span>(<span class="params">fn, interval</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> _self = fn, <span class="comment">//保存需要被延迟的函数</span></div><div class="line">            firstTime = <span class="literal">true</span>, <span class="comment">// 是否首次调用</span></div><div class="line">            intervalTime = interval || <span class="number">500</span>, <span class="comment">// 间隔调用时间，默认500毫秒</span></div><div class="line">            timer; <span class="comment">// 定时器</span></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> args = <span class="built_in">arguments</span>,</div><div class="line">                _me = <span class="keyword">this</span>;</div><div class="line">            <span class="keyword">if</span> (firstTime) &#123; <span class="comment">// 如果第一次，则无需延迟，直接调用</span></div><div class="line">                _self.apply(_me, args);</div><div class="line">                <span class="keyword">return</span> firstTime = <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (timer) &#123; <span class="comment">// 如果定时器存在，说明前一次执行还没有完成</span></div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 延迟intervalTime后执行</span></div><div class="line">                clearTimeout(timer);</div><div class="line">                timer = <span class="literal">null</span>;</div><div class="line">                _self.apply(_me, args);</div><div class="line">            &#125;, intervalTime);</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="built_in">window</span>.onresize = throttle(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>); <span class="comment">// 只触发了几次</span></div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">    <span class="comment">// window.onresize = function() &#123;</span></div><div class="line">    <span class="comment">//     console.log(1); // 几十次</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="分时函数"><a href="#分时函数" class="headerlink" title="分时函数"></a>分时函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 当一次性往DOM中添加大量节点，浏览器会卡死，所以需要分时间添加节点</span></div><div class="line">    <span class="comment">// var ary = [];</span></div><div class="line">    <span class="comment">// for (var i = 1; i &lt;= 99999; i++) &#123;</span></div><div class="line">    <span class="comment">//     ary.push(i); // 假设ary 装载了1000 个好友的数据</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var renderFriendList = function(data) &#123;</span></div><div class="line">    <span class="comment">//     for (var i = 0, l = data.length; i &lt; l; i++) &#123;</span></div><div class="line">    <span class="comment">//         var div = document.createElement('div');</span></div><div class="line">    <span class="comment">//         div.innerHTML = i;</span></div><div class="line">    <span class="comment">//         document.body.appendChild(div);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// renderFriendList(ary);</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 实现分时的函数，在intervalTime时间间隔内执行count次fn函数</div><div class="line">     * @author cgh</div><div class="line">     * @time   2017-03-06</div><div class="line">     * @param  &#123;Array&#125;   	ary    			每次fn执行需要的参数数组</div><div class="line">     * @param  &#123;Function&#125; 	fn    			处理函数</div><div class="line">     * @param  &#123;Number&#125;   	count 			每个时间间隔内执行的次数</div><div class="line">     * @param  &#123;Number&#125;   	intervalTime 	时间间隔</div><div class="line">     * @return &#123;Function&#125;       			函数</div><div class="line">     */</div><div class="line">    <span class="keyword">var</span> timeChunk = <span class="function"><span class="keyword">function</span>(<span class="params">ary, fn, count, interval</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> obj, t,</div><div class="line">            len = ary.length,</div><div class="line">            intervalTime = interval || <span class="number">200</span>; <span class="comment">// 默认时间间隔200ms</span></div><div class="line">        <span class="keyword">var</span> start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.min(count || <span class="number">1</span>, len); i++) &#123;</div><div class="line">                obj = ary.shift();</div><div class="line">                fn(obj);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            t = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (ary.length === <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">return</span> clearInterval(t);</div><div class="line">                &#125;</div><div class="line">                start();</div><div class="line">            &#125;, intervalTime);</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> ary = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">800</span>; i++) &#123;</div><div class="line">        ary.push(i);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 每隔500ms创建8个节点插入到DOM中</span></div><div class="line">    <span class="keyword">var</span> renderFriendList = timeChunk(ary, <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">        div.innerHTML = n;</div><div class="line">        <span class="built_in">document</span>.body.appendChild(div);</div><div class="line">    &#125;, <span class="number">8</span>, <span class="number">500</span>);</div><div class="line">    renderFriendList();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="惰性载入函数"><a href="#惰性载入函数" class="headerlink" title="惰性载入函数"></a>惰性载入函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span>点我绑定事件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> addEvent = <span class="function"><span class="keyword">function</span>(<span class="params">elem, type, handler</span>) </span>&#123;</div><div class="line">        <span class="comment">// 首次点击时判断绑定方式，后续点击时无需再判断</span></div><div class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.addEventListener) &#123;</div><div class="line">            addEvent = <span class="function"><span class="keyword">function</span>(<span class="params">elem, type, handler</span>) </span>&#123;</div><div class="line">                elem.addEventListener(type, handler, <span class="literal">false</span>);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.attachEvent) &#123;</div><div class="line">            addEvent = <span class="function"><span class="keyword">function</span>(<span class="params">elem, type, handler</span>) </span>&#123;</div><div class="line">                elem.attachEvent(<span class="string">'on'</span> + type, handler);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        addEvent(elem, type, handler);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'div1'</span>);</div><div class="line">    addEvent(div, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">1</span>);</div><div class="line">    &#125;);</div><div class="line">    addEvent(div, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">2</span>);</div><div class="line">    &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><h3 id="基本定义"><a href="#基本定义" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 单例模式:保证一个类仅有一个实例，并提供一个访问它的全局访问点</span></div><div class="line">    <span class="comment">// 使用场景:当某些对象只需要一个的时候，如线程池、全局缓存、window等</span></div><div class="line">    <span class="comment">// 使用举例:如登录页，点击按钮生成登录框，这个登录框只会生成一次，不会每次点击都生成一个</span></div><div class="line">    <span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.instance = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    Singleton.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="keyword">this</span>.name);</div><div class="line">    &#125;;</div><div class="line">    Singleton.getInstance = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.instance) &#123;</div><div class="line">            <span class="keyword">this</span>.instance = <span class="keyword">new</span> Singleton(name);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.instance;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> a = Singleton.getInstance(<span class="string">"AAA"</span>);</div><div class="line">    <span class="keyword">var</span> b = Singleton.getInstance(<span class="string">"BBB"</span>);</div><div class="line">    <span class="built_in">console</span>.log(a === b); <span class="comment">//true</span></div><div class="line">    <span class="comment">// 此种方法通过getInstance来获取实例，和正常的new不一样，用户必须知道这是个单例模式，也就是用户必须知道是通过getInstance方法来获取实例而不是new方式，所就这种方式对用户来说"不透明"</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="透明的单例模式"><a href="#透明的单例模式" class="headerlink" title="透明的单例模式"></a>透明的单例模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 实例化时不是通过特殊的方法来实现，实例化和平常一样使用new</span></div><div class="line">    <span class="keyword">var</span> CreateDiv = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> instance;</div><div class="line">        <span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (instance) &#123;</div><div class="line">                <span class="keyword">return</span> instance;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">this</span>.html = html;</div><div class="line">            <span class="keyword">this</span>.init();</div><div class="line">            <span class="keyword">return</span> instance = <span class="keyword">this</span>;</div><div class="line">        &#125;;</div><div class="line">        CreateDiv.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">            div.innerHTML = <span class="keyword">this</span>.html;</div><div class="line">            <span class="built_in">document</span>.body.appendChild(div);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> CreateDiv;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> a = <span class="keyword">new</span> CreateDiv(<span class="string">"div1"</span>);</div><div class="line">    <span class="keyword">var</span> b = <span class="keyword">new</span> CreateDiv(<span class="string">"div2"</span>);</div><div class="line">    <span class="built_in">console</span>.log(a === b); <span class="comment">// true</span></div><div class="line">    <span class="comment">// 不足:此处的构造函数做了2件事，1.创建对象并初始化2.保证只有一个对象。如果某天需要在页面中创建多个div，则需要手动修改此构造函数，所以推荐用代理实现单例模式</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="用代理实现单例模式"><a href="#用代理实现单例模式" class="headerlink" title="用代理实现单例模式"></a>用代理实现单例模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> CreateDiv = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.html = html;</div><div class="line">        <span class="keyword">this</span>.init();</div><div class="line">    &#125;;</div><div class="line">    CreateDiv.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">        div.innerHTML = <span class="keyword">this</span>.html;</div><div class="line">        <span class="built_in">document</span>.body.appendChild(div);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 引入代理,来保证实例的单一性</span></div><div class="line">    <span class="keyword">var</span> ProxySingletonCreateDiv = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> instance;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (!instance) &#123;</div><div class="line">                instance = <span class="keyword">new</span> CreateDiv(html);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> instance;</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> a = <span class="keyword">new</span> ProxySingletonCreateDiv(<span class="string">"div1"</span>);</div><div class="line">    <span class="keyword">var</span> b = <span class="keyword">new</span> ProxySingletonCreateDiv(<span class="string">"div2"</span>);</div><div class="line">    <span class="built_in">console</span>.log(a === b); <span class="comment">//true</span></div><div class="line">    <span class="comment">// 这样创建div和保证单一性就分开了，后期也好修改</span></div><div class="line">    <span class="comment">// 这些方法都和传统的面向对象编程一样，先有类，再创建实例</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="js中的单例模式"><a href="#js中的单例模式" class="headerlink" title="js中的单例模式"></a>js中的单例模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 单例模式的核心是只有一个实例，并提供全局访问，所以在JS中无需脱裤子放屁，先创建个类，再从类创建实例，可以直接用全局变量(对象)来创建单例</span></div><div class="line">    <span class="comment">// 全局对象满足单例的两个核心点，一个实例并提供全局访问，虽然全局对象不是单例模式，但在JS中会把全局对象当做单例模式来用</span></div><div class="line">    <span class="comment">// 但全局变量(对象)会造成全局变量污染，所以需要避免，可通过下面方式</span></div><div class="line"></div><div class="line">    <span class="comment">// 使用命名空间</span></div><div class="line">    <span class="keyword">var</span> namespace1 = &#123;</div><div class="line">        <span class="attr">a</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            alert(<span class="number">1</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">b</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            alert(<span class="number">2</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 使用闭包封装私有变量</span></div><div class="line">    <span class="keyword">var</span> user = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> _name = <span class="string">"aaa"</span>;</div><div class="line">        <span class="keyword">var</span> _age = <span class="number">18</span>;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">getUserInfo</span>: functioin() &#123;</div><div class="line">                <span class="keyword">return</span> _name + <span class="string">":"</span> + _age;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="惰性单例"><a href="#惰性单例" class="headerlink" title="惰性单例"></a>惰性单例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"loginBtn"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 惰性单例指的是在需要的时候才创建对象实例，实际在19中Singleton.getInstance就是在需要的时候创建实例，并非一开始就创建</span></div><div class="line">    <span class="comment">// 利用全局变量(对象)和惰性单例来实现登录弹窗对象的创建</span></div><div class="line">    <span class="comment">// var loginLayer = (function() &#123;</span></div><div class="line">    <span class="comment">//     var div = document.createElement("div");</span></div><div class="line">    <span class="comment">//     div.innerHTML = "我是登录窗口";</span></div><div class="line">    <span class="comment">//     div.style.display = 'none';</span></div><div class="line">    <span class="comment">//     document.body.appendChild(div);</span></div><div class="line">    <span class="comment">//     return div;</span></div><div class="line">    <span class="comment">// &#125;)();</span></div><div class="line">    <span class="comment">// document.getElementById('loginBtn').onclick = function() &#123;</span></div><div class="line">    <span class="comment">//     loginLayer.style.display = 'block';</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// 上面这种在页面加载的时候就会创建一个登录窗口，如果用户根本不点登录的时候也会创建，所以会浪费</span></div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="comment">// var createLoginLayer = function() &#123;</span></div><div class="line">    <span class="comment">//     var div = document.createElement("div");</span></div><div class="line">    <span class="comment">//     div.innerHTML = "我是登录窗口";</span></div><div class="line">    <span class="comment">//     div.style.display = 'none';</span></div><div class="line">    <span class="comment">//     document.body.appendChild(div);</span></div><div class="line">    <span class="comment">//     return div;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line"></div><div class="line">    <span class="comment">// document.getElementById('loginBtn').onclick = function() &#123;</span></div><div class="line">    <span class="comment">//     var loginLayer = createLoginLayer();</span></div><div class="line">    <span class="comment">//     loginLayer.style.display = 'block';</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// 这样虽然不会一载入就创建，但是没有保证单例，多次点击会创建多个</span></div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> createLoginLayer = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> div;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (!div) &#123;</div><div class="line">                div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">                div.innerHTML = <span class="string">"我是登录窗口"</span>;</div><div class="line">                div.style.display = <span class="string">"none"</span>;</div><div class="line">                <span class="built_in">document</span>.body.appendChild(div);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> div;</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> loginLayer = createLoginLayer();</div><div class="line">        loginLayer.style.display = <span class="string">'block'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 上面的方式已经能实现基本功能，但是仔细观察会发现，他将创建对象和管理单例的逻辑放在了一起，加入下次想创建一个iframe，就必须将上面代码再抄一遍</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="通用的惰性单例"><a href="#通用的惰性单例" class="headerlink" title="通用的惰性单例"></a>通用的惰性单例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"loginBtn"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"loginBtn2"</span>&gt;</span>登录2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 将23中的管理单例的逻辑给隔离(抽象)出来，实现创建和管理的分离</span></div><div class="line">    <span class="comment">// 管理单例</span></div><div class="line">    <span class="keyword">var</span> getSingle = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> result;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> result || (result = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 创建login对象</span></div><div class="line">    <span class="keyword">var</span> createLoginLayer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">        div.innerHTML = <span class="string">'我是登录浮窗'</span>;</div><div class="line">        div.style.display = <span class="string">'none'</span>;</div><div class="line">        <span class="built_in">document</span>.body.appendChild(div);</div><div class="line">        <span class="keyword">return</span> div;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> createSingleLoginLayer = getSingle(createLoginLayer);</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'loginBtn'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> loginLayer = createSingleLoginLayer();</div><div class="line">        loginLayer.style.display = <span class="string">'block'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 创建iframe对象</span></div><div class="line">    <span class="keyword">var</span> createIframe = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</div><div class="line">        <span class="built_in">document</span>.body.appendChild(iframe);</div><div class="line">        <span class="keyword">return</span> iframe;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> createSingleIframe = getSingle(createIframe);</div><div class="line"></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'loginBtn2'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> loginLayer = createSingleIframe();</div><div class="line">        loginLayer.src = <span class="string">'http://baidu.com'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><h3 id="基本定义-1"><a href="#基本定义-1" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 策略模式:定义一系列算法，把他们一个一个封装起来，并且使他们可以相互替换。策略模式定义了算法家族，分别封装起来，让他们之间可以互相替换，此模式让算法的变化不会影响到使用算法的客户。它将算法的实现和使用分离</span></div><div class="line">    <span class="comment">// 应用场景:当需要根据不同策略(算法)计算时;实践中，不仅可以封装算法，也可以用来封装几乎任何类型的规则，是要在分析过程中需要在不同时间应用不同的业务规则，就可以考虑是要策略模式来处理各种变化。</span></div><div class="line">    <span class="comment">// 使用举例:根据工资和绩效等级计算年终奖、缓动动画、表单验证，这三种都是会有多中不同的策略，如年终奖有SAB三等级3个策略，最终都是要得到年终奖。缓动动画有ease-in,ease-out...，最后是要得到一个动画。表单验证需要验证数字、邮箱...等，但最终都要得到是否验证通过这一结果。都是需要根据不同策略，得出某结果</span></div><div class="line">    <span class="comment">// 组成部分:1.一组策略类，封装了算法，并负责具体计算2.环境类Contex，负责接收请求，并把请求委托给某个具体的策略类</span></div><div class="line"></div><div class="line">    <span class="comment">// var calculateBonus = function(performanceLevel, salary) &#123;</span></div><div class="line">    <span class="comment">//     if (performanceLevel === "S") &#123;</span></div><div class="line">    <span class="comment">//         return salary * 4;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     if (performanceLevel === "A") &#123;</span></div><div class="line">    <span class="comment">//         return salary * 3;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     if (performanceLevel === "B") &#123;</span></div><div class="line">    <span class="comment">//         return salary * 2;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// console.log(calculateBonus("B", 2000)); //4000</span></div><div class="line">    <span class="comment">// console.log(calculateBonus("S", 4000)); //16000</span></div><div class="line">    <span class="comment">// 上面的缺点</span></div><div class="line">    <span class="comment">// 函数庞大，包含了很多if-else，这些要覆盖所有的逻辑分支</span></div><div class="line">    <span class="comment">// 缺乏弹性，如果要增加C等级，或修改倍数，必须进入函数内部修改</span></div><div class="line">    <span class="comment">// 算法复用性差</span></div><div class="line"></div><div class="line">    <span class="comment">// 使用组合函数重构</span></div><div class="line">    <span class="keyword">var</span> performanceS = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> salary * <span class="number">4</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> performanceA = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> salary * <span class="number">3</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> performanceB = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> salary * <span class="number">2</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> calculateBonus = <span class="function"><span class="keyword">function</span>(<span class="params">performanceLevel, salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (performanceLevel === <span class="string">'S'</span>) &#123;</div><div class="line">            <span class="keyword">return</span> performanceS(salary);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (performanceLevel === <span class="string">'A'</span>) &#123;</div><div class="line">            <span class="keyword">return</span> performanceA(salary);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (performanceLevel === <span class="string">'B'</span>) &#123;</div><div class="line">            <span class="keyword">return</span> performanceB(salary);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    calculateBonus(<span class="string">'A'</span>, <span class="number">10000</span>); <span class="comment">// 输出：30000</span></div><div class="line">    <span class="comment">// 虽然解决了算法复用，但是依旧庞大，并缺乏弹性</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="传统面向对象中的策略模式"><a href="#传统面向对象中的策略模式" class="headerlink" title="传统面向对象中的策略模式"></a>传统面向对象中的策略模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 使用传统面向对象方式实现策略模式，将不同策略封装到不同的类中</span></div><div class="line">    <span class="comment">// 一组策略类</span></div><div class="line">    <span class="keyword">var</span> performanceS = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    performanceS.prototype.calculate = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> salary * <span class="number">4</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> performanceA = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    performanceA.prototype.calculate = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> salary * <span class="number">3</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> performanceB = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    performanceB.prototype.calculate = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> salary * <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> Bonus = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.salary = <span class="literal">null</span>; <span class="comment">// 工资</span></div><div class="line">        <span class="keyword">this</span>.strategy = <span class="literal">null</span>; <span class="comment">// 绩效等级对应的策略对象</span></div><div class="line">    &#125;;</div><div class="line">    Bonus.prototype.setSalary = <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.salary = salary;</div><div class="line">    &#125;;</div><div class="line">    Bonus.prototype.setStrategy = <span class="function"><span class="keyword">function</span>(<span class="params">strategy</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.strategy = strategy;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 环境类，把请求委托给具体的策略对象</span></div><div class="line">    Bonus.prototype.getBonus = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.strategy.calculate(<span class="keyword">this</span>.salary); <span class="comment">// 把计算具体奖金的工作委托给某个策略对象</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> bonus = <span class="keyword">new</span> Bonus(); <span class="comment">// 实例化一个年终奖对象</span></div><div class="line">    bonus.setSalary(<span class="number">1000</span>); <span class="comment">// 添加工资</span></div><div class="line">    bonus.setStrategy(<span class="keyword">new</span> performanceS()); <span class="comment">// 传入绩效等级</span></div><div class="line">    <span class="built_in">console</span>.log(bonus.getBonus()); <span class="comment">// 获得年终奖</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="js中的策略模式"><a href="#js中的策略模式" class="headerlink" title="js中的策略模式"></a>js中的策略模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 传统的策略模式对象，必须要从类中创建，但是JS中可以直接创建，环境类对象也不用从类中创建，可以直接创建</span></div><div class="line">    <span class="comment">// 一组策略</span></div><div class="line">    <span class="keyword">var</span> strategies = &#123;</div><div class="line">        <span class="string">"S"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> salary * <span class="number">4</span>;</div><div class="line">        &#125;,</div><div class="line">        <span class="string">"A"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> salary * <span class="number">3</span>;</div><div class="line">        &#125;,</div><div class="line">        <span class="string">"B"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> salary * <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 负责把请求委托给具体的某个策略类</span></div><div class="line">    <span class="keyword">var</span> calculateBonus = <span class="function"><span class="keyword">function</span>(<span class="params">level, salary</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> strategies[level](salary);</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">console</span>.log(calculateBonus(<span class="string">"S"</span>, <span class="number">3000</span>)); <span class="comment">//12000</span></div><div class="line">    <span class="built_in">console</span>.log(calculateBonus(<span class="string">"A"</span>, <span class="number">1000</span>)); <span class="comment">//2000</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="使用策略模式实现缓动动画"><a href="#使用策略模式实现缓动动画" class="headerlink" title="使用策略模式实现缓动动画"></a>使用策略模式实现缓动动画</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position:absolute;background:blue"</span> <span class="attr">id</span>=<span class="string">"div"</span>&gt;</span>我是div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 将各种缓动动画的算法封装起来</span></div><div class="line">    <span class="keyword">var</span> tween = &#123;</div><div class="line">        <span class="comment">// t是动画已消耗的时间、b小球原始位置、c小球目标位置、d动画持续的总时间</span></div><div class="line">        linear: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * t / d + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">easeIn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * (t /= d) * t + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">strongEaseIn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * (t /= d) * t * t * t * t + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">strongEaseOut</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * ((t = t / d - <span class="number">1</span>) * t * t * t * t + <span class="number">1</span>) + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">sineaseIn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * (t /= d) * t * t + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">sineaseOut</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * ((t = t / d - <span class="number">1</span>) * t * t + <span class="number">1</span>) + b;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Animate = <span class="function"><span class="keyword">function</span>(<span class="params">dom</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dom = dom; <span class="comment">// 进行运动的dom 节点</span></div><div class="line">        <span class="keyword">this</span>.startTime = <span class="number">0</span>; <span class="comment">// 动画开始时间</span></div><div class="line">        <span class="keyword">this</span>.startPos = <span class="number">0</span>; <span class="comment">// 动画开始时，dom 节点的位置，即dom 的初始位置</span></div><div class="line">        <span class="keyword">this</span>.endPos = <span class="number">0</span>; <span class="comment">// 动画结束时，dom 节点的位置，即dom 的目标位置</span></div><div class="line">        <span class="keyword">this</span>.propertyName = <span class="literal">null</span>; <span class="comment">// dom 节点需要被改变的css 属性名</span></div><div class="line">        <span class="keyword">this</span>.easing = <span class="literal">null</span>; <span class="comment">// 缓动算法</span></div><div class="line">        <span class="keyword">this</span>.duration = <span class="literal">null</span>; <span class="comment">// 动画持续时间</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// start负责启动动画</span></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 启动动画</div><div class="line">     * @author cgh</div><div class="line">     * @time   2017-03-07</div><div class="line">     * @param  &#123;String&#125;   propertyName 要运动的属性</div><div class="line">     * @param  &#123;Number&#125;   endPos       结束位置</div><div class="line">     * @param  &#123;Time&#125;   duration     持续时间</div><div class="line">     * @param  &#123;Obj&#125;   easing       缓动算法</div><div class="line">     * @return &#123;[type]&#125;                [description]</div><div class="line">     */</div><div class="line">    Animate.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params">propertyName, endPos, duration, easing</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.startTime = +<span class="keyword">new</span> <span class="built_in">Date</span>; <span class="comment">// 动画启动时间</span></div><div class="line">        <span class="keyword">this</span>.startPos = <span class="keyword">this</span>.dom.getBoundingClientRect()[propertyName]; <span class="comment">// dom 节点初始位置</span></div><div class="line">        <span class="keyword">this</span>.propertyName = propertyName; <span class="comment">// dom 节点需要被改变的CSS 属性名</span></div><div class="line">        <span class="keyword">this</span>.endPos = endPos; <span class="comment">// dom 节点目标位置</span></div><div class="line">        <span class="keyword">this</span>.duration = duration; <span class="comment">// 动画持续事件</span></div><div class="line">        <span class="keyword">this</span>.easing = tween[easing]; <span class="comment">// 缓动算法</span></div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">var</span> timeId = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 启动定时器，开始执行动画</span></div><div class="line">            <span class="keyword">if</span> (self.step() === <span class="literal">false</span>) &#123; <span class="comment">// 如果动画已结束，则清除定时器</span></div><div class="line">                clearInterval(timeId);</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">1000</span> / <span class="number">60</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 定义小球每一帧的动画</span></div><div class="line">    Animate.prototype.step = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> t = +<span class="keyword">new</span> <span class="built_in">Date</span>; <span class="comment">// 取得当前时间</span></div><div class="line">        <span class="keyword">if</span> (t &gt;= <span class="keyword">this</span>.startTime + <span class="keyword">this</span>.duration) &#123; <span class="comment">// (1)</span></div><div class="line">            <span class="keyword">this</span>.update(<span class="keyword">this</span>.endPos); <span class="comment">// 更新小球的CSS 属性值</span></div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> pos = <span class="keyword">this</span>.easing(t - <span class="keyword">this</span>.startTime, <span class="keyword">this</span>.startPos, <span class="keyword">this</span>.endPos - <span class="keyword">this</span>.startPos, <span class="keyword">this</span>.duration);</div><div class="line">        <span class="comment">// pos 为小球当前位置</span></div><div class="line">        <span class="keyword">this</span>.update(pos); <span class="comment">// 更新小球的CSS 属性值</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 负责更新动画</span></div><div class="line">    Animate.prototype.update = <span class="function"><span class="keyword">function</span>(<span class="params">pos</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dom.style[<span class="keyword">this</span>.propertyName] = pos + <span class="string">'px'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'div'</span>);</div><div class="line">    <span class="keyword">var</span> animate = <span class="keyword">new</span> Animate(div);</div><div class="line">    animate.start(<span class="string">'left'</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="string">'strongEaseOut'</span>);</div><div class="line">    <span class="comment">// animate.start('top', 1500, 500, 'strongEaseIn');</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="使用策略模式完成表单验证"><a href="#使用策略模式完成表单验证" class="headerlink" title="使用策略模式完成表单验证"></a>使用策略模式完成表单验证</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"registerForm"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></div><div class="line">        请输入用户名：</div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userName"</span> /&gt;</span> 请输入密码：</div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span> 请输入手机号码：</div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"phoneNumber"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 策略模式的主要目的是将算法的实现和使用分离</span></div><div class="line">    <span class="comment">// 但在广义的情况下，也可以用策略模式将一些业务规则封装起来，只要这些业务规则指向的目标一致，并可被替换使用即可。如表单验证</span></div><div class="line">    <span class="comment">// var registerForm = document.getElementById('registerForm');</span></div><div class="line">    <span class="comment">// registerForm.onsubmit = function() &#123;</span></div><div class="line">    <span class="comment">//     if (registerForm.userName.value === '') &#123;</span></div><div class="line">    <span class="comment">//         alert('用户名不能为空');</span></div><div class="line">    <span class="comment">//         return false;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     if (registerForm.password.value.length &lt; 6) &#123;</span></div><div class="line">    <span class="comment">//         alert('密码长度不能少于6 位');</span></div><div class="line">    <span class="comment">//         return false;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     if (!/(^1[3|5|8][0-9]&#123;9&#125;$)/.test(registerForm.phoneNumber.value)) &#123;</span></div><div class="line">    <span class="comment">//         alert('手机号码格式不正确');</span></div><div class="line">    <span class="comment">//         return false;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// 不足很明显，函数比较庞大、缺乏弹性、复用性差</span></div><div class="line">    <span class="comment">// 策略模式改进</span></div><div class="line"></div><div class="line">    <span class="comment">// 封装校验逻辑</span></div><div class="line">    <span class="comment">/***********************策略对象**************************/</span></div><div class="line">    <span class="keyword">var</span> strategies = &#123;</div><div class="line">        <span class="attr">isNonEmpty</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value, errorMsg</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (value === <span class="string">''</span>) &#123;</div><div class="line">                <span class="keyword">return</span> errorMsg;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">minLength</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value, length, errorMsg</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (value.length &lt; length) &#123;</div><div class="line">                <span class="keyword">return</span> errorMsg;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">isMobile</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value, errorMsg</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (!<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test(value)) &#123;</div><div class="line">                <span class="keyword">return</span> errorMsg;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/***********************Validator 类**************************/</span></div><div class="line">    <span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.cache = [];</div><div class="line">    &#125;;</div><div class="line">    Validator.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">dom, rules</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, rule; rule = rules[i++];) &#123;</div><div class="line">            (<span class="function"><span class="keyword">function</span>(<span class="params">rule</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> strategyAry = rule.strategy.split(<span class="string">':'</span>);</div><div class="line">                <span class="keyword">var</span> errorMsg = rule.errorMsg;</div><div class="line">                self.cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> strategy = strategyAry.shift();</div><div class="line">                    strategyAry.unshift(dom.value);</div><div class="line">                    strategyAry.push(errorMsg);</div><div class="line">                    <span class="keyword">return</span> strategies[strategy].apply(dom, strategyAry);</div><div class="line">                &#125;);</div><div class="line">            &#125;)(rule)</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Validator.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, validatorFunc; validatorFunc = <span class="keyword">this</span>.cache[i++];) &#123;</div><div class="line">            <span class="keyword">var</span> errorMsg = validatorFunc();</div><div class="line">            <span class="keyword">if</span> (errorMsg) &#123;</div><div class="line">                <span class="keyword">return</span> errorMsg;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/***********************客户调用代码**************************/</span></div><div class="line">    <span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById(<span class="string">'registerForm'</span>);</div><div class="line">    <span class="keyword">var</span> validataFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> validator = <span class="keyword">new</span> Validator();</div><div class="line">        validator.add(registerForm.userName, [&#123;</div><div class="line">            <span class="attr">strategy</span>: <span class="string">'isNonEmpty'</span>,</div><div class="line">            <span class="attr">errorMsg</span>: <span class="string">'用户名不能为空'</span></div><div class="line">        &#125;, &#123;</div><div class="line">            <span class="attr">strategy</span>: <span class="string">'minLength:6'</span>,</div><div class="line">            <span class="attr">errorMsg</span>: <span class="string">'用户名长度不能小于10 位'</span></div><div class="line">        &#125;]);</div><div class="line">        validator.add(registerForm.password, [&#123;</div><div class="line">            <span class="attr">strategy</span>: <span class="string">'minLength:6'</span>,</div><div class="line">            <span class="attr">errorMsg</span>: <span class="string">'密码长度不能小于6 位'</span></div><div class="line">        &#125;]);</div><div class="line">        validator.add(registerForm.phoneNumber, [&#123;</div><div class="line">            <span class="attr">strategy</span>: <span class="string">'isMobile'</span>,</div><div class="line">            <span class="attr">errorMsg</span>: <span class="string">'手机号码格式不正确'</span></div><div class="line">        &#125;]);</div><div class="line">        <span class="keyword">var</span> errorMsg = validator.start();</div><div class="line">        <span class="keyword">return</span> errorMsg;</div><div class="line">    &#125;</div><div class="line">    registerForm.onsubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> errorMsg = validataFunc();</div><div class="line">        <span class="keyword">if</span> (errorMsg) &#123;</div><div class="line">            alert(errorMsg);</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 策略模式优点</span></div><div class="line">    <span class="comment">// 策略模式利用组合、委托和多态等技术和思想，可以有效地避免多重条件选择语句。</span></div><div class="line">    <span class="comment">// 策略模式提供了对开放— 封闭原则的完美支持，将算法封装在独立的strategy中，使得它们易于切换，易于理解，易于扩展。</span></div><div class="line">    <span class="comment">// 策略模式中的算法也可以复用在系统的其他地方，从而避免许多重复的复制粘贴工作。</span></div><div class="line">    <span class="comment">// 在策略模式中利用组合和委托来让Context 拥有执行算法的能力，这也是继承的一种更轻便的替代方案。</span></div><div class="line"></div><div class="line">    <span class="comment">// 缺点</span></div><div class="line">    <span class="comment">// 使用策略模式会在程序中增加许多策略类或者策略对象，但实际上这比把它们负责的逻辑堆砌在Context 中要好。</span></div><div class="line">    <span class="comment">// 要使用策略模式，必须了解所有的strategy，必须了解各个strategy 之间的不同点，这样才能选择一个合适的strategy,此时strategy 要向客户暴露它的所有实现，这是违反最少知识原则的</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><h3 id="基本定义-2"><a href="#基本定义-2" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 代理模式:为一个对象提供一个代用品或占位符，以便控制对它的访问</span></div><div class="line">    <span class="comment">// 应用场景:当不方便直接访问某个对象时</span></div><div class="line">    <span class="comment">// 分类:</span></div><div class="line">    <span class="comment">// JS中常用:</span></div><div class="line">    <span class="comment">// 虚拟代理模式:会把一些开销很大的对象，延迟到真正需要它的时候再创建(常用)</span></div><div class="line">    <span class="comment">// 缓存代理模式:可以为一些开销很大的运算结果提供暂时的缓存，在下次运算时，如果传递进来的参数跟之前一致，则可直接返回缓存的结果(常用)</span></div><div class="line">    <span class="comment">// </span></div><div class="line">    <span class="comment">// 不常用:</span></div><div class="line">    <span class="comment">// 保护代理模式:代理B可以帮A过滤掉一些请求</span></div><div class="line">    <span class="comment">// 防火墙代理模式:控制网络资源的访问，保护主体不让"坏人"接近</span></div><div class="line">    <span class="comment">// 远程代理模式:为一个对象在不同的地址空间提供局部代表，在Java 中，远程代理可以是另一个虚拟机中的对象。</span></div><div class="line">    <span class="comment">// 保护代理模式：用于对象应该有不同访问权限的情况。</span></div><div class="line">    <span class="comment">// 智能引用代理模式：取代了简单的指针，它在访问对象时执行一些附加操作，比如计算一个对象被引用的次数。</span></div><div class="line">    <span class="comment">// 写时复制代理：通常用于复制一个庞大对象的情况。写时复制代理延迟了复制的过程，当对象被真正修改时，才对它进行复制操作。写时复制代理是虚拟代理的一种变体，DLL（操作系统中的动态链接库）是其典型运用场景。</span></div><div class="line"></div><div class="line">    <span class="comment">// 使用举例:小明托人送花、虚拟代理实现图片预加载、缓存代理异步ajax请求</span></div><div class="line"></div><div class="line">    <span class="comment">// 小明委托B给A送花</span></div><div class="line">    <span class="comment">// var Flower = function() &#123;&#125;;</span></div><div class="line">    <span class="comment">// // 发起者</span></div><div class="line">    <span class="comment">// var xiaoMing = &#123;</span></div><div class="line">    <span class="comment">//     sendFolower: function(target) &#123;</span></div><div class="line">    <span class="comment">//         var flower = new Flower();</span></div><div class="line">    <span class="comment">//         target.receiveFlower(flower);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// // 接收者</span></div><div class="line">    <span class="comment">// var A = &#123;</span></div><div class="line">    <span class="comment">//     receiveFlower: function(flower) &#123;</span></div><div class="line">    <span class="comment">//         console.log("收到花" + flower);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// // 被委托的对象</span></div><div class="line">    <span class="comment">// var B = &#123;</span></div><div class="line">    <span class="comment">//     receiveFlower: function(flower) &#123;</span></div><div class="line">    <span class="comment">//         A.receiveFlower(flower);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// xiaoMing.sendFolower(B);</span></div><div class="line"></div><div class="line">    <span class="comment">// 不足，上面这个例子看不出小明自己送和托B送有什么区别，因为B只是简单的把花递给了A</span></div><div class="line">    <span class="comment">// 考虑下面情况</span></div><div class="line">    <span class="comment">// 在A心情好的时候小明送花，成功率很高。如果心情不好的时候送花，则成功率为0。小明才认识A，并不知道她心情的变化，而A的好朋友B却很了解，所以小明只管把花交给B，B负责监听A，在A心情好的时候将花传递给A</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> Flower = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> xiaoMing = &#123;</div><div class="line">        <span class="attr">sendFolower</span>: <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> flower = <span class="keyword">new</span> Flower();</div><div class="line">            target.receiveFlower(flower);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> A = &#123;</div><div class="line">        <span class="attr">receiveFlower</span>: <span class="function"><span class="keyword">function</span>(<span class="params">flower</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"收到花"</span> + flower);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">listenGoodMood</span>: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">            setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 假设1s后心情变好</span></div><div class="line">                fn();</div><div class="line">            &#125;, <span class="number">3000</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> B = &#123;</div><div class="line">        <span class="attr">receiveFlower</span>: <span class="function"><span class="keyword">function</span>(<span class="params">flower</span>) </span>&#123;</div><div class="line">            A.listenGoodMood(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 监听A的心情</span></div><div class="line">                A.receiveFlower(flower);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    xiaoMing.sendFolower(B);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="虚拟代理模式实现图片预加载"><a href="#虚拟代理模式实现图片预加载" class="headerlink" title="虚拟代理模式实现图片预加载"></a>虚拟代理模式实现图片预加载</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 在Web 开发中，图片预加载是一种常用的技术，如果直接给某个img标签节点设置src属性，由于图片过大或者网络不佳，图片的位置往往有段时间会是一片空白。常见的做法是先用一张loading 片占位，然后用异步的方式加载图片，等图片加载好了再把它填充到img节点里，这种场景就很适合使用虚拟代理</span></div><div class="line">    <span class="comment">// 非代理模式实现</span></div><div class="line">    <span class="comment">// var MyImage = (function() &#123;</span></div><div class="line">    <span class="comment">//     var imgNode = document.createElement('img');</span></div><div class="line">    <span class="comment">//     document.body.appendChild(imgNode);</span></div><div class="line">    <span class="comment">//     var img = new Image;</span></div><div class="line">    <span class="comment">//     img.onload = function() &#123;</span></div><div class="line">    <span class="comment">//         imgNode.src = img.src;</span></div><div class="line">    <span class="comment">//     &#125;;</span></div><div class="line">    <span class="comment">//     return &#123;</span></div><div class="line">    <span class="comment">//         setSrc: function(src) &#123;</span></div><div class="line">    <span class="comment">//             imgNode.src = 'http://img.zcool.cn/community/013cb15648986a32f87512f6d87dc8.gif';</span></div><div class="line">    <span class="comment">//             img.src = src;</span></div><div class="line">    <span class="comment">//         &#125;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;)();</span></div><div class="line">    <span class="comment">// MyImage.setSrc('http://img1.3lian.com/2015/a1/24/d/17.jpg');</span></div><div class="line">    <span class="comment">// 上面违反了单一职责原则，MyImage既负责给img设置src外，还负责预加载图片</span></div><div class="line"></div><div class="line">    <span class="comment">// 虚拟代理模式</span></div><div class="line">    <span class="comment">// 普通本体对象，对外提供一个setSrc接口</span></div><div class="line">    <span class="keyword">var</span> myImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> imgNode = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</div><div class="line">        <span class="built_in">document</span>.body.appendChild(imgNode);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">setSrc</span>: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</div><div class="line">                imgNode.src = src;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    <span class="comment">// 代理对象</span></div><div class="line">    <span class="keyword">var</span> proxyImage = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</div><div class="line">        img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="comment">// 真图请求完成，将真图放到页面上</span></div><div class="line">            myImage.setSrc(<span class="keyword">this</span>.src);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">setSrc</span>: <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</div><div class="line">                <span class="comment">// 设置loading图</span></div><div class="line">                myImage.setSrc(<span class="string">'http://img.zcool.cn/community/013cb15648986a32f87512f6d87dc8.gif'</span>);</div><div class="line">                <span class="comment">// 设置真图地址</span></div><div class="line">                img.src = src;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    proxyImage.setSrc(<span class="string">'http://img1.3lian.com/2015/a1/24/d/17.jpg'</span>);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="虚拟代理合并http请求"><a href="#虚拟代理合并http请求" class="headerlink" title="虚拟代理合并http请求"></a>虚拟代理合并http请求</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>1</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>2</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"3"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>3</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"4"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>4</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>5</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"6"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>6</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"7"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>7</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"8"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>8</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"9"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span>9</div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 将多个HTPP请求打包成一个，一次发往服务器</span></div><div class="line">    <span class="keyword">var</span> synchronousFile = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"开始同步文件,id为:"</span> + id);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> checkbox = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"input"</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, c; c = checkbox[i++];) &#123;</div><div class="line">        c.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="comment">// 这样每点一次就同步一次，对服务器伤害很大，可以将多个打包了，再一并发送</span></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.checked === <span class="literal">true</span>) &#123;</div><div class="line">                proxySynchronousFile(<span class="keyword">this</span>.id);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 添加代理函数，负责手机一段时间内的请求</span></div><div class="line">    <span class="keyword">var</span> proxySynchronousFile = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cache = [],</div><div class="line">            timer;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">            <span class="comment">// 存入缓存</span></div><div class="line">            cache.push(id);</div><div class="line">            <span class="keyword">if</span> (timer) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="comment">// 执行同步</span></div><div class="line">                synchronousFile(cache.join(<span class="string">","</span>));</div><div class="line">                <span class="comment">// 清除</span></div><div class="line">                clearTimeout(timer);</div><div class="line">                timer = <span class="literal">null</span>;</div><div class="line">                cache.length = <span class="number">0</span>;</div><div class="line">            &#125;, <span class="number">2000</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="虚拟代理在惰性加载中的应用"><a href="#虚拟代理在惰性加载中的应用" class="headerlink" title="虚拟代理在惰性加载中的应用"></a>虚拟代理在惰性加载中的应用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 在按特定按键时才加载另外一个js文件</span></div><div class="line">    <span class="comment">// var cache = [];</span></div><div class="line">    <span class="comment">// var miniConsole = &#123;</span></div><div class="line">    <span class="comment">//     log: function() &#123;</span></div><div class="line">    <span class="comment">//         var args = arguments;</span></div><div class="line">    <span class="comment">//         cache.push(function() &#123;</span></div><div class="line">    <span class="comment">//             return miniConsole.log.apply(miniConsole, args);</span></div><div class="line">    <span class="comment">//         &#125;);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var handler = function(ev) &#123;</span></div><div class="line">    <span class="comment">//     if (ev.keyCode === 32) &#123;</span></div><div class="line">    <span class="comment">//         // 按空格才会创建脚本</span></div><div class="line">    <span class="comment">//         var script = document.createElement("script");</span></div><div class="line">    <span class="comment">//         script.src = "js/33.js";</span></div><div class="line">    <span class="comment">//         script.onload = function() &#123;</span></div><div class="line">    <span class="comment">//             for (var i = 0, fn; fn = cache[i++];) &#123;</span></div><div class="line">    <span class="comment">//                 fn();</span></div><div class="line">    <span class="comment">//             &#125;</span></div><div class="line">    <span class="comment">//         &#125;;</span></div><div class="line">    <span class="comment">//         document.body.appendChild(script);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// document.body.addEventListener("keydown", handler, false);</span></div><div class="line">    <span class="comment">// miniConsole.log(3);</span></div><div class="line">    <span class="comment">// 这样的问题是在每次按空格都会重复创建script</span></div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> miniConsole = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cache = [];</div><div class="line">        <span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (ev.keyCode === <span class="number">32</span>) &#123;</div><div class="line">                <span class="built_in">console</span>.log(ev);</div><div class="line">                <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line">                script.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, fn; fn = cache[i++];) &#123;</div><div class="line">                        fn();</div><div class="line">                    &#125;</div><div class="line">                &#125;;</div><div class="line">                script.src = <span class="string">'js/33.js'</span>;</div><div class="line">                <span class="built_in">document</span>.body.appendChild(script);</div><div class="line">                <span class="built_in">document</span>.body.removeEventListener(<span class="string">'keydown'</span>, handler); <span class="comment">// 只加载一次33.js</span></div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="built_in">document</span>.body.addEventListener(<span class="string">'keydown'</span>, handler, <span class="literal">false</span>);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">log</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</div><div class="line">                cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">return</span> miniConsole.log.apply(miniConsole, args);</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    miniConsole.log(<span class="number">11</span>); <span class="comment">// 开始打印log</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="缓存代理"><a href="#缓存代理" class="headerlink" title="缓存代理"></a>缓存代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 可以为一些开销很大的运算结果提供暂时的缓存，在下次运算时，如果传递进来的参数跟之前一致，则可直接返回缓存的结果</span></div><div class="line">    <span class="comment">// 计算乘积</span></div><div class="line">    <span class="keyword">var</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</div><div class="line">            a *= <span class="built_in">arguments</span>[i];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">console</span>.log(mult(<span class="number">2</span>, <span class="number">3</span>));</div><div class="line">    <span class="built_in">console</span>.log(mult(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</div><div class="line">    <span class="comment">// 代理函数</span></div><div class="line">    <span class="keyword">var</span> proxyMult = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cache = &#123;&#125;;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">","</span>);</div><div class="line">            <span class="keyword">if</span> (args <span class="keyword">in</span> cache) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"来自缓存"</span>);</div><div class="line">                <span class="keyword">return</span> cache[args];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> cache[args] = mult.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="built_in">console</span>.log(proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</div><div class="line">    <span class="built_in">console</span>.log(proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>));</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="用高阶函数动态创建缓存代理"><a href="#用高阶函数动态创建缓存代理" class="headerlink" title="用高阶函数动态创建缓存代理"></a>用高阶函数动态创建缓存代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">/**************** 计算乘积 *****************/</span></div><div class="line">    <span class="keyword">var</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</div><div class="line">            a = a * <span class="built_in">arguments</span>[i];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/**************** 计算加和 *****************/</span></div><div class="line">    <span class="keyword">var</span> plus = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> a = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</div><div class="line">            a = a + <span class="built_in">arguments</span>[i];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/**************** 创建缓存代理的工厂 *****************/</span></div><div class="line">    <span class="keyword">var</span> createProxyFactory = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cache = &#123;&#125;;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">','</span>);</div><div class="line">            <span class="keyword">if</span> (args <span class="keyword">in</span> cache) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"来自缓存"</span>);</div><div class="line">                <span class="keyword">return</span> cache[args];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> cache[args] = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> proxyMult = createProxyFactory(mult),</div><div class="line">        proxyPlus = createProxyFactory(plus);</div><div class="line">    <span class="built_in">console</span>.log((proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))); <span class="comment">// 输出：24</span></div><div class="line">    <span class="built_in">console</span>.log((proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))); <span class="comment">// 输出：24</span></div><div class="line">    <span class="built_in">console</span>.log((proxyPlus(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))); <span class="comment">// 输出：10</span></div><div class="line">    <span class="built_in">console</span>.log((proxyPlus(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))); <span class="comment">// 输出：10</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><h3 id="基本定义-3"><a href="#基本定义-3" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 迭代器模式:提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。它将迭代过程从业务逻辑中抽象出来。</span></div><div class="line">    <span class="comment">// 分类:</span></div><div class="line">    <span class="comment">// 内部迭代器:内部已经定义好了迭代规则，它完全接手整个迭代过程，外部只需要一次初始调用。优点:不用关心迭代器内部实现。缺点:优点也是缺点，因为迭代器中的迭代规则以被提前规定好</span></div><div class="line">    <span class="comment">// 外部迭代器:外部迭代器必须显式地请求迭代下一个元素</span></div><div class="line">    <span class="comment">// 使用场景是:对于集合内部结果常常变化各异，我们不想暴露其内部结构的话，但又响让客户代码透明底访问其中的元素，这种情况下我们可以使用迭代器模式。</span></div><div class="line">    <span class="comment">// 使用举例:很多语言都内置了迭代器如Array.prototype.forEach、jQuery中的$.each</span></div><div class="line"></div><div class="line">    <span class="comment">// 实现自己的each(一个内部迭代器)</span></div><div class="line">    <span class="keyword">var</span> each = <span class="function"><span class="keyword">function</span>(<span class="params">ary, callback</span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = ary.length; i &lt; len; i++) &#123;</div><div class="line">            callback.call(ary[i], i, ary[i]); <span class="comment">// 在ary[i]下调用callback,传入索引i和元素ary[i]</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// each([1, 2, 3, 4], function(i, n) &#123;</span></div><div class="line">    <span class="comment">//     console.log(([i, n]));</span></div><div class="line">    <span class="comment">// &#125;);</span></div><div class="line"></div><div class="line">    <span class="comment">// 用each完成判断两个数组是否相等</span></div><div class="line">    <span class="comment">// var compare = function(ary1, ary2) &#123;</span></div><div class="line">    <span class="comment">//     // 长度不同肯定不相等</span></div><div class="line">    <span class="comment">//     if (ary1.length !== ary2.length) &#123;</span></div><div class="line">    <span class="comment">//         throw new Error("不相等");</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     // 比较内部元素值</span></div><div class="line">    <span class="comment">//     each(ary1, function(i, n) &#123;</span></div><div class="line">    <span class="comment">//         if (n !== ary2[i]) &#123;</span></div><div class="line">    <span class="comment">//             throw new Error("不相等");</span></div><div class="line">    <span class="comment">//         &#125;</span></div><div class="line">    <span class="comment">//     &#125;);</span></div><div class="line">    <span class="comment">//     console.log("相等");</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// compare([1, 2, 3], [1, 2, 4]);</span></div><div class="line">    <span class="comment">// 使用外部迭代器改写判断数组相等</span></div><div class="line">    <span class="keyword">var</span> Iterator = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> current = <span class="number">0</span>;</div><div class="line">        <span class="keyword">var</span> next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            current += <span class="number">1</span>;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">var</span> isDone = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> current &gt;= obj.length;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">var</span> getCurrItem = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> obj[current];</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">next</span>: next,</div><div class="line">            <span class="attr">isDone</span>: isDone,</div><div class="line">            <span class="attr">getCurrItem</span>: getCurrItem</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> compare = <span class="function"><span class="keyword">function</span>(<span class="params">iterator1, iterator2</span>) </span>&#123;</div><div class="line">        <span class="keyword">while</span> (!iterator1.isDone() &amp;&amp; !iterator2.isDone()) &#123;</div><div class="line">            <span class="keyword">if</span> (iterator1.getCurrItem() !== iterator2.getCurrItem()) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"不相等"</span>);</div><div class="line">            &#125;</div><div class="line">            iterator1.next();</div><div class="line">            iterator2.next();</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"相等"</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> iterator1 = Iterator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</div><div class="line">    <span class="keyword">var</span> iterator2 = Iterator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</div><div class="line">    compare(iterator1, iterator2); <span class="comment">// 输出：iterator1 和iterator2 相等</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="迭代类数组对象和字面量对象"><a href="#迭代类数组对象和字面量对象" class="headerlink" title="迭代类数组对象和字面量对象"></a>迭代类数组对象和字面量对象</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 本质上，只要对象拥有length属性的都可以迭代，arguments和对象字面量也可以迭代，仿照jquery的$.each写一个通用的迭代器</span></div><div class="line">    each = <span class="function"><span class="keyword">function</span>(<span class="params">obj, callback</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> value, i = <span class="number">0</span>,</div><div class="line">            length = obj.length,</div><div class="line">            isArray = isArraylike(obj);</div><div class="line">        <span class="keyword">if</span> (isArray) &#123;</div><div class="line">            <span class="comment">// 类数组对象</span></div><div class="line">            <span class="keyword">for</span> (; i &lt; length; i++) &#123;</div><div class="line">                value = callback.call(obj[i], i, obj[i]);</div><div class="line">                <span class="comment">// 约定回调函数返回false时，终止迭代</span></div><div class="line">                <span class="keyword">if</span> (value === <span class="literal">false</span>) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 普通对象</span></div><div class="line">            <span class="keyword">for</span> (i <span class="keyword">in</span> obj) &#123;</div><div class="line">                value = callback.call(obj[i], i, obj[i]);</div><div class="line">                <span class="keyword">if</span> (value === <span class="literal">false</span>) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> obj;</div><div class="line">    &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="倒序迭代器"><a href="#倒序迭代器" class="headerlink" title="倒序迭代器"></a>倒序迭代器</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 倒序迭代器</span></div><div class="line">    <span class="keyword">var</span> reverseEach = <span class="function"><span class="keyword">function</span>(<span class="params">ary, callback</span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> l = ary.length - <span class="number">1</span>; l &gt;= <span class="number">0</span>; l--) &#123;</div><div class="line">            callback(l, ary[l]);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    reverseEach([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], <span class="function"><span class="keyword">function</span>(<span class="params">i, n</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(n); <span class="comment">// 分别输出：2, 1 ,0</span></div><div class="line">    &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="迭代器模式实现上传空间选择"><a href="#迭代器模式实现上传空间选择" class="headerlink" title="迭代器模式实现上传空间选择"></a>迭代器模式实现上传空间选择</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// var getUploadObj = function() &#123;</span></div><div class="line">    <span class="comment">//     try &#123;</span></div><div class="line">    <span class="comment">//         return new ActiveXObject("TXFTNActiveX.FTNUpload"); // IE 上传控件</span></div><div class="line">    <span class="comment">//     &#125; catch (e) &#123;</span></div><div class="line">    <span class="comment">//         if (supportFlash()) &#123; // supportFlash 函数未提供</span></div><div class="line">    <span class="comment">//             var str = '&lt;object type="application/x-shockwave-flash"&gt;&lt;/object&gt;';</span></div><div class="line">    <span class="comment">//             return $(str).appendTo($('body'));</span></div><div class="line">    <span class="comment">//         &#125; else &#123;</span></div><div class="line">    <span class="comment">//             var str = '&lt;input name="file" type="file"/&gt;'; // 表单上传</span></div><div class="line">    <span class="comment">//             return $(str).appendTo($('body'));</span></div><div class="line">    <span class="comment">//         &#125;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// 上面的难以阅读、扩展、维护</span></div><div class="line">    <span class="comment">// 将获取上传对象封装起来</span></div><div class="line">    <span class="keyword">var</span> getActiveUploadObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">"TXFTNActiveX.FTNUpload"</span>); <span class="comment">// IE 上传控件</span></div><div class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getFlashUploadObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isSupportFlash()) &#123; <span class="comment">// isSupportFlash 函数未提供</span></div><div class="line">            <span class="keyword">var</span> str = <span class="string">'&lt;object type="application/x-shockwave-flash"&gt;&lt;/object&gt;'</span>;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">document</span>.body.innerHTML += str;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getFormUpladObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> str = <span class="string">'&lt;input name="file" type="file" class="ui-file"/&gt;'</span>; <span class="comment">// 表单上传</span></div><div class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.body.innerHTML += str;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 迭代器</span></div><div class="line">    <span class="keyword">var</span> iteratorUploadObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, fn; fn = <span class="built_in">arguments</span>[i++];) &#123;</div><div class="line">            <span class="keyword">var</span> uploadObj = fn();</div><div class="line">            <span class="keyword">if</span> (uploadObj !== <span class="literal">false</span>) &#123;</div><div class="line">                <span class="keyword">return</span> uploadObj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> uploadObj = iteratorUploadObj(getActiveUploadObj, getFlashUploadObj, getFormUpladObj);</div><div class="line">    <span class="built_in">console</span>.log(uploadObj);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><h3 id="基本定义-4"><a href="#基本定义-4" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 观察者模式又叫发布-订阅模式。它定义对象间的一种在对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。JS中一般用事件模型来替代传统的观察者模式</span></div><div class="line">    <span class="comment">// 使用场景:应用于异步编程中，这是一种替代传递回调函数的方案。可以取代对象之间硬编码的通知机制，一个对象不用再显式地调用另外一个对象的某个接口</span></div><div class="line">    <span class="comment">// 使用举例:买房，到达预售时间，售楼部(发布者)会打电话(通过花名册，一个缓存列表，拨打电话过程就是在执行回调函数的过程)通知买房者(订阅者)可以购买了。</span></div><div class="line"></div><div class="line">    <span class="comment">// var salesOffices = &#123;&#125;; // 定义售楼处，发布者</span></div><div class="line">    <span class="comment">// salesOffices.clientList = []; // 缓存列表，花名册，存放订阅者的回调函数</span></div><div class="line">    <span class="comment">// salesOffices.listen = function(fn) &#123; // 增加订阅者</span></div><div class="line">    <span class="comment">//     this.clientList.push(fn); // 订阅者的回调函数添加到缓存列表中</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// salesOffices.trigger = function() &#123; // 发布消息</span></div><div class="line">    <span class="comment">//     for (var i = 0, fn; fn = this.clientList[i++];) &#123;</span></div><div class="line">    <span class="comment">//         fn.apply(this, arguments); // arguments是发布消息时带上的参数</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// salesOffices.listen(function(price, squareMeter) &#123; // 小明订阅消息</span></div><div class="line">    <span class="comment">//     console.log("我是小明订阅的");</span></div><div class="line">    <span class="comment">//     console.log('价格= ' + price);</span></div><div class="line">    <span class="comment">//     console.log('squareMeter= ' + squareMeter);</span></div><div class="line">    <span class="comment">// &#125;);</span></div><div class="line">    <span class="comment">// salesOffices.listen(function(price, squareMeter) &#123; // 小红订阅消息</span></div><div class="line">    <span class="comment">//     console.log("我是小红订阅的");</span></div><div class="line">    <span class="comment">//     console.log('价格= ' + price);</span></div><div class="line">    <span class="comment">//     console.log('squareMeter= ' + squareMeter);</span></div><div class="line">    <span class="comment">// &#125;);</span></div><div class="line">    <span class="comment">// // 发布消息，此时会通知所有订阅者</span></div><div class="line">    <span class="comment">// salesOffices.trigger(2000000, 88); // 输出：200 万，88 平方米</span></div><div class="line">    <span class="comment">// salesOffices.trigger(3000000, 110); // 输出：300 万，110 平方米</span></div><div class="line"></div><div class="line">    <span class="comment">// 上面出现的问题时，假如小明只想买88平的，售楼部却把110平的也推送给他了</span></div><div class="line">    <span class="keyword">var</span> salesOffices = &#123;&#125;;</div><div class="line">    salesOffices.clientList = &#123;&#125;;</div><div class="line">    salesOffices.listen = <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123; <span class="comment">// key为订阅者想订阅的某个消息类型，例如小明想订阅的88平</span></div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.clientList[key]) &#123; <span class="comment">// 如果还没订阅过此类消息，则给该类消息创建一个缓存列表</span></div><div class="line">            <span class="keyword">this</span>.clientList[key] = [];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.clientList[key].push(fn); <span class="comment">// 将订阅的消息添加到缓存列表中</span></div><div class="line">    &#125;;</div><div class="line">    salesOffices.trigger = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> key = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>); <span class="comment">// 取出消息类型</span></div><div class="line">        <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[key]; <span class="comment">// 此消息类型对应的回调函数列表</span></div><div class="line">        <span class="keyword">if</span> (!fns || fns.length === <span class="number">0</span>) &#123; <span class="comment">// 没有订阅该消息，则返回</span></div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, fn; fn = fns[i++];) &#123;</div><div class="line">            fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 发布消息</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    salesOffices.listen(<span class="string">'squareMeter88'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小明订阅88 平方米房子的消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'价格= '</span> + price); <span class="comment">// 输出： 2000000</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    salesOffices.listen(<span class="string">'squareMeter88'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小周订阅88 平方米房子的消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'价格= '</span> + price); <span class="comment">// 输出： 2000000</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    salesOffices.listen(<span class="string">'squareMeter110'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小红订阅110 平方米房子的消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'价格= '</span> + price); <span class="comment">// 输出： 3000000</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    salesOffices.trigger(<span class="string">'squareMeter88'</span>, <span class="number">2000000</span>); <span class="comment">// 发布88 平方米房子的价格，此时只有小明和小周会收到订阅消息</span></div><div class="line"></div><div class="line">    salesOffices.trigger(<span class="string">'squareMeter110'</span>, <span class="number">3000000</span>); <span class="comment">// 发布110 平方米房子的价格，只有小红能收到消息</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="观察者的通用实现"><a href="#观察者的通用实现" class="headerlink" title="观察者的通用实现"></a>观察者的通用实现</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> event = &#123;</div><div class="line">        <span class="attr">clientList</span>: &#123;&#125;,</div><div class="line">        <span class="attr">listen</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.clientList[key]) &#123;</div><div class="line">                <span class="keyword">this</span>.clientList[key] = [];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">this</span>.clientList[key].push(fn);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">trigger</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> key = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[key];</div><div class="line">            <span class="keyword">if</span> (!fns || fns.length === <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, fn; fn = fns[i++];) &#123;</div><div class="line">                fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">remove</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[key];</div><div class="line">            <span class="keyword">if</span> (!fns) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (!fn) &#123;</div><div class="line">                fns &amp;&amp; (fns.length = <span class="number">0</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> l = fns.length - <span class="number">1</span>; l &gt;= <span class="number">0</span>; l--) &#123; <span class="comment">// 反向遍历订阅的回调函数列表</span></div><div class="line">                    <span class="keyword">var</span> _fn = fns[l];</div><div class="line">                    <span class="keyword">if</span> (_fn === fn) &#123;</div><div class="line">                        fns.splice(l, <span class="number">1</span>); <span class="comment">// 删除订阅者的回调函数</span></div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> cloneObj = <span class="function"><span class="keyword">function</span>(<span class="params">sourceObject</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> str, newObj = sourceObject.constructor === <span class="built_in">Array</span> ? [] : &#123;&#125;;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> sourceObject !== <span class="string">'object'</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> sourceObject) &#123;</div><div class="line">                newObj[i] = <span class="keyword">typeof</span> sourceObject[i] === <span class="string">'object'</span> ?</div><div class="line">                    cloneObj(sourceObject[i]) : sourceObject[i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> newObj;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> salesOffices = cloneObj(event);</div><div class="line"></div><div class="line">    salesOffices.listen(<span class="string">'squareMeter88'</span>, fn1 = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小明订阅售楼1 88平消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'售楼1通知小明价格= '</span> + price);</div><div class="line">    &#125;);</div><div class="line">    salesOffices.listen(<span class="string">'squareMeter88'</span>, fn2 = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小周订阅售楼1 88平消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'售楼1通知小周价格= '</span> + price);</div><div class="line">    &#125;);</div><div class="line">    salesOffices.listen(<span class="string">'squareMeter100'</span>, fn3 = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小红订阅售楼1 100平消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'售楼1通知小红价格= '</span> + price);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 售楼1发布88平米的消息</span></div><div class="line">    salesOffices.trigger(<span class="string">'squareMeter88'</span>, <span class="number">20000</span>); <span class="comment">// 输出：20000</span></div><div class="line">    <span class="comment">// 售楼1发布100平米的消息</span></div><div class="line">    salesOffices.trigger(<span class="string">'squareMeter100'</span>, <span class="number">30000</span>); <span class="comment">// 输出：20000</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"======================="</span>);;</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"删除小明订阅售楼1"</span>);</div><div class="line">    salesOffices.remove(<span class="string">'squareMeter88'</span>, fn1); <span class="comment">// 删除小明的订阅</span></div><div class="line"></div><div class="line">    salesOffices.trigger(<span class="string">'squareMeter88'</span>, <span class="number">20000</span>); <span class="comment">// 输出：20000</span></div><div class="line">    salesOffices.trigger(<span class="string">'squareMeter100'</span>, <span class="number">30000</span>); <span class="comment">// 输出：20000</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"======================="</span>);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> salesOffices2 = cloneObj(event);</div><div class="line">    salesOffices2.listen(<span class="string">'squareMeter88'</span>, fn21 = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小明订阅售楼2 88平消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'售楼2通知小明价格= '</span> + price);</div><div class="line">    &#125;);</div><div class="line">    salesOffices2.listen(<span class="string">'squareMeter88'</span>, fn22 = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小红订阅售楼2 100平消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'售楼2通知小红价格= '</span> + price);</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// 发布88平米消息</span></div><div class="line">    salesOffices2.trigger(<span class="string">'squareMeter88'</span>, <span class="number">25000</span>); <span class="comment">// 输出：25000</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"======================="</span>);;</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"删除小明订阅售楼2"</span>);</div><div class="line">    salesOffices2.remove(<span class="string">'squareMeter88'</span>, fn21); <span class="comment">// 删除小明的订阅</span></div><div class="line"></div><div class="line">    salesOffices2.trigger(<span class="string">'squareMeter88'</span>, <span class="number">35000</span>); <span class="comment">// 输出：35000</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="使用观察者模式实现网站登录"><a href="#使用观察者模式实现网站登录" class="headerlink" title="使用观察者模式实现网站登录"></a>使用观察者模式实现网站登录</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>假如我们正在开发一个商城网站，网站里有header 头部、nav 导航、消息列表、购物车等模块。这几个模块的渲染有一个共同的前提条件，就是必须先用ajax异步请求获取用户的登录信息。 这是很正常的，比如用户的名字和头像要显示在header 模块里，而这两个字段都来自用户登录后返回的信息。至于ajax 请求什么时候能成功返回用户信息，这点我们没有办法确定<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery-2.2.4.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/mock-min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> event = &#123;</div><div class="line">        <span class="attr">clientList</span>: &#123;&#125;,</div><div class="line">        <span class="attr">listen</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.clientList[key]) &#123;</div><div class="line">                <span class="keyword">this</span>.clientList[key] = [];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">this</span>.clientList[key].push(fn);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">trigger</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> key = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[key];</div><div class="line">            <span class="keyword">if</span> (!fns || fns.length === <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, fn; fn = fns[i++];) &#123;</div><div class="line">                fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">remove</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> fns = <span class="keyword">this</span>.clientList[key];</div><div class="line">            <span class="keyword">if</span> (!fns) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (!fn) &#123;</div><div class="line">                fns &amp;&amp; (fns.length = <span class="number">0</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> l = fns.length - <span class="number">1</span>; l &gt;= <span class="number">0</span>; l--) &#123; <span class="comment">// 反向遍历订阅的回调函数列表</span></div><div class="line">                    <span class="keyword">var</span> _fn = fns[l];</div><div class="line">                    <span class="keyword">if</span> (_fn === fn) &#123;</div><div class="line">                        fns.splice(l, <span class="number">1</span>); <span class="comment">// 删除订阅者的回调函数</span></div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> cloneObj = <span class="function"><span class="keyword">function</span>(<span class="params">sourceObject</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> str, newObj = sourceObject.constructor === <span class="built_in">Array</span> ? [] : &#123;&#125;;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> sourceObject !== <span class="string">'object'</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> sourceObject) &#123;</div><div class="line">                newObj[i] = <span class="keyword">typeof</span> sourceObject[i] === <span class="string">'object'</span> ?</div><div class="line">                    cloneObj(sourceObject[i]) : sourceObject[i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> newObj;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 使用 Mock模拟数据</span></div><div class="line">    Mock.setup(&#123;</div><div class="line">        <span class="attr">timeout</span>: <span class="string">'500-1000'</span></div><div class="line">    &#125;);</div><div class="line">    Mock.mock(<span class="string">'http://test.cn'</span>, &#123;</div><div class="line">        <span class="string">"userName"</span>: <span class="string">"@cname"</span>,</div><div class="line">        <span class="string">"sex|1"</span>: [<span class="string">"男"</span>, <span class="string">"女"</span>],</div><div class="line">        <span class="string">"avator"</span>: Mock.Random.image(<span class="string">'100x100'</span>, <span class="string">'#894FC4'</span>, <span class="string">'#FFF'</span>, <span class="string">'png'</span>, <span class="string">'头像'</span>),</div><div class="line">        <span class="string">"test|1-3"</span>: <span class="number">3</span></div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// 模拟请求</span></div><div class="line">    $.ajax(&#123;</div><div class="line">        <span class="attr">url</span>: <span class="string">'http://test.cn'</span>,</div><div class="line">        <span class="attr">dataType</span>: <span class="string">'json'</span></div><div class="line">    &#125;).done(<span class="function"><span class="keyword">function</span>(<span class="params">data, status, xhr</span>) </span>&#123;</div><div class="line">        <span class="comment">// 请求成功，触发登录成功</span></div><div class="line">        login.trigger(<span class="string">"loginSucc"</span>, data);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> login = cloneObj(event);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> header = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// 订阅登录的登录成功消息</span></div><div class="line">        login.listen(<span class="string">"loginSucc"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">            header.setAvator(data.avator);</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">setAvator</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"设置Header模块头像"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> nav = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        login.listen(<span class="string">"loginSucc"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">            nav.setAvator(data.avator);</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">setAvator</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"设置Nav模块头像"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="全局发布订阅-对象"><a href="#全局发布订阅-对象" class="headerlink" title="全局发布订阅-对象"></a>全局发布订阅-对象</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"count"</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"show"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> Event = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> clientList = &#123;&#125;,</div><div class="line">            listen, trigger, remove;</div><div class="line">        listen = <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (!clientList[key]) &#123;</div><div class="line">                clientList[key] = [];</div><div class="line">            &#125;</div><div class="line">            clientList[key].push(fn);</div><div class="line">        &#125;;</div><div class="line">        trigger = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> key = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">var</span> fns = clientList[key];</div><div class="line">            <span class="keyword">if</span> (!fns || fns.length === <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, fn; fn = fns[i++];) &#123;</div><div class="line">                fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        remove = <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> fns = clientList[key];</div><div class="line">            <span class="keyword">if</span> (!fns) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (!fn) &#123;</div><div class="line">                fns &amp;&amp; (fns.length = <span class="number">0</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> l = fns.length - <span class="number">1</span>; l &gt;= <span class="number">0</span>; l--) &#123;</div><div class="line">                    <span class="keyword">var</span> _fn = fns[l];</div><div class="line">                    <span class="keyword">if</span> (_fn === fn) &#123;</div><div class="line">                        fns.spice(l, <span class="number">1</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">listen</span>: listen,</div><div class="line">            <span class="attr">trigger</span>: trigger,</div><div class="line">            <span class="attr">remove</span>: remove</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    Event.listen(<span class="string">'squareMeter88'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123; <span class="comment">// 小红订阅消息</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'价格= '</span> + price); <span class="comment">// 输出：'价格=2000000'</span></div><div class="line">    &#125;);</div><div class="line">    Event.trigger(<span class="string">'squareMeter88'</span>, <span class="number">2000000</span>); <span class="comment">// 售楼处发布消息</span></div><div class="line"></div><div class="line">    <span class="comment">// 利用全局的发布-订阅对象，可以实现模块间的通信</span></div><div class="line">    <span class="comment">// 点击按钮，div中显示总的点击次数</span></div><div class="line">    <span class="keyword">var</span> a = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> count = <span class="number">0</span>;</div><div class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.getElementById(<span class="string">"count"</span>);</div><div class="line">        button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            Event.trigger(<span class="string">"add"</span>, count++);</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> b = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"show"</span>);</div><div class="line">        Event.listen(<span class="string">"add"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">count</span>) </span>&#123;</div><div class="line">            div.innerHTML = count;</div><div class="line">        &#125;);</div><div class="line">    &#125;)();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="支持先发布后订阅、命名空间的观察者模式"><a href="#支持先发布后订阅、命名空间的观察者模式" class="headerlink" title="支持先发布后订阅、命名空间的观察者模式"></a>支持先发布后订阅、命名空间的观察者模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pre</span>&gt;</span></div><div class="line">	有时，需要先发布，再订阅。如42中的登录，获取登录信息可能很快，但其他模块可能加载的很慢，就会造成已经发布了登录成功的消息，但其他模块还没有订阅的错误。</div><div class="line">	所以需要让观察者模式支持先缓存要发布的消息，等到有模块订阅消息的时候再正式发布消息。</div><div class="line">	另外，Event对象中只存在一个clientList，当订阅多了，就可能出现命名冲突的问题。所以还需要支持创建命名空间。</div><div class="line"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> Event = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> global = <span class="keyword">this</span>,</div><div class="line">            Event, _default = <span class="string">"default"</span>;</div><div class="line">        Event = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> _listen, _trigger, _remove, _slice = <span class="built_in">Array</span>.prototype.slice,</div><div class="line">                _shift = <span class="built_in">Array</span>.prototype.shift,</div><div class="line">                _unshift = <span class="built_in">Array</span>.prototype.unshift,</div><div class="line">                namespaceCache = &#123;&#125;,</div><div class="line">                _create, find, each = <span class="function"><span class="keyword">function</span>(<span class="params">ary, fn</span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> ret;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = ary.length; i &lt; l; i++) &#123;</div><div class="line">                        <span class="keyword">var</span> n = ary[i];</div><div class="line">                        ret = fn.call(n, i, n);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> ret;</div><div class="line">                &#125;;</div><div class="line">            _listen = <span class="function"><span class="keyword">function</span>(<span class="params">key, fn, cache</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (!cache[key]) &#123;</div><div class="line">                    cache[key] = [];</div><div class="line">                &#125;</div><div class="line">                cache[key].push(fn);</div><div class="line">            &#125;;</div><div class="line">            _remove = <span class="function"><span class="keyword">function</span>(<span class="params">key, cache, fn</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (cache[key]) &#123;</div><div class="line">                    <span class="keyword">if</span> (fn) &#123;</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> i = cache[key].length; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">                            <span class="keyword">if</span> (cache[key][i] === fn) &#123;</div><div class="line">                                cache[key].splice(i, <span class="number">1</span>);</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        cache[key] = &#123;&#125;;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            _trigger = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> cache = _shift.call(<span class="built_in">arguments</span>),</div><div class="line">                    key = _shift.call(<span class="built_in">arguments</span>),</div><div class="line">                    args = <span class="built_in">arguments</span>,</div><div class="line">                    _self = <span class="keyword">this</span>,</div><div class="line">                    ret, stack = cache[key];</div><div class="line">                <span class="keyword">if</span> (!stack || !stack.length) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> each(stack, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.apply(_self, args);</div><div class="line">                &#125;);</div><div class="line">            &#125;;</div><div class="line">            _create = <span class="function"><span class="keyword">function</span>(<span class="params">namespace</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> namespace = namespace || _default;</div><div class="line">                <span class="keyword">var</span> cache = &#123;&#125;,</div><div class="line">                    offlineStack = [], <span class="comment">// 离线事件 </span></div><div class="line">                    ret = &#123;</div><div class="line">                        <span class="attr">listen</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn, last</span>) </span>&#123;</div><div class="line">                            _listen(key, fn, cache);</div><div class="line">                            <span class="keyword">if</span> (offlineStack === <span class="literal">null</span>) &#123;</div><div class="line">                                <span class="keyword">return</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span> (last === <span class="string">"last"</span>) &#123;</div><div class="line">                                offlineStack.length &amp;&amp; offlineStack.pop()();</div><div class="line">                            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                each(offlineStack, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                                    <span class="keyword">this</span>();</div><div class="line">                                &#125;);</div><div class="line">                            &#125;</div><div class="line">                            offlineStack = <span class="literal">null</span>;</div><div class="line">                        &#125;,</div><div class="line">                        <span class="attr">one</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn, last</span>) </span>&#123;</div><div class="line">                            _remove(key, cache);</div><div class="line">                            <span class="keyword">this</span>.listen(key, fn, last);</div><div class="line">                        &#125;,</div><div class="line">                        <span class="attr">remove</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">                            _remove(key, cache, fn);</div><div class="line">                        &#125;,</div><div class="line">                        <span class="attr">trigger</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                            <span class="keyword">var</span> fn, args, _self = <span class="keyword">this</span>;</div><div class="line">                            _unshift.call(<span class="built_in">arguments</span>, cache);</div><div class="line">                            args = <span class="built_in">arguments</span>;</div><div class="line">                            fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                                <span class="keyword">return</span> _trigger.apply(_self, args);</div><div class="line">                            &#125;;</div><div class="line">                            <span class="keyword">if</span> (offlineStack) &#123;</div><div class="line">                                <span class="keyword">return</span> offlineStack.push(fn);</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">return</span> fn();</div><div class="line">                        &#125;</div><div class="line">                    &#125;;</div><div class="line">                <span class="keyword">return</span> namespace ?</div><div class="line">                    (namespaceCache[namespace] ? namespaceCache[namespace] :</div><div class="line">                        namespaceCache[namespace] = ret) : ret;</div><div class="line">            &#125;;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">create</span>: _create,</div><div class="line">                <span class="attr">one</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn, last</span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> event = <span class="keyword">this</span>.create();</div><div class="line">                    event.one(key, fn, last);</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">remove</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn</span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> event = <span class="keyword">this</span>.create();</div><div class="line">                    event.remove(key, fn);</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">listen</span>: <span class="function"><span class="keyword">function</span>(<span class="params">key, fn, last</span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> event = <span class="keyword">this</span>.create();</div><div class="line">                    event.listen(key, fn, last);</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">trigger</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> event = <span class="keyword">this</span>.create();</div><div class="line">                    event.trigger.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">        &#125;();</div><div class="line">        <span class="keyword">return</span> Event;</div><div class="line">    &#125;)();</div><div class="line">    <span class="comment">/************** 先发布后订阅 ********************/</span></div><div class="line">    Event.trigger(<span class="string">'click'</span>, <span class="number">1</span>);</div><div class="line">    Event.listen(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(a); <span class="comment">// 输出：1</span></div><div class="line">    &#125;);</div><div class="line">    <span class="comment">/************** 使用命名空间 ********************/</span></div><div class="line">    Event.create(<span class="string">'namespace1'</span>).listen(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(a); <span class="comment">// 输出：1</span></div><div class="line">    &#125;);</div><div class="line">    Event.create(<span class="string">'namespace1'</span>).trigger(<span class="string">'click'</span>, <span class="number">1</span>);</div><div class="line">    Event.create(<span class="string">'namespace2'</span>).listen(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(a); <span class="comment">// 输出：2</span></div><div class="line">    &#125;);</div><div class="line">    Event.create(<span class="string">'namespace2'</span>).trigger(<span class="string">'click'</span>, <span class="number">2</span>);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><h3 id="基本定义-5"><a href="#基本定义-5" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button1"</span>&gt;</span>点击按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button2"</span>&gt;</span>点击按钮2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button3"</span>&gt;</span>点击按钮3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 命令模式:命令模式是最简单和优雅的模式之一，命令模式中的命令（command）指的是一个执行某些特定事情的指令。</span></div><div class="line">    <span class="comment">// 使用场景:有时候需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么。此时希望用一种松耦合的方式来设计程序，使得请求发送者和请求接收者能够消除彼此之间的耦合关系。</span></div><div class="line">    <span class="comment">// 使用举例:拿订餐来说，客人需要向厨师发送请求，但是完全不知道这些厨师的名字和联系方式，也不知道厨师炒菜的方式和步骤。 命令模式把客人订餐的请求封装成command 对象，也就是订餐中的订单对象。这个对象可以在程序中被四处传递，就像订单可以从服务员手中传到厨师的手中。这样一来，客人不需要知道厨师的名字，从而解开了请求调用者和请求接收者之间的耦合关系。</span></div><div class="line"></div><div class="line">    <span class="comment">// 菜单程序</span></div><div class="line">    <span class="comment">// 绘制按钮和点击按钮的具体行为分离</span></div><div class="line">    <span class="comment">// 点击了按钮之后，必须向某些负责具体行为的对象发送请求，这些对象就是请求的接收者。但是目前并不知道接收者是什么对象，也不知道接收者究竟会做什么。此时我们需要借助命令对象的帮助，以便解开按钮和负责具体行为对象之间的耦合。</span></div><div class="line"></div><div class="line">    <span class="comment">// // 传统面向对象语言中的命令模式</span></div><div class="line">    <span class="comment">// var button1 = document.getElementById('button1'),</span></div><div class="line">    <span class="comment">//     button2 = document.getElementById('button2'),</span></div><div class="line">    <span class="comment">//     button3 = document.getElementById('button3');</span></div><div class="line">    <span class="comment">// // 负责往按钮上安装命令</span></div><div class="line">    <span class="comment">// var setCommand = function(button, command) &#123;</span></div><div class="line">    <span class="comment">//     button.onclick = function() &#123;</span></div><div class="line">    <span class="comment">//         command.execute();</span></div><div class="line">    <span class="comment">//     &#125;;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var MenuBar = &#123;</span></div><div class="line">    <span class="comment">//     refresh: function() &#123;</span></div><div class="line">    <span class="comment">//         console.log('刷新菜单目录');</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var SubMenu = &#123;</span></div><div class="line">    <span class="comment">//     add: function() &#123;</span></div><div class="line">    <span class="comment">//         console.log('增加子菜单');</span></div><div class="line">    <span class="comment">//     &#125;,</span></div><div class="line">    <span class="comment">//     del: function() &#123;</span></div><div class="line">    <span class="comment">//         console.log('删除子菜单');</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// // 构建命令</span></div><div class="line">    <span class="comment">// var RefreshMenuBarCommand = function(receiver) &#123;</span></div><div class="line">    <span class="comment">//     this.receiver = receiver;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// RefreshMenuBarCommand.prototype.execute = function() &#123;</span></div><div class="line">    <span class="comment">//     this.receiver.refresh();</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var AddSubMenuCommand = function(receiver) &#123;</span></div><div class="line">    <span class="comment">//     this.receiver = receiver;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// AddSubMenuCommand.prototype.execute = function() &#123;</span></div><div class="line">    <span class="comment">//     this.receiver.add();</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var DelSubMenuCommand = function(receiver) &#123;</span></div><div class="line">    <span class="comment">//     this.receiver = receiver;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// DelSubMenuCommand.prototype.execute = function() &#123;</span></div><div class="line">    <span class="comment">//     console.log('删除子菜单');</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// // 实例化命令</span></div><div class="line">    <span class="comment">// var refreshMenuBarCommand = new RefreshMenuBarCommand(MenuBar);</span></div><div class="line">    <span class="comment">// var addSubMenuCommand = new AddSubMenuCommand(SubMenu);</span></div><div class="line">    <span class="comment">// var delSubMenuCommand = new DelSubMenuCommand(SubMenu);</span></div><div class="line">    <span class="comment">// // 安装命令</span></div><div class="line">    <span class="comment">// setCommand(button1, refreshMenuBarCommand);</span></div><div class="line">    <span class="comment">// setCommand(button2, addSubMenuCommand);</span></div><div class="line">    <span class="comment">// setCommand(button3, delSubMenuCommand);</span></div><div class="line"></div><div class="line">    <span class="comment">// // 在js中使用闭包实现命令模式</span></div><div class="line">    <span class="comment">// var button1 = document.getElementById('button1');</span></div><div class="line">    <span class="comment">// var setCommand = function(button, func) &#123;</span></div><div class="line">    <span class="comment">//     button.onclick = function() &#123;</span></div><div class="line">    <span class="comment">//         func();</span></div><div class="line">    <span class="comment">//     &#125;;</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// var MenuBar = &#123;</span></div><div class="line">    <span class="comment">//     refresh: function() &#123;</span></div><div class="line">    <span class="comment">//         console.log("刷新菜单界面");</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var RefreshMenuBarCommand = function(receiver) &#123;</span></div><div class="line">    <span class="comment">//     return function() &#123;</span></div><div class="line">    <span class="comment">//         receiver.refresh();</span></div><div class="line">    <span class="comment">//     &#125;;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var refreshMenuBarCommand = RefreshMenuBarCommand(MenuBar);</span></div><div class="line">    <span class="comment">// setCommand(button1, refreshMenuBarCommand);</span></div><div class="line"></div><div class="line">    <span class="comment">// 为了更明确的表达当前正在用命令模式，或者将来有可能提供撤销操作时，可以将执行函数改为调用execute方法</span></div><div class="line">    <span class="keyword">var</span> RefreshMenuBarCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                receiver.refresh();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> button1 = <span class="built_in">document</span>.getElementById(<span class="string">'button1'</span>);</div><div class="line">    <span class="keyword">var</span> setCommand = <span class="function"><span class="keyword">function</span>(<span class="params">button, command</span>) </span>&#123;</div><div class="line">        button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            command.execute();</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> MenuBar = &#123;</div><div class="line">        <span class="attr">refresh</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"刷新菜单界面"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> refreshMenuBarCommand = RefreshMenuBarCommand(MenuBar);</div><div class="line">    setCommand(button1, refreshMenuBarCommand);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="带撤销的命令模式"><a href="#带撤销的命令模式" class="headerlink" title="带撤销的命令模式"></a>带撤销的命令模式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"ball"</span> <span class="attr">style</span>=<span class="string">"position:absolute;background:#000;width:50px;height:50px"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    输入小球移动后的位置：</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"pos"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"moveBtn"</span>&gt;</span>开始移动<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--增加取消按钮--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"cancelBtn"</span>&gt;</span>cancel<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> tween = &#123;</div><div class="line">        <span class="attr">linear</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * t / d + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">easeIn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * (t /= d) * t + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">strongEaseIn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * (t /= d) * t * t * t * t + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">strongEaseOut</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * ((t = t / d - <span class="number">1</span>) * t * t * t * t + <span class="number">1</span>) + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">sineaseIn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * (t /= d) * t * t + b;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">sineaseOut</span>: <span class="function"><span class="keyword">function</span>(<span class="params">t, b, c, d</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> c * ((t = t / d - <span class="number">1</span>) * t * t + <span class="number">1</span>) + b;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Animate = <span class="function"><span class="keyword">function</span>(<span class="params">dom</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dom = dom;</div><div class="line">        <span class="keyword">this</span>.startTime = <span class="number">0</span>;</div><div class="line">        <span class="keyword">this</span>.startPos = <span class="number">0</span>;</div><div class="line">        <span class="keyword">this</span>.endPos = <span class="number">0</span>;</div><div class="line">        <span class="keyword">this</span>.propertyName = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">this</span>.easing = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">this</span>.duration = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    Animate.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params">propertyName, endPos, duration, easing</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.startTime = +<span class="keyword">new</span> <span class="built_in">Date</span>;</div><div class="line">        <span class="keyword">this</span>.startPos = <span class="keyword">this</span>.dom.getBoundingClientRect()[propertyName];</div><div class="line">        <span class="keyword">this</span>.propertyName = propertyName;</div><div class="line">        <span class="keyword">this</span>.endPos = endPos;</div><div class="line">        <span class="keyword">this</span>.duration = duration;</div><div class="line">        <span class="keyword">this</span>.easing = tween[easing];</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">var</span> timeId = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (self.step() === <span class="literal">false</span>) &#123;</div><div class="line">                clearInterval(timeId);</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">1000</span> / <span class="number">60</span>);</div><div class="line">    &#125;;</div><div class="line">    Animate.prototype.step = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> t = +<span class="keyword">new</span> <span class="built_in">Date</span>;</div><div class="line">        <span class="keyword">if</span> (t &gt;= <span class="keyword">this</span>.startTime + <span class="keyword">this</span>.duration) &#123;</div><div class="line">            <span class="keyword">this</span>.update(<span class="keyword">this</span>.endPos);</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> pos = <span class="keyword">this</span>.easing(t - <span class="keyword">this</span>.startTime, <span class="keyword">this</span>.startPos, <span class="keyword">this</span>.endPos - <span class="keyword">this</span>.startPos, <span class="keyword">this</span>.duration);</div><div class="line">        <span class="keyword">this</span>.update(pos);</div><div class="line">    &#125;;</div><div class="line">    Animate.prototype.update = <span class="function"><span class="keyword">function</span>(<span class="params">pos</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dom.style[<span class="keyword">this</span>.propertyName] = pos + <span class="string">'px'</span>;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 以上为运动算法</span></div><div class="line">    <span class="comment">// 下面通过命令模式实现运动以及撤销功能</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> ball = <span class="built_in">document</span>.getElementById(<span class="string">'ball'</span>);</div><div class="line">    <span class="keyword">var</span> pos = <span class="built_in">document</span>.getElementById(<span class="string">'pos'</span>);</div><div class="line">    <span class="keyword">var</span> moveBtn = <span class="built_in">document</span>.getElementById(<span class="string">'moveBtn'</span>);</div><div class="line">    <span class="keyword">var</span> cancelBtn = <span class="built_in">document</span>.getElementById(<span class="string">'cancelBtn'</span>);</div><div class="line">    <span class="keyword">var</span> MoveCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver, pos</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.receiver = receiver;</div><div class="line">        <span class="keyword">this</span>.pos = pos;</div><div class="line">        <span class="keyword">this</span>.oldPos = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    MoveCommand.prototype.execute = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.receiver.start(<span class="string">'left'</span>, <span class="keyword">this</span>.pos, <span class="number">1000</span>, <span class="string">'strongEaseOut'</span>);</div><div class="line">        <span class="comment">// 记录小球开始移动前的位置</span></div><div class="line">        <span class="keyword">this</span>.oldPos = <span class="keyword">this</span>.receiver.dom.getBoundingClientRect()[<span class="keyword">this</span>.receiver.propertyName];</div><div class="line">    &#125;;</div><div class="line">    MoveCommand.prototype.undo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// 回到小球移动前记录的位置</span></div><div class="line">        <span class="keyword">this</span>.receiver.start(<span class="string">'left'</span>, <span class="keyword">this</span>.oldPos, <span class="number">1000</span>, <span class="string">'strongEaseOut'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> moveCommand;</div><div class="line">    moveBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> animate = <span class="keyword">new</span> Animate(ball);</div><div class="line">        moveCommand = <span class="keyword">new</span> MoveCommand(animate, pos.value);</div><div class="line">        moveCommand.execute();</div><div class="line">    &#125;;</div><div class="line">    cancelBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        moveCommand.undo(); <span class="comment">// 撤销命令</span></div><div class="line">    &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="使用命令模式实现重做"><a href="#使用命令模式实现重做" class="headerlink" title="使用命令模式实现重做"></a>使用命令模式实现重做</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"replay"</span>&gt;</span>播放录像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> Ryu = &#123;</div><div class="line">        <span class="attr">attack</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'攻击'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">defense</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'防御'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">jump</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'跳跃'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">crouch</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'蹲下'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> makeCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver, state</span>) </span>&#123; <span class="comment">// 创建命令</span></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            receiver[state]();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> commands = &#123;</div><div class="line">        <span class="string">"119"</span>: <span class="string">"jump"</span>, <span class="comment">// W</span></div><div class="line">        <span class="string">"115"</span>: <span class="string">"crouch"</span>, <span class="comment">// S</span></div><div class="line">        <span class="string">"97"</span>: <span class="string">"defense"</span>, <span class="comment">// A</span></div><div class="line">        <span class="string">"100"</span>: <span class="string">"attack"</span> <span class="comment">// D</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> commandStack = []; <span class="comment">// 保存命令的堆栈</span></div><div class="line">    <span class="built_in">document</span>.onkeypress = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> keyCode = ev.keyCode,</div><div class="line">            command = makeCommand(Ryu, commands[keyCode]);</div><div class="line">        <span class="keyword">if</span> (command) &#123;</div><div class="line">            command(); <span class="comment">// 执行命令</span></div><div class="line">            commandStack.push(command); <span class="comment">// 将刚刚执行过的命令保存进堆栈</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'replay'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 点击播放录像</span></div><div class="line">        <span class="keyword">var</span> command;</div><div class="line">        <span class="keyword">while</span> (command = commandStack.shift()) &#123; <span class="comment">// 从堆栈里依次取出命令并执行</span></div><div class="line">            command();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="宏命令"><a href="#宏命令" class="headerlink" title="宏命令"></a>宏命令</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> closeDoorCommand = &#123;</div><div class="line">        <span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'关门'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> openPcCommand = &#123;</div><div class="line">        <span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开电脑'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> openQQCommand = &#123;</div><div class="line">        <span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'登录QQ'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> MacroCommand = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">commandList</span>: [],</div><div class="line">            <span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params">command</span>) </span>&#123;</div><div class="line">                <span class="keyword">this</span>.commandList.push(command);</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, command; command = <span class="keyword">this</span>.commandList[i++];) &#123;</div><div class="line">                    command.execute();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> macroCommand = MacroCommand();</div><div class="line">    macroCommand.add(closeDoorCommand);</div><div class="line">    macroCommand.add(openPcCommand);</div><div class="line">    macroCommand.add(openQQCommand);</div><div class="line">    macroCommand.execute();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h2><h3 id="基本定义-6"><a href="#基本定义-6" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 组合模式:组合模式就是用小的子对象来构建更大的对象，而这些小的子对象本身也许是由更小的“孙对象”构成的。</span></div><div class="line">    <span class="comment">// 组合模式将对象组合成树形结构，以表示“部分-整体”的层次结构。组合模式可以非常方便地描述对象部分-整体层次结构。 除了用来表示树形结构之外，组合模式的另一个好处是通过对象的多态性表现，使得用户对单个对象和组合对象的使用具有一致性。利用对象多态性统一对待组合对象和单个对象。利用对象的多态性表现，可以使客户端忽略组合对象和单个对象的不同。在组合模式中，客户将统一地使用组合结构中的所有对象，而不需要关心它究竟是组合对象还是单个对象。</span></div><div class="line">    <span class="comment">// 使用场景:表示对象的部分-整体层次结构。组合模式可以方便地构造一棵树来表示对象的部分-整体结构。特别是我们在开发期间不确定这棵树到底存在多少层次的时候。在树的构造最终完成之后，只需要通过请求树的最顶层对象，便能对整棵树做统一的操作。在组合模式中增加和删除树的节点非常方便，并且符合开放-封闭原则;客户希望统一对待树中的所有对象。组合模式使客户可以忽略组合对象和叶对象的区别，客户在面对这棵树的时候，不用关心当前正在处理的对象是组合对象还是叶对象，也就不用写一堆if、else语句来分别处理它们。组合对象和叶对象会各自做自己正确的事情，这是组合模式最重要的能力。</span></div><div class="line">    <span class="comment">// 使用举例:扫描文件夹,文件夹和文件之间的关系，非常适合用组合模式来描述。文件夹里既可以包含文件，又可以包含其他文件夹</span></div><div class="line"></div><div class="line">    <span class="comment">/***************文件夹*******************/</span></div><div class="line">    <span class="keyword">var</span> Folder = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.files = [];</div><div class="line">    &#125;;</div><div class="line">    Folder.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.files.push(file);</div><div class="line">    &#125;;</div><div class="line">    Folder.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"开始扫描文件夹:"</span> + <span class="keyword">this</span>.name);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, file, files = <span class="keyword">this</span>.files; file = files[i++];) &#123;</div><div class="line">            file.scan();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/*****************文件*******************/</span></div><div class="line">    <span class="keyword">var</span> File = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;;</div><div class="line">    File.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"文件下面不能再添加文件"</span>);</div><div class="line">    &#125;;</div><div class="line">    File.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"开始扫描文件:"</span> + <span class="keyword">this</span>.name);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/****创建文件夹及文件****/</span></div><div class="line">    <span class="keyword">var</span> folder = <span class="keyword">new</span> Folder(<span class="string">'学习资料'</span>);</div><div class="line">    <span class="keyword">var</span> folder1 = <span class="keyword">new</span> Folder(<span class="string">'JavaScript'</span>);</div><div class="line">    <span class="keyword">var</span> folder2 = <span class="keyword">new</span> Folder(<span class="string">'jQuery'</span>);</div><div class="line">    <span class="keyword">var</span> file1 = <span class="keyword">new</span> File(<span class="string">'JavaScript 设计模式与开发实践'</span>);</div><div class="line">    <span class="keyword">var</span> file2 = <span class="keyword">new</span> File(<span class="string">'精通jQuery'</span>);</div><div class="line">    <span class="keyword">var</span> file3 = <span class="keyword">new</span> File(<span class="string">'重构与模式'</span>)</div><div class="line">    folder1.add(file1);</div><div class="line">    folder2.add(file2);</div><div class="line">    folder.add(folder1);</div><div class="line">    folder.add(folder2);</div><div class="line">    <span class="keyword">var</span> folder3 = <span class="keyword">new</span> Folder(<span class="string">'Nodejs'</span>);</div><div class="line">    <span class="keyword">var</span> file4 = <span class="keyword">new</span> File(<span class="string">'深入浅出Node.js'</span>);</div><div class="line">    folder3.add(file4);</div><div class="line">    <span class="keyword">var</span> file5 = <span class="keyword">new</span> File(<span class="string">'JavaScript 语言精髓与编程实践'</span>);</div><div class="line">    folder.add(folder3);</div><div class="line">    folder.add(file5);</div><div class="line">    <span class="comment">/****扫描文件夹****/</span></div><div class="line">    folder.scan();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="组合模式-引用父对象"><a href="#组合模式-引用父对象" class="headerlink" title="组合模式-引用父对象"></a>组合模式-引用父对象</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 在49的基础上要添加删除功能，例如删除某个文件的时候，其实是在其上层文件夹中删除该文件。此时文件就必须要保存上层对象的引用</span></div><div class="line">    <span class="keyword">var</span> Folder = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.parent = <span class="literal">null</span>; <span class="comment">//增加this.parent 属性</span></div><div class="line">        <span class="keyword">this</span>.files = [];</div><div class="line">    &#125;;</div><div class="line">    Folder.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</div><div class="line">        file.parent = <span class="keyword">this</span>; <span class="comment">//设置父对象</span></div><div class="line">        <span class="keyword">this</span>.files.push(file);</div><div class="line">    &#125;;</div><div class="line">    Folder.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'开始扫描文件夹: '</span> + <span class="keyword">this</span>.name);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, file, files = <span class="keyword">this</span>.files; file = files[i++];) &#123;</div><div class="line">            file.scan();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 增加删除功能</span></div><div class="line">    Folder.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.parent) &#123; <span class="comment">//根节点或者树外的游离节点</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> files = <span class="keyword">this</span>.parent.files, l = files.length - <span class="number">1</span>; l &gt;= <span class="number">0</span>; l--) &#123;</div><div class="line">            <span class="keyword">var</span> file = files[l];</div><div class="line">            <span class="keyword">if</span> (file === <span class="keyword">this</span>) &#123;</div><div class="line">                files.splice(l, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> File = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.parent = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    File.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'不能添加在文件下面'</span>);</div><div class="line">    &#125;;</div><div class="line">    File.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'开始扫描文件: '</span> + <span class="keyword">this</span>.name);</div><div class="line">    &#125;;</div><div class="line">    File.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.parent) &#123; <span class="comment">//根节点或者树外的游离节点</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> files = <span class="keyword">this</span>.parent.files, l = files.length - <span class="number">1</span>; l &gt;= <span class="number">0</span>; l--) &#123;</div><div class="line">            <span class="keyword">var</span> file = files[l];</div><div class="line">            <span class="keyword">if</span> (file === <span class="keyword">this</span>) &#123;</div><div class="line">                files.splice(l, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> folder = <span class="keyword">new</span> Folder(<span class="string">'学习资料'</span>);</div><div class="line">    <span class="keyword">var</span> folder1 = <span class="keyword">new</span> Folder(<span class="string">'JavaScript'</span>);</div><div class="line">    <span class="keyword">var</span> file1 = <span class="keyword">new</span> Folder(<span class="string">'深入浅出Node.js'</span>);</div><div class="line"></div><div class="line">    folder1.add(<span class="keyword">new</span> File(<span class="string">'JavaScript 设计模式与开发实践'</span>));</div><div class="line">    folder.add(folder1);</div><div class="line">    folder.add(file1);</div><div class="line">    folder.scan();</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"/******移除文件夹******/"</span>);</div><div class="line">    folder1.remove();</div><div class="line">    folder.scan();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h2><h3 id="基本定义-7"><a href="#基本定义-7" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 模板方法模式:一种基于继承的设计模式</span></div><div class="line">    <span class="comment">// 构成:第一部分是抽象父类，第二部分是具体的实现子类;通常在抽象父类中封装了子类的算法框架，包括实现一些公共方法以及封装子类中所有方法的执行顺序。子类通过继承这个抽象类，也继承了整个算法结构，并且可以选择重写父类的方法;父类封装了子类的算法框架和方法的执行顺序，子类继承父类之后，父类通知子类执行这些方法，好莱坞原则很好地诠释了这种设计技巧，即高层组件调用底层组件。</span></div><div class="line">    <span class="comment">// 使用场景:从大的方面来讲，模板方法模式常被架构师用于搭建项目的框架，架构师定好了框架的骨架，程序员继承框架的结构之后，负责往里面填空。</span></div><div class="line">    <span class="comment">// 在Web 开发中也能找到很多模板方法模式的适用场景</span></div><div class="line">    <span class="comment">// 比如我们在构建一系列的UI 组件这些组件的构建过程一般如下所示：</span></div><div class="line">    <span class="comment">// (1) 初始化一个div 容器；</span></div><div class="line">    <span class="comment">// (2) 通过ajax 请求拉取相应的数据；</span></div><div class="line">    <span class="comment">// (3) 把数据渲染到div 容器里面，完成组件的构造；</span></div><div class="line">    <span class="comment">// (4) 通知用户组件渲染完毕。</span></div><div class="line">    <span class="comment">// 我们看到， 任何组件的构建都遵循上面的4步，其中第(1)步和第(4)步是相同的。第(2)步不同的地方只是请求ajax的远程地址，第(3)步不同的地方是渲染数据的方式。于是我们可以把这4个步骤都抽象到父类的模板方法里面，父类中还可以顺便提供第(1)步和第(4)步的具体实现。当子类继承这个父类之后，会重写模板方法里面的第(2)步和第(3)步。</span></div><div class="line">    <span class="comment">// 使用举例:泡咖啡和泡茶</span></div><div class="line">    <span class="comment">// 泡咖啡</span></div><div class="line">    <span class="comment">// (1) 把水煮沸</span></div><div class="line">    <span class="comment">// (2) 用沸水冲泡咖啡</span></div><div class="line">    <span class="comment">// (3) 把咖啡倒进杯子</span></div><div class="line">    <span class="comment">// (4) 加糖和牛奶</span></div><div class="line">    <span class="comment">// 泡茶</span></div><div class="line">    <span class="comment">// (1) 把水煮沸</span></div><div class="line">    <span class="comment">// (2) 用沸水浸泡茶叶</span></div><div class="line">    <span class="comment">// (3) 把茶水倒进杯子</span></div><div class="line">    <span class="comment">// (4) 加柠檬</span></div><div class="line">    <span class="comment">// 二者基本步骤是相同，不同的地方有</span></div><div class="line">    <span class="comment">// 原料不同。一个是咖啡，一个是茶，但我们可以把它们都抽象为“饮料”。</span></div><div class="line">    <span class="comment">// 泡的方式不同。咖啡是冲泡，而茶叶是浸泡，我们可以把它们都抽象为“泡”。</span></div><div class="line">    <span class="comment">// 加入的调料不同。一个是糖和牛奶，一个是柠檬，但我们可以把它们都抽象为“调料”。</span></div><div class="line">    <span class="comment">// 抽象之后</span></div><div class="line">    <span class="comment">// (1) 把水煮沸</span></div><div class="line">    <span class="comment">// (2) 用沸水冲泡饮料</span></div><div class="line">    <span class="comment">// (3) 把饮料倒进杯子</span></div><div class="line">    <span class="comment">// (4) 加调料</span></div><div class="line"></div><div class="line">    <span class="comment">// 抽象父类-饮料类</span></div><div class="line">    <span class="keyword">var</span> Beverage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    <span class="comment">// 烧水</span></div><div class="line">    Beverage.prototype.boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"把水煮沸"</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 泡</span></div><div class="line">    Beverage.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写brew方法'</span>);</div><div class="line">    &#125;; <span class="comment">// 空方法，应该由子类重写，若子类忘记重写，可在父类上添加一个错误提醒信息</span></div><div class="line">    <span class="comment">// 倒入杯子</span></div><div class="line">    Beverage.prototype.pourInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写pourInCup方法'</span>);</div><div class="line">    &#125;; <span class="comment">// 空方法，应该由子类重写</span></div><div class="line">    <span class="comment">// 加调料</span></div><div class="line">    Beverage.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写addCondiments方法'</span>);</div><div class="line">    &#125;; <span class="comment">// 空方法，应该由子类重写</span></div><div class="line">    Beverage.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.boilWater();</div><div class="line">        <span class="keyword">this</span>.brew();</div><div class="line">        <span class="keyword">this</span>.pourInCup();</div><div class="line">        <span class="keyword">this</span>.addCondiments();</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 抽象子类-coffee</span></div><div class="line">    <span class="keyword">var</span> Coffee = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    <span class="comment">// 继承饮料类</span></div><div class="line">    Coffee.prototype = <span class="keyword">new</span> Beverage();</div><div class="line">    <span class="comment">// 重写泡、倒入杯子、加调料方法</span></div><div class="line">    Coffee.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'用沸水冲泡咖啡'</span>);</div><div class="line">    &#125;;</div><div class="line">    Coffee.prototype.pourInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'把咖啡倒进杯子'</span>);</div><div class="line">    &#125;;</div><div class="line">    Coffee.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'加糖和牛奶'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// coffee实例</span></div><div class="line">    <span class="keyword">var</span> Coffee = <span class="keyword">new</span> Coffee();</div><div class="line">    Coffee.init();</div><div class="line">    <span class="comment">// 抽象子类-tea</span></div><div class="line">    <span class="keyword">var</span> Tea = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    Tea.prototype = <span class="keyword">new</span> Beverage();</div><div class="line">    Tea.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'用沸水浸泡茶叶'</span>);</div><div class="line">    &#125;;</div><div class="line">    Tea.prototype.pourInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'把茶倒进杯子'</span>);</div><div class="line">    &#125;;</div><div class="line">    Tea.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'加柠檬'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> tea = <span class="keyword">new</span> Tea();</div><div class="line">    tea.init();</div><div class="line">    <span class="comment">// 上面Beverage.prototype.init 被称为模板方法。该方法中封装了子类的算法框架，它作为一个算法的模板，指导子类以何种顺序去执行哪些方法</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="钩子方法"><a href="#钩子方法" class="headerlink" title="钩子方法"></a>钩子方法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 在50中实现了下面的流程，如果有客人不加调料，该如何实现</span></div><div class="line">    <span class="comment">// (1) 把水煮沸</span></div><div class="line">    <span class="comment">// (2) 用沸水冲泡饮料</span></div><div class="line">    <span class="comment">// (3) 把饮料倒进杯子</span></div><div class="line">    <span class="comment">// (4) 加调料</span></div><div class="line">    <span class="comment">// 钩子方法（hook）可以用来解决这个问题，放置钩子是隔离变化的一种常见手段。我们在父类中容易变化的地方放置钩子，钩子可以有一个默认的实现，究竟要不要“挂钩”，这由子类自行决定。钩子方法的返回结果决定了模板方法后面部分的执行步骤，也就是程序接下来的走向，这样一来，程序就拥有了变化的可能。</span></div><div class="line">    <span class="keyword">var</span> Beverage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    Beverage.prototype.boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"把水煮沸"</span>);</div><div class="line">    &#125;;</div><div class="line">    Beverage.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写brew 方法'</span>);</div><div class="line">    &#125;;</div><div class="line">    Beverage.prototype.pourInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写pourInCup 方法'</span>);</div><div class="line">    &#125;;</div><div class="line">    Beverage.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写addCondiments 方法'</span>);</div><div class="line">    &#125;;</div><div class="line">    Beverage.prototype.customerWantsCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 默认需要调料</span></div><div class="line">    &#125;;</div><div class="line">    Beverage.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.boilWater();</div><div class="line">        <span class="keyword">this</span>.brew();</div><div class="line">        <span class="keyword">this</span>.pourInCup();</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.customerWantsCondiments()) &#123; <span class="comment">// 如果挂钩返回true，则需要调料</span></div><div class="line">            <span class="keyword">this</span>.addCondiments();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> CoffeeWithHook = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    CoffeeWithHook.prototype = <span class="keyword">new</span> Beverage();</div><div class="line">    CoffeeWithHook.prototype.brew = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'用沸水冲泡咖啡'</span>);</div><div class="line">    &#125;;</div><div class="line">    CoffeeWithHook.prototype.pourInCup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'把咖啡倒进杯子'</span>);</div><div class="line">    &#125;;</div><div class="line">    CoffeeWithHook.prototype.addCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'加糖和牛奶'</span>);</div><div class="line">    &#125;;</div><div class="line">    CoffeeWithHook.prototype.customerWantsCondiments = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.confirm(<span class="string">'请问需要调料吗？'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> coffeeWithHook = <span class="keyword">new</span> CoffeeWithHook();</div><div class="line">    coffeeWithHook.init();</div><div class="line"></div><div class="line">    <span class="comment">// 好莱坞原则</span></div><div class="line">    <span class="comment">// 好莱坞无疑是演员的天堂，但好莱坞也有很多找不到工作的新人演员，许多新人演员在好莱坞把简历递给演艺公司之后就只有回家等待电话。有时候该演员等得不耐烦了，给演艺公司打电话询问情况，演艺公司往往这样回答：“不要来找我，我会给你打电话。”</span></div><div class="line">    <span class="comment">// 在设计中，这样的规则就称为好莱坞原则。在这一原则的指导下，我们允许底层组件将自己挂钩到高层组件中， 而高层组件会决定什么时候、 以何种方式去使用这些底层组件， 高层组件对待底层组件的方式， 跟演艺公司对待新人演员一样，都是“ 别调用我们，我们会调用你”。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="模板方法模式在js中的实现"><a href="#模板方法模式在js中的实现" class="headerlink" title="模板方法模式在js中的实现"></a>模板方法模式在js中的实现</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> Beverage = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> boilWater = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"把水煮沸"</span>);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">var</span> brew = param.brew || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"必须传递brew方法"</span>);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">var</span> pourInCup = param.pourInCup || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"必须传递pourInCup方法"</span>);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">var</span> addCondiments = param.addCondiments || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"必须传递addCondiments方法"</span>);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">        F.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            boilWater();</div><div class="line">            brew();</div><div class="line">            pourInCup();</div><div class="line">            addCondiments();</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> F;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Coffee = Beverage(&#123;</div><div class="line">        <span class="attr">brew</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'用沸水冲泡咖啡'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">pourInCup</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'把咖啡倒进杯子'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">addCondiments</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'加糖和牛奶'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> Tea = Beverage(&#123;</div><div class="line">        <span class="attr">brew</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'用沸水浸泡茶叶'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">pourInCup</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'把茶倒进杯子'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">addCondiments</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'加柠檬'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> coffee = <span class="keyword">new</span> Coffee();</div><div class="line">    coffee.init();</div><div class="line">    <span class="keyword">var</span> tea = <span class="keyword">new</span> Tea();</div><div class="line">    tea.init();</div><div class="line">    <span class="comment">// 在这段代码中，我们把brew、pourInCup、addCondiments 这些方法依次传入Beverage 函数，    Beverage 函数被调用之后返回构造器F。 F 类中包含了“ 模板方法” F.prototype.init。 跟继承得到的效果一样， 该“ 模板方法” 里依然封装了饮料子类的算法框架。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><h3 id="基本定义-8"><a href="#基本定义-8" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 享元模式:享元(flyweight)模式是一种用于性能优化的模式，“ fly” 在这里是苍蝇的意思， 意为蝇量级。 享元模式的核心是运用共享技术来有效支持大量细粒度的对象。</span></div><div class="line"></div><div class="line">    <span class="comment">// 享元模式的目标是尽量减少共享对象的数量，享元模式要求将对象的属性划分为内部状态与外部状态（状态在这里通常指属性）,关于如何划分内部状态和外部状态，下面的几条经验提供了一些指引。</span></div><div class="line">    <span class="comment">// 内部状态存储于对象内部。</span></div><div class="line">    <span class="comment">// 内部状态可以被一些对象共享。</span></div><div class="line">    <span class="comment">// 内部状态独立于具体的场景，通常不会改变。</span></div><div class="line">    <span class="comment">// 外部状态取决于具体的场景，并根据场景而变化，外部状态不能被共享。</span></div><div class="line">    <span class="comment">// 我们便可以把所有内部状态相同的对象都指定为同一个共享的对象。而外部状态可以从对象身上剥离出来，并储存在外部。</span></div><div class="line">    <span class="comment">// 剥离了外部状态的对象成为共享对象，外部状态在必要时被传入共享对象来组装成一个完整的对象。虽然组装外部状态成为一个完整对象的过程需要花费一定的时间，但却可以大大减少系统中的对象数量，相比之下，这点时间或许是微不足道的。因此，享元模式是一种用时间换空间的优化模式。</span></div><div class="line"></div><div class="line">    <span class="comment">// 使用场景:</span></div><div class="line">    <span class="comment">// 一个程序中使用了大量的相似对象。</span></div><div class="line">    <span class="comment">// 由于使用了大量对象，造成很大的内存开销。</span></div><div class="line">    <span class="comment">// 对象的大多数状态都可以变为外部状态。</span></div><div class="line">    <span class="comment">// 剥离出对象的外部状态之后，可以用相对较少的共享对象取代大量对象。</span></div><div class="line">    <span class="comment">// 使用举例:假设有个内衣工厂，目前的产品有50种男式内衣和50种女士内衣，为了推销产品，工厂决定生产一些塑料模特来穿上他们的内衣拍成广告照片。 </span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// 正常情况下需要50 个男模特和50个女模特，然后让他们每人分别穿上一件内衣来拍照</span></div><div class="line">    <span class="comment">// var Model = function(sex, underwear) &#123;</span></div><div class="line">    <span class="comment">//     this.sex = sex;</span></div><div class="line">    <span class="comment">//     this.underwear = underwear;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// Model.prototype.takePhoto = function() &#123;</span></div><div class="line">    <span class="comment">//     console.log("sex=" + this.sex + ";underwear=" + this.underwear);</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// for (var i = 1; i &lt;= 50; i++) &#123;</span></div><div class="line">    <span class="comment">//     var maleModel = new Model("male", "underwear" + i);</span></div><div class="line">    <span class="comment">//     maleModel.takePhoto();</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// for (var j = 1; j &lt;= 50; j++) &#123;</span></div><div class="line">    <span class="comment">//     var femaleModel = new Model("female", "underwear" + j);</span></div><div class="line">    <span class="comment">//     femaleModel.takePhoto();</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// 这样会产生100个对象，如果有10000种内衣，则此程序会爆炸</span></div><div class="line"></div><div class="line">    <span class="comment">// 优化，其实只要一个男模特、一个女模特，让他们分别试穿50件内衣然后拍照即可</span></div><div class="line">    <span class="keyword">var</span> Model = <span class="function"><span class="keyword">function</span>(<span class="params">sex</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.sex = sex;</div><div class="line">    &#125;;</div><div class="line">    Model.prototype.takePhoto = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"sex="</span> + <span class="keyword">this</span>.sex + <span class="string">";underwear="</span> + <span class="keyword">this</span>.underwear);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> maleModel = <span class="keyword">new</span> Model(<span class="string">'male'</span>),</div><div class="line">        femaleModel = <span class="keyword">new</span> Model(<span class="string">'female'</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++) &#123;</div><div class="line">        maleModel.underwear = <span class="string">'underwear'</span> + i;</div><div class="line">        maleModel.takePhoto();</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">1</span>; j &lt;= <span class="number">50</span>; j++) &#123;</div><div class="line">        femaleModel.underwear = <span class="string">'underwear'</span> + j;</div><div class="line">        femaleModel.takePhoto();</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 上例中性别是内部状态，内衣是外部状态</span></div><div class="line">    <span class="comment">// 可以被对象共享的属性通常被划分为内部状态，如同不管什么样式的衣服，都可以按照性别不同，穿在同一个男模特或者女模特身上，模特的性别就可以作为内部状态储存在共享对象的内部。而外部状态取决于具体的场景，并根据场景而变化，就像例子中每件衣服都是不同的，它们不能被一些对象共享，因此只能被划分为外部状态。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="享元模式重构上传"><a href="#享元模式重构上传" class="headerlink" title="享元模式重构上传"></a>享元模式重构上传</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 普通上传</span></div><div class="line">    <span class="comment">// var id = 0;</span></div><div class="line">    <span class="comment">// window.startUpload = function(uploadType, files) &#123;</span></div><div class="line">    <span class="comment">//     for (var i = 0, file; file = files[i++];) &#123;</span></div><div class="line">    <span class="comment">//         var uploadObj = new Upload(uploadType, file.fileName, file.fileSize);</span></div><div class="line">    <span class="comment">//         uploadObj.init(id++);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var Upload = function(uploadType, fileName, fileSize) &#123;</span></div><div class="line">    <span class="comment">//     this.uploadType = uploadType;</span></div><div class="line">    <span class="comment">//     this.fileName = fileName;</span></div><div class="line">    <span class="comment">//     this.fileSize = fileSize;</span></div><div class="line">    <span class="comment">//     this.dom = null;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// Upload.prototype.init = function(id) &#123;</span></div><div class="line">    <span class="comment">//     var that = this;</span></div><div class="line">    <span class="comment">//     this.id = id;</span></div><div class="line">    <span class="comment">//     this.dom = document.createElement("div");</span></div><div class="line">    <span class="comment">//     this.dom.innerHTML = '&lt;span&gt;文件名称:' + this.fileName + ', 文件大小: ' + this.fileSize + '&lt;/span&gt;' +</span></div><div class="line">    <span class="comment">//         '&lt;button class="delFile"&gt;删除&lt;/button&gt;';</span></div><div class="line">    <span class="comment">//     this.dom.querySelector(".delFile").onclick = function() &#123;</span></div><div class="line">    <span class="comment">//         that.delFile();</span></div><div class="line">    <span class="comment">//     &#125;;</span></div><div class="line">    <span class="comment">//     document.body.appendChild(this.dom);</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// Upload.prototype.delFile = function() &#123;</span></div><div class="line">    <span class="comment">//     if (this.fileSize &lt; 3000) &#123;</span></div><div class="line">    <span class="comment">//         return this.dom.parentNode.removeChild(this.dom);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     if (window.confirm("确定要删除该文件吗？" + this.fileName)) &#123;</span></div><div class="line">    <span class="comment">//         return this.dom.parentNode.removeChild(this.dom);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// startUpload('plugin', [&#123;</span></div><div class="line">    <span class="comment">//     fileName: '1.txt',</span></div><div class="line">    <span class="comment">//     fileSize: 1000</span></div><div class="line">    <span class="comment">// &#125;, &#123;</span></div><div class="line">    <span class="comment">//     fileName: '2.html',</span></div><div class="line">    <span class="comment">//     fileSize: 3000</span></div><div class="line">    <span class="comment">// &#125;, &#123;</span></div><div class="line">    <span class="comment">//     fileName: '3.txt',</span></div><div class="line">    <span class="comment">//     fileSize: 5000</span></div><div class="line">    <span class="comment">// &#125;]);</span></div><div class="line">    <span class="comment">// startUpload('flash', [&#123;</span></div><div class="line">    <span class="comment">//     fileName: '4.txt',</span></div><div class="line">    <span class="comment">//     fileSize: 1000</span></div><div class="line">    <span class="comment">// &#125;, &#123;</span></div><div class="line">    <span class="comment">//     fileName: '5.html',</span></div><div class="line">    <span class="comment">//     fileSize: 3000</span></div><div class="line">    <span class="comment">// &#125;, &#123;</span></div><div class="line">    <span class="comment">//     fileName: '6.txt',</span></div><div class="line">    <span class="comment">//     fileSize: 5000</span></div><div class="line">    <span class="comment">// &#125;]);</span></div><div class="line">    <span class="comment">// 上面的问题在于，有多少个要上传的文件，就要需要创建多少个upload对象</span></div><div class="line"></div><div class="line">    <span class="comment">// 使用享元模式重构</span></div><div class="line">    <span class="comment">// uploadType是内部状态，fileName和fileSize都是外部状态</span></div><div class="line">    <span class="keyword">var</span> Upload = <span class="function"><span class="keyword">function</span>(<span class="params">uploadType</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.uploadType = uploadType;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.delFile = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">        uploadManager.setExternalState(id, <span class="keyword">this</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.fileSize &lt; <span class="number">3000</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.confirm(<span class="string">'确定要删除该文件吗? '</span> + <span class="keyword">this</span>.fileName)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> UploadFactory = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> createdFlyWeightObjs = &#123;&#125;;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">create</span>: <span class="function"><span class="keyword">function</span>(<span class="params">uploadType</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (createdFlyWeightObjs[uploadType]) &#123;</div><div class="line">                    <span class="keyword">return</span> createdFlyWeightObjs[uploadType];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> createdFlyWeightObjs[uploadType] = <span class="keyword">new</span> Upload(uploadType);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> uploadManager = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> uploadDatabase = &#123;&#125;;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params">id, uploadType, fileName, fileSize</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> flyWeightObj = UploadFactory.create(uploadType);</div><div class="line">                <span class="keyword">var</span> dom = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">                dom.innerHTML =</div><div class="line">                    <span class="string">'&lt;span&gt;文件名称:'</span> + fileName + <span class="string">', 文件大小: '</span> + fileSize + <span class="string">'&lt;/span&gt;'</span> +</div><div class="line">                    <span class="string">'&lt;button class="delFile"&gt;删除&lt;/button&gt;'</span>;</div><div class="line">                dom.querySelector(<span class="string">'.delFile'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    flyWeightObj.delFile(id);</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">document</span>.body.appendChild(dom);</div><div class="line">                uploadDatabase[id] = &#123;</div><div class="line">                    <span class="attr">fileName</span>: fileName,</div><div class="line">                    <span class="attr">fileSize</span>: fileSize,</div><div class="line">                    <span class="attr">dom</span>: dom</div><div class="line">                &#125;;</div><div class="line">                <span class="keyword">return</span> flyWeightObj;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">setExternalState</span>: <span class="function"><span class="keyword">function</span>(<span class="params">id, flyWeightObj</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> uploadData = uploadDatabase[id];</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> uploadData) &#123;</div><div class="line">                    flyWeightObj[i] = uploadData[i];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> id = <span class="number">0</span>;</div><div class="line">    <span class="built_in">window</span>.startUpload = <span class="function"><span class="keyword">function</span>(<span class="params">uploadType, files</span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, file; file = files[i++];) &#123;</div><div class="line">            <span class="keyword">var</span> uploadObj = uploadManager.add(++id, uploadType, file.fileName, file.fileSize);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    startUpload(<span class="string">'plugin'</span>, [&#123;</div><div class="line">        <span class="attr">fileName</span>: <span class="string">'1.txt'</span>,</div><div class="line">        <span class="attr">fileSize</span>: <span class="number">1000</span></div><div class="line">    &#125;, &#123;</div><div class="line">        <span class="attr">fileName</span>: <span class="string">'2.html'</span>,</div><div class="line">        <span class="attr">fileSize</span>: <span class="number">3000</span></div><div class="line">    &#125;, &#123;</div><div class="line">        <span class="attr">fileName</span>: <span class="string">'3.txt'</span>,</div><div class="line">        <span class="attr">fileSize</span>: <span class="number">5000</span></div><div class="line">    &#125;]);</div><div class="line">    startUpload(<span class="string">'flash'</span>, [&#123;</div><div class="line">        <span class="attr">fileName</span>: <span class="string">'4.txt'</span>,</div><div class="line">        <span class="attr">fileSize</span>: <span class="number">1000</span></div><div class="line">    &#125;, &#123;</div><div class="line">        <span class="attr">fileName</span>: <span class="string">'5.html'</span>,</div><div class="line">        <span class="attr">fileSize</span>: <span class="number">3000</span></div><div class="line">    &#125;, &#123;</div><div class="line">        <span class="attr">fileName</span>: <span class="string">'6.txt'</span>,</div><div class="line">        <span class="attr">fileSize</span>: <span class="number">5000</span></div><div class="line">    &#125;]);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="对象池"><a href="#对象池" class="headerlink" title="对象池"></a>对象池</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 对象池维</span></div><div class="line">    <span class="comment">// 护一个装载空闲对象的池子，如果需要对象的时候，不是直接new，而是转从对象池里获取。如</span></div><div class="line">    <span class="comment">// 果对象池里没有空闲对象，则创建一个新的对象，当获取出的对象完成它的职责之后， 再进入</span></div><div class="line">    <span class="comment">// 池子等待被下次获取。</span></div><div class="line">    <span class="comment">// 对象池技术的应用非常广泛，HTTP 连接池和数据库连接池都是其代表应用。在Web 前端开</span></div><div class="line">    <span class="comment">// 发中，对象池使用最多的场景大概就是跟DOM 有关的操作。很多空间和时间都消耗在了DOM</span></div><div class="line">    <span class="comment">// 节点上，如何避免频繁地创建和删除DOM 节点就成了一个有意义的话题。</span></div><div class="line">    <span class="comment">// 对象池跟享元模式的思想有点相似,虽然innerHTML 的值A、B、C、D 等也可以看成节点的外部状态，但在这里我们并没有主动分离内部状态和外部状态的过程。</span></div><div class="line">    <span class="keyword">var</span> toolTipFactory = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> toolTipPool = [];</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">create</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (toolTipPool.length === <span class="number">0</span>) &#123;</div><div class="line">                    <span class="comment">// 对象池为空则创建一个div</span></div><div class="line">                    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">                    <span class="built_in">document</span>.body.appendChild(div);</div><div class="line">                    <span class="keyword">return</span> div;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">// 不为空则取出一个</span></div><div class="line">                    <span class="keyword">return</span> toolTipPool.shift();</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">recover</span>: <span class="function"><span class="keyword">function</span>(<span class="params">tooltipDom</span>) </span>&#123;</div><div class="line">                <span class="comment">// 对象池回收dom</span></div><div class="line">                <span class="keyword">return</span> toolTipPool.push(tooltipDom);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    <span class="comment">// 创建2个小气泡</span></div><div class="line">    <span class="keyword">var</span> ary = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, str; str = [<span class="string">"A"</span>, <span class="string">"B"</span>][i++];) &#123;</div><div class="line">        <span class="keyword">var</span> toolTip = toolTipFactory.create();</div><div class="line">        toolTip.innerHTML = str;</div><div class="line">        ary.push(toolTip);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(ary);</div><div class="line">    <span class="comment">// 地图需要重绘，所以先回收之前创建的2个气泡</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, toolTip; toolTip = ary[i++];) &#123;</div><div class="line">        toolTipFactory.recover(toolTip);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 创建6个气泡</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, str; str = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>][i++];) &#123;</div><div class="line">        <span class="keyword">var</span> toolTip = toolTipFactory.create();</div><div class="line">        toolTip.innerHTML = str;</div><div class="line">    &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="通用对象池"><a href="#通用对象池" class="headerlink" title="通用对象池"></a>通用对象池</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 通用的创建对象池的工厂</span></div><div class="line">    <span class="keyword">var</span> objectPoolFactory = <span class="function"><span class="keyword">function</span>(<span class="params">creactObjFn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> objectPool = [];</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">create</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> obj = objectPool.length === <span class="number">0</span> ? creactObjFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>) : objectPool.shift();</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">recover</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">                objectPool.push(obj);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> iframeFactory = objectPoolFactory(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</div><div class="line">        <span class="built_in">document</span>.body.appendChild(iframe);</div><div class="line">        iframe.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="comment">// 防止iframe重复加载的bug</span></div><div class="line">            iframe.onload = <span class="literal">null</span>;</div><div class="line">            <span class="comment">// 加载完成后回收节点，供下次使用</span></div><div class="line">            iframeFactory.recover(iframe);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> iframe;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> iframe1 = iframeFactory.create();</div><div class="line">    iframe1.src = <span class="string">'http://www.baidu.com'</span>;</div><div class="line">    <span class="keyword">var</span> iframe2 = iframeFactory.create();</div><div class="line">    iframe2.src = <span class="string">'http://www.qq.com'</span>;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> iframe3 = iframeFactory.create();</div><div class="line">        iframe3.src = <span class="string">'http://www.163.com'</span>;</div><div class="line">    &#125;, <span class="number">3000</span>);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="职责链模式"><a href="#职责链模式" class="headerlink" title="职责链模式"></a>职责链模式</h2><h3 id="基本定义-9"><a href="#基本定义-9" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 职责链模式:使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系， 将这些对象连成一条链， 并沿着这条链传递该请求， 直到有一个对象处理它为止。</span></div><div class="line">    <span class="comment">// 使用场景:类似队列的操作时可以用</span></div><div class="line">    <span class="comment">// 使用举例:公司针对支付过定金的用户有一定的优惠政策。在正式购买后，已经支付过500元定金的用户会收到100元的商城优惠券，200元定金的用户可以收到50 元的优惠券，而之前没有支付定金的用户只能进入普通购买模式，也就是没有优惠券，且在库存有限的情况下不一定保证能买到。我们的订单页面是PHP 吐出的模板，在页面加载之初，PHP 会传递给页面几个字段。</span></div><div class="line">    <span class="comment">// orderType：表示订单类型（定金用户或者普通购买用户），code 的值为1 的时候是500 元定金用户，为2 的时候是200 元定金用户，为3 的时候是普通购买用户。</span></div><div class="line">    <span class="comment">// pay：表示用户是否已经支付定金，值为true 或者false, 虽然用户已经下过500 元定金的订单，但如果他一直没有支付定金，现在只能降级进入普通购买模式。</span></div><div class="line">    <span class="comment">// stock：表示当前用于普通购买的手机库存数量，已经支付过500 元或者200 元定金的用户不受此限制。</span></div><div class="line"></div><div class="line">    <span class="comment">// 用普通流程写</span></div><div class="line">    <span class="comment">// var order = function(orderType, pay, stock) &#123;</span></div><div class="line">    <span class="comment">//     if (orderType === 1) &#123; // 500 元定金购买模式</span></div><div class="line">    <span class="comment">//         if (pay === true) &#123; // 已支付定金</span></div><div class="line">    <span class="comment">//             console.log('500 元定金预购, 得到100 优惠券');</span></div><div class="line">    <span class="comment">//         &#125; else &#123; // 未支付定金，降级到普通购买模式</span></div><div class="line">    <span class="comment">//             if (stock &gt; 0) &#123; // 用于普通购买的手机还有库存</span></div><div class="line">    <span class="comment">//                 console.log('普通购买, 无优惠券');</span></div><div class="line">    <span class="comment">//             &#125; else &#123;</span></div><div class="line">    <span class="comment">//                 console.log('手机库存不足');</span></div><div class="line">    <span class="comment">//             &#125;</span></div><div class="line">    <span class="comment">//         &#125;</span></div><div class="line">    <span class="comment">//     &#125; else if (orderType === 2) &#123; // 200 元定金购买模式</span></div><div class="line">    <span class="comment">//         if (pay === true) &#123;</span></div><div class="line">    <span class="comment">//             console.log('200 元定金预购, 得到50 优惠券');</span></div><div class="line">    <span class="comment">//         &#125; else &#123;</span></div><div class="line">    <span class="comment">//             if (stock &gt; 0) &#123;</span></div><div class="line">    <span class="comment">//                 console.log('普通购买, 无优惠券');</span></div><div class="line">    <span class="comment">//             &#125; else &#123;</span></div><div class="line">    <span class="comment">//                 console.log('手机库存不足');</span></div><div class="line">    <span class="comment">//             &#125;</span></div><div class="line">    <span class="comment">//         &#125;</span></div><div class="line">    <span class="comment">//     &#125; else if (orderType === 3) &#123;</span></div><div class="line">    <span class="comment">//         if (stock &gt; 0) &#123;</span></div><div class="line">    <span class="comment">//             console.log('普通购买, 无优惠券');</span></div><div class="line">    <span class="comment">//         &#125; else &#123;</span></div><div class="line">    <span class="comment">//             console.log('手机库存不足');</span></div><div class="line">    <span class="comment">//         &#125;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// order(1, true, 500); // 输出： 500 元定金预购, 得到100 优惠券</span></div><div class="line"></div><div class="line">    <span class="comment">// 用职责链来重写</span></div><div class="line">    <span class="comment">// 先把500 元订单、200 元订单以及普通购买分成3个函数</span></div><div class="line">    <span class="comment">// 接下来把orderType、pay、stock 这3 个字段当作参数传递给500 元订单函数，如果该函数不符合处理条件，则把这个请求传递给后面的200 元订单函数，如果200 元订单函数依然不能处理该请求，则继续传递请求给普通购买函数</span></div><div class="line">    <span class="comment">// 500 元订单</span></div><div class="line">    <span class="keyword">var</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (orderType === <span class="number">1</span> &amp;&amp; pay === <span class="literal">true</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'500 元定金预购, 得到100 优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            order200(orderType, pay, stock); <span class="comment">// 将请求传递给200 元订单</span></div><div class="line">            <span class="comment">// order200 和order500 耦合在一起</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 200 元订单</span></div><div class="line">    <span class="keyword">var</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (orderType === <span class="number">2</span> &amp;&amp; pay === <span class="literal">true</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'200 元定金预购, 得到50 优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            orderNormal(orderType, pay, stock); <span class="comment">// 将请求传递给普通订单</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 普通购买订单</span></div><div class="line">    <span class="keyword">var</span> orderNormal = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (stock &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'普通购买, 无优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'手机库存不足'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 测试结果：</span></div><div class="line">    order500(<span class="number">1</span>, <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：500 元定金预购, 得到100 优惠券</span></div><div class="line">    order500(<span class="number">1</span>, <span class="literal">false</span>, <span class="number">500</span>); <span class="comment">// 输出：普通购买, 无优惠券</span></div><div class="line">    order500(<span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：200 元定金预购, 得到500 优惠券</span></div><div class="line">    order500(<span class="number">3</span>, <span class="literal">false</span>, <span class="number">500</span>); <span class="comment">// 输出：普通购买, 无优惠券</span></div><div class="line">    order500(<span class="number">3</span>, <span class="literal">false</span>, <span class="number">0</span>); <span class="comment">// 输出：手机库存不足</span></div><div class="line">    <span class="comment">// 相比上面一个去掉了很多if判断，但是仍然存在每个处理对象相互耦合的问题，在order500中有order200</span></div><div class="line">    <span class="comment">// 如果有天我们要增加300 元预订或者去掉200 元预订，意味着就必须改动这些业务函数内部。就像一根环环相扣打了死结的链条，如果要增加、拆除或者移动一个节点，就必须得先砸烂这根链条</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="灵活可拆分的职责链节点"><a href="#灵活可拆分的职责链节点" class="headerlink" title="灵活可拆分的职责链节点"></a>灵活可拆分的职责链节点</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 58中的第二个例子很不灵活，链中的每个节点无法灵活拆分和重组</span></div><div class="line">    <span class="keyword">var</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (orderType === <span class="number">1</span> &amp;&amp; pay === <span class="literal">true</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'500 元定金预购，得到100 优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">'nextSuccessor'</span>; <span class="comment">// 我不知道下一个节点是谁，反正把请求往后面传递</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (orderType === <span class="number">2</span> &amp;&amp; pay === <span class="literal">true</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'200 元定金预购，得到50 优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">'nextSuccessor'</span>; <span class="comment">// 我不知道下一个节点是谁，反正把请求往后面传递</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> orderNormal = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (stock &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'普通购买，无优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'手机库存不足'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// Chain.prototype.setNextSuccessor 指定在链中的下一个节点</span></div><div class="line">    <span class="comment">// Chain.prototype.passRequest 传递请求给某个节点</span></div><div class="line">    <span class="keyword">var</span> Chain = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.fn = fn;</div><div class="line">        <span class="keyword">this</span>.successor = <span class="literal">null</span>; <span class="comment">//表示在链中的下一个节点</span></div><div class="line">    &#125;;</div><div class="line">    Chain.prototype.setNextSuccessor = <span class="function"><span class="keyword">function</span>(<span class="params">successor</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.successor = successor;</div><div class="line">    &#125;;</div><div class="line">    Chain.prototype.passRequest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ret = <span class="keyword">this</span>.fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        <span class="keyword">if</span> (ret === <span class="string">"nextSuccessor"</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.successor &amp;&amp; <span class="keyword">this</span>.successor.passRequest.apply(<span class="keyword">this</span>.successor, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 将订单函数包装成职责链的节点</span></div><div class="line">    <span class="keyword">var</span> chainOrder500 = <span class="keyword">new</span> Chain(order500);</div><div class="line">    <span class="keyword">var</span> chainOrder200 = <span class="keyword">new</span> Chain(order200);</div><div class="line">    <span class="keyword">var</span> chainOrderNormal = <span class="keyword">new</span> Chain(orderNormal);</div><div class="line">    <span class="comment">// 然后指定节点在职责链中的顺序</span></div><div class="line">    chainOrder500.setNextSuccessor(chainOrder200);</div><div class="line">    chainOrder200.setNextSuccessor(chainOrderNormal);</div><div class="line">    <span class="comment">// 传递请求</span></div><div class="line">    chainOrder500.passRequest(<span class="number">1</span>, <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：500 元定金预购，得到100 优惠券</span></div><div class="line">    chainOrder500.passRequest(<span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：200 元定金预购，得到50 优惠券</span></div><div class="line">    chainOrder500.passRequest(<span class="number">3</span>, <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：普通购买，无优惠券</span></div><div class="line">    chainOrder500.passRequest(<span class="number">1</span>, <span class="literal">false</span>, <span class="number">0</span>); <span class="comment">// 输出：手机库存不足</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="异步的职责链"><a href="#异步的职责链" class="headerlink" title="异步的职责链"></a>异步的职责链</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 在59中我们让每个节点函数同步返回一个特定的值"nextSuccessor"，来表示是否把请求传递给下一个节点。而在现实开发中，我们经常会遇到一些异步的问题，比如我们要在节点函数中发起一个ajax异步请求，异步请求返回的结果才能决定是否继续在职责链中passRequest。</span></div><div class="line">    <span class="keyword">var</span> Chain = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.fn = fn;</div><div class="line">        <span class="keyword">this</span>.successor = <span class="literal">null</span>; <span class="comment">//表示在链中的下一个节点</span></div><div class="line">    &#125;;</div><div class="line">    Chain.prototype.setNextSuccessor = <span class="function"><span class="keyword">function</span>(<span class="params">successor</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.successor = successor;</div><div class="line">    &#125;;</div><div class="line">    Chain.prototype.passRequest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ret = <span class="keyword">this</span>.fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        <span class="keyword">if</span> (ret === <span class="string">"nextSuccessor"</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.successor &amp;&amp; <span class="keyword">this</span>.successor.passRequest.apply(<span class="keyword">this</span>.successor, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 添加next，表示手动传递请求给下一节点</span></div><div class="line">    Chain.prototype.next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.successor &amp;&amp; <span class="keyword">this</span>.successor.passRequest.apply(<span class="keyword">this</span>.successor, <span class="built_in">arguments</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> fn1 = <span class="keyword">new</span> Chain(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">        <span class="keyword">return</span> <span class="string">'nextSuccessor'</span>;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> fn2 = <span class="keyword">new</span> Chain(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            self.next();</div><div class="line">        &#125;, <span class="number">1000</span>);</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> fn3 = <span class="keyword">new</span> Chain(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">    &#125;);</div><div class="line">    fn1.setNextSuccessor(fn2).setNextSuccessor(fn3);</div><div class="line">    fn1.passRequest();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="用AOP实现职责链"><a href="#用AOP实现职责链" class="headerlink" title="用AOP实现职责链"></a>用AOP实现职责链</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> ret = self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">if</span> (ret === <span class="string">'nextSuccessor'</span>) &#123;</div><div class="line">                <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> order500 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (orderType === <span class="number">1</span> &amp;&amp; pay === <span class="literal">true</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'500 元定金预购，得到100 优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">'nextSuccessor'</span>; <span class="comment">// 我不知道下一个节点是谁，反正把请求往后面传递</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> order200 = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (orderType === <span class="number">2</span> &amp;&amp; pay === <span class="literal">true</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'200 元定金预购，得到50 优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">'nextSuccessor'</span>; <span class="comment">// 我不知道下一个节点是谁，反正把请求往后面传递</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> orderNormal = <span class="function"><span class="keyword">function</span>(<span class="params">orderType, pay, stock</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (stock &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'普通购买，无优惠券'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'手机库存不足'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> order = order500.after(order200).after(orderNormal);</div><div class="line">    order(<span class="number">1</span>, <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：500 元定金预购，得到100 优惠券</span></div><div class="line">    order(<span class="number">2</span>, <span class="literal">true</span>, <span class="number">500</span>); <span class="comment">// 输出：200 元定金预购，得到50 优惠券</span></div><div class="line">    order(<span class="number">1</span>, <span class="literal">false</span>, <span class="number">500</span>); <span class="comment">// 输出：普通购买，无优惠券</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="用职责链获取文件上传对象"><a href="#用职责链获取文件上传对象" class="headerlink" title="用职责链获取文件上传对象"></a>用职责链获取文件上传对象</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> ret = self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">if</span> (ret === <span class="string">'nextSuccessor'</span>) &#123;</div><div class="line">                <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getActiveUploadObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">"TXFTNActiveX.FTNUpload"</span>); <span class="comment">// IE 上传控件</span></div><div class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">'nextSuccessor'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getFlashUploadObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (supportFlash()) &#123;</div><div class="line">            <span class="keyword">var</span> str = <span class="string">'&lt;object type="application/x-shockwave-flash"&gt;&lt;/object&gt;'</span>;</div><div class="line">            <span class="keyword">return</span> $(str).appendTo($(<span class="string">'body'</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">'nextSuccessor'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getFormUpladObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> $(<span class="string">'&lt;form&gt;&lt;input name="file" type="file"/&gt;&lt;/form&gt;'</span>).appendTo($(<span class="string">'body'</span>));</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getUploadObj = getActiveUploadObj.after(getFlashUploadObj).after(getFormUpladObj);</div><div class="line">    <span class="built_in">console</span>.log(getUploadObj());</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><h3 id="基本定义-10"><a href="#基本定义-10" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 中介者模式:程序由大大小小的单一对象组成，所有这些对象都按照某种关系和规则来通信。当对象多了以后，相互通信会变的非常封闭式。中介者模式的作用就是解除对象与对象之间的紧耦合关系。增加一个中介者对象后，所有的相关对象都通过中介者对象来通信，而不是互相引用，所以当一个对象发生改变时，只需要通知中介者对象即可。中介者使各对象之间耦合松散，而且可以独立地改变它们之间的交互。中介者模式使网状的多对多关系变成了相对简单的一对多关系</span></div><div class="line">    <span class="comment">// 使用场景:当对象之间相互引用非常多时</span></div><div class="line">    <span class="comment">// 使用举例:泡泡堂游戏、购买商品</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Player</span>(<span class="params">name, teamColor</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.partners = []; <span class="comment">// 队友列表</span></div><div class="line">        <span class="keyword">this</span>.enemies = []; <span class="comment">// 敌人列表</span></div><div class="line">        <span class="keyword">this</span>.state = <span class="string">'live'</span>; <span class="comment">// 玩家状态</span></div><div class="line">        <span class="keyword">this</span>.name = name; <span class="comment">// 角色名字</span></div><div class="line">        <span class="keyword">this</span>.teamColor = teamColor; <span class="comment">// 队伍颜色</span></div><div class="line">    &#125;;</div><div class="line">    Player.prototype.win = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 玩家团队胜利</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'winner: '</span> + <span class="keyword">this</span>.name);</div><div class="line">    &#125;;</div><div class="line">    Player.prototype.lose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 玩家团队失败</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'loser: '</span> + <span class="keyword">this</span>.name);</div><div class="line">    &#125;;</div><div class="line">    Player.prototype.die = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 玩家死亡</span></div><div class="line">        <span class="keyword">var</span> all_dead = <span class="literal">true</span>;</div><div class="line">        <span class="keyword">this</span>.state = <span class="string">'dead'</span>; <span class="comment">// 设置玩家状态为死亡</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, partner; partner = <span class="keyword">this</span>.partners[i++];) &#123; <span class="comment">// 遍历队友列表</span></div><div class="line">            <span class="keyword">if</span> (partner.state !== <span class="string">'dead'</span>) &#123; <span class="comment">// 如果还有一个队友没有死亡，则游戏还未失败</span></div><div class="line">                all_dead = <span class="literal">false</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (all_dead === <span class="literal">true</span>) &#123; <span class="comment">// 如果队友全部死亡</span></div><div class="line">            <span class="keyword">this</span>.lose(); <span class="comment">// 通知自己游戏失败</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, partner; partner = <span class="keyword">this</span>.partners[i++];) &#123; <span class="comment">// 通知所有队友玩家游戏失败</span></div><div class="line">                partner.lose();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, enemy; enemy = <span class="keyword">this</span>.enemies[i++];) &#123; <span class="comment">// 通知所有敌人游戏胜利</span></div><div class="line">                enemy.win();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> playerFactory = <span class="function"><span class="keyword">function</span>(<span class="params">name, teamColor</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> newPlayer = <span class="keyword">new</span> Player(name, teamColor); <span class="comment">// 创建新玩家</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, player; player = players[i++];) &#123; <span class="comment">// 通知所有的玩家，有新角色加入</span></div><div class="line">            <span class="keyword">if</span> (player.teamColor === newPlayer.teamColor) &#123; <span class="comment">// 如果是同一队的玩家</span></div><div class="line">                player.partners.push(newPlayer); <span class="comment">// 相互添加到队友列表</span></div><div class="line">                newPlayer.partners.push(player);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                player.enemies.push(newPlayer); <span class="comment">// 相互添加到敌人列表</span></div><div class="line">                newPlayer.enemies.push(player);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        players.push(newPlayer);</div><div class="line">        <span class="keyword">return</span> newPlayer;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> players = [];</div><div class="line">    <span class="comment">//红队：</span></div><div class="line">    <span class="keyword">var</span> player1 = playerFactory(<span class="string">'皮蛋'</span>, <span class="string">'red'</span>),</div><div class="line">        player2 = playerFactory(<span class="string">'小乖'</span>, <span class="string">'red'</span>),</div><div class="line">        player3 = playerFactory(<span class="string">'宝宝'</span>, <span class="string">'red'</span>),</div><div class="line">        player4 = playerFactory(<span class="string">'小强'</span>, <span class="string">'red'</span>);</div><div class="line">    <span class="comment">//蓝队：</span></div><div class="line">    <span class="keyword">var</span> player5 = playerFactory(<span class="string">'黑妞'</span>, <span class="string">'blue'</span>),</div><div class="line">        player6 = playerFactory(<span class="string">'葱头'</span>, <span class="string">'blue'</span>),</div><div class="line">        player7 = playerFactory(<span class="string">'胖墩'</span>, <span class="string">'blue'</span>),</div><div class="line">        player8 = playerFactory(<span class="string">'海盗'</span>, <span class="string">'blue'</span>);</div><div class="line">    player1.die();</div><div class="line">    player2.die();</div><div class="line">    player4.die();</div><div class="line">    player3.die();</div><div class="line">    <span class="comment">// 问题,每个玩家和其他玩家都是紧紧耦合在一起的。当每个对象的状态发生改变，比如角色移动、吃到道具或者死亡时，都必须要显式地遍历通知其他对象。当玩家变的很多，则会爆炸</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="中介者模式改造泡泡堂游戏"><a href="#中介者模式改造泡泡堂游戏" class="headerlink" title="中介者模式改造泡泡堂游戏"></a>中介者模式改造泡泡堂游戏</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Player</span>(<span class="params">name, teamColor</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name; <span class="comment">// 角色名字</span></div><div class="line">        <span class="keyword">this</span>.teamColor = teamColor; <span class="comment">// 队伍颜色</span></div><div class="line">        <span class="keyword">this</span>.state = <span class="string">'alive'</span>; <span class="comment">// 玩家生存状态</span></div><div class="line">    &#125;;</div><div class="line">    Player.prototype.win = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' won '</span>);</div><div class="line">    &#125;;</div><div class="line">    Player.prototype.lose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' lost'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/*******************玩家死亡*****************/</span></div><div class="line">    Player.prototype.die = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.state = <span class="string">'dead'</span>;</div><div class="line">        playerDirector.reciveMessage(<span class="string">'playerDead'</span>, <span class="keyword">this</span>); <span class="comment">// 给中介者发送消息，玩家死亡</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/*******************移除玩家*****************/</span></div><div class="line">    Player.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        playerDirector.reciveMessage(<span class="string">'removePlayer'</span>, <span class="keyword">this</span>); <span class="comment">// 给中介者发送消息，移除一个玩家</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">/*******************玩家换队*****************/</span></div><div class="line">    Player.prototype.changeTeam = <span class="function"><span class="keyword">function</span>(<span class="params">color</span>) </span>&#123;</div><div class="line">        playerDirector.reciveMessage(<span class="string">'changeTeam'</span>, <span class="keyword">this</span>, color); <span class="comment">// 给中介者发送消息，玩家换队</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> playerFactory = <span class="function"><span class="keyword">function</span>(<span class="params">name, teamColor</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> newPlayer = <span class="keyword">new</span> Player(name, teamColor); <span class="comment">// 创造一个新的玩家对象</span></div><div class="line">        playerDirector.reciveMessage(<span class="string">'addPlayer'</span>, newPlayer); <span class="comment">// 给中介者发送消息，新增玩家</span></div><div class="line">        <span class="keyword">return</span> newPlayer;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> playerDirector = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> players = &#123;&#125;, <span class="comment">// 保存所有玩家</span></div><div class="line">            operations = &#123;&#125;; <span class="comment">// 中介者可以执行的操作</span></div><div class="line">        <span class="comment">/****************新增一个玩家***************************/</span></div><div class="line">        operations.addPlayer = <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> teamColor = player.teamColor; <span class="comment">// 玩家的队伍颜色</span></div><div class="line">            players[teamColor] = players[teamColor] || []; <span class="comment">// 如果该颜色的玩家还没有成立队伍，则新成立一个队伍</span></div><div class="line">            players[teamColor].push(player); <span class="comment">// 添加玩家进队伍</span></div><div class="line">        &#125;;</div><div class="line">        <span class="comment">/****************移除一个玩家***************************/</span></div><div class="line">        operations.removePlayer = <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> teamColor = player.teamColor, <span class="comment">// 玩家的队伍颜色</span></div><div class="line">                teamPlayers = players[teamColor] || []; <span class="comment">// 该队伍所有成员</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = teamPlayers.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123; <span class="comment">// 遍历删除</span></div><div class="line">                <span class="keyword">if</span> (teamPlayers[i] === player) &#123;</div><div class="line">                    teamPlayers.splice(i, <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">/****************玩家换队***************************/</span></div><div class="line">        operations.changeTeam = <span class="function"><span class="keyword">function</span>(<span class="params">player, newTeamColor</span>) </span>&#123; <span class="comment">// 玩家换队</span></div><div class="line">            operations.removePlayer(player); <span class="comment">// 从原队伍中删除</span></div><div class="line">            player.teamColor = newTeamColor; <span class="comment">// 改变队伍颜色</span></div><div class="line">            operations.addPlayer(player); <span class="comment">// 增加到新队伍中</span></div><div class="line">        &#125;;</div><div class="line">        operations.playerDead = <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123; <span class="comment">// 玩家死亡</span></div><div class="line">            <span class="keyword">var</span> teamColor = player.teamColor,</div><div class="line">                teamPlayers = players[teamColor]; <span class="comment">// 玩家所在队伍</span></div><div class="line">            <span class="keyword">var</span> all_dead = <span class="literal">true</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, player; player = teamPlayers[i++];) &#123;</div><div class="line">                <span class="keyword">if</span> (player.state !== <span class="string">'dead'</span>) &#123;</div><div class="line">                    all_dead = <span class="literal">false</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (all_dead === <span class="literal">true</span>) &#123; <span class="comment">// 全部死亡</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, player; player = teamPlayers[i++];) &#123;</div><div class="line">                    player.lose(); <span class="comment">// 本队所有玩家lose</span></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> color <span class="keyword">in</span> players) &#123;</div><div class="line">                    <span class="keyword">if</span> (color !== teamColor) &#123;</div><div class="line">                        <span class="keyword">var</span> teamPlayers = players[color]; <span class="comment">// 其他队伍的玩家</span></div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, player; player = teamPlayers[i++];) &#123;</div><div class="line">                            player.win(); <span class="comment">// 其他队伍所有玩家win</span></div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">var</span> reciveMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> message = <span class="built_in">Array</span>.prototype.shift.call(<span class="built_in">arguments</span>); <span class="comment">// arguments 的第一个参数为消息名称</span></div><div class="line">            operations[message].apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">reciveMessage</span>: reciveMessage</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line"></div><div class="line">    <span class="comment">// 红队：</span></div><div class="line">    <span class="keyword">var</span> player1 = playerFactory(<span class="string">'皮蛋'</span>, <span class="string">'red'</span>),</div><div class="line">        player2 = playerFactory(<span class="string">'小乖'</span>, <span class="string">'red'</span>),</div><div class="line">        player3 = playerFactory(<span class="string">'宝宝'</span>, <span class="string">'red'</span>),</div><div class="line">        player4 = playerFactory(<span class="string">'小强'</span>, <span class="string">'red'</span>);</div><div class="line">    <span class="comment">// 蓝队：</span></div><div class="line">    <span class="keyword">var</span> player5 = playerFactory(<span class="string">'黑妞'</span>, <span class="string">'blue'</span>),</div><div class="line">        player6 = playerFactory(<span class="string">'葱头'</span>, <span class="string">'blue'</span>),</div><div class="line">        player7 = playerFactory(<span class="string">'胖墩'</span>, <span class="string">'blue'</span>),</div><div class="line">        player8 = playerFactory(<span class="string">'海盗'</span>, <span class="string">'blue'</span>);</div><div class="line">    player1.changeTeam(<span class="string">'blue'</span>);</div><div class="line">    player2.die();</div><div class="line">    player3.die();</div><div class="line">    player4.die();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="普通方法购买商品"><a href="#普通方法购买商品" class="headerlink" title="普通方法购买商品"></a>普通方法购买商品</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>选择颜色:</div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"colorSelect"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>请选择<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"red"</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"blue"</span>&gt;</span>蓝色<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">    选择内存:</div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"memorySelect"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>请选择<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"32G"</span>&gt;</span>32G<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"16G"</span>&gt;</span>16G<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">    输入购买数量:</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"numberInput"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span> 您选择了颜色:</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"colorInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span> 您选择了内存:</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"memoryInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span> 您输入了数量:</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"numberInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"nextBtn"</span> <span class="attr">disabled</span>=<span class="string">"true"</span>&gt;</span>请选择手机颜色和购买数量<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 假设我们正在编写一个手机购买的页面，在购买流程中，可以选择手机的颜色以及输入购买数量，同时页面中有两个展示区域，分别向用户展示刚刚选择好的颜色和数量。还有一个按钮动态显示下一步的操作，我们需要查询该颜色手机对应的库存，如果库存数量少于这次的购买数量，按钮将被禁用并且显示库存不足，反之按钮可以点击并且显示放入购物车。</span></div><div class="line">    <span class="keyword">var</span> colorSelect = <span class="built_in">document</span>.getElementById(<span class="string">'colorSelect'</span>),</div><div class="line">        numberInput = <span class="built_in">document</span>.getElementById(<span class="string">'numberInput'</span>),</div><div class="line">        colorInfo = <span class="built_in">document</span>.getElementById(<span class="string">'colorInfo'</span>),</div><div class="line">        numberInfo = <span class="built_in">document</span>.getElementById(<span class="string">'numberInfo'</span>),</div><div class="line">        nextBtn = <span class="built_in">document</span>.getElementById(<span class="string">'nextBtn'</span>);</div><div class="line">    <span class="keyword">var</span> goods = &#123; <span class="comment">// 手机库存</span></div><div class="line">        <span class="string">"red|32G"</span>: <span class="number">3</span>, <span class="comment">// 红色32G，库存数量为3</span></div><div class="line">        <span class="string">"red|16G"</span>: <span class="number">0</span>,</div><div class="line">        <span class="string">"blue|32G"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"blue|16G"</span>: <span class="number">6</span></div><div class="line">    &#125;;</div><div class="line">    colorSelect.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> color = <span class="keyword">this</span>.value,</div><div class="line">            memory = memorySelect.value,</div><div class="line">            stock = goods[color + <span class="string">'|'</span> + memory];</div><div class="line">        number = numberInput.value, <span class="comment">// 数量</span></div><div class="line">            colorInfo.innerHTML = color;</div><div class="line">        <span class="keyword">if</span> (!color) &#123;</div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请选择手机颜色'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!memory) &#123;</div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请选择内存大小'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!(<span class="regexp">/^[0-9]*[1-9][0-9]*$/</span>).test(number)) &#123; <span class="comment">// 输入购买数量是否为正整数</span></div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请输入正确的购买数量'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (number &gt; stock) &#123; <span class="comment">// 当前选择数量没有超过库存量</span></div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'库存不足'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        nextBtn.disabled = <span class="literal">false</span>;</div><div class="line">        nextBtn.innerHTML = <span class="string">'放入购物车'</span>;</div><div class="line">    &#125;;</div><div class="line">    numberInput.oninput = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> color = colorSelect.value, <span class="comment">// 颜色</span></div><div class="line">            number = <span class="keyword">this</span>.value, <span class="comment">// 数量</span></div><div class="line">            memory = memorySelect.value,</div><div class="line">            stock = goods[color + <span class="string">'|'</span> + memory];</div><div class="line">        number = numberInput.value, <span class="comment">// 数量</span></div><div class="line">            numberInfo.innerHTML = number;</div><div class="line">        <span class="keyword">if</span> (!color) &#123;</div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请选择手机颜色'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!memory) &#123;</div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请选择内存大小'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!(<span class="regexp">/^[0-9]*[1-9][0-9]*$/</span>).test(number)) &#123; <span class="comment">// 输入购买数量是否为正整数</span></div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请输入正确的购买数量'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (number &gt; stock) &#123; <span class="comment">// 当前选择数量没有超过库存量</span></div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'库存不足'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        nextBtn.disabled = <span class="literal">false</span>;</div><div class="line">        nextBtn.innerHTML = <span class="string">'放入购物车'</span>;</div><div class="line">    &#125;;</div><div class="line">    memorySelect.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> color = colorSelect.value, <span class="comment">// 颜色</span></div><div class="line">            number = numberInput.value, <span class="comment">// 数量</span></div><div class="line">            memory = <span class="keyword">this</span>.value,</div><div class="line">            stock = goods[color + <span class="string">'|'</span> + memory]; <span class="comment">// 该颜色手机对应的当前库存</span></div><div class="line">        memoryInfo.innerHTML = memory;</div><div class="line">        <span class="keyword">if</span> (!color) &#123;</div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请选择手机颜色'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!memory) &#123;</div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请选择内存大小'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!(<span class="regexp">/^[0-9]*[1-9][0-9]*$/</span>).test(number)) &#123; <span class="comment">// 输入购买数量是否为正整数</span></div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'请输入正确的购买数量'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (number &gt; stock) &#123; <span class="comment">// 当前选择数量没有超过库存量</span></div><div class="line">            nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">            nextBtn.innerHTML = <span class="string">'库存不足'</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        nextBtn.disabled = <span class="literal">false</span>;</div><div class="line">        nextBtn.innerHTML = <span class="string">'放入购物车'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 上面的方式，每个对象都耦合在一起，当修改一个地方，需要在每个事件里同步修改，非常不利于维护。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="中介者模式购买商品"><a href="#中介者模式购买商品" class="headerlink" title="中介者模式购买商品"></a>中介者模式购买商品</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>选择颜色:</div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"colorSelect"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>请选择<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"red"</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"blue"</span>&gt;</span>蓝色<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">    选择内存:</div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"memorySelect"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>请选择<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"16G"</span>&gt;</span>16G<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"32G"</span>&gt;</span>32G<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">    选择CPU:</div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"cpuSelect"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>请选择<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"800"</span>&gt;</span>800<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"801"</span>&gt;</span>801<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">    输入购买数量:</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"numberInput"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span> 您选择了颜色:</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"colorInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span> 您选择了内存:</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"memoryInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span>您选择了cpu:</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"cpuInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span> 您输入了数量:</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"numberInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"nextBtn"</span> <span class="attr">disabled</span>=<span class="string">"true"</span>&gt;</span>请选择手机颜色和购买数量<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 引入中介者模式,所有的节点对象只跟中介者通信</span></div><div class="line">    <span class="keyword">var</span> goods = &#123; <span class="comment">// 手机库存</span></div><div class="line">        <span class="string">"red|32G|800"</span>: <span class="number">3</span>, <span class="comment">// 颜色red，内存32G，cpu800，对应库存数量为3</span></div><div class="line">        <span class="string">"red|16G|801"</span>: <span class="number">0</span>,</div><div class="line">        <span class="string">"blue|32G|800"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"blue|16G|801"</span>: <span class="number">6</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> mediator = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> colorSelect = <span class="built_in">document</span>.getElementById(<span class="string">'colorSelect'</span>),</div><div class="line">            memorySelect = <span class="built_in">document</span>.getElementById(<span class="string">'memorySelect'</span>),</div><div class="line">            numberInput = <span class="built_in">document</span>.getElementById(<span class="string">'numberInput'</span>),</div><div class="line">            colorInfo = <span class="built_in">document</span>.getElementById(<span class="string">'colorInfo'</span>),</div><div class="line">            cpuInfo = <span class="built_in">document</span>.getElementById(<span class="string">'cpuInfo'</span>),</div><div class="line">            memoryInfo = <span class="built_in">document</span>.getElementById(<span class="string">'memoryInfo'</span>),</div><div class="line">            numberInfo = <span class="built_in">document</span>.getElementById(<span class="string">'numberInfo'</span>),</div><div class="line">            nextBtn = <span class="built_in">document</span>.getElementById(<span class="string">'nextBtn'</span>),</div><div class="line">            cpuSelect = <span class="built_in">document</span>.getElementById(<span class="string">'cpuSelect'</span>);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">changed</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> color = colorSelect.value,</div><div class="line">                    memory = memorySelect.value,</div><div class="line">                    number = numberInput.value,</div><div class="line">                    cpu = cpuSelect.value,</div><div class="line">                    stock = goods[color + <span class="string">'|'</span> + memory + <span class="string">'|'</span> + cpu];</div><div class="line">                <span class="keyword">if</span> (obj === colorSelect) &#123;</div><div class="line">                    colorInfo.innerHTML = color;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj === memorySelect) &#123;</div><div class="line">                    memoryInfo.innerHTML = memory;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj === cpuSelect) &#123;</div><div class="line">                    cpuInfo.innerHTML = cpu;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj === numberInput) &#123;</div><div class="line">                    numberInfo.innerHTML = number;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!color) &#123;</div><div class="line">                    nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">                    nextBtn.innerHTML = <span class="string">"请选择手机颜色"</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!memory) &#123;</div><div class="line">                    nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">                    nextBtn.innerHTML = <span class="string">"请选择手机内存大小"</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!cpu) &#123;</div><div class="line">                    nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">                    nextBtn.innerHTML = <span class="string">"请选择CPU"</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!(<span class="regexp">/^[0-9]*[1-9][0-9]*$/</span>).test(number)) &#123; <span class="comment">// 输入购买数量是否为正整数</span></div><div class="line">                    nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">                    nextBtn.innerHTML = <span class="string">'请输入正确的购买数量'</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!stock || number &gt; stock) &#123; <span class="comment">// 当前选择数量没有超过库存量</span></div><div class="line">                    nextBtn.disabled = <span class="literal">true</span>;</div><div class="line">                    nextBtn.innerHTML = <span class="string">'库存不足'</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                nextBtn.disabled = <span class="literal">false</span>;</div><div class="line">                nextBtn.innerHTML = <span class="string">"放入购物车"</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;)();</div><div class="line">    colorSelect.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        mediator.changed(<span class="keyword">this</span>);</div><div class="line">    &#125;;</div><div class="line">    memorySelect.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        mediator.changed(<span class="keyword">this</span>);</div><div class="line">    &#125;;</div><div class="line">    cpuSelect.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        mediator.changed(<span class="keyword">this</span>);</div><div class="line">    &#125;;</div><div class="line">    numberInput.oninput = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        mediator.changed(<span class="keyword">this</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 当再添加一个cpu型号时，可直接在mediator中添加即可</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h2><h3 id="基本定义-11"><a href="#基本定义-11" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 装饰者模式:装饰者模式可以动态地给某个对象添加一些额外的职责，而不会影响从这个类中派生的其他对象。装饰者模式能够在不改变对象自身的基础上，在程序运行期间给对象    动态地添加职责。</span></div><div class="line">    <span class="comment">// 使用场景:当需要给对象动态的添加行为时</span></div><div class="line">    <span class="comment">// 使用举例:统计代码、插件式验证等</span></div><div class="line"></div><div class="line">    <span class="comment">// 传统装饰者模式</span></div><div class="line">    <span class="comment">// var Plane = function() &#123;&#125;</span></div><div class="line">    <span class="comment">// Plane.prototype.fire = function() &#123;</span></div><div class="line">    <span class="comment">//     console.log('发射普通子弹');</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var MissileDecorator = function(plane) &#123;</span></div><div class="line">    <span class="comment">//     this.plane = plane;</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// MissileDecorator.prototype.fire = function() &#123;</span></div><div class="line">    <span class="comment">//     this.plane.fire();</span></div><div class="line">    <span class="comment">//     console.log('发射导弹');</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var AtomDecorator = function(plane) &#123;</span></div><div class="line">    <span class="comment">//     this.plane = plane;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// AtomDecorator.prototype.fire = function() &#123;</span></div><div class="line">    <span class="comment">//     this.plane.fire();</span></div><div class="line">    <span class="comment">//     console.log('发射原子弹');</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var plane = new Plane();</span></div><div class="line">    <span class="comment">// plane = new MissileDecorator(plane);</span></div><div class="line">    <span class="comment">// plane = new AtomDecorator(plane);</span></div><div class="line">    <span class="comment">// plane.fire();</span></div><div class="line">    <span class="comment">// // 分别输出： 发射普通子弹、发射导弹、发射原子弹</span></div><div class="line"></div><div class="line">    <span class="comment">// js中的装饰者模式</span></div><div class="line">    <span class="keyword">var</span> plane = &#123;</div><div class="line">        <span class="attr">fire</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"发射普通"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> missileDecorator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'发射导弹'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> atomDecorator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'发射原子弹'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> fire1 = plane.fire;</div><div class="line">    plane.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        fire1();</div><div class="line">        missileDecorator();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> fire2 = plane.fire;</div><div class="line">    plane.fire = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        fire2();</div><div class="line">        atomDecorator();</div><div class="line">    &#125;</div><div class="line">    plane.fire();</div><div class="line">    <span class="comment">// 分别输出： 发射普通子弹、发射导弹、发射原子弹</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="装饰函数"><a href="#装饰函数" class="headerlink" title="装饰函数"></a>装饰函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 装饰函数-&gt;为函数添加功能</span></div><div class="line"></div><div class="line">    <span class="comment">// 最low的添加功能，直接改写原函数</span></div><div class="line">    <span class="comment">// var a = function() &#123;</span></div><div class="line">    <span class="comment">//     alert(1);</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line"></div><div class="line">    <span class="comment">// var a = function() &#123;</span></div><div class="line">    <span class="comment">//     alert(1);</span></div><div class="line">    <span class="comment">//     alert(2);</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line"></div><div class="line">    <span class="comment">// 保存原函数的引用，这种方法必须得维护_a这个中间量，如果装饰链过长或要装饰的函数过多，中间量就会变的很多;还会出现this劫持问题</span></div><div class="line">    <span class="comment">// var a = function() &#123;</span></div><div class="line">    <span class="comment">//     alert(1);</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var _a = a;</span></div><div class="line">    <span class="comment">// a = function() &#123;</span></div><div class="line">    <span class="comment">//     _a();</span></div><div class="line">    <span class="comment">//     alert(2);</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// a();</span></div><div class="line"></div><div class="line">    <span class="comment">// 上面方法会出现下面的this劫持问题</span></div><div class="line">    <span class="comment">// var _getElementById = document.getElementById;</span></div><div class="line">    <span class="comment">// document.getElementById = function(id) &#123;</span></div><div class="line">    <span class="comment">//     alert(1);</span></div><div class="line">    <span class="comment">//     return _getElementById(id); // (1)</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// var button = document.getElementById('button'); // error</span></div><div class="line">    <span class="comment">// 报错原因是getElementById内部是要用到this,调用_getElementById时this是指向window而不是document，所以会报错</span></div><div class="line"></div><div class="line">    <span class="comment">// 为解决上面问题，可以将document动态传入</span></div><div class="line">    <span class="keyword">var</span> _getElementById = <span class="built_in">document</span>.getElementById;</div><div class="line">    <span class="built_in">document</span>.getElementById = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">1</span>);</div><div class="line">        <span class="keyword">return</span> _getElementById.apply(<span class="built_in">document</span>, <span class="built_in">arguments</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> button = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="用AOP来装饰函数"><a href="#用AOP来装饰函数" class="headerlink" title="用AOP来装饰函数"></a>用AOP来装饰函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">beforefn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>; <span class="comment">// 保存原函数的引用</span></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 返回包含了原函数和新函数的"代理"函数</span></div><div class="line">            beforefn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 执行新函数，且保证this 不被劫持，新函数接受的参数</span></div><div class="line">            <span class="comment">// 也会被原封不动地传入原函数，新函数在原函数之前执行</span></div><div class="line">            <span class="keyword">return</span> __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 执行原函数并返回原函数的执行结果，</span></div><div class="line">            <span class="comment">// 并且保证this 不被劫持</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">afterfn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> ret = __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            afterfn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">document</span>.getElementById = <span class="built_in">document</span>.getElementById.before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="string">"取button之前"</span>);</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> button = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</div><div class="line">    <span class="built_in">console</span>.log(button);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">window</span>.onload = (<span class="built_in">window</span>.onload || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">2</span>);</div><div class="line">    &#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">3</span>);</div><div class="line">    &#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">4</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 上面的AOP 实现是在Function.prototype 上添加before 和after 方法，但许多人不喜欢这种污染原型的方式，那么我们可以做一些变通，把原函数和新函数都作为参数传入before 或者after 方法</span></div><div class="line">    <span class="keyword">var</span> before = <span class="function"><span class="keyword">function</span>(<span class="params">fn, beforefn</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            beforefn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> a = before(</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            alert(<span class="number">3</span>)</div><div class="line">        &#125;,</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            alert(<span class="number">2</span>)</div><div class="line">        &#125;</div><div class="line">    );</div><div class="line">    a = before(a, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">1</span>);</div><div class="line">    &#125;);</div><div class="line">    a();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="用AOP实现数据上报"><a href="#用AOP实现数据上报" class="headerlink" title="用AOP实现数据上报"></a>用AOP实现数据上报</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">tag</span>=<span class="string">"login"</span> <span class="attr">id</span>=<span class="string">"button"</span>&gt;</span>点击打开登录浮层<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 一般在业务完成后要要求添加上数据统计的功能</span></div><div class="line"></div><div class="line">    <span class="comment">// 普通上报</span></div><div class="line">    <span class="comment">// var showLogin = function() &#123;</span></div><div class="line">    <span class="comment">//     console.log('打开登录浮层');</span></div><div class="line">    <span class="comment">//     log(this.getAttribute('tag'));</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// var log = function(tag) &#123;</span></div><div class="line">    <span class="comment">//     console.log('上报标签为: ' + tag);</span></div><div class="line">    <span class="comment">//     // (new Image).src = 'http:// xxx.com/report?tag=' + tag; // 真正的上报代码略</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// document.getElementById('button').onclick = showLogin;</span></div><div class="line">    <span class="comment">// showLogin既打开浮层又上报</span></div><div class="line"></div><div class="line">    <span class="comment">// 使用AOP分离</span></div><div class="line">    <span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">afterfn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> ret = __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            afterfn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> showLogin = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'打开登录浮层'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> log = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'上报标签为: '</span> + <span class="keyword">this</span>.getAttribute(<span class="string">'tag'</span>));</div><div class="line">    &#125;;</div><div class="line">    showLogin = showLogin.after(log); <span class="comment">// 打开登录浮层之后上报数据</span></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>).onclick = showLogin;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="用AOP动态改变函数的参数"><a href="#用AOP动态改变函数的参数" class="headerlink" title="用AOP动态改变函数的参数"></a>用AOP动态改变函数的参数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 1,2公用了arguments，所以可以在1中将arguments改变</span></div><div class="line">    <span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">beforefn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            beforefn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// (1)</span></div><div class="line">            <span class="keyword">return</span> __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// (2)</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(param); <span class="comment">// 输出： &#123;a: "a", b: "b"&#125;</span></div><div class="line">    &#125;</div><div class="line">    func = func.before(<span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</div><div class="line">        param.b = <span class="string">'b'</span>;</div><div class="line">    &#125;);</div><div class="line">    func(&#123;</div><div class="line">        <span class="attr">a</span>: <span class="string">'a'</span></div><div class="line">    &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="利用AOP动态改变参数实现发送ajax前添加token"><a href="#利用AOP动态改变参数实现发送ajax前添加token" class="headerlink" title="利用AOP动态改变参数实现发送ajax前添加token"></a>利用AOP动态改变参数实现发送ajax前添加token</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 需要在每次发送ajax前添加一个验证用的token</span></div><div class="line"></div><div class="line">    <span class="comment">// 通常做法</span></div><div class="line">    <span class="comment">// var getToken = function() &#123;</span></div><div class="line">    <span class="comment">//     return 'Token';</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// var ajax = function(type, url, param) &#123;</span></div><div class="line">    <span class="comment">//     param = param || &#123;&#125;;</span></div><div class="line">    <span class="comment">//     param.Token = getToken(); // 发送ajax 请求的代码略...</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line"></div><div class="line">    <span class="comment">// 如果要将这个ajax发布到网上，可能有些人就不需要token</span></div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">beforefn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>; <span class="comment">// 保存原函数的引用</span></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 返回包含了原函数和新函数的"代理"函数</span></div><div class="line">            beforefn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 执行新函数，且保证this 不被劫持，新函数接受的参数</span></div><div class="line">            <span class="comment">// 也会被原封不动地传入原函数，新函数在原函数之前执行</span></div><div class="line">            <span class="keyword">return</span> __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 执行原函数并返回原函数的执行结果，</span></div><div class="line">            <span class="comment">// 并且保证this 不被劫持</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> ajax = <span class="function"><span class="keyword">function</span>(<span class="params">type, url, param</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(param);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getToken = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Token"</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 在ajax发送之前添加token</span></div><div class="line">    ajax = ajax.before(<span class="function"><span class="keyword">function</span>(<span class="params">type, url, param</span>) </span>&#123;</div><div class="line">        param.Token = getToken();</div><div class="line">    &#125;);</div><div class="line">    ajax(<span class="string">"get"</span>, <span class="string">'http:// xxx.com/userinfo'</span>, &#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'sven'</span></div><div class="line">    &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="插件式的表单验证"><a href="#插件式的表单验证" class="headerlink" title="插件式的表单验证"></a>插件式的表单验证</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>用户名：</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span> 密码：</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"submitBtn"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 正常写法</span></div><div class="line">    <span class="comment">// var username = document.getElementById('username'),</span></div><div class="line">    <span class="comment">//     password = document.getElementById('password'),</span></div><div class="line">    <span class="comment">//     submitBtn = document.getElementById('submitBtn');</span></div><div class="line">    <span class="comment">// var formSubmit = function() &#123;</span></div><div class="line">    <span class="comment">//     if (username.value === '') &#123;</span></div><div class="line">    <span class="comment">//         return alert('用户名不能为空');</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     if (password.value === '') &#123;</span></div><div class="line">    <span class="comment">//         return alert('密码不能为空');</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     var param = &#123;</span></div><div class="line">    <span class="comment">//         username: username.value,</span></div><div class="line">    <span class="comment">//         password: password.value</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     ajax('http:// xxx.com/login', param); // ajax 具体实现略</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// submitBtn.onclick = function() &#123;</span></div><div class="line">    <span class="comment">//     formSubmit();</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line"></div><div class="line">    <span class="comment">// 存在的问题formSubmit承担了过多的职责，一要验证，二要负责提交</span></div><div class="line"></div><div class="line">    <span class="comment">// 将验证逻辑分离到validata中</span></div><div class="line">    <span class="comment">// var validata = function() &#123;</span></div><div class="line">    <span class="comment">//     if (username.value === '') &#123;</span></div><div class="line">    <span class="comment">//         alert('用户名不能为空');</span></div><div class="line">    <span class="comment">//         return false;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     if (password.value === '') &#123;</span></div><div class="line">    <span class="comment">//         alert('密码不能为空');</span></div><div class="line">    <span class="comment">//         return false;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var formSubmit = function() &#123;</span></div><div class="line">    <span class="comment">//     if (validata() === false) &#123; // 校验未通过</span></div><div class="line">    <span class="comment">//         return;</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     var param = &#123;</span></div><div class="line">    <span class="comment">//         username: username.value,</span></div><div class="line">    <span class="comment">//         password: password.value</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">//     ajax('http:// xxx.com/login', param);</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// submitBtn.onclick = function() &#123;</span></div><div class="line">    <span class="comment">//     formSubmit();</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// 此时，虽将验证逻辑抽离，但formSubmit中还需要validata的返回值</span></div><div class="line">    <span class="comment">// 再次优化</span></div><div class="line"></div><div class="line">    <span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span>(<span class="params">beforefn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (beforefn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>) === <span class="literal">false</span>) &#123;</div><div class="line">                <span class="comment">// beforefn 返回false 的情况直接return，不再执行后面的原函数</span></div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> validata = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (username.value === <span class="string">''</span>) &#123;</div><div class="line">            alert(<span class="string">'用户名不能为空'</span>);</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (password.value === <span class="string">''</span>) &#123;</div><div class="line">            alert(<span class="string">'密码不能为空'</span>);</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> formSubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> param = &#123;</div><div class="line">            <span class="attr">username</span>: username.value,</div><div class="line">            <span class="attr">password</span>: password.value</div><div class="line">        &#125;</div><div class="line">        ajax(<span class="string">'http:// xxx.com/login'</span>, param);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 利用AOP动态织入验证逻辑</span></div><div class="line">    formSubmit = formSubmit.before(validata);</div><div class="line">    submitBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        formSubmit();</div><div class="line">    &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="AOP的注意事项"><a href="#AOP的注意事项" class="headerlink" title="AOP的注意事项"></a>AOP的注意事项</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// before,after返回的实际上是一个新函数，所以原先保存在函数上的属性会丢失;这种装饰方式也叠加了函数的作用域，如果装饰的链条过长，性能上也会受到一些影响。</span></div><div class="line">    <span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">afterfn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> __self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> ret = __self.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            afterfn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            <span class="keyword">return</span> ret;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    func.a = <span class="string">'a'</span>;</div><div class="line">    func = func.after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        alert(<span class="number">2</span>);</div><div class="line">    &#125;);</div><div class="line">    alert(func.a); <span class="comment">// 输出：undefined</span></div><div class="line"></div><div class="line">    <span class="comment">// 代理模式和装饰者模式的不同</span></div><div class="line">    <span class="comment">// 代理模式和装饰者模式最重要的区别在于它们的意图和设计目的。代理模式的目的是，当直接访问本体不方便或者不符合需要时，为这个本体提供一个替代者。本体定义了关键功能，而代理提供或拒绝对它的访问，或者在访问本体之前做一些额外的事情。装饰者模式的作用就是为对象动态加入行为。换句话说，代理模式强调一种关系（Proxy 与它的实体之间的关系），这种关系可以静态的表达，也就是说，这种关系在一开始就可以被确定。而装饰者模式用于一开始不能确定对象的全部功能时。代理模式通常只有一层代理本体的引用，而装饰者模式经常会形成一条长长的装饰链。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><h3 id="基本定义-12"><a href="#基本定义-12" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 状态模式:允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。状态模式的关键是区分事物内部的状态，事物内部状态的改变往往会带来事物的行为改变。往往将状态封装成一个类，跟此状态有关的所有行为都被封装在这个类的内部</span></div><div class="line">    <span class="comment">// 使用场景:程序有多种状态，并状态改变会影响其他行为时</span></div><div class="line">    <span class="comment">// 使用举例:一个开关的两个状态(开、关)，将影响灯泡的状态</span></div><div class="line">    <span class="keyword">var</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.state = <span class="string">'off'</span>; <span class="comment">// 给电灯设置初始状态off</span></div><div class="line">        <span class="keyword">this</span>.button = <span class="literal">null</span>; <span class="comment">// 电灯开关按钮</span></div><div class="line">    &#125;;</div><div class="line">    Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>),</div><div class="line">            self = <span class="keyword">this</span>;</div><div class="line">        button.innerHTML = <span class="string">'开关'</span>;</div><div class="line">        <span class="keyword">this</span>.button = <span class="built_in">document</span>.body.appendChild(button);</div><div class="line">        <span class="keyword">this</span>.button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            self.buttonWasPressed();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Light.prototype.buttonWasPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.state === <span class="string">'off'</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开灯'</span>);</div><div class="line">            <span class="keyword">this</span>.state = <span class="string">'on'</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.state === <span class="string">'on'</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'关灯'</span>);</div><div class="line">            <span class="keyword">this</span>.state = <span class="string">'off'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> light = <span class="keyword">new</span> Light();</div><div class="line">    light.init();</div><div class="line"></div><div class="line">    <span class="comment">//这个世界上的电灯并非只有一种。许多酒店里有另外一种电灯，这种电灯也只有一个开关，但它的表现是：第一次按下打开弱光，第二次按下打开强光，第三次才是关闭电灯</span></div><div class="line">    Light.prototype.buttonWasPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.state === <span class="string">'off'</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'弱光'</span>);</div><div class="line">            <span class="keyword">this</span>.state = <span class="string">'weakLight'</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.state === <span class="string">'weakLight'</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'强光'</span>);</div><div class="line">            <span class="keyword">this</span>.state = <span class="string">'strongLight'</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.state === <span class="string">'strongLight'</span>) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'关灯'</span>);</div><div class="line">            <span class="keyword">this</span>.state = <span class="string">'off'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 上面的缺点</span></div><div class="line">    <span class="comment">// buttonWasPressed方法违反了开放-封闭原则，每次新增或修改light的状态都需要改动buttonWasPressed方法</span></div><div class="line">    <span class="comment">// 所有跟状态有关的行为都封装在了buttonWasPressed方法里，以后若需要修改可能会造成此方法的无限膨胀</span></div><div class="line">    <span class="comment">// 状态的切换非常不明显，仅仅表现在对state变量的赋值，实际过程中可能会遗忘，也无法一目了然的知道总共有多少状态</span></div><div class="line">    <span class="comment">// 状态之间的切换关系依靠if...else来切换，维护麻烦</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="状态模式改进电灯程序"><a href="#状态模式改进电灯程序" class="headerlink" title="状态模式改进电灯程序"></a>状态模式改进电灯程序</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 通常我们谈到封装，一般都会优先封装对象的行为，而不是对象的状态。但在状态模式中刚好相反，状态模式的关键是把事物的每种状态都封装成单独的类，跟此种状态有关的行为都被封装在这个类的内部，所以button 被按下的的时候，只需要在上下文中，把这个请求委托给当前的状态对象即可，该状态对象会负责渲染它自身的行为</span></div><div class="line"></div><div class="line">    <span class="comment">// OffLightState</span></div><div class="line">    <span class="keyword">var</span> OffLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.light = light;</div><div class="line">    &#125;;</div><div class="line">    OffLightState.prototype.buttonWasPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"弱光"</span>); <span class="comment">// offLightState对应的行为</span></div><div class="line">        <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.weakLightState); <span class="comment">// 切换到weakLightState</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// WeakLightState：</span></div><div class="line">    <span class="keyword">var</span> WeakLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.light = light;</div><div class="line">    &#125;;</div><div class="line">    WeakLightState.prototype.buttonWasPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'强光'</span>); <span class="comment">// weakLightState 对应的行为</span></div><div class="line">        <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.strongLightState); <span class="comment">// 切换状态到strongLightState</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// StrongLightState：</span></div><div class="line">    <span class="keyword">var</span> StrongLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.light = light;</div><div class="line">    &#125;;</div><div class="line">    StrongLightState.prototype.buttonWasPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'超强光'</span>); <span class="comment">// strongLightState 对应的行为</span></div><div class="line">        <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.superStrongLightState); <span class="comment">// 切换状态到offLightState</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> SuperStrongLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.light = light;</div><div class="line">    &#125;;</div><div class="line">    SuperStrongLightState.prototype.buttonWasPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'关灯'</span>);</div><div class="line">        <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.offLightState);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.offLightState = <span class="keyword">new</span> OffLightState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.weakLightState = <span class="keyword">new</span> WeakLightState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.strongLightState = <span class="keyword">new</span> StrongLightState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.superStrongLightState = <span class="keyword">new</span> SuperStrongLightState(<span class="keyword">this</span>); <span class="comment">// 新增superStrongLightState 对象</span></div><div class="line">        <span class="keyword">this</span>.button = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">"button"</span>),</div><div class="line">            self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">this</span>.button = <span class="built_in">document</span>.body.appendChild(button);</div><div class="line">        <span class="keyword">this</span>.button.innerHTML = <span class="string">"开关"</span>;</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.offLightState; <span class="comment">// 设置当前状态</span></div><div class="line">        <span class="keyword">this</span>.button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            self.currState.buttonWasPressed();</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    Light.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">newState</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.currState = newState;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> light = <span class="keyword">new</span> Light();</div><div class="line">    light.init();</div><div class="line"></div><div class="line">    <span class="comment">// 添加新状态时</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="状态模式的通用结构"><a href="#状态模式的通用结构" class="headerlink" title="状态模式的通用结构"></a>状态模式的通用结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 首先定义了Light 类，Light类在这里也被称为上下文（Context）。随后在Light 的构造函数中，我们要创建每一个状态类的实例对象，Context将持有这些状态对象的引用，以便把请求委托给状态对象。用户的请求，即点击button的动作也是实现在Context中的</span></div><div class="line">    <span class="keyword">var</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.offLightState = <span class="keyword">new</span> OffLightState(<span class="keyword">this</span>); <span class="comment">// 持有状态对象的引用</span></div><div class="line">        <span class="keyword">this</span>.weakLightState = <span class="keyword">new</span> WeakLightState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.strongLightState = <span class="keyword">new</span> StrongLightState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.superStrongLightState = <span class="keyword">new</span> SuperStrongLightState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.button = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>),</div><div class="line">            self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">this</span>.button = <span class="built_in">document</span>.body.appendChild(button);</div><div class="line">        <span class="keyword">this</span>.button.innerHTML = <span class="string">'开关'</span>;</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.offLightState; <span class="comment">// 设置默认初始状态</span></div><div class="line">        <span class="keyword">this</span>.button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 定义用户的请求动作</span></div><div class="line">            self.currState.buttonWasPressed();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 接下来可能是个苦力活，我们要编写各种状态类，light对象被传入状态类的构造函数，状态对象也需要持有light对象的引用，以便调用light 中的方法或者直接操作light 对象</span></div><div class="line">    <span class="keyword">var</span> OffLightState = <span class="function"><span class="keyword">function</span>(<span class="params">light</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.light = light;</div><div class="line">    &#125;;</div><div class="line">    OffLightState.prototype.buttonWasPressed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'弱光'</span>);</div><div class="line">        <span class="keyword">this</span>.light.setState(<span class="keyword">this</span>.light.weakLightState);</div><div class="line">    &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="状态模式实现文件上传"><a href="#状态模式实现文件上传" class="headerlink" title="状态模式实现文件上传"></a>状态模式实现文件上传</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">//文件在扫描状态中，是不能进行任何操作的，既不能暂停也不能删除文件，只能等待扫描完成。扫描完成之后，根据文件的md5 值判断，若确认该文件已经存在于服务器，直接跳到上传完成状态。如果该文件的大小超过允许上传的最大值，或者该文件已经损坏，则跳往上传失败状态。剩下的情况下才进入上传中状态。</span></div><div class="line">    <span class="comment">// 上传过程中可以点击暂停按钮来暂停上传，暂停后点击同一个按钮会继续上传。</span></div><div class="line">    <span class="comment">// 扫描和上传过程中，点击删除按钮无效，只有在暂停、上传完成、上传失败之后，才能    删除文件。</span></div><div class="line"></div><div class="line">    <span class="comment">// 正常实现</span></div><div class="line">    <span class="built_in">window</span>.external.upload = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(state); <span class="comment">// 可能为sign、uploading、done、error</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> plugin = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> plugin = <span class="built_in">document</span>.createElement(<span class="string">'embed'</span>);</div><div class="line">        plugin.style.display = <span class="string">'none'</span>;</div><div class="line">        plugin.type = <span class="string">'application/txftn-webkit'</span>;</div><div class="line">        plugin.sign = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始文件扫描'</span>);</div><div class="line">        &#125;</div><div class="line">        plugin.pause = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'暂停文件上传'</span>);</div><div class="line">        &#125;;</div><div class="line">        plugin.uploading = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始文件上传'</span>);</div><div class="line">        &#125;;</div><div class="line">        plugin.del = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'删除文件上传'</span>);</div><div class="line">        &#125;</div><div class="line">        plugin.done = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'文件上传完成'</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">document</span>.body.appendChild(plugin);</div><div class="line">        <span class="keyword">return</span> plugin;</div><div class="line">    &#125;)();</div><div class="line"></div><div class="line">    <span class="keyword">var</span> Upload = <span class="function"><span class="keyword">function</span>(<span class="params">fileName</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.plugin = plugin;</div><div class="line">        <span class="keyword">this</span>.fileName = fileName;</div><div class="line">        <span class="keyword">this</span>.button1 = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">this</span>.button2 = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">this</span>.state = <span class="string">'sign'</span>; <span class="comment">// 设置初始状态为waiting</span></div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">this</span>.dom = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">        <span class="keyword">this</span>.dom.innerHTML =</div><div class="line">            <span class="string">'&lt;span&gt;文件名称:'</span> + <span class="keyword">this</span>.fileName + <span class="string">'&lt;/span&gt;\</span></div><div class="line">&lt;button data-action="button1"&gt;扫描中&lt;/button&gt;\</div><div class="line">&lt;button data-action="button2"&gt;删除&lt;/button&gt;';</div><div class="line">        <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.dom);</div><div class="line">        <span class="keyword">this</span>.button1 = <span class="keyword">this</span>.dom.querySelector(<span class="string">'[data-action="button1"]'</span>); <span class="comment">// 第一个按钮</span></div><div class="line">        <span class="keyword">this</span>.button2 = <span class="keyword">this</span>.dom.querySelector(<span class="string">'[data-action="button2"]'</span>); <span class="comment">// 第二个按钮</span></div><div class="line">        <span class="keyword">this</span>.bindEvent();</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.bindEvent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">this</span>.button1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (self.state === <span class="string">'sign'</span>) &#123; <span class="comment">// 扫描状态下，任何操作无效</span></div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'扫描中，点击无效...'</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.state === <span class="string">'uploading'</span>) &#123; <span class="comment">// 上传中，点击切换到暂停</span></div><div class="line">                self.changeState(<span class="string">'pause'</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.state === <span class="string">'pause'</span>) &#123; <span class="comment">// 暂停中，点击切换到上传中</span></div><div class="line">                self.changeState(<span class="string">'uploading'</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.state === <span class="string">'done'</span>) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'文件已完成上传, 点击无效'</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.state === <span class="string">'error'</span>) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'文件上传失败, 点击无效'</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">this</span>.button2.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (self.state === <span class="string">'done'</span> || self.state === <span class="string">'error'</span> || self.state === <span class="string">'pause'</span>) &#123;</div><div class="line">                <span class="comment">// 上传完成、上传失败和暂停状态下可以删除</span></div><div class="line">                self.changeState(<span class="string">'del'</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.state === <span class="string">'sign'</span>) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'文件正在扫描中，不能删除'</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.state === <span class="string">'uploading'</span>) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'文件正在上传中，不能删除'</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.changeState = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (state) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">'sign'</span>:</div><div class="line">                <span class="keyword">this</span>.plugin.sign();</div><div class="line">                <span class="keyword">this</span>.button1.innerHTML = <span class="string">'扫描中，任何操作无效'</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'uploading'</span>:</div><div class="line">                <span class="keyword">this</span>.plugin.uploading();</div><div class="line">                <span class="keyword">this</span>.button1.innerHTML = <span class="string">'正在上传，点击暂停'</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'pause'</span>:</div><div class="line">                <span class="keyword">this</span>.plugin.pause();</div><div class="line">                <span class="keyword">this</span>.button1.innerHTML = <span class="string">'已暂停，点击继续上传'</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'done'</span>:</div><div class="line">                <span class="keyword">this</span>.plugin.done();</div><div class="line">                <span class="keyword">this</span>.button1.innerHTML = <span class="string">'上传完成'</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'error'</span>:</div><div class="line">                <span class="keyword">this</span>.button1.innerHTML = <span class="string">'上传失败'</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'del'</span>:</div><div class="line">                <span class="keyword">this</span>.plugin.del();</div><div class="line">                <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'删除完成'</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">this</span>.state = state;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> uploadObj = <span class="keyword">new</span> Upload(<span class="string">'JavaScript 设计模式与开发实践'</span>);</div><div class="line">    uploadObj.init();</div><div class="line">    <span class="built_in">window</span>.external.upload = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123; <span class="comment">// 插件调用JavaScript 的方法</span></div><div class="line">        uploadObj.changeState(state);</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">window</span>.external.upload(<span class="string">'sign'</span>); <span class="comment">// 文件开始扫描</span></div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">window</span>.external.upload(<span class="string">'uploading'</span>); <span class="comment">// 1 秒后开始上传</span></div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">window</span>.external.upload(<span class="string">'done'</span>); <span class="comment">// 5 秒后上传完成</span></div><div class="line">    &#125;, <span class="number">5000</span>);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="状态模式重构文件上传"><a href="#状态模式重构文件上传" class="headerlink" title="状态模式重构文件上传"></a>状态模式重构文件上传</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">window</span>.external.upload = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(state); <span class="comment">// 可能为sign、uploading、done、error</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> plugin = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> plugin = <span class="built_in">document</span>.createElement(<span class="string">'embed'</span>);</div><div class="line">        plugin.style.display = <span class="string">'none'</span>;</div><div class="line">        plugin.type = <span class="string">'application/txftn-webkit'</span>;</div><div class="line">        plugin.sign = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始文件扫描'</span>);</div><div class="line">        &#125;</div><div class="line">        plugin.pause = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'暂停文件上传'</span>);</div><div class="line">        &#125;;</div><div class="line">        plugin.uploading = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始文件上传'</span>);</div><div class="line">        &#125;;</div><div class="line">        plugin.del = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'删除文件上传'</span>);</div><div class="line">        &#125;</div><div class="line">        plugin.done = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'文件上传完成'</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">document</span>.body.appendChild(plugin);</div><div class="line">        <span class="keyword">return</span> plugin;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> Upload = <span class="function"><span class="keyword">function</span>(<span class="params">fileName</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.plugin = plugin;</div><div class="line">        <span class="keyword">this</span>.fileName = fileName;</div><div class="line">        <span class="keyword">this</span>.button1 = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">this</span>.button2 = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">this</span>.signState = <span class="keyword">new</span> SignState(<span class="keyword">this</span>); <span class="comment">// 设置初始状态为waiting</span></div><div class="line">        <span class="keyword">this</span>.uploadingState = <span class="keyword">new</span> UploadingState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.pauseState = <span class="keyword">new</span> PauseState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.doneState = <span class="keyword">new</span> DoneState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.errorState = <span class="keyword">new</span> ErrorState(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.signState; <span class="comment">// 设置当前状态</span></div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">this</span>.dom = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">        <span class="keyword">this</span>.dom.innerHTML =</div><div class="line">            <span class="string">'&lt;span&gt;文件名称:'</span> + <span class="keyword">this</span>.fileName + <span class="string">'&lt;/span&gt;\</span></div><div class="line">&lt;button data-action="button1"&gt;扫描中&lt;/button&gt;\</div><div class="line">&lt;button data-action="button2"&gt;删除&lt;/button&gt;';</div><div class="line">        <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.dom);</div><div class="line">        <span class="keyword">this</span>.button1 = <span class="keyword">this</span>.dom.querySelector(<span class="string">'[data-action="button1"]'</span>);</div><div class="line">        <span class="keyword">this</span>.button2 = <span class="keyword">this</span>.dom.querySelector(<span class="string">'[data-action="button2"]'</span>);</div><div class="line">        <span class="keyword">this</span>.bindEvent();</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.bindEvent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">this</span>.button1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            self.currState.clickHandler1();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.button2.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            self.currState.clickHandler2();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.sign = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.plugin.sign();</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.signState;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.uploading = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.button1.innerHTML = <span class="string">'正在上传，点击暂停'</span>;</div><div class="line">        <span class="keyword">this</span>.plugin.uploading();</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.uploadingState;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.pause = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.button1.innerHTML = <span class="string">'已暂停，点击继续上传'</span>;</div><div class="line">        <span class="keyword">this</span>.plugin.pause();</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.pauseState;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.done = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.button1.innerHTML = <span class="string">'上传完成'</span>;</div><div class="line">        <span class="keyword">this</span>.plugin.done();</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.doneState;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.error = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.button1.innerHTML = <span class="string">'上传失败'</span>;</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.errorState;</div><div class="line">    &#125;;</div><div class="line">    Upload.prototype.del = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.plugin.del();</div><div class="line">        <span class="keyword">this</span>.dom.parentNode.removeChild(<span class="keyword">this</span>.dom);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> StateFactory = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> State = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">        State.prototype.clickHandler1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写父类的clickHandler1 方法'</span>);</div><div class="line">        &#125;</div><div class="line">        State.prototype.clickHandler2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'子类必须重写父类的clickHandler2 方法'</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">param</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span>(<span class="params">uploadObj</span>) </span>&#123;</div><div class="line">                <span class="keyword">this</span>.uploadObj = uploadObj;</div><div class="line">            &#125;;</div><div class="line">            F.prototype = <span class="keyword">new</span> State();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> param) &#123;</div><div class="line">                F.prototype[i] = param[i];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> F;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">    <span class="keyword">var</span> SignState = StateFactory(&#123;</div><div class="line">        <span class="attr">clickHandler1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'扫描中，点击无效...'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">clickHandler2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'文件正在上传中，不能删除'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> UploadingState = StateFactory(&#123;</div><div class="line">        <span class="attr">clickHandler1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.uploadObj.pause();</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">clickHandler2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'文件正在上传中，不能删除'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> PauseState = StateFactory(&#123;</div><div class="line">        <span class="attr">clickHandler1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.uploadObj.uploading();</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">clickHandler2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.uploadObj.del();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> DoneState = StateFactory(&#123;</div><div class="line">        <span class="attr">clickHandler1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'文件已完成上传, 点击无效'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">clickHandler2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.uploadObj.del();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> ErrorState = StateFactory(&#123;</div><div class="line">        <span class="attr">clickHandler1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'文件上传失败, 点击无效'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">clickHandler2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.uploadObj.del();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> uploadObj = <span class="keyword">new</span> Upload(<span class="string">'JavaScript 设计模式与开发实践'</span>);</div><div class="line">    uploadObj.init();</div><div class="line">    <span class="built_in">window</span>.external.upload = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">        uploadObj[state]();</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">window</span>.external.upload(<span class="string">'sign'</span>);</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">window</span>.external.upload(<span class="string">'uploading'</span>); <span class="comment">// 1 秒后开始上传</span></div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">window</span>.external.upload(<span class="string">'done'</span>); <span class="comment">// 5 秒后上传完成</span></div><div class="line">    &#125;, <span class="number">5000</span>);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="状态模式注意事项"><a href="#状态模式注意事项" class="headerlink" title="状态模式注意事项"></a>状态模式注意事项</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 状态模式的优缺点</span></div><div class="line">    <span class="comment">// 状态模式定义了状态与行为之间的关系，并将它们封装在一个类里。通过增加新的状态类，很容易增加新的状态和转换。</span></div><div class="line">    <span class="comment">// 避免Context 无限膨胀，状态切换的逻辑被分布在状态类中，也去掉了Context 中原本过多的条件分支。</span></div><div class="line">    <span class="comment">// 用对象代替字符串来记录当前状态，使得状态的切换更加一目了然。</span></div><div class="line">    <span class="comment">// Context 中的请求动作和状态类中封装的行为可以非常容易地独立变化而互不影响。</span></div><div class="line"></div><div class="line">    <span class="comment">// 缺点</span></div><div class="line">    <span class="comment">// 状态模式的缺点是会在系统中定义许多状态类，编写20 个状态类是一项枯燥乏味的工作，而且系统中会因此而增加不少对象。另外，由于逻辑分散在状态类中，虽然避开了不受欢迎的条件分支语句，但也造成了逻辑分散的问题，我们无法在一个地方就看出整个状态机的逻辑。</span></div><div class="line"></div><div class="line">    <span class="comment">// 状态模式的性能优化点</span></div><div class="line">    <span class="comment">// 有两种选择来管理state 对象的创建和销毁。第一种是仅当state 对象被需要时才创建并随后销毁，另一种是一开始就创建好所有的状态对象，并且始终不销毁它们。如果state对象比较庞大，可以用第一种方式来节省内存，这样可以避免创建一些不会用到的对象并及时地回收它们。但如果状态的改变很频繁，最好一开始就把这些state 对象都创建出来，也没有必要销毁它们，因为可能很快将再次用到它们。</span></div><div class="line">    <span class="comment">// 在本章的例子中，我们为每个Context 对象都创建了一组state 对象，实际上这些state对象之间是可以共享的，各Context 对象可以共享一个state 对象，这也是享元模式的应用场景之一。</span></div><div class="line"></div><div class="line">    <span class="comment">// 状态模式和策略模式的关系</span></div><div class="line">    <span class="comment">// 相同点</span></div><div class="line">    <span class="comment">// 策略模式和状态模式的相同点是，它们都有一个上下文、一些策略或者状态类，上下文把请求委托给这些类来执行。</span></div><div class="line">    <span class="comment">// 不同点</span></div><div class="line">    <span class="comment">// 策略模式中的各个策略类之间是平等又平行的，它们之间没有任何联系，所以客户必须熟知这些策略类的作用，以便客户可以随时主动切换算法；而在状态模式中，状态和状态对应的行为是早已被封装好的，状态之间的切换也早被规定完成，“改变行为”这件事情发生在状态模式内部。对客户来说，并不需要了解这些细节。这正是状态模式的作用所在。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="js版本的状态机"><a href="#js版本的状态机" class="headerlink" title="js版本的状态机"></a>js版本的状态机</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 状态模式是状态机的实现之一，但在JavaScript 这种“无类”语言中，没有规定让状态对象一定要从类中创建而来。另外一点，JavaScript 可以非常方便地使用委托技术，并不需要事先让一个对象持有另一个对象。下面的状态机选择了通过Function.prototype.call 方法直接把请求委托给某个字面量对象来执行。</span></div><div class="line"></div><div class="line">    <span class="comment">// 改写灯泡</span></div><div class="line">    <span class="keyword">var</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.currState = FSM.off; <span class="comment">// 设置当前状态</span></div><div class="line">        <span class="keyword">this</span>.button = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">"button"</span>),</div><div class="line">            self = <span class="keyword">this</span>;</div><div class="line">        button.innerHTML = <span class="string">"已关灯"</span>;</div><div class="line">        <span class="keyword">this</span>.button = <span class="built_in">document</span>.body.appendChild(button);</div><div class="line">        <span class="keyword">this</span>.button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            self.currState.buttonWasPressed.call(self); <span class="comment">// 把请求委托给FSM状态机</span></div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> FSM = &#123;</div><div class="line">        <span class="attr">off</span>: &#123;</div><div class="line">            <span class="attr">buttonWasPressed</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'关灯'</span>);</div><div class="line">                <span class="keyword">this</span>.button.innerHTML = <span class="string">'下一次按我是开灯'</span>;</div><div class="line">                <span class="keyword">this</span>.currState = FSM.on;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">on</span>: &#123;</div><div class="line">            <span class="attr">buttonWasPressed</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'开灯'</span>);</div><div class="line">                <span class="keyword">this</span>.button.innerHTML = <span class="string">'下一次按我是关灯'</span>;</div><div class="line">                <span class="keyword">this</span>.currState = FSM.off;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> light = <span class="keyword">new</span> Light();</div><div class="line">    light.init();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="使用delegate函数实现状态机"><a href="#使用delegate函数实现状态机" class="headerlink" title="使用delegate函数实现状态机"></a>使用delegate函数实现状态机</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> delegate = <span class="function"><span class="keyword">function</span>(<span class="params">client, delegation</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">buttonWasPressed</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 将客户的操作委托给delegation 对象</span></div><div class="line">                <span class="keyword">return</span> delegation.buttonWasPressed.apply(client, <span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> FSM = &#123;</div><div class="line">        <span class="attr">off</span>: &#123;</div><div class="line">            <span class="attr">buttonWasPressed</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'关灯'</span>);</div><div class="line">                <span class="keyword">this</span>.button.innerHTML = <span class="string">'下一次按我是开灯'</span>;</div><div class="line">                <span class="keyword">this</span>.currState = <span class="keyword">this</span>.onState;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">on</span>: &#123;</div><div class="line">            <span class="attr">buttonWasPressed</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'开灯'</span>);</div><div class="line">                <span class="keyword">this</span>.button.innerHTML = <span class="string">'下一次按我是关灯'</span>;</div><div class="line">                <span class="keyword">this</span>.currState = <span class="keyword">this</span>.offState;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Light = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.offState = delegate(<span class="keyword">this</span>, FSM.off);</div><div class="line">        <span class="keyword">this</span>.onState = delegate(<span class="keyword">this</span>, FSM.on);</div><div class="line">        <span class="keyword">this</span>.currState = <span class="keyword">this</span>.offState; <span class="comment">// 设置初始状态为关闭状态</span></div><div class="line">        <span class="keyword">this</span>.button = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    Light.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>),</div><div class="line">            self = <span class="keyword">this</span>;</div><div class="line">        button.innerHTML = <span class="string">'已关灯'</span>;</div><div class="line">        <span class="keyword">this</span>.button = <span class="built_in">document</span>.body.appendChild(button);</div><div class="line">        <span class="keyword">this</span>.button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            self.currState.buttonWasPressed();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> light = <span class="keyword">new</span> Light();</div><div class="line">    light.init();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="表驱动的有限状态机"><a href="#表驱动的有限状态机" class="headerlink" title="表驱动的有限状态机"></a>表驱动的有限状态机</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 参考:https://github.com/jakesgordon/javascript-state-machine</span></div><div class="line">    <span class="keyword">var</span> fsm = StateMachine.create(&#123;</div><div class="line">        <span class="attr">initial</span>: <span class="string">'off'</span>,</div><div class="line">        <span class="attr">events</span>: [&#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'buttonWasPressed'</span>,</div><div class="line">            <span class="attr">from</span>: <span class="string">'off'</span>,</div><div class="line">            <span class="attr">to</span>: <span class="string">'on'</span></div><div class="line">        &#125;, &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'buttonWasPressed'</span>,</div><div class="line">            <span class="attr">from</span>: <span class="string">'on'</span>,</div><div class="line">            <span class="attr">to</span>: <span class="string">'off'</span></div><div class="line">        &#125;],</div><div class="line">        <span class="attr">callbacks</span>: &#123;</div><div class="line">            <span class="attr">onbuttonWasPressed</span>: <span class="function"><span class="keyword">function</span>(<span class="params">event, from, to</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">eventName, from, to, args, errorCode, errorMessage</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">// 从一种状态试图切换到一种不可能到达的状态的时候</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        fsm.buttonWasPressed();</div><div class="line">    &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><h3 id="基本定义-13"><a href="#基本定义-13" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 适配器模式:适配器模式的作用是解决两个软件实体间的接口不兼容的问题,它不考虑这些接口是怎样实现的，也不考虑它们将来可能会如何演化。适配器模式不需要改变已有的接口，就能够使它们协同作用。使用适配器模式之后，原本由于接口不兼容而不能工作的两个软件实体可以一起工作。</span></div><div class="line">    <span class="comment">// 使用场景:当两个接口不一样时，可以采用亡羊补牢的方式实现一个适配器，来提供一个统一的接口</span></div><div class="line">    <span class="comment">// 使用举例:百度谷歌地图提供的展示地图的API不同，一个show,一个display</span></div><div class="line">    <span class="keyword">var</span> googleMap = &#123;</div><div class="line">        <span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始渲染谷歌地图'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> baiduMap = &#123;</div><div class="line">        <span class="attr">display</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'开始渲染百度地图'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> baiduMapAdapter = &#123;</div><div class="line">        <span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> baiduMap.display();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    renderMap(googleMap); <span class="comment">// 输出：开始渲染谷歌地图</span></div><div class="line">    renderMap(baiduMapAdapter); <span class="comment">// 输出：开始渲染百度地图</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h2><h3 id="基本定义-14"><a href="#基本定义-14" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 就一个类而言，应该仅有一个引起它变化的原因。在JS中类用的很少，单一职责更多的是体现在对象和方法上</span></div><div class="line">    <span class="comment">// SRP原则体现为：一个对象（方法）只做一件事情。-&gt;职责分离</span></div><div class="line">    <span class="comment">// SRP原则在代理模式、迭代器模式、单例模式、装饰者模式中都有体现</span></div><div class="line"></div><div class="line">    <span class="comment">// 何时用职责分离:</span></div><div class="line">    <span class="comment">// 如果随着需求的变化，有2个职责总是同时变化，则不必分离他们</span></div><div class="line">    <span class="comment">// 如果两个职责以后确定不会发生变化，则不用分离</span></div><div class="line"></div><div class="line">    <span class="comment">// SRP原则优缺点</span></div><div class="line">    <span class="comment">// 优点:降低了单个类或者对象的复杂度，按照职责把对象分解成更小的粒度，这有助于代码的复用，也有利于进行单元测试。当一个职责需要变更的时候，不会影响到其他的职责。</span></div><div class="line">    <span class="comment">// 缺点:会增加编写代码的复杂度。当我们按照职责把对象分解成更小的粒度之后，实际上也增大了这些对象之间相互联系的难度。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="最少知识原则"><a href="#最少知识原则" class="headerlink" title="最少知识原则"></a>最少知识原则</h2><h3 id="基本定义-15"><a href="#基本定义-15" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 最少知识原则（LKP）说的是一个软件实体应当尽可能少地与其他实体发生相互作用。这里的软件实体是一个广义的概念，不仅包括对象，还包括系统、类、模块、函数、变量等。</span></div><div class="line">    <span class="comment">// 最少知识原则要求我们在设计程序时，应当尽量减少对象之间的交互。如果两个对象之间不必彼此直接通信，那么这两个对象就不要发生直接的相互联系。常见的做法是引入一个第三者对象，来承担这些对象之间的通信作用。如果一些对象需要向另一些对象发起请求，可以通过第三者对象来转发这些请求。</span></div><div class="line">    <span class="comment">// 中介者模式、外观模式(定义了一个高层接口去封装一组“子系统”，可以直接定义调用高层接口完成一组事情，也可调用子系统中的某一个接口完成某一个特定事情)中都有体现。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="开放封闭原则"><a href="#开放封闭原则" class="headerlink" title="开放封闭原则"></a>开放封闭原则</h2><h3 id="基本定义-16"><a href="#基本定义-16" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 在面向对象的程序设计中，开放-封闭原则（OCP）是最重要的一条原则</span></div><div class="line">    <span class="comment">// 软件实体（类、模块、函数）等应该是可以扩展的，但是不可修改。(进行扩展，但不能修改源代码-&gt;保留源码基础上增加代码)</span></div><div class="line">    <span class="comment">// 开放-封闭原则的思想：当需要改变一个程序的功能或者给这个程序增加新功能的时候，可以使用增加代码的方式，但是不允许改动程序的源代码。</span></div><div class="line">    <span class="comment">// 挑选出最容易发生变化的地方，然后构造抽象来封闭这些变化。在不可避免发生修改的时候，尽量修改那些相对容易修改的地方。</span></div><div class="line">    <span class="comment">// 发布-订阅、模板方法、策略、代理、职责链等模式都有体现</span></div><div class="line"></div><div class="line">    <span class="comment">// 过多的条件分支语句是造成程序违反开放-封闭原则的一个常见原因。每当需要增加一个新的if时，就必须修改源代码。</span></div><div class="line">    <span class="comment">// 当看到很多if时，应考虑能否使用对象的多态性来重构(找出变化部分，将其封装起来，这样就可以将变化的和稳定的隔离开来)</span></div><div class="line"></div><div class="line">    <span class="comment">// 反例，很多if，违反开放-封闭原则</span></div><div class="line">    <span class="comment">// var makeSound = function(animal) &#123;</span></div><div class="line">    <span class="comment">//     if (animal instanceof Duck) &#123;</span></div><div class="line">    <span class="comment">//         console.log('嘎嘎嘎');</span></div><div class="line">    <span class="comment">//     &#125; else if (animal instanceof Chicken) &#123;</span></div><div class="line">    <span class="comment">//         console.log('咯咯咯');</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="comment">// var Duck = function() &#123;&#125;;</span></div><div class="line">    <span class="comment">// var Chicken = function() &#123;&#125;;</span></div><div class="line">    <span class="comment">// makeSound(new Duck()); // 输出：嘎嘎嘎</span></div><div class="line">    <span class="comment">// makeSound(new Chicken()); // 输出：咯咯咯</span></div><div class="line"></div><div class="line">    <span class="comment">// 利用多态的思想，我们把程序中不变的部分隔离出来（动物都会叫），然后把可变的部分封装起来（不同类型的动物发出不同的叫声），这样一来程序就具有了可扩展性。当我们想让一只狗发出叫声时，只需增加一段代码即可，而不用去改动原有的makeSound 函数</span></div><div class="line">    <span class="keyword">var</span> makeSound = <span class="function"><span class="keyword">function</span>(<span class="params">animal</span>) </span>&#123;</div><div class="line">        animal.sound();</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Duck = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    Duck.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'嘎嘎嘎'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> Chicken = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    Chicken.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'咯咯咯'</span>);</div><div class="line">    &#125;;</div><div class="line">    makeSound(<span class="keyword">new</span> Duck()); <span class="comment">// 嘎嘎嘎</span></div><div class="line">    makeSound(<span class="keyword">new</span> Chicken()); <span class="comment">// 咯咯咯</span></div><div class="line">    <span class="comment">/********* 增加动物狗，不用改动原有的makeSound 函数 ****************/</span></div><div class="line">    <span class="keyword">var</span> Dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    Dog.prototype.sound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'汪汪汪'</span>);</div><div class="line">    &#125;;</div><div class="line">    makeSound(<span class="keyword">new</span> Dog()); <span class="comment">// 汪汪汪</span></div><div class="line"></div><div class="line">    <span class="comment">// 实现开放-封闭原则的其他方法:放置钩子见52、使用回调(特殊钩子)</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="接口和面向接口编程"><a href="#接口和面向接口编程" class="headerlink" title="接口和面向接口编程"></a>接口和面向接口编程</h2><h3 id="基本定义-17"><a href="#基本定义-17" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 接口:</span></div><div class="line">    <span class="comment">// 第一种含义:我们经常说一个库或者模块对外提供了某某API 接口。通过主动暴露的接口来通信，可以隐藏软件系统内部的工作细节</span></div><div class="line">    <span class="comment">// 第二种含义:是一些语言提供的关键字，比如Java 的interface。interface 关键字可以产生一个完全抽象的类。这个完全抽象的类用来表示一种契约，专门负责建立类与类之间的联系。</span></div><div class="line">    <span class="comment">// 第三种含义:“面向接口编程”中的接口，接口的含义在这里体现得更为抽象。-&gt;接口是对象能响应的请求的集合。</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="代码重构技巧"><a href="#代码重构技巧" class="headerlink" title="代码重构技巧"></a>代码重构技巧</h2><h3 id="基本定义-18"><a href="#基本定义-18" class="headerlink" title="基本定义"></a>基本定义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 1.提炼函数</span></div><div class="line">    <span class="keyword">var</span> getUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        ajax(<span class="string">'http:// xxx.com/userInfo'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="comment">// 有打印数据的操作，可提炼出来</span></div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'userId: '</span> + data.userId);</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'userName: '</span> + data.userName);</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'nickName: '</span> + data.nickName);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> getUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        ajax(<span class="string">'http:// xxx.com/userInfo'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">            printDetails(data);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> printDetails = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'userId: '</span> + data.userId);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'userName: '</span> + data.userName);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'nickName: '</span> + data.nickName);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 2.合并重复的条件片段</span></div><div class="line">    <span class="keyword">var</span> paging = <span class="function"><span class="keyword">function</span>(<span class="params">currPage</span>) </span>&#123;</div><div class="line">        <span class="comment">// 每个分支里面都有jump</span></div><div class="line">        <span class="keyword">if</span> (currPage &lt;= <span class="number">0</span>) &#123;</div><div class="line">            currPage = <span class="number">0</span>;</div><div class="line">            jump(currPage); <span class="comment">// 跳转</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currPage &gt;= totalPage) &#123;</div><div class="line">            currPage = totalPage;</div><div class="line">            jump(currPage); <span class="comment">// 跳转</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            jump(currPage); <span class="comment">// 跳转</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> paging = <span class="function"><span class="keyword">function</span>(<span class="params">currPage</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (currPage &lt;= <span class="number">0</span>) &#123;</div><div class="line">            currPage = <span class="number">0</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currPage &gt;= totalPage) &#123;</div><div class="line">            currPage = totalPage;</div><div class="line">        &#125;</div><div class="line">        jump(currPage); <span class="comment">// 把jump 函数独立出来</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">jump</span>(<span class="params">page</span>) </span>&#123;</div><div class="line">        xxxxx</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 3.把条件分支语句提炼成函数</span></div><div class="line">    <span class="keyword">var</span> getPrice = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        <span class="keyword">if</span> (date.getMonth() &gt;= <span class="number">6</span> &amp;&amp; date.getMonth() &lt;= <span class="number">9</span>) &#123; <span class="comment">// 可将判断夏天提取出来，单独使用</span></div><div class="line">            <span class="keyword">return</span> price * <span class="number">0.8</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> price;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> isSummer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        <span class="keyword">return</span> date.getMonth() &gt;= <span class="number">6</span> &amp;&amp; date.getMonth() &lt;= <span class="number">9</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getPrice = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isSummer()) &#123; <span class="comment">// 夏天</span></div><div class="line">            <span class="keyword">return</span> price * <span class="number">0.8</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> price;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 4.合理使用循环</span></div><div class="line">    <span class="keyword">var</span> createXHR = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> xhr;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'MSXML2.XMLHttp.6.0'</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'MSXML2.XMLHttp.3.0'</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">                xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'MSXML2.XMLHttp'</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> xhr;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> xhr = createXHR();</div><div class="line">    <span class="comment">// 可用循环一次生成</span></div><div class="line">    <span class="keyword">var</span> createXHR = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> versions = [<span class="string">'MSXML2.XMLHttp.6.0ddd'</span>, <span class="string">'MSXML2.XMLHttp.3.0'</span>, <span class="string">'MSXML2.XMLHttp'</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, version; version = versions[i++];) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(version);</div><div class="line">            &#125; <span class="keyword">catch</span> (e) &#123;&#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> xhr = createXHR();</div><div class="line"></div><div class="line">    <span class="comment">// 5.提前让函数退出代替嵌套条件分支</span></div><div class="line">    <span class="keyword">var</span> del = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ret;</div><div class="line">        <span class="keyword">if</span> (!obj.isReadOnly) &#123; <span class="comment">// 不为只读的才能被删除</span></div><div class="line">            <span class="keyword">if</span> (obj.isFolder) &#123; <span class="comment">// 如果是文件夹</span></div><div class="line">                ret = deleteFolder(obj);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj.isFile) &#123; <span class="comment">// 如果是文件</span></div><div class="line">                ret = deleteFile(obj);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> del = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (obj.isReadOnly) &#123; <span class="comment">// 反转if 表达式</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (obj.isFolder) &#123;</div><div class="line">            <span class="keyword">return</span> deleteFolder(obj);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (obj.isFile) &#123;</div><div class="line">            <span class="keyword">return</span> deleteFile(obj);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 6.传递对象参数代替过长的参数列表</span></div><div class="line">    <span class="keyword">var</span> setUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params">id, name, address, sex, mobile, qq</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'id= '</span> + id);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'name= '</span> + name);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'address= '</span> + address);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'sex= '</span> + sex);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'mobile= '</span> + mobile);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'qq= '</span> + qq);</div><div class="line">    &#125;;</div><div class="line">    setUserInfo(<span class="number">1314</span>, <span class="string">'sven'</span>, <span class="string">'shenzhen'</span>, <span class="string">'male'</span>, <span class="string">'137********'</span>, <span class="number">377876679</span>);</div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> setUserInfo = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'id= '</span> + obj.id);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'name= '</span> + obj.name);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'address= '</span> + obj.address);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'sex= '</span> + obj.sex);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'mobile= '</span> + obj.mobile);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'qq= '</span> + obj.qq);</div><div class="line">    &#125;;</div><div class="line">    setUserInfo(&#123;</div><div class="line">        <span class="attr">id</span>: <span class="number">1314</span>,</div><div class="line">        <span class="attr">name</span>: <span class="string">'sven'</span>,</div><div class="line">        <span class="attr">address</span>: <span class="string">'shenzhen'</span>,</div><div class="line">        <span class="attr">sex</span>: <span class="string">'male'</span>,</div><div class="line">        <span class="attr">mobile</span>: <span class="string">'137********'</span>,</div><div class="line">        <span class="attr">qq</span>: <span class="number">377876679</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 7.尽量减少参数数量</span></div><div class="line">    <span class="keyword">var</span> draw = <span class="function"><span class="keyword">function</span>(<span class="params">width, height, square</span>) </span>&#123;&#125;;</div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> draw = <span class="function"><span class="keyword">function</span>(<span class="params">width, height</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> square = width * height;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 8.少用三目运算符，仅在简单判断时使用，复杂情况下用if</span></div><div class="line">    <span class="keyword">if</span> (!aup || !bup) &#123;</div><div class="line">        <span class="keyword">return</span> a === doc ? <span class="number">-1</span> :</div><div class="line">            b === doc ? <span class="number">1</span> :</div><div class="line">            aup ? <span class="number">-1</span> :</div><div class="line">            bup ? <span class="number">1</span> :</div><div class="line">            sortInput ?</div><div class="line">            (indexOf.call(sortInput, a) - indexOf.call(sortInput, b)) :</div><div class="line">            <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 9.分解大型类</span></div><div class="line">    <span class="comment">// 10.用return退出多重循环</span></div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (i * j &gt; <span class="number">30</span>) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">console</span>.log(i); <span class="comment">// 这句代码没有机会被执行</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 改进</span></div><div class="line">    <span class="keyword">var</span> print = <span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(i);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (i * j &gt; <span class="number">30</span>) &#123;</div><div class="line">                    <span class="keyword">return</span> print(i);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    func();</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/设计模式/" rel="tag"># 设计模式</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/15/mini-program-bus/" rel="next" title="mini-program-bus">
                <i class="fa fa-chevron-left"></i> mini-program-bus
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/27/oop-basic-in-js/" rel="prev" title="oop-basic-in-js">
                oop-basic-in-js <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/Avatar.png"
               alt="BryanAdamss" />
          <p class="site-author-name" itemprop="name">BryanAdamss</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/BryanAdamss" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#JavaScript设计模式与开发实践"><span class="nav-number">1.</span> <span class="nav-text">JavaScript设计模式与开发实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础知识"><span class="nav-number">1.1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#鸭子类型"><span class="nav-number">1.1.1.</span> <span class="nav-text">鸭子类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多态"><span class="nav-number">1.1.2.</span> <span class="nav-text">多态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多态2"><span class="nav-number">1.1.3.</span> <span class="nav-text">多态2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多态3"><span class="nav-number">1.1.4.</span> <span class="nav-text">多态3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装数据"><span class="nav-number">1.1.5.</span> <span class="nav-text">封装数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装实现"><span class="nav-number">1.1.6.</span> <span class="nav-text">封装实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原型模式"><span class="nav-number">1.1.7.</span> <span class="nav-text">原型模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this"><span class="nav-number">1.1.8.</span> <span class="nav-text">this</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#call、apply"><span class="nav-number">1.1.9.</span> <span class="nav-text">call、apply</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#闭包"><span class="nav-number">1.1.10.</span> <span class="nav-text">闭包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#利用闭包创建测试类型函数"><span class="nav-number">1.1.11.</span> <span class="nav-text">利用闭包创建测试类型函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#闭包封装变量"><span class="nav-number">1.1.12.</span> <span class="nav-text">闭包封装变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#回调函数"><span class="nav-number">1.1.13.</span> <span class="nav-text">回调函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOP"><span class="nav-number">1.1.14.</span> <span class="nav-text">AOP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数柯里化"><span class="nav-number">1.1.15.</span> <span class="nav-text">函数柯里化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反柯理化"><span class="nav-number">1.1.16.</span> <span class="nav-text">反柯理化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数截流"><span class="nav-number">1.1.17.</span> <span class="nav-text">函数截流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分时函数"><span class="nav-number">1.1.18.</span> <span class="nav-text">分时函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#惰性载入函数"><span class="nav-number">1.1.19.</span> <span class="nav-text">惰性载入函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单例模式"><span class="nav-number">1.2.</span> <span class="nav-text">单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义"><span class="nav-number">1.2.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#透明的单例模式"><span class="nav-number">1.2.2.</span> <span class="nav-text">透明的单例模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用代理实现单例模式"><span class="nav-number">1.2.3.</span> <span class="nav-text">用代理实现单例模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js中的单例模式"><span class="nav-number">1.2.4.</span> <span class="nav-text">js中的单例模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#惰性单例"><span class="nav-number">1.2.5.</span> <span class="nav-text">惰性单例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通用的惰性单例"><span class="nav-number">1.2.6.</span> <span class="nav-text">通用的惰性单例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#策略模式"><span class="nav-number">1.3.</span> <span class="nav-text">策略模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#传统面向对象中的策略模式"><span class="nav-number">1.3.2.</span> <span class="nav-text">传统面向对象中的策略模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js中的策略模式"><span class="nav-number">1.3.3.</span> <span class="nav-text">js中的策略模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用策略模式实现缓动动画"><span class="nav-number">1.3.4.</span> <span class="nav-text">使用策略模式实现缓动动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用策略模式完成表单验证"><span class="nav-number">1.3.5.</span> <span class="nav-text">使用策略模式完成表单验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代理模式"><span class="nav-number">1.4.</span> <span class="nav-text">代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-2"><span class="nav-number">1.4.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟代理模式实现图片预加载"><span class="nav-number">1.4.2.</span> <span class="nav-text">虚拟代理模式实现图片预加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟代理合并http请求"><span class="nav-number">1.4.3.</span> <span class="nav-text">虚拟代理合并http请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟代理在惰性加载中的应用"><span class="nav-number">1.4.4.</span> <span class="nav-text">虚拟代理在惰性加载中的应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存代理"><span class="nav-number">1.4.5.</span> <span class="nav-text">缓存代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用高阶函数动态创建缓存代理"><span class="nav-number">1.4.6.</span> <span class="nav-text">用高阶函数动态创建缓存代理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#迭代器模式"><span class="nav-number">1.5.</span> <span class="nav-text">迭代器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-3"><span class="nav-number">1.5.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迭代类数组对象和字面量对象"><span class="nav-number">1.5.2.</span> <span class="nav-text">迭代类数组对象和字面量对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#倒序迭代器"><span class="nav-number">1.5.3.</span> <span class="nav-text">倒序迭代器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迭代器模式实现上传空间选择"><span class="nav-number">1.5.4.</span> <span class="nav-text">迭代器模式实现上传空间选择</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#观察者模式"><span class="nav-number">1.6.</span> <span class="nav-text">观察者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-4"><span class="nav-number">1.6.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#观察者的通用实现"><span class="nav-number">1.6.2.</span> <span class="nav-text">观察者的通用实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用观察者模式实现网站登录"><span class="nav-number">1.6.3.</span> <span class="nav-text">使用观察者模式实现网站登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全局发布订阅-对象"><span class="nav-number">1.6.4.</span> <span class="nav-text">全局发布订阅-对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支持先发布后订阅、命名空间的观察者模式"><span class="nav-number">1.6.5.</span> <span class="nav-text">支持先发布后订阅、命名空间的观察者模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命令模式"><span class="nav-number">1.7.</span> <span class="nav-text">命令模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-5"><span class="nav-number">1.7.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#带撤销的命令模式"><span class="nav-number">1.7.2.</span> <span class="nav-text">带撤销的命令模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用命令模式实现重做"><span class="nav-number">1.7.3.</span> <span class="nav-text">使用命令模式实现重做</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#宏命令"><span class="nav-number">1.7.4.</span> <span class="nav-text">宏命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组合模式"><span class="nav-number">1.8.</span> <span class="nav-text">组合模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-6"><span class="nav-number">1.8.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组合模式-引用父对象"><span class="nav-number">1.8.2.</span> <span class="nav-text">组合模式-引用父对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模板方法模式"><span class="nav-number">1.9.</span> <span class="nav-text">模板方法模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-7"><span class="nav-number">1.9.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#钩子方法"><span class="nav-number">1.9.2.</span> <span class="nav-text">钩子方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板方法模式在js中的实现"><span class="nav-number">1.9.3.</span> <span class="nav-text">模板方法模式在js中的实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#享元模式"><span class="nav-number">1.10.</span> <span class="nav-text">享元模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-8"><span class="nav-number">1.10.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#享元模式重构上传"><span class="nav-number">1.10.2.</span> <span class="nav-text">享元模式重构上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对象池"><span class="nav-number">1.10.3.</span> <span class="nav-text">对象池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通用对象池"><span class="nav-number">1.10.4.</span> <span class="nav-text">通用对象池</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#职责链模式"><span class="nav-number">1.11.</span> <span class="nav-text">职责链模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-9"><span class="nav-number">1.11.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#灵活可拆分的职责链节点"><span class="nav-number">1.11.2.</span> <span class="nav-text">灵活可拆分的职责链节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步的职责链"><span class="nav-number">1.11.3.</span> <span class="nav-text">异步的职责链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用AOP实现职责链"><span class="nav-number">1.11.4.</span> <span class="nav-text">用AOP实现职责链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用职责链获取文件上传对象"><span class="nav-number">1.11.5.</span> <span class="nav-text">用职责链获取文件上传对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中介者模式"><span class="nav-number">1.12.</span> <span class="nav-text">中介者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-10"><span class="nav-number">1.12.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中介者模式改造泡泡堂游戏"><span class="nav-number">1.12.2.</span> <span class="nav-text">中介者模式改造泡泡堂游戏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#普通方法购买商品"><span class="nav-number">1.12.3.</span> <span class="nav-text">普通方法购买商品</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中介者模式购买商品"><span class="nav-number">1.12.4.</span> <span class="nav-text">中介者模式购买商品</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#装饰者模式"><span class="nav-number">1.13.</span> <span class="nav-text">装饰者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-11"><span class="nav-number">1.13.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#装饰函数"><span class="nav-number">1.13.2.</span> <span class="nav-text">装饰函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用AOP来装饰函数"><span class="nav-number">1.13.3.</span> <span class="nav-text">用AOP来装饰函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用AOP实现数据上报"><span class="nav-number">1.13.4.</span> <span class="nav-text">用AOP实现数据上报</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用AOP动态改变函数的参数"><span class="nav-number">1.13.5.</span> <span class="nav-text">用AOP动态改变函数的参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#利用AOP动态改变参数实现发送ajax前添加token"><span class="nav-number">1.13.6.</span> <span class="nav-text">利用AOP动态改变参数实现发送ajax前添加token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#插件式的表单验证"><span class="nav-number">1.13.7.</span> <span class="nav-text">插件式的表单验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOP的注意事项"><span class="nav-number">1.13.8.</span> <span class="nav-text">AOP的注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#状态模式"><span class="nav-number">1.14.</span> <span class="nav-text">状态模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-12"><span class="nav-number">1.14.1.</span> <span class="nav-text">基本定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式改进电灯程序"><span class="nav-number">1.14.2.</span> <span class="nav-text">状态模式改进电灯程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式的通用结构"><span class="nav-number">1.14.3.</span> <span class="nav-text">状态模式的通用结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式实现文件上传"><span class="nav-number">1.14.4.</span> <span class="nav-text">状态模式实现文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式重构文件上传"><span class="nav-number">1.14.5.</span> <span class="nav-text">状态模式重构文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式注意事项"><span class="nav-number">1.14.6.</span> <span class="nav-text">状态模式注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js版本的状态机"><span class="nav-number">1.14.7.</span> <span class="nav-text">js版本的状态机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用delegate函数实现状态机"><span class="nav-number">1.14.8.</span> <span class="nav-text">使用delegate函数实现状态机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表驱动的有限状态机"><span class="nav-number">1.14.9.</span> <span class="nav-text">表驱动的有限状态机</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#适配器模式"><span class="nav-number">1.15.</span> <span class="nav-text">适配器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-13"><span class="nav-number">1.15.1.</span> <span class="nav-text">基本定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单一职责原则"><span class="nav-number">1.16.</span> <span class="nav-text">单一职责原则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-14"><span class="nav-number">1.16.1.</span> <span class="nav-text">基本定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#最少知识原则"><span class="nav-number">1.17.</span> <span class="nav-text">最少知识原则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-15"><span class="nav-number">1.17.1.</span> <span class="nav-text">基本定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开放封闭原则"><span class="nav-number">1.18.</span> <span class="nav-text">开放封闭原则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-16"><span class="nav-number">1.18.1.</span> <span class="nav-text">基本定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接口和面向接口编程"><span class="nav-number">1.19.</span> <span class="nav-text">接口和面向接口编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-17"><span class="nav-number">1.19.1.</span> <span class="nav-text">基本定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码重构技巧"><span class="nav-number">1.20.</span> <span class="nav-text">代码重构技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本定义-18"><span class="nav-number">1.20.1.</span> <span class="nav-text">基本定义</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BryanAdamss</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


  

</body>
</html>
